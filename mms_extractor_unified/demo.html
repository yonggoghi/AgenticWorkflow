<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MMS Extractor API Demo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 30px;
            padding: 30px;
            min-height: 80vh;
        }

        .input-section {
            background: #f8fafc;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #e2e8f0;
        }

        .output-section {
            background: #f1f5f9;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #cbd5e1;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #334155;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #475569;
            font-size: 0.95rem;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-input:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }

        .form-select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 40px;
            appearance: none;
        }

        .parameters-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .checkbox-input {
            width: 18px;
            height: 18px;
            accent-color: #4f46e5;
        }

        .submit-btn {
            width: 100%;
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(79, 70, 229, 0.3);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .loading {
            display: none;
        }

        .result-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #e2e8f0;
            margin-bottom: 20px;
        }

        .result-tabs {
            display: flex;
            border-bottom: 2px solid #e2e8f0;
            margin-bottom: 20px;
        }

        .tab-button {
            padding: 12px 20px;
            background: none;
            border: none;
            font-weight: 600;
            color: #64748b;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab-button.active {
            color: #4f46e5;
            border-bottom-color: #4f46e5;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .json-viewer {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            overflow-x: auto;
            white-space: pre-wrap;
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .result-table th {
            background: #f8fafc;
            color: #374151;
            font-weight: 600;
            padding: 12px 16px;
            text-align: left;
            border-bottom: 2px solid #e5e7eb;
            font-size: 0.9rem;
        }

        .result-table td {
            padding: 12px 16px;
            border-bottom: 1px solid #f3f4f6;
            color: #374151;
            font-size: 0.9rem;
            vertical-align: top;
        }

        .result-table tr:last-child td {
            border-bottom: none;
        }

        .result-table tr:hover {
            background: #f9fafb;
        }

        .category-header {
            background: #4f46e5;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            padding: 16px;
            margin: 20px 0 10px 0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .category-header:first-child {
            margin-top: 0;
        }

        .result-value {
            font-weight: 500;
        }

        .result-value.empty {
            color: #9ca3af;
            font-style: italic;
        }

        .result-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .result-list li {
            padding: 4px 0;
            border-bottom: 1px solid #f3f4f6;
        }

        .result-list li:last-child {
            border-bottom: none;
        }

        .entity-dag-content {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 12px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.6;
            color: #374151;
            white-space: pre-wrap;
        }

        .dag-image-container {
            text-align: center;
            padding: 20px;
        }

        .dag-image {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .error-message {
            background: #fef2f2;
            color: #dc2626;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #fecaca;
            margin-bottom: 20px;
        }

        .success-message {
            background: #f0fdf4;
            color: #16a34a;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #bbf7d0;
            margin-bottom: 20px;
        }

        .metadata {
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            font-size: 0.9rem;
            color: #64748b;
        }

        .metadata-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .sample-messages {
            background: #fef7ff;
            border: 1px solid #e879f9;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .sample-title {
            font-weight: 600;
            color: #a21caf;
            margin-bottom: 10px;
        }

        .sample-item {
            background: white;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid #f3e8ff;
        }

        .sample-item:hover {
            background: #faf5ff;
            border-color: #c084fc;
        }

        .sample-item:last-child {
            margin-bottom: 0;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #ffffff;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }

            .parameters-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2rem;
            }
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 350px 1fr;
            }
        }

        .api-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .api-status.online {
            background: #f0fdf4;
            color: #16a34a;
            border: 1px solid #bbf7d0;
        }

        .api-status.offline {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-robot"></i> MMS Extractor API Demo</h1>
            <p>AI ê¸°ë°˜ MMS ê´‘ê³  ë©”ì‹œì§€ ì •ë³´ ì¶”ì¶œ ì„œë¹„ìŠ¤</p>
        </div>

        <div class="main-content">
            <!-- ì…ë ¥ ì„¹ì…˜ -->
            <div class="input-section">
                <h2 class="section-title">
                    <i class="fas fa-edit"></i>
                    ë©”ì‹œì§€ ì…ë ¥ ë° ì„¤ì •
                </h2>

                <div id="apiStatus" class="api-status offline">
                    <div class="status-indicator"></div>
                    API ì„œë²„ ìƒíƒœ í™•ì¸ ì¤‘...
                </div>

                <div class="sample-messages">
                    <div class="sample-title">
                        <i class="fas fa-lightbulb"></i> ìƒ˜í”Œ ë©”ì‹œì§€ (í´ë¦­í•˜ì—¬ ì‚¬ìš©)
                    </div>
                    <div class="sample-item" onclick="loadSample(0)">
                        [SKí…”ë ˆì½¤] ZEMí° í¬ì¼“ëª¬ì—ë””ì…˜3 ì•ˆë‚´ - ìš°ë¦¬ ì•„ì´ ì²« ë²ˆì§¸ ìŠ¤ë§ˆíŠ¸í°
                    </div>
                    <div class="sample-item" onclick="loadSample(1)">
                        [T world] 5G ìš”ê¸ˆì œ íŠ¹ê°€ í˜œíƒ - ì›” 39,000ì› í• ì¸
                    </div>
                    <div class="sample-item" onclick="loadSample(2)">
                        [SKí…”ë ˆì½¤] ê°¤ëŸ­ì‹œ S24 ì‚¬ì „ì˜ˆì•½ - ìµœëŒ€ 30ë§Œì› í• ì¸
                    </div>
                </div>

                <form id="extractionForm">
                    <div class="form-group">
                        <label class="form-label" for="message">MMS ë©”ì‹œì§€ ë‚´ìš© *</label>
                        <textarea id="message" class="form-input form-textarea" 
                                placeholder="ì¶”ì¶œí•˜ê³  ì‹¶ì€ MMS ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." 
                                required></textarea>
                    </div>

                    <div class="parameters-grid">
                        <div class="form-group">
                            <label class="form-label" for="llmModel">LLM ëª¨ë¸</label>
                            <select id="llmModel" class="form-input form-select">
                                <option value="ax">A.X (SKT)</option>
                                <option value="gemma">Gemma</option>
                                <option value="claude">Claude</option>
                                <option value="gemini">Gemini</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="dataSource">ë°ì´í„° ì†ŒìŠ¤</label>
                            <select id="dataSource" class="form-input form-select">
                                <option value="local">Local (CSV)</option>
                                <option value="db">Database</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="productMode">ìƒí’ˆ ì¶”ì¶œ ëª¨ë“œ</label>
                            <select id="productMode" class="form-input form-select">
                                <option value="nlp">NLP (í˜•íƒœì†Œ ë¶„ì„)</option>
                                <option value="llm">LLM ê¸°ë°˜</option>
                                <option value="rag">RAG (ê²€ìƒ‰ì¦ê°•)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="entityMode">ê°œì²´ëª… ì¶”ì¶œ ëª¨ë“œ</label>
                            <select id="entityMode" class="form-input form-select">
                                <option value="logic">í†µí•© LLM ê¸°ë°˜</option>
                                <option value="llm">ë³„ë„ LLM ê¸°ë°˜</option>
                            </select>
                        </div>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="extractDag" class="checkbox-input">
                        <label for="extractDag" class="form-label">ì˜¤í¼ ê´€ê³„ DAG ì¶”ì¶œ</label>
                    </div>

                    <button type="submit" class="submit-btn" id="submitBtn">
                        <i class="fas fa-play"></i>
                        <span class="btn-text">ì •ë³´ ì¶”ì¶œ ì‹¤í–‰</span>
                        <div class="spinner loading"></div>
                    </button>
                </form>
            </div>

            <!-- ê²°ê³¼ ì„¹ì…˜ -->
            <div class="output-section">
                <h2 class="section-title">
                    <i class="fas fa-chart-bar"></i>
                    ì‘ì—… ê²°ê³¼
                </h2>

                <div id="resultsContainer" style="display: none;">
                    <div class="result-tabs">
                        <button class="tab-button active" onclick="switchTab('extracted')">
                            <i class="fas fa-table"></i> ì¶”ì¶œ ì •ë³´
                        </button>
                        <button class="tab-button" onclick="switchTab('json')">
                            <i class="fas fa-code"></i> ì¶”ì¶œ JSON
                        </button>
                        <button class="tab-button" onclick="switchTab('dag')" id="dagTabButton">
                            <i class="fas fa-project-diagram"></i> DAG ì´ë¯¸ì§€
                        </button>
                        <button class="tab-button" onclick="switchTab('metadata')">
                            <i class="fas fa-info-circle"></i> ë©”íƒ€ë°ì´í„°
                        </button>
                    </div>

                    <div id="extractedTab" class="tab-content active">
                        <div class="result-container">
                            <div id="extractedResult" style="background: #f8fafc; padding: 20px; border-radius: 8px;"></div>
                        </div>
                    </div>

                    <div id="jsonTab" class="tab-content">
                        <div class="result-container">
                            <pre id="jsonResult" class="json-viewer"></pre>
                        </div>
                    </div>

                    <div id="dagTab" class="tab-content">
                        <div class="result-container">
                            <div id="dagImageContainer" class="dag-image-container">
                                <div style="text-align: center; padding: 40px; color: #64748b;">
                                    <i class="fas fa-image" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                                    <p>DAG ì´ë¯¸ì§€ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                                    <p style="font-size: 0.9rem; margin-top: 10px;">ë©”ì‹œì§€ë¥¼ ì¶”ì¶œí•˜ë©´ ìë™ìœ¼ë¡œ ì´ë¯¸ì§€ê°€ ë¡œë“œë©ë‹ˆë‹¤.</p>
                                    <button onclick="testExistingImage()" style="margin-top: 15px; background: #f59e0b; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
                                        ğŸ§ª ê¸°ì¡´ ì´ë¯¸ì§€ë¡œ í…ŒìŠ¤íŠ¸
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="metadataTab" class="tab-content">
                        <div class="result-container">
                            <div id="metadataContent" class="metadata"></div>
                        </div>
                    </div>
                </div>

                <div id="noResults" class="result-container">
                    <div style="text-align: center; color: #64748b; padding: 40px;">
                        <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                        <p>ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ê³  'ì •ë³´ ì¶”ì¶œ ì‹¤í–‰' ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ìƒ˜í”Œ ë©”ì‹œì§€ ë°ì´í„°
        const sampleMessages = [
            `[SKí…”ë ˆì½¤] ZEMí° í¬ì¼“ëª¬ì—ë””ì…˜3 ì•ˆë‚´
(ê´‘ê³ )[SKT] ìš°ë¦¬ ì•„ì´ ì²« ë²ˆì§¸ ìŠ¤ë§ˆíŠ¸í°, ZEM í‚¤ì¦ˆí°__#04 ê³ ê°ë‹˜, ì•ˆë…•í•˜ì„¸ìš”!
ìš°ë¦¬ ì•„ì´ ìŠ¤ë§ˆíŠ¸í° ê³ ë¯¼ ì¤‘ì´ì…¨ë‹¤ë©´, ìë…€ ìŠ¤ë§ˆíŠ¸í° ê´€ë¦¬ ì•± ZEMì´ ì„¤ì¹˜ëœ SKTë§Œì˜ ì•ˆì „í•œ í‚¤ì¦ˆí°,
ZEMí° í¬ì¼“ëª¬ì—ë””ì…˜3ìœ¼ë¡œ ìš°ë¦¬ ì•„ì´ ì·¨í–¥ì„ ì €ê²©í•´ ë³´ì„¸ìš”!

âœ¨ íŠ¹ë³„ í˜œíƒ
- ì›” ìš”ê¸ˆ 20% í• ì¸ (ì²« 6ê°œì›”)
- í¬ì¼“ëª¬ ì¼€ì´ìŠ¤ ë¬´ë£Œ ì¦ì •
- ZEM í”„ë¦¬ë¯¸ì—„ ì„œë¹„ìŠ¤ 3ê°œì›” ë¬´ë£Œ

ğŸ“ ë¬¸ì˜: 1588-0011 (í‰ì¼ 9ì‹œ-18ì‹œ)
ğŸª ê°€ê¹Œìš´ T world ë§¤ì¥ ë°©ë¬¸
ğŸŒ www.tworld.co.kr

ìˆ˜ì‹ ê±°ë¶€ 080-011-0000`,

            `[T world] 5G ìš”ê¸ˆì œ íŠ¹ê°€ í˜œíƒ
(ê´‘ê³ ) 5G ìŠˆí¼í”Œëœ íŠ¹ê°€ ì´ë²¤íŠ¸ ì§„í–‰ ì¤‘!

ğŸ¯ ì´ë‹¬ì˜ íŠ¹ê°€
- 5G ìŠˆí¼í”Œëœ (ë°ì´í„° ë¬´ì œí•œ): ì›” 79,000ì› â†’ 39,000ì› (50% í• ì¸)
- ê°€ì¡± ì¶”ê°€ íšŒì„ : ì›” 29,000ì›
- YouTube Premium 6ê°œì›” ë¬´ë£Œ

ğŸ“… ì´ë²¤íŠ¸ ê¸°ê°„: 2024.01.01 ~ 2024.01.31
ğŸ ì‹ ê·œ ê°€ì… ì‹œ ê°¤ëŸ­ì‹œ ë²„ì¦ˆ ì¦ì •

ì˜¨ë¼ì¸ ê°€ì…: m.tworld.co.kr
ë§¤ì¥ ë°©ë¬¸: ì „êµ­ T world ë§¤ì¥
ê³ ê°ì„¼í„°: 114

ìˆ˜ì‹ ê±°ë¶€ 080-011-0000`,

            `[SKí…”ë ˆì½¤] ê°¤ëŸ­ì‹œ S24 ì‚¬ì „ì˜ˆì•½
(ê´‘ê³ ) ê°¤ëŸ­ì‹œ S24 ì‹œë¦¬ì¦ˆ ì‚¬ì „ì˜ˆì•½ ì‹œì‘!

ğŸŒŸ ì‚¬ì „ì˜ˆì•½ í˜œíƒ
- ê°¤ëŸ­ì‹œ S24 Ultra: ìµœëŒ€ 30ë§Œì› í• ì¸
- ê°¤ëŸ­ì‹œ S24+: ìµœëŒ€ 25ë§Œì› í• ì¸  
- ê°¤ëŸ­ì‹œ S24: ìµœëŒ€ 20ë§Œì› í• ì¸

ğŸ ì¶”ê°€ í˜œíƒ
- ê°¤ëŸ­ì‹œ ì›Œì¹˜6 50% í• ì¸
- ë¬´ì„ ì¶©ì „ê¸° ë¬´ë£Œ ì¦ì •
- ì¼€ì–´í”ŒëŸ¬ìŠ¤ 6ê°œì›” ë¬´ë£Œ

ğŸ“… ì‚¬ì „ì˜ˆì•½: 2024.01.10 ~ 2024.01.24
ğŸ“± ì¶œì‹œì¼: 2024.01.31

T world ì•±ì—ì„œ ê°„í¸ ì˜ˆì•½
ë§¤ì¥ ì˜ˆì•½: tworldfriends.co.kr/D123456789
ë¬¸ì˜: 1588-0011

ìˆ˜ì‹ ê±°ë¶€ 080-011-0000`
        ];

        // API ê¸°ë³¸ ì„¤ì •
        const API_BASE_URL = 'http://localhost:8000';  // MMS Extractor API
        const DEMO_API_BASE_URL = 'http://localhost:8080';  // Demo Server API (for DAG images)
        let apiOnline = false;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ API ìƒíƒœ í™•ì¸
        document.addEventListener('DOMContentLoaded', function() {
            checkApiStatus();
            
            // í¼ ì œì¶œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('extractionForm').addEventListener('submit', handleSubmit);
            
            // DAG íƒ­ì„ ê¸°ë³¸ìœ¼ë¡œ í‘œì‹œ (í…ŒìŠ¤íŠ¸ìš©)
            showDagTab();
            console.log('ğŸ¯ DAG íƒ­ì´ ê¸°ë³¸ìœ¼ë¡œ í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤.');
        });

        // API ìƒíƒœ í™•ì¸
        async function checkApiStatus() {
            const statusElement = document.getElementById('apiStatus');
            
            try {
                const response = await fetch(`${API_BASE_URL}/health`, {
                    method: 'GET',
                    timeout: 5000
                });
                
                if (response.ok) {
                    apiOnline = true;
                    statusElement.className = 'api-status online';
                    statusElement.innerHTML = '<div class="status-indicator"></div>API ì„œë²„ ì˜¨ë¼ì¸';
                } else {
                    throw new Error('API ì‘ë‹µ ì˜¤ë¥˜');
                }
            } catch (error) {
                apiOnline = false;
                statusElement.className = 'api-status offline';
                statusElement.innerHTML = '<div class="status-indicator"></div>API ì„œë²„ ì˜¤í”„ë¼ì¸ (localhost:8000 í™•ì¸ í•„ìš”)';
            }
        }

        // ìƒ˜í”Œ ë©”ì‹œì§€ ë¡œë“œ
        function loadSample(index) {
            if (index >= 0 && index < sampleMessages.length) {
                document.getElementById('message').value = sampleMessages[index];
                
                // ìƒ˜í”Œì— ë”°ë¼ ì ì ˆí•œ ì„¤ì • ì ìš©
                if (index === 0) {
                    document.getElementById('extractDag').checked = true;
                } else if (index === 1) {
                    document.getElementById('llmModel').value = 'claude';
                    document.getElementById('productMode').value = 'llm';
                } else if (index === 2) {
                    document.getElementById('entityMode').value = 'llm';
                }
            }
        }

        // í¼ ì œì¶œ ì²˜ë¦¬
        async function handleSubmit(event) {
            event.preventDefault();
            
            if (!apiOnline) {
                showError('API ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.');
                return;
            }

            const submitBtn = document.getElementById('submitBtn');
            const btnText = submitBtn.querySelector('.btn-text');
            const spinner = submitBtn.querySelector('.spinner');
            
            // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
            submitBtn.disabled = true;
            btnText.textContent = 'ì²˜ë¦¬ ì¤‘...';
            spinner.style.display = 'block';

            // í¼ ë°ì´í„° ìˆ˜ì§‘
            const formData = {
                message: document.getElementById('message').value,
                llm_model: document.getElementById('llmModel').value,
                offer_info_data_src: document.getElementById('dataSource').value,
                product_info_extraction_mode: document.getElementById('productMode').value,
                entity_matching_mode: document.getElementById('entityMode').value,
                extract_entity_dag: document.getElementById('extractDag').checked
            };

            try {
                const response = await fetch(`${API_BASE_URL}/extract`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    displayResults(result);
                    showSuccess('ì •ë³´ ì¶”ì¶œì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                } else {
                    showError(result.error || 'ì¶”ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('API í˜¸ì¶œ ì˜¤ë¥˜:', error);
                showError('API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            } finally {
                // ë²„íŠ¼ ìƒíƒœ ë³µì›
                submitBtn.disabled = false;
                btnText.textContent = 'ì •ë³´ ì¶”ì¶œ ì‹¤í–‰';
                spinner.style.display = 'none';
            }
        }

        // ê²°ê³¼ í‘œì‹œ
        function displayResults(data) {
            const resultsContainer = document.getElementById('resultsContainer');
            const noResults = document.getElementById('noResults');
            
            // ê²°ê³¼ ì»¨í…Œì´ë„ˆ í‘œì‹œ
            resultsContainer.style.display = 'block';
            noResults.style.display = 'none';

            // ì¶”ì¶œ ê²°ê³¼ í‘œì‹œ (êµ¬ì¡°í™”ëœ í…Œì´ë¸”)
            const extractedResult = document.getElementById('extractedResult');
            extractedResult.innerHTML = formatExtractedResults(data.result);

            // JSON ê²°ê³¼ í‘œì‹œ (ì›ë³¸ JSON)
            const jsonResult = document.getElementById('jsonResult');
            jsonResult.textContent = JSON.stringify(data.result, null, 2);

            // ë©”íƒ€ë°ì´í„° í‘œì‹œ
            const metadataContent = document.getElementById('metadataContent');
            metadataContent.innerHTML = `
                <div class="metadata-item">
                    <span>LLM ëª¨ë¸:</span>
                    <span>${data.metadata.llm_model}</span>
                </div>
                <div class="metadata-item">
                    <span>ë°ì´í„° ì†ŒìŠ¤:</span>
                    <span>${data.metadata.offer_info_data_src}</span>
                </div>
                <div class="metadata-item">
                    <span>ìƒí’ˆ ì¶”ì¶œ ëª¨ë“œ:</span>
                    <span>${data.metadata.product_info_extraction_mode}</span>
                </div>
                <div class="metadata-item">
                    <span>ê°œì²´ëª… ì¶”ì¶œ ëª¨ë“œ:</span>
                    <span>${data.metadata.entity_matching_mode}</span>
                </div>
                <div class="metadata-item">
                    <span>DAG ì¶”ì¶œ:</span>
                    <span>${data.metadata.extract_entity_dag ? 'Yes' : 'No'}</span>
                </div>
                <div class="metadata-item">
                    <span>ì²˜ë¦¬ ì‹œê°„:</span>
                    <span>${data.metadata.processing_time_seconds}ì´ˆ</span>
                </div>
                <div class="metadata-item">
                    <span>ë©”ì‹œì§€ ê¸¸ì´:</span>
                    <span>${data.metadata.message_length}ì</span>
                </div>
            `;

            // DAG ì´ë¯¸ì§€ ì²˜ë¦¬
            if (data.metadata.extract_entity_dag && data.result.entity_dag) {
                showDagTab();
                
                // í˜„ì¬ ë©”ì‹œì§€ì˜ í•´ì‹œë¥¼ ê³„ì‚°í•˜ì—¬ ë™ì ìœ¼ë¡œ ì´ë¯¸ì§€ ë¡œë“œ
                const currentMessage = document.getElementById('message').value;
                console.log('DAG ì´ë¯¸ì§€ ë™ì  ë¡œë“œ ì‹œì‘...');
                loadDagImageForMessage(currentMessage);
            } else {
                hideDagTab();
            }
        }

        // íŠ¹ì • ë©”ì‹œì§€ì— ëŒ€í•œ DAG ì´ë¯¸ì§€ ë¡œë“œ (ì„œë²„ì˜ í•´ì‹œ ê³„ì‚° API ì‚¬ìš©)
        async function loadDagImageForMessage(message) {
            const dagContainer = document.getElementById('dagImageContainer');
            
            try {
                // ì„œë²„ì—ì„œ í•´ì‹œ ê³„ì‚° ë° ì´ë¯¸ì§€ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
                const response = await fetch(`${DEMO_API_BASE_URL}/api/calculate-hash`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: message })
                });
                
                if (!response.ok) {
                    throw new Error('í•´ì‹œ ê³„ì‚° API í˜¸ì¶œ ì‹¤íŒ¨');
                }
                
                const hashData = await response.json();
                console.log('ì„œë²„ í•´ì‹œ ê³„ì‚° ê²°ê³¼:', hashData);
                console.log('ì´ë¯¸ì§€ ì¡´ì¬ ì—¬ë¶€:', hashData.image_exists);
                console.log('ì´ë¯¸ì§€ URL:', hashData.url);
                
                if (hashData.image_exists) {
                    // ì´ë¯¸ì§€ê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš°
                    console.log('ğŸ¯ ì´ë¯¸ì§€ ì¡´ì¬ í™•ì¸ë¨, URL:', hashData.url);
                    console.log('ğŸ¯ ì™„ì „í•œ ì´ë¯¸ì§€ URL:', `${DEMO_API_BASE_URL}${hashData.url}`);
                    
                    // simple_test.htmlê³¼ ë™ì¼í•œ ê°„ë‹¨í•œ ë°©ì‹ìœ¼ë¡œ ì´ë¯¸ì§€ í‘œì‹œ
                    dagContainer.innerHTML = `
                        <div style="text-align: center; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <h4 style="color: #4f46e5; margin-bottom: 15px;">
                                <i class="fas fa-project-diagram"></i> ì˜¤í¼ ê´€ê³„ ê·¸ë˜í”„ (DAG)
                            </h4>

                            <img src="${DEMO_API_BASE_URL}${hashData.url}" 
                                 alt="DAG ì´ë¯¸ì§€" 
                                 style="max-width: 100%; height: auto; border: 1px solid #ddd; border-radius: 5px;"
                                 onload="console.log('âœ… DAG ì´ë¯¸ì§€ ë¡œë“œ ì„±ê³µ'); this.style.border='2px solid #10b981';"
                                 onerror="console.error('âŒ DAG ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨'); this.style.display='none'; this.parentElement.innerHTML += '<p style=color:red;>ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨</p>';">
                            <div style="margin-top: 15px; padding: 10px; background: #f0f9ff; border-radius: 8px;">
                                <p style="color: #0369a1; font-size: 0.9rem; margin: 0;">
                                    <i class="fas fa-lightbulb"></i>
                                    ì´ ê·¸ë˜í”„ëŠ” ë©”ì‹œì§€ì—ì„œ ì¶”ì¶œëœ ì˜¤í¼ ìƒí’ˆë“¤ ê°„ì˜ ê´€ê³„ë¥¼ ì‹œê°í™”í•œ ê²ƒì…ë‹ˆë‹¤.
                                </p>
                            </div>
                        </div>
                    `;

                } else {
                    // ì´ë¯¸ì§€ê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš°
                    console.log('âš ï¸ ì´ë¯¸ì§€ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŒ. ëŒ€ê¸° ë©”ì‹œì§€ í‘œì‹œ');
                    console.log('âš ï¸ ì˜ˆìƒ íŒŒì¼ëª…:', hashData.expected_filename);
                    dagContainer.innerHTML = `
                        <div style="text-align: center; padding: 40px; background: #fef3c7; border-radius: 10px; border: 2px dashed #f59e0b;">
                            <i class="fas fa-hourglass-half" style="font-size: 2.5rem; color: #f59e0b; margin-bottom: 15px;"></i>
                            <h4 style="color: #92400e; margin-bottom: 10px;">DAG ì´ë¯¸ì§€ ëŒ€ê¸° ì¤‘</h4>
                            <p style="color: #b45309; margin-bottom: 15px;">
                                í•´ë‹¹ ë©”ì‹œì§€ì˜ DAG ì´ë¯¸ì§€ê°€ ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br>
                                ì˜ˆìƒ íŒŒì¼ëª…: ${hashData.expected_filename}
                            </p>
                            <button onclick="loadDagImageForMessage(document.getElementById('message').value)" 
                                    style="background: #f59e0b; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
                                <i class="fas fa-refresh"></i> ë‹¤ì‹œ í™•ì¸
                            </button>
                            <p style="color: #a16207; font-size: 0.8rem; margin-top: 10px;">
                                DAG ì¶”ì¶œì´ ì™„ë£Œë˜ë©´ ì´ë¯¸ì§€ê°€ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.
                            </p>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('ë©”ì‹œì§€ë³„ DAG ì´ë¯¸ì§€ ë¡œë“œ ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ ë°œìƒ ì‹œ ì¼ë°˜ì ì¸ ìµœì‹  ì´ë¯¸ì§€ ë¡œë“œë¡œ í´ë°±
                dagContainer.innerHTML = `
                    <div style="text-align: center; padding: 30px; background: #fef2f2; border-radius: 10px; border: 1px solid #fecaca;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 2rem; color: #dc2626; margin-bottom: 10px;"></i>
                        <p style="color: #dc2626; margin-bottom: 10px;">íŠ¹ì • DAG ì´ë¯¸ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                        <button onclick="loadDagImage()" style="background: #dc2626; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
                            <i class="fas fa-images"></i> ìµœì‹  ì´ë¯¸ì§€ ë³´ê¸°
                        </button>
                    </div>
                `;
            }
        }

        // ì¼ë°˜ì ì¸ ìµœì‹  DAG ì´ë¯¸ì§€ ë¡œë“œ
        async function loadDagImage() {
            const dagContainer = document.getElementById('dagImageContainer');
            
            try {
                // ìµœì‹  DAG ì´ë¯¸ì§€ ìš”ì²­
                const response = await fetch(`${DEMO_API_BASE_URL}/api/latest-dag-image`);
                
                if (response.ok) {
                    const imageData = await response.json();
                    const imageUrl = imageData.url;
                    const filename = imageData.filename;
                    
                    dagContainer.innerHTML = `
                        <div style="margin-bottom: 15px;">
                            <h4 style="color: #4f46e5; margin-bottom: 10px;">
                                <i class="fas fa-project-diagram"></i> ì˜¤í¼ ê´€ê³„ ê·¸ë˜í”„ (DAG)
                            </h4>
                        </div>
                        <img src="${DEMO_API_BASE_URL}${imageUrl}" alt="DAG ì´ë¯¸ì§€" class="dag-image" 
                             onload="this.style.opacity=1" 
                             onerror="this.parentElement.innerHTML='<p style=color:#dc2626;><i class=fas fa-exclamation-triangle></i> ì´ë¯¸ì§€ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>'"
                             style="opacity: 0; transition: opacity 0.3s ease;">
                        <div style="margin-top: 15px; padding: 10px; background: #f0f9ff; border-radius: 8px; border: 1px solid #bae6fd;">
                            <p style="color: #0369a1; font-size: 0.9rem; margin: 0;">
                                <i class="fas fa-info-circle"></i>
                                ì´ ê·¸ë˜í”„ëŠ” ë©”ì‹œì§€ì—ì„œ ì¶”ì¶œëœ ì—”í‹°í‹°ë“¤ ê°„ì˜ ê´€ê³„ë¥¼ ì‹œê°í™”í•œ ê²ƒì…ë‹ˆë‹¤.
                            </p>
                        </div>
                    `;
                } else {
                    // ì´ë¯¸ì§€ê°€ ì—†ëŠ” ê²½ìš°
                    dagContainer.innerHTML = `
                        <div style="text-align: center; padding: 40px; background: #f8fafc; border-radius: 10px; border: 2px dashed #cbd5e1;">
                            <i class="fas fa-image" style="font-size: 2.5rem; color: #94a3b8; margin-bottom: 15px;"></i>
                            <h4 style="color: #64748b; margin-bottom: 10px;">DAG ì´ë¯¸ì§€ ìƒì„± ì¤‘</h4>
                            <p style="color: #94a3b8; margin-bottom: 15px;">
                                ì˜¤í¼ ê´€ê³„ ê·¸ë˜í”„ê°€ ìƒì„±ë˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                            </p>
                            <button onclick="loadDagImage()" style="background: #4f46e5; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
                                <i class="fas fa-refresh"></i> ìƒˆë¡œê³ ì¹¨
                            </button>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('DAG ì´ë¯¸ì§€ ë¡œë“œ ì˜¤ë¥˜:', error);
                dagContainer.innerHTML = `
                    <div style="text-align: center; padding: 30px; background: #fef2f2; border-radius: 10px; border: 1px solid #fecaca;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 2rem; color: #dc2626; margin-bottom: 10px;"></i>
                        <p style="color: #dc2626;">DAG ì´ë¯¸ì§€ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p style="color: #991b1b; font-size: 0.9rem;">ì„œë²„ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
                    </div>
                `;
            }
        }

        // DAG íƒ­ í‘œì‹œ
        function showDagTab() {
            console.log('ğŸ”„ DAG íƒ­ í‘œì‹œ ì¤‘...');
            const dagTab = document.getElementById('dagTabButton');
            if (dagTab) {
                dagTab.style.display = 'block';
                console.log('âœ… DAG íƒ­ ë²„íŠ¼ í‘œì‹œë¨');
            } else {
                console.error('âŒ DAG íƒ­ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }
        }

        // DAG íƒ­ ìˆ¨ê¹€
        function hideDagTab() {
            console.log('ğŸ”„ DAG íƒ­ ìˆ¨ê¹€ ì¤‘...');
            const dagTab = document.getElementById('dagTabButton');
            if (dagTab) {
                dagTab.style.display = 'none';
                console.log('âœ… DAG íƒ­ ë²„íŠ¼ ìˆ¨ê¹€ë¨');
            }
        }

        // ê°•ì œë¡œ DAG íƒ­ í‘œì‹œ ë° í™œì„±í™” (ë””ë²„ê¹…ìš©)
        function forceShowDagTab() {
            console.log('ğŸ”§ ê°•ì œë¡œ DAG íƒ­ í‘œì‹œ ë° í™œì„±í™”...');
            
            // 1. DAG íƒ­ ë²„íŠ¼ í‘œì‹œ
            showDagTab();
            
            // 2. DAG íƒ­ìœ¼ë¡œ ì „í™˜
            switchTab('dag');
            
            // 3. DAG íƒ­ì´ ì œëŒ€ë¡œ í™œì„±í™”ë˜ì—ˆëŠ”ì§€ í™•ì¸
            const dagTabContent = document.getElementById('dagTab');
            if (dagTabContent) {
                console.log('âœ… DAG íƒ­ ë‚´ìš© í™œì„±í™”ë¨');
                dagTabContent.style.display = 'block';  // ê°•ì œë¡œ í‘œì‹œ
                dagTabContent.classList.add('active');   // active í´ë˜ìŠ¤ ì¶”ê°€
            } else {
                console.error('âŒ DAG íƒ­ ë‚´ìš©ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }
            
            // 4. DAG íƒ­ ë²„íŠ¼ë„ activeë¡œ ì„¤ì •
            const dagTabButton = document.getElementById('dagTabButton');
            if (dagTabButton) {
                dagTabButton.classList.add('active');
                console.log('âœ… DAG íƒ­ ë²„íŠ¼ í™œì„±í™”ë¨');
            }
        }

        // íƒ­ ì „í™˜
        function switchTab(tabName) {
            console.log('íƒ­ ì „í™˜ ì‹œì‘:', tabName);
            
            // ëª¨ë“  íƒ­ ë²„íŠ¼ì˜ active í´ë˜ìŠ¤ ì œê±°
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // ëª¨ë“  íƒ­ ë‚´ìš© ìˆ¨ê¹€
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ì„ íƒëœ íƒ­ ë²„íŠ¼ í™œì„±í™” (event ê°ì²´ê°€ ìˆì„ ë•Œë§Œ)
            if (typeof event !== 'undefined' && event.target) {
                event.target.classList.add('active');
            } else {
                // eventê°€ ì—†ì„ ë•ŒëŠ” í•´ë‹¹ íƒ­ ë²„íŠ¼ì„ ì§ì ‘ ì°¾ì•„ì„œ í™œì„±í™”
                const targetButton = document.querySelector(`[onclick="switchTab('${tabName}')"]`);
                if (targetButton) {
                    targetButton.classList.add('active');
                }
            }
            
            // ì„ íƒëœ íƒ­ ë‚´ìš© í‘œì‹œ
            const targetTab = document.getElementById(tabName + 'Tab');
            if (targetTab) {
                targetTab.classList.add('active');
                console.log('âœ… íƒ­ í™œì„±í™” ì™„ë£Œ:', tabName);
                
                // DAG íƒ­ì´ í™œì„±í™”ë˜ë©´ ìë™ìœ¼ë¡œ ì´ë¯¸ì§€ ë¡œë“œ
                if (tabName === 'dag') {
                    console.log('ğŸ”„ DAG íƒ­ í™œì„±í™”ë¨, ìë™ ì´ë¯¸ì§€ ë¡œë“œ ì‹œì‘...');
                    const messageInput = document.getElementById('message');
                    if (messageInput && messageInput.value.trim()) {
                        loadDagImageForMessage(messageInput.value);
                    } else {
                        console.log('âš ï¸ ë©”ì‹œì§€ê°€ ì—†ì–´ì„œ ì´ë¯¸ì§€ ë¡œë“œë¥¼ ê±´ë„ˆëœë‹ˆë‹¤.');
                    }
                }
            } else {
                console.error('âŒ íƒ­ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ:', tabName + 'Tab');
            }
        }

        // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
        function showSuccess(message) {
            const existingMessage = document.querySelector('.success-message');
            if (existingMessage) {
                existingMessage.remove();
            }

            const successDiv = document.createElement('div');
            successDiv.className = 'success-message';
            successDiv.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
            
            const resultsContainer = document.getElementById('resultsContainer');
            resultsContainer.insertBefore(successDiv, resultsContainer.firstChild);

            // 3ì´ˆ í›„ ìë™ ì œê±°
            setTimeout(() => {
                if (successDiv.parentNode) {
                    successDiv.remove();
                }
            }, 3000);
        }

        // ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
        function showError(message) {
            const existingMessage = document.querySelector('.error-message');
            if (existingMessage) {
                existingMessage.remove();
            }

            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${message}`;
            
            const outputSection = document.querySelector('.output-section');
            const sectionTitle = outputSection.querySelector('.section-title');
            outputSection.insertBefore(errorDiv, sectionTitle.nextSibling);

            // 5ì´ˆ í›„ ìë™ ì œê±°
            setTimeout(() => {
                if (errorDiv.parentNode) {
                    errorDiv.remove();
                }
            }, 5000);
        }

        // ì£¼ê¸°ì ìœ¼ë¡œ API ìƒíƒœ í™•ì¸ (30ì´ˆë§ˆë‹¤)
        setInterval(checkApiStatus, 30000);

        // JSONì„ ë™ì ìœ¼ë¡œ í…Œì´ë¸” í˜•íƒœë¡œ í¬ë§·íŒ…
        function formatExtractedResults(result) {
            if (!result || typeof result !== 'object') {
                return '<div class="result-value empty">ì¶”ì¶œëœ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            }

            return generateTableFromObject(result);
        }

        // í‚¤ë“¤ì„ ì›í•˜ëŠ” ìˆœì„œë¡œ ì •ë ¬í•˜ëŠ” í•¨ìˆ˜
        function getOrderedKeys(keys) {
            // ì›í•˜ëŠ” í‘œì‹œ ìˆœì„œ ì •ì˜
            const preferredOrder = [
                'title',
                'purpose', 
                'product',  // 'produdt' ì˜¤íƒ€ ëŒ€ë¹„í•´ì„œ 'product'ë„ í¬í•¨
                'produdt',  // ì›ë³¸ ì˜¤íƒ€ ë²„ì „
                'channel',
                'pgm',
                'entity_dag'
            ];
            
            const orderedKeys = [];
            const remainingKeys = [...keys];
            
            // 1. ì„ í˜¸í•˜ëŠ” ìˆœì„œëŒ€ë¡œ í‚¤ë“¤ì„ ë¨¼ì € ì¶”ê°€
            preferredOrder.forEach(preferredKey => {
                const index = remainingKeys.indexOf(preferredKey);
                if (index !== -1) {
                    orderedKeys.push(preferredKey);
                    remainingKeys.splice(index, 1);  // ì²˜ë¦¬ëœ í‚¤ëŠ” ì œê±°
                }
            });
            
            // 2. ë‚¨ì€ í‚¤ë“¤ì„ ì•ŒíŒŒë²³ ìˆœì„œë¡œ ë’¤ì— ì¶”ê°€ (ìƒˆë¡œìš´ í‚¤ë“¤ ëŒ€ì‘)
            remainingKeys.sort().forEach(key => {
                orderedKeys.push(key);
            });
            
            return orderedKeys;
        }

        // ê°ì²´ë¥¼ ì¬ê·€ì ìœ¼ë¡œ í…Œì´ë¸”ë¡œ ë³€í™˜
        function generateTableFromObject(obj, depth = 0) {
            if (!obj || typeof obj !== 'object') {
                return formatValue(obj);
            }

            let html = '';
            const keys = Object.keys(obj);
            
            // ì›í•˜ëŠ” ìˆœì„œë¡œ í‚¤ ì •ë ¬
            const orderedKeys = getOrderedKeys(keys);
            
            if (orderedKeys.length === 0) {
                return '<div class="result-value empty">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            }

            orderedKeys.forEach((key, index) => {
                const value = obj[key];
                const categoryIcon = getCategoryIcon(key);
                
                // ì¹´í…Œê³ ë¦¬ í—¤ë” (ìµœìƒìœ„ ë ˆë²¨ë§Œ)
                if (depth === 0) {
                    html += `
                        <div class="category-header">
                            <i class="fas ${categoryIcon}"></i> ${key}
                        </div>
                    `;
                }
                
                html += `
                    <table class="result-table">
                        <thead>
                            <tr>
                                <th style="width: 10%;">NO</th>
                                <th>ë‚´ìš©</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                const isEntityDag = key === 'entity_dag';
                
                if (value && typeof value === 'object' && !Array.isArray(value)) {
                    // ì¤‘ì²© ê°ì²´ì¸ ê²½ìš° - í•˜ìœ„ í‚¤ë“¤ì„ í–‰ìœ¼ë¡œ í‘œì‹œ
                    Object.keys(value).forEach((subKey, index) => {
                        html += addTableRowWithNumber(index + 1, `<strong>${subKey}:</strong> ${formatValue(value[subKey])}`, isEntityDag);
                    });
                } else if (Array.isArray(value)) {
                    // ë°°ì—´ì¸ ê²½ìš° - ê° í•­ëª©ì— ìˆœë²ˆ í‘œì‹œ
                    value.forEach((item, index) => {
                        html += addTableRowWithNumber(index + 1, formatValue(item), isEntityDag);
                    });
                } else {
                    // ë‹¨ìˆœ ê°’ì¸ ê²½ìš°
                    html += addTableRowWithNumber(1, formatValue(value), isEntityDag);
                }
                
                html += '</tbody></table>';
            });

            return html;
        }

        // ì¹´í…Œê³ ë¦¬ë³„ ì•„ì´ì½˜ ë§¤í•‘
        function getCategoryIcon(key) {
            const iconMap = {
                // ê¸°ì¡´ í•œêµ­ì–´ í‚¤
                'ê´‘ê³ _ì •ë³´': 'fa-bullhorn',
                'ê´‘ê³ ì •ë³´': 'fa-bullhorn',
                'í˜œíƒ': 'fa-gift',
                'íƒ€ê²Ÿ_ì •ë³´': 'fa-users',
                'íƒ€ê²Ÿì •ë³´': 'fa-users',
                'ì±„ë„_ì •ë³´': 'fa-phone',
                'ì±„ë„ì •ë³´': 'fa-phone',
                'ì—°ë½ì²˜': 'fa-phone',
                'ì›¹ì‚¬ì´íŠ¸': 'fa-globe',
                'ë§¤ì¥': 'fa-store',
                'ìƒí’ˆ': 'fa-box',
                'ê°€ê²©': 'fa-won-sign',
                'í• ì¸': 'fa-percentage',
                'ì´ë²¤íŠ¸': 'fa-calendar-alt',
                'ê¸°ê°„': 'fa-clock',
                'entity_dag': 'fa-project-diagram',
                'dag': 'fa-project-diagram',
                'ì—”í‹°í‹°': 'fa-project-diagram',
                
                // ìƒˆë¡œìš´ ì˜ì–´ í‚¤ë“¤
                'title': 'fa-heading',
                'purpose': 'fa-bullseye',
                'product': 'fa-box',
                'produdt': 'fa-box',  // ì˜¤íƒ€ ë²„ì „
                'channel': 'fa-broadcast-tower',
                'pgm': 'fa-cog'
            };
            
            // í‚¤ì— í¬í•¨ëœ ë‹¨ì–´ë¡œ ì•„ì´ì½˜ ì°¾ê¸°
            for (const [keyword, icon] of Object.entries(iconMap)) {
                if (key.includes(keyword)) {
                    return icon;
                }
            }
            
            return 'fa-info-circle'; // ê¸°ë³¸ ì•„ì´ì½˜
        }

        // í…Œì´ë¸” í–‰ ì¶”ê°€ í—¬í¼ í•¨ìˆ˜ (ê¸°ì¡´ í˜¸í™˜ì„±ìš©)
        function addTableRow(label, value) {
            const formattedValue = formatValue(value);
            const valueClass = (!value || value === '' || (Array.isArray(value) && value.length === 0)) ? 'result-value empty' : 'result-value';
            
            return `
                <tr>
                    <td><strong>${label}</strong></td>
                    <td class="${valueClass}">${formattedValue}</td>
                </tr>
            `;
        }

        // NO ì»¬ëŸ¼ì´ ìˆëŠ” í…Œì´ë¸” í–‰ ì¶”ê°€ í—¬í¼ í•¨ìˆ˜
        function addTableRowWithNumber(number, content, isEntityDag = false) {
            const valueClass = (!content || content === '') ? 'result-value empty' : 'result-value';
            
            // entity_dag ê°’ì¸ ê²½ìš° íŠ¹ë³„í•œ ìŠ¤íƒ€ì¼ ì ìš©
            if (isEntityDag && content && content !== 'ì •ë³´ ì—†ìŒ') {
                content = `<div class="entity-dag-content">${content}</div>`;
            }
            
            return `
                <tr>
                    <td style="text-align: center; font-weight: 600; color: #6366f1;">${number}</td>
                    <td class="${valueClass}">${content}</td>
                </tr>
            `;
        }

        // ê°’ í¬ë§·íŒ… í—¬í¼ í•¨ìˆ˜
        function formatValue(value, depth = 0) {
            // ë¬´í•œ ì¬ê·€ ë°©ì§€
            if (depth > 3) {
                return typeof value === 'object' ? '[ë³µì¡í•œ ê°ì²´]' : String(value);
            }
            
            if (!value || value === '') {
                return 'ì •ë³´ ì—†ìŒ';
            }
            
            if (Array.isArray(value)) {
                return formatArray(value, depth);
            }
            
            if (typeof value === 'object') {
                return formatObjectAsKeyValue(value, depth);
            }
            
            // ë¬¸ìì—´ì—ì„œ ì¤„ë°”ê¿ˆ ë¬¸ì ì²˜ë¦¬
            const stringValue = String(value);
            if (stringValue.includes('\\n') || stringValue.includes('/n')) {
                return stringValue
                    .replace(/\\n/g, '<br>')
                    .replace(/\/n/g, '<br>');
            }
            
            return stringValue;
        }

        // ê°ì²´ë¥¼ í‚¤-ê°’ ìŒìœ¼ë¡œ í¬ë§·íŒ…
        function formatObjectAsKeyValue(obj, depth = 0) {
            if (!obj || typeof obj !== 'object') {
                return 'ì •ë³´ ì—†ìŒ';
            }
            
            const entries = Object.entries(obj);
            if (entries.length === 0) {
                return 'ì •ë³´ ì—†ìŒ';
            }
            
            // ë‹¨ì¼ í‚¤-ê°’ ìŒì¸ ê²½ìš° ê°„ë‹¨í•˜ê²Œ í‘œì‹œ
            if (entries.length === 1) {
                const [key, value] = entries[0];
                return `<strong>${key}:</strong> ${formatValue(value, depth + 1)}`;
            }
            
            // ì—¬ëŸ¬ í‚¤-ê°’ ìŒì¸ ê²½ìš° ë¦¬ìŠ¤íŠ¸ë¡œ í‘œì‹œ
            return `<ul class="result-list">${
                entries.map(([key, value]) => 
                    `<li><strong>${key}:</strong> ${formatValue(value, depth + 1)}</li>`
                ).join('')
            }</ul>`;
        }

        // ë°°ì—´ í¬ë§·íŒ… í—¬í¼ í•¨ìˆ˜
        function formatArray(arr, depth = 0) {
            if (!arr || !Array.isArray(arr) || arr.length === 0) {
                return 'ì •ë³´ ì—†ìŒ';
            }
            
            if (arr.length === 1) {
                return formatValue(arr[0], depth + 1);
            }
            
            return `<ul class="result-list">${arr.map(item => `<li>${formatValue(item, depth + 1)}</li>`).join('')}</ul>`;
        }

        // ê°„ë‹¨í•œ DAG ì´ë¯¸ì§€ í‘œì‹œ í•¨ìˆ˜ (ë””ë²„ê¹… í•¨ìˆ˜ë“¤ ì œê±°)
        
        // í…ŒìŠ¤íŠ¸ìš©: ê¸°ì¡´ ì´ë¯¸ì§€ë¡œ ê°•ì œ í…ŒìŠ¤íŠ¸
        function testExistingImage() {
            console.log('ğŸ§ª ê¸°ì¡´ ì´ë¯¸ì§€ë¡œ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            const dagContainer = document.getElementById('dagImageContainer');
            const testImageUrl = '/dag_images/dag_14f66ce15b2741f2d08ec8a8ce6d23a8438671c6020c6b0badc25d9a6401af7a.png';
            const fullUrl = `${DEMO_API_BASE_URL}${testImageUrl}`;
            console.log('ğŸ§ª í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ URL:', fullUrl);
            
            dagContainer.innerHTML = `
                <div style="text-align: center; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <h4 style="color: #4f46e5; margin-bottom: 15px;">
                        <i class="fas fa-project-diagram"></i> í…ŒìŠ¤íŠ¸ DAG ì´ë¯¸ì§€
                    </h4>
                    <img src="${fullUrl}" 
                         alt="í…ŒìŠ¤íŠ¸ DAG ì´ë¯¸ì§€" 
                         style="max-width: 100%; height: auto; border: 1px solid #ddd; border-radius: 5px;"
                         onload="console.log('âœ… í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ ë¡œë“œ ì„±ê³µ!'); this.style.border='2px solid #10b981';"
                         onerror="console.error('âŒ í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨!'); this.style.display='none'; this.parentElement.innerHTML += '<p style=color:red;>í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨</p>';">
                    <button onclick="testExistingImage()" style="margin-top: 10px; background: #4f46e5; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
                        ğŸ§ª ë‹¤ì‹œ í…ŒìŠ¤íŠ¸
                    </button>
                </div>
            `;
        }
        
        // DAG íƒ­ í´ë¦­ì‹œ ìë™ ì´ë¯¸ì§€ ë¡œë”© ì™„ë£Œ
    </script>
</body>
</html>
