2025-09-11 11:29:38,937 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-11 11:29:38,937 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-11 11:29:38,937 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-11 11:29:38,937 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-09-11 11:29:38,937 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-11 11:29:38,938 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-11 11:29:38,957 - __main__ - INFO - Using device: mps
2025-09-11 11:29:38,957 - __main__ - INFO - _initialize_device 실행완료: 0.02초
2025-09-11 11:29:38,957 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-11 11:29:38,957 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-11 11:29:38,957 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-11 11:29:38,957 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-11 11:29:38,957 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-11 11:29:38,957 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-11 11:29:38,957 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-11 11:29:39,990 - __main__ - INFO - Model loaded on mps
2025-09-11 11:29:39,990 - __main__ - INFO - _initialize_embedding_model 실행완료: 1.03초
2025-09-11 11:29:39,990 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-11 11:29:40,458 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-11 11:29:40,458 - __main__ - INFO - _initialize_kiwi 실행완료: 0.47초
2025-09-11 11:29:40,458 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-11 11:29:40,458 - __main__ - INFO - ============================================================
2025-09-11 11:29:40,458 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-11 11:29:40,458 - __main__ - INFO - ============================================================
2025-09-11 11:29:40,458 - __main__ - INFO - 데이터 소스 모드: local
2025-09-11 11:29:40,458 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-11 11:29:40,458 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-11 11:29:40,458 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-11 11:29:40,459 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-11 11:29:40,459 - __main__ - ERROR - 상품 정보 로드 실패: [Errno 2] No such file or directory: './data/offer_master_data.csv'
2025-09-11 11:29:40,461 - __main__ - ERROR - 오류 상세: Traceback (most recent call last):
  File "/Users/1110566/workspace/AgenticWorkflow/mms_extractor_prd/mms_extractor.py", line 990, in _load_item_data
    item_pdf_raw = pd.read_csv(csv_path)
                   ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Caskroom/miniforge/base/lib/python3.12/site-packages/pandas/io/parsers/readers.py", line 1026, in read_csv
    return _read(filepath_or_buffer, kwds)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Caskroom/miniforge/base/lib/python3.12/site-packages/pandas/io/parsers/readers.py", line 620, in _read
    parser = TextFileReader(filepath_or_buffer, **kwds)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Caskroom/miniforge/base/lib/python3.12/site-packages/pandas/io/parsers/readers.py", line 1620, in __init__
    self._engine = self._make_engine(f, self.engine)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Caskroom/miniforge/base/lib/python3.12/site-packages/pandas/io/parsers/readers.py", line 1880, in _make_engine
    self.handles = get_handle(
                   ^^^^^^^^^^^
  File "/opt/homebrew/Caskroom/miniforge/base/lib/python3.12/site-packages/pandas/io/common.py", line 873, in get_handle
    handle = open(
             ^^^^^
FileNotFoundError: [Errno 2] No such file or directory: './data/offer_master_data.csv'

2025-09-11 11:29:40,462 - __main__ - WARNING - 빈 DataFrame으로 fallback 설정됨
2025-09-11 11:29:40,462 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (0, 4)
2025-09-11 11:29:40,462 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn']
2025-09-11 11:29:40,462 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-11 11:29:40,462 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-11 11:29:40,462 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (0, 4)
2025-09-11 11:29:40,466 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-11 11:29:40,466 - __main__ - INFO - null이 아닌 상품명 수: 0개
2025-09-11 11:29:40,466 - __main__ - INFO - 기존 item_nm_alias 데이터가 없어 item_nm에서 별칭을 생성합니다.
2025-09-11 11:29:40,467 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 0 -> 0
2025-09-11 11:29:40,467 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-11 11:29:40,467 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (0, 5)
2025-09-11 11:29:40,467 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-11 11:29:40,468 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-11 11:29:40,468 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-11 11:29:40,468 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-11 11:29:40,468 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-11 11:29:40,468 - __main__ - INFO - 등록할 고유 별칭 수: 0개
2025-09-11 11:29:40,468 - __main__ - INFO - 유효한 별칭 수: 0개
2025-09-11 11:29:40,468 - __main__ - INFO - Kiwi에 상품명 등록 완료: 0개 성공, 0개 실패
2025-09-11 11:29:40,468 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-11 11:29:40,468 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-11 11:29:40,470 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-11 11:29:40,470 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-11 11:29:40,619 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-11 11:29:40,619 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-11 11:29:40,619 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-11 11:29:41,103 - __main__ - INFO - 조직 정보 로드 완료: 259233개 조직
2025-09-11 11:29:41,103 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (259233, 8)
2025-09-11 11:29:41,103 - __main__ - INFO - ============================================================
2025-09-11 11:29:41,103 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-11 11:29:41,103 - __main__ - INFO - ============================================================
2025-09-11 11:29:41,103 - __main__ - INFO - ✅ 상품 데이터: (0, 5)
2025-09-11 11:29:41,104 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-11 11:29:41,104 - __main__ - INFO - ✅ 조직 데이터: (259233, 8)
2025-09-11 11:29:41,104 - __main__ - INFO - ✅ 정지어: 166개
2025-09-11 11:29:41,104 - __main__ - INFO - _load_data 실행완료: 0.65초
2025-09-11 11:29:41,104 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-11 11:29:41,104 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-11 11:29:41,104 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
            '[T 우주] 넷플릭스와 웨이브를 월 9,900원에! 
(광고)[S...
2025-09-11 11:29:41,104 - __main__ - INFO - ============================================================
2025-09-11 11:29:41,104 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-11 11:29:41,104 - __main__ - INFO - ============================================================
2025-09-11 11:29:41,104 - __main__ - INFO - 메시지 내용: 
            '[T 우주] 넷플릭스와 웨이브를 월 9,900원에! 
(광고)[SKT] 넷플릭스+웨이브 월 9,900원, 이게 되네! __#04 고객님,_넷플릭스와 웨이브 둘 다 보고 싶었지만, 가격 때문에 망설이셨다면 지금이 바로 기회! __오직 T 우주에서만, _2개월 동안 월 9,900원에 넷플릭스와 웨이브를 모두 즐기실 수 있습니다.__8월...
2025-09-11 11:29:41,104 - __main__ - INFO - 메시지 길이: 675 문자
2025-09-11 11:29:41,104 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-11 11:29:41,104 - __main__ - INFO - 데이터 소스: local
2025-09-11 11:29:41,104 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-11 11:29:41,104 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-11 11:29:41,104 - __main__ - INFO - LLM 모델: ax
2025-09-11 11:29:41,104 - __main__ - INFO - 상품 데이터 크기: (0, 5)
2025-09-11 11:29:41,104 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-11 11:29:41,104 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-11 11:29:41,104 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-11 11:29:41,104 - __main__ - INFO - 처리할 메시지 길이: 649 문자
2025-09-11 11:29:41,104 - __main__ - ERROR - 상품 데이터가 비어있습니다! 엔티티 추출 불가
2025-09-11 11:29:41,104 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 0.00초
2025-09-11 11:29:41,104 - __main__ - INFO - 추출된 후보 엔티티: []
2025-09-11 11:29:41,104 - __main__ - INFO - 매칭된 상품 정보: (0, 0)
2025-09-11 11:29:41,104 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-11 11:29:41,203 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-11 11:29:41,203 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-11 11:29:41,203 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 423 문자
2025-09-11 11:29:41,203 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-11 11:29:41,203 - __main__ - WARNING - 후보 아이템이 없습니다!
2025-09-11 11:29:41,203 - __main__ - WARNING - 이는 다음 중 하나의 문제일 수 있습니다:
2025-09-11 11:29:41,203 - __main__ - WARNING - 1. 상품 데이터 로딩 실패
2025-09-11 11:29:41,203 - __main__ - WARNING - 2. 엔티티 추출 실패
2025-09-11 11:29:41,203 - __main__ - WARNING - 3. 유사도 매칭 임계값 문제
2025-09-11 11:29:41,204 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-11 11:29:41,204 - __main__ - INFO - 구성된 프롬프트 길이: 5837 문자
2025-09-11 11:29:41,204 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-11 11:29:41,204 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 5837)
2025-09-11 11:29:41,204 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-11 11:29:41,204 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-11 11:29:46,839 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-11 11:29:46,852 - __main__ - INFO - LLM 응답 길이: 774 문자
2025-09-11 11:29:46,852 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "[T 우주] 넷플릭스와 웨이브를 월 9,900원에!",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "쿠폰 제공 안내"
    ],
    "product": [
        {
            "name": "우주패스 Netflix(광고형 스탠다드)",
            "action": "가입"
        },
        {
            "name": "Wavve 콘텐츠 팩",
            "action": "사용"
        }
    ],
    "channel": [
        {
            "type": "URL",
            "value": "http://t-mms.kr/jAs/#74",
            "action": "추가 정보"
        },
        {
            ...
2025-09-11 11:29:46,852 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-11 11:29:46,852 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-11 11:29:46,852 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-11 11:29:46,853 - __main__ - INFO - 파싱된 JSON 내용: {'title': '[T 우주] 넷플릭스와 웨이브를 월 9,900원에!', 'purpose': ['상품 가입 유도', '혜택 안내', '쿠폰 제공 안내'], 'product': [{'name': '우주패스 Netflix(광고형 스탠다드)', 'action': '가입'}, {'name': 'Wavve 콘텐츠 팩', 'action': '사용'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/jAs/#74', 'action': '추가 정보'}, {'type': '전화번호', 'value': '1505', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['상품및부가서비스가입유도_구독', '사용법/혜택/이벤트안내_구독']}
2025-09-11 11:29:46,853 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-11 11:29:46,853 - __main__ - INFO - LLM 추출 엔티티: ['우주패스 Netflix(광고형 스탠다드)', 'Wavve 콘텐츠 팩']
2025-09-11 11:29:46,873 - __main__ - ERROR - LLM 기반 엔티티 추출 실패: 'item_nm_alias'
2025-09-11 11:29:46,874 - __main__ - INFO - extract_entities_by_llm 실행완료: 0.02초
2025-09-11 11:29:46,877 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-11 11:29:46,877 - __main__ - INFO - ============================================================
2025-09-11 11:29:46,877 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-11 11:29:46,877 - __main__ - INFO - ============================================================
2025-09-11 11:29:46,877 - __main__ - INFO - 제목: [T 우주] 넷플릭스와 웨이브를 월 9,900원에!
2025-09-11 11:29:46,877 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '쿠폰 제공 안내']
2025-09-11 11:29:46,877 - __main__ - INFO - 상품 수: 2개
2025-09-11 11:29:46,877 - __main__ - INFO - 채널 수: 3개
2025-09-11 11:29:46,877 - __main__ - INFO - 프로그램 수: 2개
2025-09-11 11:29:46,877 - __main__ - INFO - process_message 실행완료: 5.77초
2025-09-11 11:29:46,878 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-11 11:30:44,488 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-11 11:30:44,488 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-11 11:30:44,488 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-11 11:30:44,488 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-09-11 11:30:44,488 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-11 11:30:44,489 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-11 11:30:44,506 - __main__ - INFO - Using device: mps
2025-09-11 11:30:44,506 - __main__ - INFO - _initialize_device 실행완료: 0.02초
2025-09-11 11:30:44,506 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-11 11:30:44,506 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-11 11:30:44,506 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-11 11:30:44,506 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-11 11:30:44,506 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-11 11:30:44,506 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-11 11:30:44,506 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-11 11:30:45,367 - __main__ - INFO - Model loaded on mps
2025-09-11 11:30:45,367 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.86초
2025-09-11 11:30:45,367 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-11 11:30:45,805 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-11 11:30:45,805 - __main__ - INFO - _initialize_kiwi 실행완료: 0.44초
2025-09-11 11:30:45,805 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-11 11:30:45,805 - __main__ - INFO - ============================================================
2025-09-11 11:30:45,805 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-11 11:30:45,805 - __main__ - INFO - ============================================================
2025-09-11 11:30:45,805 - __main__ - INFO - 데이터 소스 모드: local
2025-09-11 11:30:45,805 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-11 11:30:45,805 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-11 11:30:45,805 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-11 11:30:45,805 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-11 11:30:45,874 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-11 11:30:45,874 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-11 11:30:45,874 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-11 11:30:45,878 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-11 11:30:45,879 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-11 11:30:45,879 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 11:30:45,880 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 11:30:45,880 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-11 11:30:45,880 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-11 11:30:45,882 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-11 11:30:45,885 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-11 11:30:45,885 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-11 11:30:45,885 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 11:30:45,886 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-11 11:30:45,886 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-11 11:30:45,886 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-11 11:30:45,886 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 11:30:45,886 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-11 11:30:45,886 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-11 11:30:45,886 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-11 11:30:45,887 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-11 11:30:45,887 - __main__ - INFO - null이 아닌 상품명 수: 10551개
2025-09-11 11:30:45,887 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 11:30:45,888 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-11 11:30:45,888 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 11:30:46,019 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-11 11:30:46,023 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 21522
2025-09-11 11:30:46,024 - __main__ - INFO - 별칭 적용 후 샘플: ['우주PASS Netflix 인증', '우주Pass Netflix 인증', '우주pass Netflix 인증', '우주패스 Netflix 인증', '우주패스 넷플릭스 인증']
2025-09-11 11:30:46,024 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-11 11:30:46,024 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (21522, 9)
2025-09-11 11:30:46,024 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-11 11:30:46,025 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-11 11:30:46,025 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-11 11:30:46,025 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-11 11:30:46,025 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-11 11:30:46,027 - __main__ - INFO - 등록할 고유 별칭 수: 16403개
2025-09-11 11:30:46,028 - __main__ - INFO - 유효한 별칭 수: 16403개
2025-09-11 11:30:46,028 - __main__ - INFO - 등록할 별칭 샘플: ['우주PASS Netflix 인증', '우주Pass Netflix 인증', '우주pass Netflix 인증', '우주패스 Netflix 인증', '우주패스 넷플릭스 인증']
2025-09-11 11:30:46,044 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16403개 성공, 0개 실패
2025-09-11 11:30:46,044 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-11 11:30:46,044 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-11 11:30:46,045 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-11 11:30:46,045 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-11 11:30:46,202 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-11 11:30:46,202 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-11 11:30:46,202 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-11 11:30:46,714 - __main__ - INFO - 조직 정보 로드 완료: 259233개 조직
2025-09-11 11:30:46,714 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (259233, 8)
2025-09-11 11:30:46,714 - __main__ - INFO - ============================================================
2025-09-11 11:30:46,714 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-11 11:30:46,714 - __main__ - INFO - ============================================================
2025-09-11 11:30:46,714 - __main__ - INFO - ✅ 상품 데이터: (21522, 9)
2025-09-11 11:30:46,714 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-11 11:30:46,714 - __main__ - INFO - ✅ 조직 데이터: (259233, 8)
2025-09-11 11:30:46,714 - __main__ - INFO - ✅ 정지어: 166개
2025-09-11 11:30:46,714 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-11 11:30:46,716 - __main__ - INFO - 고유 상품명 수: 6847개
2025-09-11 11:30:46,718 - __main__ - INFO - 고유 별칭 수: 16403개
2025-09-11 11:30:46,719 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-11 11:30:46,719 - __main__ - INFO - _load_data 실행완료: 0.91초
2025-09-11 11:30:46,719 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-11 11:30:46,719 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-11 11:30:46,719 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
            '[T 우주] 넷플릭스와 웨이브를 월 9,900원에! 
(광고)[S...
2025-09-11 11:30:46,719 - __main__ - INFO - ============================================================
2025-09-11 11:30:46,719 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-11 11:30:46,719 - __main__ - INFO - ============================================================
2025-09-11 11:30:46,719 - __main__ - INFO - 메시지 내용: 
            '[T 우주] 넷플릭스와 웨이브를 월 9,900원에! 
(광고)[SKT] 넷플릭스+웨이브 월 9,900원, 이게 되네! __#04 고객님,_넷플릭스와 웨이브 둘 다 보고 싶었지만, 가격 때문에 망설이셨다면 지금이 바로 기회! __오직 T 우주에서만, _2개월 동안 월 9,900원에 넷플릭스와 웨이브를 모두 즐기실 수 있습니다.__8월...
2025-09-11 11:30:46,719 - __main__ - INFO - 메시지 길이: 675 문자
2025-09-11 11:30:46,719 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-11 11:30:46,719 - __main__ - INFO - 데이터 소스: local
2025-09-11 11:30:46,719 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-11 11:30:46,719 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-11 11:30:46,719 - __main__ - INFO - LLM 모델: ax
2025-09-11 11:30:46,719 - __main__ - INFO - 상품 데이터 크기: (21522, 9)
2025-09-11 11:30:46,719 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-11 11:30:46,719 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-11 11:30:46,719 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-11 11:30:46,719 - __main__ - INFO - 처리할 메시지 길이: 649 문자
2025-09-11 11:30:46,720 - __main__ - INFO - 매칭할 상품 별칭 수: 16403개
2025-09-11 11:30:47,220 - __main__ - INFO - 분할된 문장 수: 21개
2025-09-11 11:30:47,221 - __main__ - INFO - 필터링된 문장들: [' T 우주 넷플릭스와 웨이브 월 에 광고 SKT ', '넷플릭스 웨이브 월 이게 되네 ', ' 고객님 ']...
2025-09-11 11:30:47,226 - __main__ - INFO - 전체 토큰 수: 272개
2025-09-11 11:30:47,226 - __main__ - INFO - NNP 태그 토큰들: ['넷플릭스', '넷플릭스', '넷플릭스', '넷플릭스', 'Netflix', 'Wavve 콘텐츠 팩', 'Netflix']
2025-09-11 11:30:47,226 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['Wavve 콘텐츠 팩', '넷플릭스', 'Netflix']
2025-09-11 11:30:47,226 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-11 11:30:48,265 - __main__ - INFO - 퍼지 매칭 결과 크기: (5348, 3)
2025-09-11 11:30:48,266 - __main__ - INFO - 퍼지 매칭 성공: 5348개 결과
2025-09-11 11:30:48,266 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' T 우주 넷플릭스와 웨이브 월 에 광고 SKT ', 'item_nm_alias': '우주패스 넷플릭스 인증', 'sim': 0.6956521739130435}, {'sent': ' T 우주 넷플릭스와 웨이브 월 에 광고 SKT ', 'item_nm_alias': '밴드 데이터 세이브', 'sim': 0.4}, {'sent': ' T 우주 넷플릭스와 웨이브 월 에 광고 SKT ', 'item_nm_alias': '다이렉트5G 76(넷플릭스)', 'sim': 0.41666666666666663}]
2025-09-11 11:30:48,266 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-11 11:30:48,363 - __main__ - INFO - 시퀀스 유사도 결과 크기: (5348, 3)
2025-09-11 11:30:48,364 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' T 우주 넷플릭스와 웨이브 월 에 광고 SKT ', 'item_nm_alias': '우주패스 넷플릭스 인증', 'sim': 0.5333333333333333}, {'sent': ' T 우주 넷플릭스와 웨이브 월 에 광고 SKT ', 'item_nm_alias': '밴드 데이터 세이브', 'sim': 0.32000000000000006}, {'sent': ' T 우주 넷플릭스와 웨이브 월 에 광고 SKT ', 'item_nm_alias': '다이렉트5G 76(넷플릭스)', 'sim': 0.34285714285714286}]
2025-09-11 11:30:48,364 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-11 11:30:48,367 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 58개
2025-09-11 11:30:48,369 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 4개
2025-09-11 11:30:48,370 - __main__ - INFO - 통합된 후보 아이템 수: 62개
2025-09-11 11:30:48,372 - __main__ - INFO - 최종 후보 아이템 리스트: ['Netflix', 'Wavve 콘텐츠 팩', '넷플릭스', 'Netflix 광고형 스탠다드 이용권', 'Netflix 스탠다드 이용권', 'T 우주패스 Netflix', '우주패스 Netflix 인증', '멤버십가입', '우주패스 Netflix 추가혜택', '티빙 광고형 스탠다드', 'Netflix 프리미엄 이용권', 'Wavve 콘텐츠 팩_인증', 'Wavve 콘텐츠 팩 연간', 'Wavve 콘텐츠 팩(TV)', 'Wavve 콘텐츠 팩(티비)', '타다 쿠폰', 'Netflix 단독', 'Wavve 콘텐츠 팩_할인2', 'Wavve 콘텐츠 팩_할인1', 'Wavve 콘텐츠 팩(이벤트)', 'Wavve 콘텐츠 팩 플러스', 'Wavve 콘텐츠 팩 이용권', 'tving 광고형 스탠다드', 'TVING 광고형 스탠다드', '플로 콘텐츠 팩', 'T 우주패스 넷플릭스', '넷플릭스 광고형 스탠다드 이용권', 'Wavve 콘텐츠 팩 프리미엄', '멤버십 미가입자', 'Wavve 콘텐츠 팩 plus', 'Wavve 콘텐츠 팩 Plus', 'Wavve 콘텐츠 팩 PLUS', '클럽T 스탠다드', '클럽T 프리미엄']
2025-09-11 11:30:48,375 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (25, 2)
2025-09-11 11:30:48,375 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'FLO 콘텐츠 팩', 'item_id': ['PR00000217']}, {'item_nm': 'Netflix', 'item_id': ['PR00000501', 'PR00000501']}, {'item_nm': 'Netflix 광고형 스탠다드 이용권', 'item_id': ['PR00000418', 'PR00000418']}]
2025-09-11 11:30:48,376 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.66초
2025-09-11 11:30:48,376 - __main__ - INFO - 추출된 후보 엔티티: ['Netflix', 'Wavve 콘텐츠 팩', '넷플릭스', 'Netflix 광고형 스탠다드 이용권', 'Netflix 스탠다드 이용권', 'T 우주패스 Netflix', '우주패스 Netflix 인증', '멤버십가입', '우주패스 Netflix 추가혜택', '티빙 광고형 스탠다드', 'Netflix 프리미엄 이용권', 'Wavve 콘텐츠 팩_인증', 'Wavve 콘텐츠 팩 연간', 'Wavve 콘텐츠 팩(TV)', 'Wavve 콘텐츠 팩(티비)', '타다 쿠폰', 'Netflix 단독', 'Wavve 콘텐츠 팩_할인2', 'Wavve 콘텐츠 팩_할인1', 'Wavve 콘텐츠 팩(이벤트)', 'Wavve 콘텐츠 팩 플러스', 'Wavve 콘텐츠 팩 이용권', 'tving 광고형 스탠다드', 'TVING 광고형 스탠다드', '플로 콘텐츠 팩', 'T 우주패스 넷플릭스', '넷플릭스 광고형 스탠다드 이용권', 'Wavve 콘텐츠 팩 프리미엄', '멤버십 미가입자', 'Wavve 콘텐츠 팩 plus', 'Wavve 콘텐츠 팩 Plus', 'Wavve 콘텐츠 팩 PLUS', '클럽T 스탠다드', '클럽T 프리미엄']
2025-09-11 11:30:48,376 - __main__ - INFO - 매칭된 상품 정보: (25, 2)
2025-09-11 11:30:48,376 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-11 11:30:48,474 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-11 11:30:48,474 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-11 11:30:48,474 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 423 문자
2025-09-11 11:30:48,474 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-11 11:30:48,474 - __main__ - INFO - 후보 아이템 리스트 크기: 34개
2025-09-11 11:30:48,474 - __main__ - INFO - 후보 아이템 리스트: ['Netflix', 'Wavve 콘텐츠 팩', '넷플릭스', 'Netflix 광고형 스탠다드 이용권', 'Netflix 스탠다드 이용권', 'T 우주패스 Netflix', '우주패스 Netflix 인증', '멤버십가입', '우주패스 Netflix 추가혜택', '티빙 광고형 스탠다드', 'Netflix 프리미엄 이용권', 'Wavve 콘텐츠 팩_인증', 'Wavve 콘텐츠 팩 연간', 'Wavve 콘텐츠 팩(TV)', 'Wavve 콘텐츠 팩(티비)', '타다 쿠폰', 'Netflix 단독', 'Wavve 콘텐츠 팩_할인2', 'Wavve 콘텐츠 팩_할인1', 'Wavve 콘텐츠 팩(이벤트)', 'Wavve 콘텐츠 팩 플러스', 'Wavve 콘텐츠 팩 이용권', 'tving 광고형 스탠다드', 'TVING 광고형 스탠다드', '플로 콘텐츠 팩', 'T 우주패스 넷플릭스', '넷플릭스 광고형 스탠다드 이용권', 'Wavve 콘텐츠 팩 프리미엄', '멤버십 미가입자', 'Wavve 콘텐츠 팩 plus', 'Wavve 콘텐츠 팩 Plus', 'Wavve 콘텐츠 팩 PLUS', '클럽T 스탠다드', '클럽T 프리미엄']
2025-09-11 11:30:48,474 - __main__ - INFO - extra_item_pdf 크기: (25, 2)
2025-09-11 11:30:48,474 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-11 11:30:48,475 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'FLO 콘텐츠 팩', 'item_id': ['PR00000217']}, {'item_nm': 'Netflix', 'item_id': ['PR00000501', 'PR00000501']}]
2025-09-11 11:30:48,476 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 25개
2025-09-11 11:30:48,476 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': 'FLO 콘텐츠 팩', 'action': '기타'}, {'name': 'Netflix', 'action': '기타'}]
2025-09-11 11:30:48,476 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-11 11:30:48,476 - __main__ - INFO - 구성된 프롬프트 길이: 7259 문자
2025-09-11 11:30:48,476 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-11 11:30:48,476 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 7259)
2025-09-11 11:30:48,476 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-11 11:30:48,476 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-11 11:30:56,235 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-11 11:30:56,243 - __main__ - INFO - LLM 응답 길이: 1176 문자
2025-09-11 11:30:56,243 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "[T 우주] 넷플릭스와 웨이브를 월 9,900원에!",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "쿠폰 제공 안내"
    ],
    "product": [
        {
            "name": "Netflix",
            "action": "가입"
        },
        {
            "name": "Wavve",
            "action": "가입"
        },
        {
            "name": "우주패스 Netflix",
            "action": "가입"
        },
        {
            "name": "Netflix 광고형 스탠다드",
            "action": "가입"
        },
        {
          ...
2025-09-11 11:30:56,243 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-11 11:30:56,244 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-11 11:30:56,244 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-11 11:30:56,244 - __main__ - INFO - 파싱된 JSON 내용: {'title': '[T 우주] 넷플릭스와 웨이브를 월 9,900원에!', 'purpose': ['상품 가입 유도', '혜택 안내', '쿠폰 제공 안내'], 'product': [{'name': 'Netflix', 'action': '가입'}, {'name': 'Wavve', 'action': '가입'}, {'name': '우주패스 Netflix', 'action': '가입'}, {'name': 'Netflix 광고형 스탠다드', 'action': '가입'}, {'name': 'Wavve 콘텐츠 팩', 'action': '가입'}, {'name': 'Netflix 스탠다드', 'action': '가입'}, {'name': 'Netflix 프리미엄', 'action': '가입'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/jAs/#74', 'action': '추가 정보'}, {'type': '전화번호', 'value': '1505', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['상품및부가서비스가입유도_구독', '사용법/혜택/이벤트안내_구독']}
2025-09-11 11:30:56,244 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-11 11:30:56,244 - __main__ - INFO - LLM 추출 엔티티: ['Netflix', 'Wavve', '우주패스 Netflix', 'Netflix 광고형 스탠다드', 'Wavve 콘텐츠 팩', 'Netflix 스탠다드', 'Netflix 프리미엄']
2025-09-11 11:30:56,540 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 4224)
2025-09-11 11:30:56,540 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-11 11:30:56,540 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-11 11:30:57,218 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-11 11:30:57,507 - __main__ - INFO - extract_entities_by_llm 실행완료: 1.26초
2025-09-11 11:30:57,511 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-11 11:30:57,511 - __main__ - INFO - ============================================================
2025-09-11 11:30:57,511 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-11 11:30:57,511 - __main__ - INFO - ============================================================
2025-09-11 11:30:57,511 - __main__ - INFO - 제목: [T 우주] 넷플릭스와 웨이브를 월 9,900원에!
2025-09-11 11:30:57,511 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '쿠폰 제공 안내']
2025-09-11 11:30:57,511 - __main__ - INFO - 상품 수: 5개
2025-09-11 11:30:57,511 - __main__ - INFO - 채널 수: 3개
2025-09-11 11:30:57,511 - __main__ - INFO - 프로그램 수: 2개
2025-09-11 11:30:57,512 - __main__ - INFO - process_message 실행완료: 10.79초
2025-09-11 11:30:57,512 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-11 12:39:21,002 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-11 12:39:21,003 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-11 12:39:21,003 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-11 12:39:21,003 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-09-11 12:39:21,003 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-11 12:39:21,004 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-11 12:39:21,021 - __main__ - INFO - Using device: mps
2025-09-11 12:39:21,021 - __main__ - INFO - _initialize_device 실행완료: 0.02초
2025-09-11 12:39:21,021 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-11 12:39:21,021 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-11 12:39:21,022 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-11 12:39:21,022 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-11 12:39:21,022 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-11 12:39:21,022 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-11 12:39:21,022 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-11 12:39:22,057 - __main__ - INFO - Model loaded on mps
2025-09-11 12:39:22,057 - __main__ - INFO - _initialize_embedding_model 실행완료: 1.04초
2025-09-11 12:39:22,057 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-11 12:39:22,466 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-11 12:39:22,466 - __main__ - INFO - _initialize_kiwi 실행완료: 0.41초
2025-09-11 12:39:22,466 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-11 12:39:22,466 - __main__ - INFO - ============================================================
2025-09-11 12:39:22,466 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-11 12:39:22,466 - __main__ - INFO - ============================================================
2025-09-11 12:39:22,466 - __main__ - INFO - 데이터 소스 모드: local
2025-09-11 12:39:22,466 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-11 12:39:22,466 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-11 12:39:22,467 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-11 12:39:22,467 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-11 12:39:22,540 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-11 12:39:22,540 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-11 12:39:22,540 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-11 12:39:22,543 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-11 12:39:22,544 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-11 12:39:22,544 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 12:39:22,545 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 12:39:22,545 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-11 12:39:22,545 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-11 12:39:22,546 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-11 12:39:22,549 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-11 12:39:22,549 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-11 12:39:22,549 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 12:39:22,549 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-11 12:39:22,549 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-11 12:39:22,550 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-11 12:39:22,550 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 12:39:22,550 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-11 12:39:22,550 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-11 12:39:22,550 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-11 12:39:22,557 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-11 12:39:22,557 - __main__ - INFO - null이 아닌 상품명 수: 10551개
2025-09-11 12:39:22,557 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 12:39:22,558 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-11 12:39:22,558 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 12:39:22,682 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-11 12:39:22,686 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 21522
2025-09-11 12:39:22,687 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 넷플릭스 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증']
2025-09-11 12:39:22,687 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-11 12:39:22,687 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (21522, 9)
2025-09-11 12:39:22,687 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-11 12:39:22,688 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-11 12:39:22,688 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-11 12:39:22,689 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-11 12:39:22,689 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-11 12:39:22,690 - __main__ - INFO - 등록할 고유 별칭 수: 16403개
2025-09-11 12:39:22,691 - __main__ - INFO - 유효한 별칭 수: 16403개
2025-09-11 12:39:22,691 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 넷플릭스 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증']
2025-09-11 12:39:22,704 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16403개 성공, 0개 실패
2025-09-11 12:39:22,704 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-11 12:39:22,704 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-11 12:39:22,708 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-11 12:39:22,708 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-11 12:39:22,856 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-11 12:39:22,856 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-11 12:39:22,856 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-11 12:39:22,866 - __main__ - WARNING - 조직 정보 로드 실패: 'utf-8' codec can't decode byte 0xb4 in position 104: invalid start byte
2025-09-11 12:39:22,868 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (0, 3)
2025-09-11 12:39:22,868 - __main__ - INFO - ============================================================
2025-09-11 12:39:22,868 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-11 12:39:22,868 - __main__ - INFO - ============================================================
2025-09-11 12:39:22,868 - __main__ - INFO - ✅ 상품 데이터: (21522, 9)
2025-09-11 12:39:22,868 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-11 12:39:22,868 - __main__ - INFO - ✅ 조직 데이터: (0, 3)
2025-09-11 12:39:22,868 - __main__ - INFO - ✅ 정지어: 166개
2025-09-11 12:39:22,868 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-11 12:39:22,869 - __main__ - INFO - 고유 상품명 수: 6847개
2025-09-11 12:39:22,871 - __main__ - INFO - 고유 별칭 수: 16403개
2025-09-11 12:39:22,872 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-11 12:39:22,872 - __main__ - INFO - _load_data 실행완료: 0.41초
2025-09-11 12:39:22,872 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-11 12:39:22,872 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-11 12:39:22,872 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-11 12:39:22,872 - __main__ - INFO - ============================================================
2025-09-11 12:39:22,872 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-11 12:39:22,872 - __main__ - INFO - ============================================================
2025-09-11 12:39:22,872 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-11 12:39:22,872 - __main__ - INFO - 메시지 길이: 420 문자
2025-09-11 12:39:22,872 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-11 12:39:22,872 - __main__ - INFO - 데이터 소스: local
2025-09-11 12:39:22,872 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-11 12:39:22,872 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-11 12:39:22,872 - __main__ - INFO - LLM 모델: ax
2025-09-11 12:39:22,873 - __main__ - INFO - 상품 데이터 크기: (21522, 9)
2025-09-11 12:39:22,873 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-11 12:39:22,873 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-11 12:39:22,873 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-11 12:39:22,873 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-11 12:39:22,874 - __main__ - INFO - 매칭할 상품 별칭 수: 16403개
2025-09-11 12:39:23,328 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-11 12:39:23,329 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-11 12:39:23,332 - __main__ - INFO - 전체 토큰 수: 155개
2025-09-11 12:39:23,332 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하', '갤럭시', 'A', '기기값', '아이폰', '을지로입구역', '하나은행', '명동']
2025-09-11 12:39:23,332 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['명동', '을지로입구역', '갤럭시', '하나은행', '아이폰', '기기값', '구매하']
2025-09-11 12:39:23,332 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-11 12:39:24,099 - __main__ - INFO - 퍼지 매칭 결과 크기: (1047, 3)
2025-09-11 12:39:24,099 - __main__ - INFO - 퍼지 매칭 성공: 1047개 결과
2025-09-11 12:39:24,100 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-11 12:39:24,100 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-11 12:39:24,140 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1047, 3)
2025-09-11 12:39:24,140 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-11 12:39:24,141 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-11 12:39:24,143 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 1개
2025-09-11 12:39:24,145 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 1개
2025-09-11 12:39:24,145 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-09-11 12:39:24,147 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시']
2025-09-11 12:39:24,149 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (1, 2)
2025-09-11 12:39:24,150 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-11 12:39:24,150 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.28초
2025-09-11 12:39:24,150 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시']
2025-09-11 12:39:24,150 - __main__ - INFO - 매칭된 상품 정보: (1, 2)
2025-09-11 12:39:24,150 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-11 12:39:24,235 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-11 12:39:24,235 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-11 12:39:24,235 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-11 12:39:24,235 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-11 12:39:24,235 - __main__ - INFO - 후보 아이템 리스트 크기: 1개
2025-09-11 12:39:24,236 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시']
2025-09-11 12:39:24,236 - __main__ - INFO - extra_item_pdf 크기: (1, 2)
2025-09-11 12:39:24,236 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-11 12:39:24,236 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-11 12:39:24,237 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 1개
2025-09-11 12:39:24,237 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': 'GALAXY', 'action': '기타'}]
2025-09-11 12:39:24,237 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-11 12:39:24,237 - __main__ - INFO - 구성된 프롬프트 길이: 5000 문자
2025-09-11 12:39:24,237 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-11 12:39:24,237 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 5000)
2025-09-11 12:39:24,237 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-11 12:39:24,237 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-11 12:39:32,574 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-11 12:39:32,583 - __main__ - INFO - LLM 응답 길이: 1245 문자
2025-09-11 12:39:32,583 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "갤럭시 S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        },
        {
            "name"...
2025-09-11 12:39:32,583 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-11 12:39:32,584 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-11 12:39:32,584 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-11 12:39:32,584 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': '갤럭시 S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}, {'name': '인터넷+TV', 'action': '가입'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '가입'}, {'type': '전화번호', 'value': '080-801-0011', 'action': '수신 거부'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-11 12:39:32,584 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-11 12:39:32,584 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', '갤럭시 S24 FE', '아이폰17', '인터넷+TV']
2025-09-11 12:39:32,782 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 3050)
2025-09-11 12:39:32,782 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-11 12:39:32,782 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-11 12:39:33,470 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-11 12:39:33,750 - __main__ - INFO - extract_entities_by_llm 실행완료: 1.17초
2025-09-11 12:39:33,754 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-11 12:39:33,754 - __main__ - INFO - ============================================================
2025-09-11 12:39:33,754 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-11 12:39:33,754 - __main__ - INFO - ============================================================
2025-09-11 12:39:33,754 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-11 12:39:33,754 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-11 12:39:33,754 - __main__ - INFO - 상품 수: 2개
2025-09-11 12:39:33,754 - __main__ - INFO - 채널 수: 5개
2025-09-11 12:39:33,755 - __main__ - INFO - 프로그램 수: 2개
2025-09-11 12:39:33,755 - __main__ - INFO - process_message 실행완료: 10.88초
2025-09-11 12:39:33,755 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-11 12:41:43,778 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-11 12:41:43,778 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-11 12:41:43,778 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-11 12:41:43,778 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-09-11 12:41:43,778 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-11 12:41:43,779 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-11 12:41:43,796 - __main__ - INFO - Using device: mps
2025-09-11 12:41:43,796 - __main__ - INFO - _initialize_device 실행완료: 0.02초
2025-09-11 12:41:43,796 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-11 12:41:43,796 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-11 12:41:43,797 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-11 12:41:43,797 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-11 12:41:43,797 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-11 12:41:43,797 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-11 12:41:43,797 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-11 12:41:44,625 - __main__ - INFO - Model loaded on mps
2025-09-11 12:41:44,625 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.83초
2025-09-11 12:41:44,625 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-11 12:41:45,033 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-11 12:41:45,033 - __main__ - INFO - _initialize_kiwi 실행완료: 0.41초
2025-09-11 12:41:45,033 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-11 12:41:45,033 - __main__ - INFO - ============================================================
2025-09-11 12:41:45,033 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-11 12:41:45,033 - __main__ - INFO - ============================================================
2025-09-11 12:41:45,033 - __main__ - INFO - 데이터 소스 모드: local
2025-09-11 12:41:45,033 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-11 12:41:45,033 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-11 12:41:45,033 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-11 12:41:45,033 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-11 12:41:45,097 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-11 12:41:45,097 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-11 12:41:45,097 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-11 12:41:45,101 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-11 12:41:45,101 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-11 12:41:45,102 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 12:41:45,102 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 12:41:45,102 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-11 12:41:45,103 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-11 12:41:45,104 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-11 12:41:45,106 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-11 12:41:45,106 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-11 12:41:45,106 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 12:41:45,107 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-11 12:41:45,107 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-11 12:41:45,107 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-11 12:41:45,107 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 12:41:45,107 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-11 12:41:45,107 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-11 12:41:45,107 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-11 12:41:45,108 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-11 12:41:45,109 - __main__ - INFO - null이 아닌 상품명 수: 10551개
2025-09-11 12:41:45,109 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 12:41:45,109 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-11 12:41:45,109 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 12:41:45,233 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-11 12:41:45,238 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 21522
2025-09-11 12:41:45,239 - __main__ - INFO - 별칭 적용 후 샘플: ['우주pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주Pass Netflix 인증', '우주패스 넷플릭스 인증']
2025-09-11 12:41:45,239 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-11 12:41:45,239 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (21522, 9)
2025-09-11 12:41:45,239 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-11 12:41:45,240 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-11 12:41:45,240 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-11 12:41:45,240 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-11 12:41:45,240 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-11 12:41:45,242 - __main__ - INFO - 등록할 고유 별칭 수: 16403개
2025-09-11 12:41:45,243 - __main__ - INFO - 유효한 별칭 수: 16403개
2025-09-11 12:41:45,243 - __main__ - INFO - 등록할 별칭 샘플: ['우주pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주Pass Netflix 인증', '우주패스 넷플릭스 인증']
2025-09-11 12:41:45,255 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16403개 성공, 0개 실패
2025-09-11 12:41:45,255 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-11 12:41:45,255 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-11 12:41:45,256 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-11 12:41:45,257 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-11 12:41:45,406 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-11 12:41:45,406 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-11 12:41:45,406 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-11 12:41:45,475 - __main__ - INFO - 조직 정보 로드 완료: 5765개 조직
2025-09-11 12:41:45,475 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-11 12:41:45,475 - __main__ - INFO - ============================================================
2025-09-11 12:41:45,475 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-11 12:41:45,475 - __main__ - INFO - ============================================================
2025-09-11 12:41:45,475 - __main__ - INFO - ✅ 상품 데이터: (21522, 9)
2025-09-11 12:41:45,475 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-11 12:41:45,475 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-11 12:41:45,475 - __main__ - INFO - ✅ 정지어: 166개
2025-09-11 12:41:45,475 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-11 12:41:45,476 - __main__ - INFO - 고유 상품명 수: 6847개
2025-09-11 12:41:45,478 - __main__ - INFO - 고유 별칭 수: 16403개
2025-09-11 12:41:45,479 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-11 12:41:45,479 - __main__ - INFO - _load_data 실행완료: 0.45초
2025-09-11 12:41:45,479 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-11 12:41:45,479 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-11 12:41:45,479 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-11 12:41:45,479 - __main__ - INFO - ============================================================
2025-09-11 12:41:45,479 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-11 12:41:45,479 - __main__ - INFO - ============================================================
2025-09-11 12:41:45,479 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-11 12:41:45,479 - __main__ - INFO - 메시지 길이: 420 문자
2025-09-11 12:41:45,479 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-11 12:41:45,479 - __main__ - INFO - 데이터 소스: local
2025-09-11 12:41:45,479 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-11 12:41:45,480 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-11 12:41:45,480 - __main__ - INFO - LLM 모델: ax
2025-09-11 12:41:45,480 - __main__ - INFO - 상품 데이터 크기: (21522, 9)
2025-09-11 12:41:45,480 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-11 12:41:45,480 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-11 12:41:45,480 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-11 12:41:45,480 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-11 12:41:45,481 - __main__ - INFO - 매칭할 상품 별칭 수: 16403개
2025-09-11 12:41:45,942 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-11 12:41:45,943 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-11 12:41:45,946 - __main__ - INFO - 전체 토큰 수: 155개
2025-09-11 12:41:45,946 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하', '갤럭시', 'A', '기기값', '아이폰', '을지로입구역', '하나은행', '명동']
2025-09-11 12:41:45,946 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['갤럭시', '아이폰', '구매하', '하나은행', '명동', '을지로입구역', '기기값']
2025-09-11 12:41:45,946 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-11 12:41:46,713 - __main__ - INFO - 퍼지 매칭 결과 크기: (1047, 3)
2025-09-11 12:41:46,713 - __main__ - INFO - 퍼지 매칭 성공: 1047개 결과
2025-09-11 12:41:46,714 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-11 12:41:46,714 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-11 12:41:46,753 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1047, 3)
2025-09-11 12:41:46,753 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-11 12:41:46,754 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-11 12:41:46,756 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 1개
2025-09-11 12:41:46,758 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 1개
2025-09-11 12:41:46,758 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-09-11 12:41:46,760 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시']
2025-09-11 12:41:46,762 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (1, 2)
2025-09-11 12:41:46,762 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-11 12:41:46,762 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.28초
2025-09-11 12:41:46,762 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시']
2025-09-11 12:41:46,762 - __main__ - INFO - 매칭된 상품 정보: (1, 2)
2025-09-11 12:41:46,763 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-11 12:41:46,848 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-11 12:41:46,848 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-11 12:41:46,848 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-11 12:41:46,848 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-11 12:41:46,848 - __main__ - INFO - 후보 아이템 리스트 크기: 1개
2025-09-11 12:41:46,848 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시']
2025-09-11 12:41:46,848 - __main__ - INFO - extra_item_pdf 크기: (1, 2)
2025-09-11 12:41:46,848 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-11 12:41:46,848 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-11 12:41:46,849 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 1개
2025-09-11 12:41:46,849 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': 'GALAXY', 'action': '기타'}]
2025-09-11 12:41:46,849 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-11 12:41:46,849 - __main__ - INFO - 구성된 프롬프트 길이: 5000 문자
2025-09-11 12:41:46,849 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-11 12:41:46,849 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 5000)
2025-09-11 12:41:46,849 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-11 12:41:46,849 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-11 12:41:55,198 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-11 12:41:55,206 - __main__ - INFO - LLM 응답 길이: 1245 문자
2025-09-11 12:41:55,207 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "갤럭시 S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        },
        {
            "name"...
2025-09-11 12:41:55,207 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-11 12:41:55,207 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-11 12:41:55,207 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-11 12:41:55,207 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': '갤럭시 S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}, {'name': '인터넷+TV', 'action': '가입'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '가입'}, {'type': '전화번호', 'value': '080-801-0011', 'action': '수신 거부'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-11 12:41:55,207 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-11 12:41:55,207 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', '갤럭시 S24 FE', '아이폰17', '인터넷+TV']
2025-09-11 12:41:55,403 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 3050)
2025-09-11 12:41:55,403 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-11 12:41:55,403 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-11 12:41:55,951 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-11 12:41:56,244 - __main__ - INFO - extract_entities_by_llm 실행완료: 1.04초
2025-09-11 12:41:56,301 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-11 12:41:56,301 - __main__ - INFO - ============================================================
2025-09-11 12:41:56,301 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-11 12:41:56,301 - __main__ - INFO - ============================================================
2025-09-11 12:41:56,301 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-11 12:41:56,301 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-11 12:41:56,301 - __main__ - INFO - 상품 수: 2개
2025-09-11 12:41:56,301 - __main__ - INFO - 채널 수: 5개
2025-09-11 12:41:56,301 - __main__ - INFO - 프로그램 수: 2개
2025-09-11 12:41:56,301 - __main__ - INFO - process_message 실행완료: 10.82초
2025-09-11 12:41:56,301 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-11 12:51:50,133 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-11 12:51:50,133 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-11 12:51:50,133 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-11 12:51:50,133 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-09-11 12:51:50,133 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-11 12:51:50,134 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-11 12:51:50,198 - __main__ - INFO - Using device: mps
2025-09-11 12:51:50,199 - __main__ - INFO - _initialize_device 실행완료: 0.06초
2025-09-11 12:51:50,199 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-11 12:51:50,199 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-11 12:51:50,199 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-11 12:51:50,199 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-11 12:51:50,199 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-11 12:51:50,199 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-11 12:51:50,199 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-11 12:51:54,984 - __main__ - INFO - Model loaded on mps
2025-09-11 12:51:54,984 - __main__ - INFO - _initialize_embedding_model 실행완료: 4.78초
2025-09-11 12:51:54,984 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-11 12:51:55,683 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-11 12:51:55,683 - __main__ - INFO - _initialize_kiwi 실행완료: 0.70초
2025-09-11 12:51:55,683 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-11 12:51:55,683 - __main__ - INFO - ============================================================
2025-09-11 12:51:55,683 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-11 12:51:55,683 - __main__ - INFO - ============================================================
2025-09-11 12:51:55,683 - __main__ - INFO - 데이터 소스 모드: local
2025-09-11 12:51:55,683 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-11 12:51:55,683 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-11 12:51:55,683 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-11 12:51:55,683 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-11 12:51:55,823 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-11 12:51:55,823 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-11 12:51:55,824 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-11 12:51:55,827 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-11 12:51:55,828 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-11 12:51:55,828 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 12:51:55,829 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 12:51:55,829 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-11 12:51:55,829 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-11 12:51:55,936 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-11 12:51:55,940 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-11 12:51:55,940 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-11 12:51:55,940 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 12:51:55,940 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-11 12:51:55,940 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-11 12:51:55,941 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-11 12:51:55,941 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 12:51:55,941 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-11 12:51:55,941 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-11 12:51:55,941 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-11 12:51:56,016 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-11 12:51:56,017 - __main__ - INFO - null이 아닌 상품명 수: 10551개
2025-09-11 12:51:56,017 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 12:51:56,017 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-11 12:51:56,018 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 12:51:56,155 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-11 12:51:56,161 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 21522
2025-09-11 12:51:56,161 - __main__ - INFO - 별칭 적용 후 샘플: ['우주Pass Netflix 인증', '우주pass Netflix 인증', '우주패스 Netflix 인증', '우주패스 넷플릭스 인증', '우주PASS Netflix 인증']
2025-09-11 12:51:56,161 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-11 12:51:56,162 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (21522, 9)
2025-09-11 12:51:56,162 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-11 12:51:56,185 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-11 12:51:56,185 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-11 12:51:56,185 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-11 12:51:56,185 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-11 12:51:56,187 - __main__ - INFO - 등록할 고유 별칭 수: 16403개
2025-09-11 12:51:56,188 - __main__ - INFO - 유효한 별칭 수: 16403개
2025-09-11 12:51:56,188 - __main__ - INFO - 등록할 별칭 샘플: ['우주Pass Netflix 인증', '우주pass Netflix 인증', '우주패스 Netflix 인증', '우주패스 넷플릭스 인증', '우주PASS Netflix 인증']
2025-09-11 12:51:56,204 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16403개 성공, 0개 실패
2025-09-11 12:51:56,204 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-11 12:51:56,204 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-11 12:51:56,263 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-11 12:51:56,263 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-11 12:51:57,173 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-11 12:51:57,173 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-11 12:51:57,173 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-11 12:51:57,173 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-09-11 12:51:57,173 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-09-11 12:51:57,173 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-11 12:51:57,244 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-09-11 12:51:57,244 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-11 12:51:57,247 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-09-11 12:51:57,247 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-09-11 12:51:57,247 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-09-11 12:51:57,247 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 12:51:57,248 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-11 12:51:57,248 - __main__ - INFO - ============================================================
2025-09-11 12:51:57,248 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-11 12:51:57,248 - __main__ - INFO - ============================================================
2025-09-11 12:51:57,248 - __main__ - INFO - ✅ 상품 데이터: (21522, 9)
2025-09-11 12:51:57,248 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-11 12:51:57,248 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-11 12:51:57,248 - __main__ - INFO - ✅ 정지어: 166개
2025-09-11 12:51:57,248 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-11 12:51:57,250 - __main__ - INFO - 고유 상품명 수: 6847개
2025-09-11 12:51:57,252 - __main__ - INFO - 고유 별칭 수: 16403개
2025-09-11 12:51:57,253 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-11 12:51:57,253 - __main__ - INFO - _load_data 실행완료: 1.57초
2025-09-11 12:51:57,253 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-11 12:51:57,253 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-11 12:51:57,253 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-11 12:51:57,253 - __main__ - INFO - ============================================================
2025-09-11 12:51:57,253 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-11 12:51:57,253 - __main__ - INFO - ============================================================
2025-09-11 12:51:57,253 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-11 12:51:57,253 - __main__ - INFO - 메시지 길이: 420 문자
2025-09-11 12:51:57,253 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-11 12:51:57,253 - __main__ - INFO - 데이터 소스: local
2025-09-11 12:51:57,253 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-11 12:51:57,253 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-11 12:51:57,253 - __main__ - INFO - LLM 모델: ax
2025-09-11 12:51:57,253 - __main__ - INFO - 상품 데이터 크기: (21522, 9)
2025-09-11 12:51:57,253 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-11 12:51:57,253 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-11 12:51:57,253 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-11 12:51:57,253 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-11 12:51:57,255 - __main__ - INFO - 매칭할 상품 별칭 수: 16403개
2025-09-11 12:51:57,735 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-11 12:51:57,735 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-11 12:51:57,741 - __main__ - INFO - 전체 토큰 수: 155개
2025-09-11 12:51:57,741 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하', '갤럭시', 'A', '기기값', '아이폰', '을지로입구역', '하나은행', '명동']
2025-09-11 12:51:57,741 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['갤럭시', '아이폰', '기기값', '을지로입구역', '하나은행', '구매하', '명동']
2025-09-11 12:51:57,741 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-11 12:51:58,539 - __main__ - INFO - 퍼지 매칭 결과 크기: (1047, 3)
2025-09-11 12:51:58,539 - __main__ - INFO - 퍼지 매칭 성공: 1047개 결과
2025-09-11 12:51:58,540 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-11 12:51:58,540 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-11 12:51:58,580 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1047, 3)
2025-09-11 12:51:58,581 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-11 12:51:58,581 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-11 12:51:58,583 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 1개
2025-09-11 12:51:58,585 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 1개
2025-09-11 12:51:58,585 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-09-11 12:51:58,588 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시']
2025-09-11 12:51:58,590 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (1, 2)
2025-09-11 12:51:58,590 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-11 12:51:58,590 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.34초
2025-09-11 12:51:58,590 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시']
2025-09-11 12:51:58,590 - __main__ - INFO - 매칭된 상품 정보: (1, 2)
2025-09-11 12:51:58,590 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-11 12:51:58,686 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-11 12:51:58,687 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-11 12:51:58,687 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-11 12:51:58,687 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-11 12:51:58,687 - __main__ - INFO - 후보 아이템 리스트 크기: 1개
2025-09-11 12:51:58,687 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시']
2025-09-11 12:51:58,687 - __main__ - INFO - extra_item_pdf 크기: (1, 2)
2025-09-11 12:51:58,687 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-11 12:51:58,687 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-11 12:51:58,688 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 1개
2025-09-11 12:51:58,688 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': 'GALAXY', 'action': '기타'}]
2025-09-11 12:51:58,688 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-11 12:51:58,688 - __main__ - INFO - 구성된 프롬프트 길이: 5000 문자
2025-09-11 12:51:58,688 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-11 12:51:58,688 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 5000)
2025-09-11 12:51:58,688 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-11 12:51:58,688 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-11 12:52:07,004 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-11 12:52:07,013 - __main__ - INFO - LLM 응답 길이: 1245 문자
2025-09-11 12:52:07,014 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "갤럭시 S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        },
        {
            "name"...
2025-09-11 12:52:07,014 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-11 12:52:07,014 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-11 12:52:07,014 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-11 12:52:07,015 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': '갤럭시 S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}, {'name': '인터넷+TV', 'action': '가입'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '가입'}, {'type': '전화번호', 'value': '080-801-0011', 'action': '수신 거부'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-11 12:52:07,015 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-11 12:52:07,015 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', '갤럭시 S24 FE', '아이폰17', '인터넷+TV']
2025-09-11 12:52:07,210 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 3050)
2025-09-11 12:52:07,210 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-11 12:52:07,210 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-11 12:52:07,790 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-11 12:52:08,076 - __main__ - INFO - extract_entities_by_llm 실행완료: 1.06초
2025-09-11 12:52:08,133 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-11 12:52:08,133 - __main__ - INFO - ============================================================
2025-09-11 12:52:08,133 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-11 12:52:08,133 - __main__ - INFO - ============================================================
2025-09-11 12:52:08,133 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-11 12:52:08,133 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-11 12:52:08,133 - __main__ - INFO - 상품 수: 2개
2025-09-11 12:52:08,133 - __main__ - INFO - 채널 수: 5개
2025-09-11 12:52:08,133 - __main__ - INFO - 프로그램 수: 2개
2025-09-11 12:52:08,133 - __main__ - INFO - process_message 실행완료: 10.88초
2025-09-11 12:52:08,133 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-11 15:03:17,844 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-11 15:03:17,844 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-11 15:03:17,844 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-11 15:03:17,845 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-09-11 15:03:17,845 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-11 15:03:17,846 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-11 15:03:17,862 - __main__ - INFO - Using device: mps
2025-09-11 15:03:17,862 - __main__ - INFO - _initialize_device 실행완료: 0.02초
2025-09-11 15:03:17,862 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-11 15:03:17,862 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-11 15:03:17,862 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-11 15:03:17,862 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-11 15:03:17,862 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-11 15:03:17,863 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-11 15:03:17,863 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-11 15:03:18,981 - __main__ - INFO - Model loaded on mps
2025-09-11 15:03:18,981 - __main__ - INFO - _initialize_embedding_model 실행완료: 1.12초
2025-09-11 15:03:18,981 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-11 15:03:19,392 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-11 15:03:19,392 - __main__ - INFO - _initialize_kiwi 실행완료: 0.41초
2025-09-11 15:03:19,392 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-11 15:03:19,392 - __main__ - INFO - ============================================================
2025-09-11 15:03:19,392 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-11 15:03:19,392 - __main__ - INFO - ============================================================
2025-09-11 15:03:19,393 - __main__ - INFO - 데이터 소스 모드: local
2025-09-11 15:03:19,393 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-11 15:03:19,393 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-11 15:03:19,393 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-11 15:03:19,393 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-11 15:03:19,466 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-11 15:03:19,466 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-11 15:03:19,466 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-11 15:03:19,470 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-11 15:03:19,470 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-11 15:03:19,471 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 15:03:19,471 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 15:03:19,472 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-11 15:03:19,472 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-11 15:03:19,473 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-11 15:03:19,476 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-11 15:03:19,476 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-11 15:03:19,476 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 15:03:19,476 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-11 15:03:19,476 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-11 15:03:19,477 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-11 15:03:19,477 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 15:03:19,477 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-11 15:03:19,477 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-11 15:03:19,477 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-11 15:03:19,480 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-11 15:03:19,480 - __main__ - INFO - null이 아닌 상품명 수: 10551개
2025-09-11 15:03:19,480 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 15:03:19,480 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-11 15:03:19,481 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 15:03:19,605 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-11 15:03:19,609 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 21522
2025-09-11 15:03:19,610 - __main__ - INFO - 별칭 적용 후 샘플: ['우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증']
2025-09-11 15:03:19,610 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-11 15:03:19,610 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (21522, 9)
2025-09-11 15:03:19,610 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-11 15:03:19,611 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-11 15:03:19,611 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-11 15:03:19,611 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-11 15:03:19,611 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-11 15:03:19,613 - __main__ - INFO - 등록할 고유 별칭 수: 16403개
2025-09-11 15:03:19,613 - __main__ - INFO - 유효한 별칭 수: 16403개
2025-09-11 15:03:19,613 - __main__ - INFO - 등록할 별칭 샘플: ['우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증']
2025-09-11 15:03:19,629 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16403개 성공, 0개 실패
2025-09-11 15:03:19,629 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-11 15:03:19,629 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-11 15:03:19,631 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-11 15:03:19,632 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-11 15:03:19,814 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-11 15:03:19,815 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-11 15:03:19,815 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-11 15:03:19,815 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-09-11 15:03:19,815 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-09-11 15:03:19,815 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-11 15:03:19,880 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-09-11 15:03:19,880 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-11 15:03:19,882 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-09-11 15:03:19,883 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-09-11 15:03:19,883 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-09-11 15:03:19,883 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 15:03:19,883 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-09-11 15:03:19,884 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-11 15:03:19,884 - __main__ - INFO - ============================================================
2025-09-11 15:03:19,884 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-11 15:03:19,884 - __main__ - INFO - ============================================================
2025-09-11 15:03:19,884 - __main__ - INFO - ✅ 상품 데이터: (21522, 9)
2025-09-11 15:03:19,884 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-11 15:03:19,884 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-11 15:03:19,884 - __main__ - INFO - ✅ 정지어: 166개
2025-09-11 15:03:19,884 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-11 15:03:19,885 - __main__ - INFO - 고유 상품명 수: 6847개
2025-09-11 15:03:19,887 - __main__ - INFO - 고유 별칭 수: 16403개
2025-09-11 15:03:19,888 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-11 15:03:19,888 - __main__ - INFO - _load_data 실행완료: 0.50초
2025-09-11 15:03:19,888 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-11 15:03:19,888 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-11 15:03:19,888 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-11 15:03:19,888 - __main__ - INFO - ============================================================
2025-09-11 15:03:19,888 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-11 15:03:19,888 - __main__ - INFO - ============================================================
2025-09-11 15:03:19,888 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-11 15:03:19,888 - __main__ - INFO - 메시지 길이: 420 문자
2025-09-11 15:03:19,888 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-11 15:03:19,888 - __main__ - INFO - 데이터 소스: local
2025-09-11 15:03:19,888 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-11 15:03:19,888 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-11 15:03:19,888 - __main__ - INFO - LLM 모델: ax
2025-09-11 15:03:19,888 - __main__ - INFO - 상품 데이터 크기: (21522, 9)
2025-09-11 15:03:19,888 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-11 15:03:19,888 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-11 15:03:19,888 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-11 15:03:19,888 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-11 15:03:19,889 - __main__ - INFO - 매칭할 상품 별칭 수: 16403개
2025-09-11 15:03:20,352 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-11 15:03:20,352 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-11 15:03:20,356 - __main__ - INFO - 전체 토큰 수: 155개
2025-09-11 15:03:20,356 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하', '갤럭시', 'A', '기기값', '아이폰', '을지로입구역', '하나은행', '명동']
2025-09-11 15:03:20,356 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['을지로입구역', '아이폰', '기기값', '하나은행', '구매하', '명동', '갤럭시']
2025-09-11 15:03:20,356 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-11 15:03:21,113 - __main__ - INFO - 퍼지 매칭 결과 크기: (1047, 3)
2025-09-11 15:03:21,113 - __main__ - INFO - 퍼지 매칭 성공: 1047개 결과
2025-09-11 15:03:21,114 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-11 15:03:21,114 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-11 15:03:21,153 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1047, 3)
2025-09-11 15:03:21,154 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-11 15:03:21,154 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-11 15:03:21,156 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 1개
2025-09-11 15:03:21,157 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 1개
2025-09-11 15:03:21,158 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-09-11 15:03:21,160 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시']
2025-09-11 15:03:21,161 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (1, 2)
2025-09-11 15:03:21,162 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-11 15:03:21,162 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.27초
2025-09-11 15:03:21,162 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시']
2025-09-11 15:03:21,162 - __main__ - INFO - 매칭된 상품 정보: (1, 2)
2025-09-11 15:03:21,162 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-11 15:03:21,263 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-11 15:03:21,263 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-11 15:03:21,263 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-11 15:03:21,263 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-11 15:03:21,263 - __main__ - INFO - 후보 아이템 리스트 크기: 1개
2025-09-11 15:03:21,263 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시']
2025-09-11 15:03:21,263 - __main__ - INFO - extra_item_pdf 크기: (1, 2)
2025-09-11 15:03:21,263 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-11 15:03:21,264 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-11 15:03:21,265 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 1개
2025-09-11 15:03:21,265 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': 'GALAXY', 'action': '기타'}]
2025-09-11 15:03:21,265 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-11 15:03:21,265 - __main__ - INFO - 구성된 프롬프트 길이: 5000 문자
2025-09-11 15:03:21,265 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-11 15:03:21,265 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 5000)
2025-09-11 15:03:21,265 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-11 15:03:21,265 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-11 15:03:30,185 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-11 15:03:30,198 - __main__ - INFO - LLM 응답 길이: 1245 문자
2025-09-11 15:03:30,198 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "갤럭시 S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        },
        {
            "name"...
2025-09-11 15:03:30,198 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-11 15:03:30,199 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-11 15:03:30,199 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-11 15:03:30,199 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': '갤럭시 S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}, {'name': '인터넷+TV', 'action': '가입'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '가입'}, {'type': '전화번호', 'value': '080-801-0011', 'action': '수신 거부'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-11 15:03:30,199 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-11 15:03:30,199 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', '갤럭시 S24 FE', '아이폰17', '인터넷+TV']
2025-09-11 15:03:30,715 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-11 15:03:30,715 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 17480)
2025-09-11 15:03:30,715 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-11 15:03:30,715 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-11 15:03:31,269 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-11 15:03:31,518 - __main__ - INFO - extract_entities_by_llm 실행완료: 1.32초
2025-09-11 15:03:31,575 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-11 15:03:31,575 - __main__ - INFO - ============================================================
2025-09-11 15:03:31,575 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-11 15:03:31,575 - __main__ - INFO - ============================================================
2025-09-11 15:03:31,575 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-11 15:03:31,575 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-11 15:03:31,575 - __main__ - INFO - 상품 수: 1개
2025-09-11 15:03:31,575 - __main__ - INFO - 채널 수: 5개
2025-09-11 15:03:31,575 - __main__ - INFO - 프로그램 수: 2개
2025-09-11 15:03:31,575 - __main__ - INFO - process_message 실행완료: 11.69초
2025-09-11 15:03:31,575 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-19 12:49:49,150 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-19 12:49:49,152 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-19 12:49:49,152 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-19 12:49:49,152 - __main__ - INFO - 🎯 DAG 추출 모드 활성화됨
2025-09-19 12:49:49,152 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-19 12:49:49,153 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-19 12:49:49,208 - __main__ - INFO - Using device: mps
2025-09-19 12:49:49,208 - __main__ - INFO - _initialize_device 실행완료: 0.06초
2025-09-19 12:49:49,208 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-19 12:49:49,209 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-19 12:49:49,209 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-19 12:49:49,209 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-19 12:49:49,209 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-19 12:49:49,209 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-19 12:49:49,209 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-19 12:49:54,067 - __main__ - INFO - Model loaded on mps
2025-09-19 12:49:54,067 - __main__ - INFO - _initialize_embedding_model 실행완료: 4.86초
2025-09-19 12:49:54,067 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-19 12:49:54,573 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-19 12:49:54,573 - __main__ - INFO - _initialize_kiwi 실행완료: 0.51초
2025-09-19 12:49:54,573 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-19 12:49:54,573 - __main__ - INFO - ============================================================
2025-09-19 12:49:54,573 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-19 12:49:54,573 - __main__ - INFO - ============================================================
2025-09-19 12:49:54,573 - __main__ - INFO - 데이터 소스 모드: local
2025-09-19 12:49:54,573 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-19 12:49:54,573 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-19 12:49:54,573 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-19 12:49:54,574 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-19 12:49:54,646 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-19 12:49:54,646 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-19 12:49:54,647 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-19 12:49:54,652 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-19 12:49:54,652 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-19 12:49:54,653 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-19 12:49:54,653 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-19 12:49:54,654 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-19 12:49:54,654 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-19 12:49:54,661 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-19 12:49:54,663 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-19 12:49:54,663 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-19 12:49:54,663 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-19 12:49:54,663 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-19 12:49:54,663 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-19 12:49:54,664 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-19 12:49:54,664 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-19 12:49:54,664 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-19 12:49:54,664 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-19 12:49:54,664 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-19 12:49:54,669 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-19 12:49:54,669 - __main__ - INFO - null이 아닌 상품명 수: 10551개
2025-09-19 12:49:54,669 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-19 12:49:54,669 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-19 12:49:54,670 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-19 12:49:54,799 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-19 12:49:54,805 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 21522
2025-09-19 12:49:54,806 - __main__ - INFO - 별칭 적용 후 샘플: ['우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주패스 넷플릭스 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증']
2025-09-19 12:49:54,806 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-19 12:49:54,806 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (21522, 9)
2025-09-19 12:49:54,806 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-19 12:49:54,807 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-19 12:49:54,807 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-19 12:49:54,807 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-19 12:49:54,807 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-19 12:49:54,809 - __main__ - INFO - 등록할 고유 별칭 수: 16403개
2025-09-19 12:49:54,810 - __main__ - INFO - 유효한 별칭 수: 16403개
2025-09-19 12:49:54,810 - __main__ - INFO - 등록할 별칭 샘플: ['우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주패스 넷플릭스 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증']
2025-09-19 12:49:54,822 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16403개 성공, 0개 실패
2025-09-19 12:49:54,822 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-19 12:49:54,822 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-19 12:49:54,834 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-19 12:49:54,834 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-19 12:49:55,054 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-19 12:49:55,055 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-19 12:49:55,055 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-19 12:49:55,055 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-09-19 12:49:55,055 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-09-19 12:49:55,055 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-19 12:49:55,123 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-09-19 12:49:55,123 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-19 12:49:55,124 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-09-19 12:49:55,124 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-09-19 12:49:55,125 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-09-19 12:49:55,125 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-19 12:49:55,125 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-09-19 12:49:55,125 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-19 12:49:55,125 - __main__ - INFO - ============================================================
2025-09-19 12:49:55,125 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-19 12:49:55,125 - __main__ - INFO - ============================================================
2025-09-19 12:49:55,125 - __main__ - INFO - ✅ 상품 데이터: (21522, 9)
2025-09-19 12:49:55,125 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-19 12:49:55,125 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-19 12:49:55,125 - __main__ - INFO - ✅ 정지어: 166개
2025-09-19 12:49:55,125 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-19 12:49:55,126 - __main__ - INFO - 고유 상품명 수: 6847개
2025-09-19 12:49:55,128 - __main__ - INFO - 고유 별칭 수: 16403개
2025-09-19 12:49:55,129 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-19 12:49:55,129 - __main__ - INFO - _load_data 실행완료: 0.56초
2025-09-19 12:49:55,129 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-19 12:49:55,129 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-19 12:49:55,129 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-19 12:49:55,129 - __main__ - INFO - ============================================================
2025-09-19 12:49:55,129 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-19 12:49:55,129 - __main__ - INFO - ============================================================
2025-09-19 12:49:55,129 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-19 12:49:55,129 - __main__ - INFO - 메시지 길이: 421 문자
2025-09-19 12:49:55,129 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-19 12:49:55,129 - __main__ - INFO - 데이터 소스: local
2025-09-19 12:49:55,129 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-19 12:49:55,129 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-19 12:49:55,129 - __main__ - INFO - LLM 모델: ax
2025-09-19 12:49:55,129 - __main__ - INFO - 상품 데이터 크기: (21522, 9)
2025-09-19 12:49:55,129 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-19 12:49:55,129 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-19 12:49:55,129 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-19 12:49:55,129 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-19 12:49:55,131 - __main__ - INFO - 매칭할 상품 별칭 수: 16403개
2025-09-19 12:49:55,588 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-19 12:49:55,588 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-19 12:49:55,591 - __main__ - INFO - 전체 토큰 수: 155개
2025-09-19 12:49:55,591 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하', '갤럭시', 'A', '기기값', '아이폰', '을지로입구역', '하나은행', '명동']
2025-09-19 12:49:55,591 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['아이폰', '하나은행', '구매하', '명동', '갤럭시', '을지로입구역', '기기값']
2025-09-19 12:49:55,591 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-19 12:49:56,031 - __main__ - INFO - 퍼지 매칭 결과 크기: (1047, 3)
2025-09-19 12:49:56,032 - __main__ - INFO - 퍼지 매칭 성공: 1047개 결과
2025-09-19 12:49:56,032 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-19 12:49:56,032 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-19 12:49:56,058 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1047, 3)
2025-09-19 12:49:56,059 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-19 12:49:56,059 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-19 12:49:56,061 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 1개
2025-09-19 12:49:56,062 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 1개
2025-09-19 12:49:56,062 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-09-19 12:49:56,065 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시']
2025-09-19 12:49:56,066 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (1, 2)
2025-09-19 12:49:56,066 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-19 12:49:56,066 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 0.94초
2025-09-19 12:49:56,066 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시']
2025-09-19 12:49:56,066 - __main__ - INFO - 매칭된 상품 정보: (1, 2)
2025-09-19 12:49:56,066 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-19 12:49:56,154 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-19 12:49:56,154 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-19 12:49:56,154 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-19 12:49:56,154 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-19 12:49:56,155 - __main__ - INFO - 후보 아이템 리스트 크기: 1개
2025-09-19 12:49:56,155 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시']
2025-09-19 12:49:56,155 - __main__ - INFO - extra_item_pdf 크기: (1, 2)
2025-09-19 12:49:56,155 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-19 12:49:56,155 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-19 12:49:56,156 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 1개
2025-09-19 12:49:56,156 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': 'GALAXY', 'action': '기타'}]
2025-09-19 12:49:56,156 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-19 12:49:56,156 - __main__ - INFO - 구성된 프롬프트 길이: 5000 문자
2025-09-19 12:49:56,156 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-19 12:49:56,156 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 5000)
2025-09-19 12:49:56,156 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-19 12:49:56,156 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-19 12:50:04,611 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-19 12:50:04,625 - __main__ - INFO - LLM 응답 길이: 1245 문자
2025-09-19 12:50:04,626 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "갤럭시 S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        },
        {
            "name"...
2025-09-19 12:50:04,626 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-19 12:50:04,626 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-19 12:50:04,626 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-19 12:50:04,626 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': '갤럭시 S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}, {'name': '인터넷+TV', 'action': '가입'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '가입'}, {'type': '전화번호', 'value': '080-801-0011', 'action': '수신 거부'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-19 12:50:04,626 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-19 12:50:04,626 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', '갤럭시 S24 FE', '아이폰17', '인터넷+TV']
2025-09-19 12:50:05,001 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-19 12:50:05,001 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 17480)
2025-09-19 12:50:05,001 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-19 12:50:05,001 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-19 12:50:06,545 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-19 12:50:06,722 - __main__ - INFO - extract_entities_by_llm 실행완료: 2.10초
2025-09-19 12:50:06,754 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-19 12:50:06,754 - __main__ - INFO - ============================================================
2025-09-19 12:50:06,754 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-19 12:50:06,754 - __main__ - INFO - ============================================================
2025-09-19 12:50:06,754 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-19 12:50:06,754 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-19 12:50:06,754 - __main__ - INFO - 상품 수: 1개
2025-09-19 12:50:06,754 - __main__ - INFO - 채널 수: 5개
2025-09-19 12:50:06,754 - __main__ - INFO - 프로그램 수: 2개
2025-09-19 12:50:06,754 - __main__ - INFO - process_message 실행완료: 11.63초
2025-09-19 12:50:06,754 - __main__ - INFO - 순차적 처리로 메인 추출 및 DAG 추출 수행
2025-09-19 12:50:06,754 - __main__ - INFO - ============================== DAG 추출 시작 ==============================
2025-09-19 12:50:06,755 - entity_dag_extractor - INFO - 🚀 DAG 추출 프로세스 시작
2025-09-19 12:50:06,755 - entity_dag_extractor - INFO - 📝 입력 메시지 길이: 421자
2025-09-19 12:50:06,755 - entity_dag_extractor - INFO - 🤖 사용 LLM 모델: client=<openai.resources.chat.completions.completions.Completions object at 0x128f93410> async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x128f93770> root_client=<openai.OpenAI object at 0x1291e5f20> root_async_client=<openai.AsyncOpenAI object at 0x128f93530> model_name='skt/ax4' temperature=0.0 model_kwargs={} openai_api_key=SecretStr('**********') openai_api_base='https://api.platform.a15t.com/v1' max_tokens=4000
2025-09-19 12:50:06,755 - entity_dag_extractor - INFO - 🤖 LLM에 DAG 추출 요청 중...
2025-09-19 12:50:06,755 - entity_dag_extractor - INFO - 📏 프롬프트 길이: 3406자
2025-09-19 12:50:35,449 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-19 12:50:35,453 - entity_dag_extractor - INFO - 📝 LLM 응답 길이: 3198자
2025-09-19 12:50:35,453 - entity_dag_extractor - INFO - 📄 LLM 응답 미리보기: ## 1. 메시지 분석

```
[메시지 요약 및 핵심 의도]
SKT 을지로점에서 9월 중 갤럭시 시리즈와 아이폰17에 대한 특별 할인 및 혜택을 제공하며, SK로 통신사 이동 시 추가 혜택을 안내함. 매장 방문과 온라인 사전예약을 통해 기기 구매 및 통신사 이동을 유도하고 있음.

[식별된 가치 제안 목록]
- 갤럭시 시리즈(와이드8, A36, S24 F...
2025-09-19 12:50:35,453 - entity_dag_extractor - INFO - 🔍 DAG 섹션 추출 중...
2025-09-19 12:50:35,454 - entity_dag_extractor - INFO - 📄 추출된 DAG 섹션 길이: 284자
2025-09-19 12:50:35,454 - entity_dag_extractor - INFO - 🔗 DAG 파싱 중...
2025-09-19 12:50:35,455 - entity_dag_extractor - INFO - 📊 파싱된 DAG - 노드 수: 11, 엣지 수: 9
2025-09-19 12:50:35,455 - entity_dag_extractor - INFO - 🎯 DAG 노드 목록: ['을지로점:방문', '갤럭시:구매', '기기값할인:수령', '추가할인:수령', '통신사:이동', '상품권:수령', '인터넷TV:가입', '현금지원:수령', '온라인링크:접속', '아이폰17:사전예약', '바로개통:수령']
2025-09-19 12:50:35,455 - entity_dag_extractor - INFO - 🔗 DAG 엣지 목록: [('을지로점:방문', '갤럭시:구매'), ('을지로점:방문', '통신사:이동'), ('갤럭시:구매', '기기값할인:수령'), ('갤럭시:구매', '추가할인:수령'), ('통신사:이동', '상품권:수령'), ('통신사:이동', '인터넷TV:가입'), ('인터넷TV:가입', '현금지원:수령'), ('온라인링크:접속', '아이폰17:사전예약'), ('아이폰17:사전예약', '바로개통:수령')]
2025-09-19 12:50:35,455 - entity_dag_extractor - INFO - ✅ DAG 추출 프로세스 완료
2025-09-19 12:50:35,456 - utils - INFO - 🎨 DAG 다이어그램 생성 시작 - 파일명: dag_ea42c65e2727ae609ac65fcfbeae8a3ccd3131f39e75b2236c29bf21305dca18
2025-09-19 12:50:35,456 - utils - INFO - 📊 입력 그래프 - 노드 수: 11, 엣지 수: 9
2025-09-19 12:50:35,458 - utils - INFO - 🖼️ DAG 이미지 렌더링 중...
2025-09-19 12:50:36,481 - utils - INFO - ✅ DAG 다이어그램 생성 완료: dag_images/dag_ea42c65e2727ae609ac65fcfbeae8a3ccd3131f39e75b2236c29bf21305dca18.png
2025-09-19 12:50:36,482 - __main__ - INFO - ✅ DAG 추출 완료: dag_ea42c65e2727ae609ac65fcfbeae8a3ccd3131f39e75b2236c29bf21305dca18
2025-09-19 12:50:36,482 - __main__ - INFO - 🕒 DAG 처리 시간: 29.727초
2025-09-19 12:50:36,482 - __main__ - INFO - 📏 DAG 섹션 길이: 284자
2025-09-19 12:50:36,482 - __main__ - INFO - 📄 DAG 내용 미리보기: (을지로점:방문) -[방문하면]-> (갤럭시:구매)
(갤럭시:구매) -[구매하면]-> (기기값할인:수령)
(갤럭시:구매) -[구매후 제휴카드사용하면]-> (추가할인:수령)
(을지로점:방문) -[방문하면]-> (통신사:이동)
(통신사:이동) -[이동하면]-> (상품권:수령)
(통신사:이동) -[이동하면]-> (인터넷TV:가입)
(인터넷TV:가입) -[가입하면...
2025-09-19 12:50:36,482 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-19 12:50:37,065 - mongodb_utils - INFO - MongoDB 연결 성공: aos.mmsext
2025-09-19 12:50:37,067 - mongodb_utils - INFO - 문서 저장 성공: 68ccd30dd4cb39cb1ae1e705
2025-09-19 12:50:37,068 - mongodb_utils - INFO - MongoDB 연결 해제
2025-09-19 16:03:44,949 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-19 16:03:44,949 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-19 16:03:44,949 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-19 16:03:44,949 - __main__ - INFO - 🎯 DAG 추출 모드 활성화됨
2025-09-19 16:03:44,949 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-19 16:03:44,950 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-19 16:03:44,967 - __main__ - INFO - Using device: mps
2025-09-19 16:03:44,967 - __main__ - INFO - _initialize_device 실행완료: 0.02초
2025-09-19 16:03:44,967 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-19 16:03:44,968 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-19 16:03:44,968 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-19 16:03:44,968 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-19 16:03:44,968 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-19 16:03:44,968 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-19 16:03:44,968 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-19 16:03:46,077 - __main__ - INFO - Model loaded on mps
2025-09-19 16:03:46,077 - __main__ - INFO - _initialize_embedding_model 실행완료: 1.11초
2025-09-19 16:03:46,077 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-19 16:03:46,505 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-19 16:03:46,505 - __main__ - INFO - _initialize_kiwi 실행완료: 0.43초
2025-09-19 16:03:46,505 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-19 16:03:46,505 - __main__ - INFO - ============================================================
2025-09-19 16:03:46,506 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-19 16:03:46,506 - __main__ - INFO - ============================================================
2025-09-19 16:03:46,506 - __main__ - INFO - 데이터 소스 모드: local
2025-09-19 16:03:46,506 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-19 16:03:46,506 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-19 16:03:46,506 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-19 16:03:46,506 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-19 16:03:46,570 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-19 16:03:46,570 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-19 16:03:46,570 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-19 16:03:46,574 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-19 16:03:46,574 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-19 16:03:46,575 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-19 16:03:46,575 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-19 16:03:46,576 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-19 16:03:46,576 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-19 16:03:46,578 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-19 16:03:46,580 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-19 16:03:46,580 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-19 16:03:46,580 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-19 16:03:46,581 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-19 16:03:46,581 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-19 16:03:46,581 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-19 16:03:46,581 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-19 16:03:46,581 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-19 16:03:46,581 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-19 16:03:46,581 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-19 16:03:46,582 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-19 16:03:46,583 - __main__ - INFO - null이 아닌 상품명 수: 10551개
2025-09-19 16:03:46,583 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-19 16:03:46,583 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-19 16:03:46,583 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-19 16:03:46,710 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-19 16:03:46,715 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 21522
2025-09-19 16:03:46,716 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 Netflix 인증', '우주패스 넷플릭스 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증']
2025-09-19 16:03:46,716 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-19 16:03:46,716 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (21522, 9)
2025-09-19 16:03:46,716 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-19 16:03:46,717 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-19 16:03:46,717 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-19 16:03:46,717 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-19 16:03:46,717 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-19 16:03:46,719 - __main__ - INFO - 등록할 고유 별칭 수: 16403개
2025-09-19 16:03:46,720 - __main__ - INFO - 유효한 별칭 수: 16403개
2025-09-19 16:03:46,720 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 Netflix 인증', '우주패스 넷플릭스 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증']
2025-09-19 16:03:46,734 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16403개 성공, 0개 실패
2025-09-19 16:03:46,734 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-19 16:03:46,734 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-19 16:03:46,736 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-19 16:03:46,736 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-19 16:03:46,915 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-19 16:03:46,916 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-19 16:03:46,916 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-19 16:03:46,916 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-09-19 16:03:46,916 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-09-19 16:03:46,916 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-19 16:03:46,984 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-09-19 16:03:46,984 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-19 16:03:46,986 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-09-19 16:03:46,986 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-09-19 16:03:46,986 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-09-19 16:03:46,986 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-19 16:03:46,986 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-09-19 16:03:46,987 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-19 16:03:46,987 - __main__ - INFO - ============================================================
2025-09-19 16:03:46,987 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-19 16:03:46,987 - __main__ - INFO - ============================================================
2025-09-19 16:03:46,987 - __main__ - INFO - ✅ 상품 데이터: (21522, 9)
2025-09-19 16:03:46,987 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-19 16:03:46,987 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-19 16:03:46,987 - __main__ - INFO - ✅ 정지어: 166개
2025-09-19 16:03:46,987 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-19 16:03:46,988 - __main__ - INFO - 고유 상품명 수: 6847개
2025-09-19 16:03:46,990 - __main__ - INFO - 고유 별칭 수: 16403개
2025-09-19 16:03:46,991 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-19 16:03:46,991 - __main__ - INFO - _load_data 실행완료: 0.49초
2025-09-19 16:03:46,991 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-19 16:03:46,991 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-19 16:03:46,991 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-19 16:03:46,991 - __main__ - INFO - ============================================================
2025-09-19 16:03:46,991 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-19 16:03:46,991 - __main__ - INFO - ============================================================
2025-09-19 16:03:46,991 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-19 16:03:46,991 - __main__ - INFO - 메시지 길이: 421 문자
2025-09-19 16:03:46,991 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-19 16:03:46,991 - __main__ - INFO - 데이터 소스: local
2025-09-19 16:03:46,991 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-19 16:03:46,992 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-19 16:03:46,992 - __main__ - INFO - LLM 모델: ax
2025-09-19 16:03:46,992 - __main__ - INFO - 상품 데이터 크기: (21522, 9)
2025-09-19 16:03:46,992 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-19 16:03:46,992 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-19 16:03:46,992 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-19 16:03:46,992 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-19 16:03:46,993 - __main__ - INFO - 매칭할 상품 별칭 수: 16403개
2025-09-19 16:03:47,474 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-19 16:03:47,475 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-19 16:03:47,478 - __main__ - INFO - 전체 토큰 수: 155개
2025-09-19 16:03:47,478 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하', '갤럭시', 'A', '기기값', '아이폰', '을지로입구역', '하나은행', '명동']
2025-09-19 16:03:47,478 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['하나은행', '명동', '을지로입구역', '아이폰', '구매하', '갤럭시', '기기값']
2025-09-19 16:03:47,478 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-19 16:03:48,367 - __main__ - INFO - 퍼지 매칭 결과 크기: (1047, 3)
2025-09-19 16:03:48,367 - __main__ - INFO - 퍼지 매칭 성공: 1047개 결과
2025-09-19 16:03:48,368 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-19 16:03:48,368 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-19 16:03:48,407 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1047, 3)
2025-09-19 16:03:48,408 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-19 16:03:48,408 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-19 16:03:48,410 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 1개
2025-09-19 16:03:48,412 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 1개
2025-09-19 16:03:48,413 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-09-19 16:03:48,415 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시']
2025-09-19 16:03:48,417 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (1, 2)
2025-09-19 16:03:48,417 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-19 16:03:48,417 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.43초
2025-09-19 16:03:48,417 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시']
2025-09-19 16:03:48,417 - __main__ - INFO - 매칭된 상품 정보: (1, 2)
2025-09-19 16:03:48,417 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-19 16:03:48,510 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-19 16:03:48,510 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-19 16:03:48,510 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-19 16:03:48,510 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-19 16:03:48,510 - __main__ - INFO - 후보 아이템 리스트 크기: 1개
2025-09-19 16:03:48,510 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시']
2025-09-19 16:03:48,510 - __main__ - INFO - extra_item_pdf 크기: (1, 2)
2025-09-19 16:03:48,510 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-19 16:03:48,510 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-19 16:03:48,511 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 1개
2025-09-19 16:03:48,511 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': 'GALAXY', 'action': '기타'}]
2025-09-19 16:03:48,511 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-19 16:03:48,512 - __main__ - INFO - 구성된 프롬프트 길이: 5000 문자
2025-09-19 16:03:48,512 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-19 16:03:48,512 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 5000)
2025-09-19 16:03:48,512 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-19 16:03:48,512 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-19 16:03:57,670 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-19 16:03:57,684 - __main__ - INFO - LLM 응답 길이: 1245 문자
2025-09-19 16:03:57,684 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "갤럭시 S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        },
        {
            "name"...
2025-09-19 16:03:57,684 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-19 16:03:57,684 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-19 16:03:57,685 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-19 16:03:57,685 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': '갤럭시 S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}, {'name': '인터넷+TV', 'action': '가입'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '가입'}, {'type': '전화번호', 'value': '080-801-0011', 'action': '수신 거부'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-19 16:03:57,685 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-19 16:03:57,685 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', '갤럭시 S24 FE', '아이폰17', '인터넷+TV']
2025-09-19 16:03:58,184 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-19 16:03:58,185 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 17480)
2025-09-19 16:03:58,185 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-19 16:03:58,185 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-19 16:03:59,703 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-19 16:03:59,974 - __main__ - INFO - extract_entities_by_llm 실행완료: 2.29초
2025-09-19 16:04:00,031 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-19 16:04:00,031 - __main__ - INFO - ============================================================
2025-09-19 16:04:00,031 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-19 16:04:00,031 - __main__ - INFO - ============================================================
2025-09-19 16:04:00,031 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-19 16:04:00,031 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-19 16:04:00,031 - __main__ - INFO - 상품 수: 1개
2025-09-19 16:04:00,031 - __main__ - INFO - 채널 수: 5개
2025-09-19 16:04:00,031 - __main__ - INFO - 프로그램 수: 2개
2025-09-19 16:04:00,031 - __main__ - INFO - process_message 실행완료: 13.04초
2025-09-19 16:04:00,031 - __main__ - INFO - 순차적 처리로 메인 추출 및 DAG 추출 수행
2025-09-19 16:04:00,031 - __main__ - INFO - ============================== DAG 추출 시작 ==============================
2025-09-19 16:04:00,032 - entity_dag_extractor - INFO - 🚀 DAG 추출 프로세스 시작
2025-09-19 16:04:00,032 - entity_dag_extractor - INFO - 📝 입력 메시지 길이: 421자
2025-09-19 16:04:00,032 - entity_dag_extractor - INFO - 🤖 사용 LLM 모델: client=<openai.resources.chat.completions.completions.Completions object at 0x34550d790> async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x3500f9400> root_client=<openai.OpenAI object at 0x34546bf50> root_async_client=<openai.AsyncOpenAI object at 0x34550c110> model_name='skt/ax4' temperature=0.0 model_kwargs={} openai_api_key=SecretStr('**********') openai_api_base='https://api.platform.a15t.com/v1' max_tokens=4000
2025-09-19 16:04:00,032 - entity_dag_extractor - INFO - 🤖 LLM에 DAG 추출 요청 중...
2025-09-19 16:04:00,032 - entity_dag_extractor - INFO - 📏 프롬프트 길이: 3406자
2025-09-19 16:04:29,438 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-19 16:04:29,441 - entity_dag_extractor - INFO - 📝 LLM 응답 길이: 3008자
2025-09-19 16:04:29,441 - entity_dag_extractor - INFO - 📄 LLM 응답 미리보기: ## 1. 메시지 분석

```
[메시지 요약 및 핵심 의도]
SKT 을지로점에서 9월 중 갤럭시 시리즈와 아이폰17에 대한 특별 할인 및 혜택을 제공하며, SK로 통신사 이동 시 추가 혜택을 안내함. 매장 방문과 온라인 사전예약을 통해 기기 구매 및 통신사 이동을 유도하고 있음.

[식별된 가치 제안 목록]
- 갤럭시 시리즈(와이드8, A36, S24 F...
2025-09-19 16:04:29,441 - entity_dag_extractor - INFO - 🔍 DAG 섹션 추출 중...
2025-09-19 16:04:29,442 - entity_dag_extractor - INFO - 📄 추출된 DAG 섹션 길이: 312자
2025-09-19 16:04:29,442 - entity_dag_extractor - INFO - 🔗 DAG 파싱 중...
2025-09-19 16:04:29,443 - entity_dag_extractor - INFO - 📊 파싱된 DAG - 노드 수: 12, 엣지 수: 10
2025-09-19 16:04:29,443 - entity_dag_extractor - INFO - 🎯 DAG 노드 목록: ['을지로점:방문', '갤럭시:구매', '기기값할인:수령', '추가할인:수령', '통신사:이동', '상품권:수령', '인터넷TV:가입', '현금지원:수령', '온라인링크:접속', '아이폰17:사전예약', '바로개통:수령', '아이폰17:구매']
2025-09-19 16:04:29,443 - entity_dag_extractor - INFO - 🔗 DAG 엣지 목록: [('을지로점:방문', '갤럭시:구매'), ('을지로점:방문', '통신사:이동'), ('갤럭시:구매', '기기값할인:수령'), ('갤럭시:구매', '추가할인:수령'), ('통신사:이동', '상품권:수령'), ('통신사:이동', '인터넷TV:가입'), ('인터넷TV:가입', '현금지원:수령'), ('온라인링크:접속', '아이폰17:사전예약'), ('아이폰17:사전예약', '바로개통:수령'), ('아이폰17:사전예약', '아이폰17:구매')]
2025-09-19 16:04:29,443 - entity_dag_extractor - INFO - ✅ DAG 추출 프로세스 완료
2025-09-19 16:04:29,444 - utils - INFO - 🎨 DAG 다이어그램 생성 시작 - 파일명: dag_ea42c65e2727ae609ac65fcfbeae8a3ccd3131f39e75b2236c29bf21305dca18
2025-09-19 16:04:29,444 - utils - INFO - 📊 입력 그래프 - 노드 수: 12, 엣지 수: 10
2025-09-19 16:04:29,446 - utils - INFO - 🖼️ DAG 이미지 렌더링 중...
2025-09-19 16:04:29,665 - utils - INFO - ✅ DAG 다이어그램 생성 완료: dag_images/dag_ea42c65e2727ae609ac65fcfbeae8a3ccd3131f39e75b2236c29bf21305dca18.png
2025-09-19 16:04:29,665 - __main__ - INFO - ✅ DAG 추출 완료: dag_ea42c65e2727ae609ac65fcfbeae8a3ccd3131f39e75b2236c29bf21305dca18
2025-09-19 16:04:29,665 - __main__ - INFO - 🕒 DAG 처리 시간: 29.634초
2025-09-19 16:04:29,665 - __main__ - INFO - 📏 DAG 섹션 길이: 312자
2025-09-19 16:04:29,666 - __main__ - INFO - 📄 DAG 내용 미리보기: (을지로점:방문) -[방문하면]-> (갤럭시:구매)
(갤럭시:구매) -[구매하면]-> (기기값할인:수령)
(갤럭시:구매) -[제휴카드사용하면]-> (추가할인:수령)
(을지로점:방문) -[방문하면]-> (통신사:이동)
(통신사:이동) -[이동하면]-> (상품권:수령)
(통신사:이동) -[이동후]-> (인터넷TV:가입)
(인터넷TV:가입) -[가입하면]-> (...
2025-09-19 16:04:29,666 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-19 16:04:29,743 - mongodb_utils - INFO - MongoDB 연결 성공: aos.mmsext
2025-09-19 16:04:29,744 - mongodb_utils - INFO - 문서 저장 성공: 68cd007df56630caefcaa11c
2025-09-19 16:04:29,744 - mongodb_utils - INFO - MongoDB 연결 해제
2025-09-19 16:23:51,078 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-19 16:23:51,079 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-19 16:23:51,079 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-19 16:23:51,079 - __main__ - INFO - 🎯 DAG 추출 모드 활성화됨
2025-09-19 16:23:51,079 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-19 16:23:51,083 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-19 16:23:51,103 - __main__ - INFO - Using device: mps
2025-09-19 16:23:51,104 - __main__ - INFO - _initialize_device 실행완료: 0.02초
2025-09-19 16:23:51,104 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-19 16:23:51,104 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-19 16:23:51,104 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-19 16:23:51,104 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-19 16:23:51,104 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-19 16:23:51,104 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-19 16:23:51,104 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-19 16:23:52,546 - __main__ - INFO - Model loaded on mps
2025-09-19 16:23:52,546 - __main__ - INFO - _initialize_embedding_model 실행완료: 1.44초
2025-09-19 16:23:52,546 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-19 16:23:52,980 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-19 16:23:52,980 - __main__ - INFO - _initialize_kiwi 실행완료: 0.43초
2025-09-19 16:23:52,980 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-19 16:23:52,980 - __main__ - INFO - ============================================================
2025-09-19 16:23:52,980 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-19 16:23:52,980 - __main__ - INFO - ============================================================
2025-09-19 16:23:52,980 - __main__ - INFO - 데이터 소스 모드: local
2025-09-19 16:23:52,980 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-19 16:23:52,980 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-19 16:23:52,980 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-19 16:23:52,980 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-19 16:23:53,047 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-19 16:23:53,047 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-19 16:23:53,047 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-19 16:23:53,051 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-19 16:23:53,052 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-19 16:23:53,052 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-19 16:23:53,052 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-19 16:23:53,053 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-19 16:23:53,053 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-19 16:23:53,054 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-19 16:23:53,057 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-19 16:23:53,057 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-19 16:23:53,057 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-19 16:23:53,057 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-19 16:23:53,057 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-19 16:23:53,058 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-19 16:23:53,058 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-19 16:23:53,058 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-19 16:23:53,058 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-19 16:23:53,058 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-19 16:23:53,059 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-19 16:23:53,059 - __main__ - INFO - null이 아닌 상품명 수: 10551개
2025-09-19 16:23:53,059 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-19 16:23:53,060 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-19 16:23:53,060 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-19 16:23:53,184 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-19 16:23:53,189 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 21522
2025-09-19 16:23:53,189 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 넷플릭스 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증', '우주pass Netflix 인증']
2025-09-19 16:23:53,189 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-19 16:23:53,190 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (21522, 9)
2025-09-19 16:23:53,190 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-19 16:23:53,191 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-19 16:23:53,191 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-19 16:23:53,191 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-19 16:23:53,191 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-19 16:23:53,193 - __main__ - INFO - 등록할 고유 별칭 수: 16403개
2025-09-19 16:23:53,193 - __main__ - INFO - 유효한 별칭 수: 16403개
2025-09-19 16:23:53,193 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 넷플릭스 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증', '우주pass Netflix 인증']
2025-09-19 16:23:53,209 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16403개 성공, 0개 실패
2025-09-19 16:23:53,209 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-19 16:23:53,209 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-19 16:23:53,211 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-19 16:23:53,211 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-19 16:23:53,384 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-19 16:23:53,384 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-19 16:23:53,384 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-19 16:23:53,384 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-09-19 16:23:53,384 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-09-19 16:23:53,384 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-19 16:23:53,453 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-09-19 16:23:53,454 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-19 16:23:53,456 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-09-19 16:23:53,456 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-09-19 16:23:53,456 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-09-19 16:23:53,456 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-19 16:23:53,456 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-09-19 16:23:53,457 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-19 16:23:53,457 - __main__ - INFO - ============================================================
2025-09-19 16:23:53,457 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-19 16:23:53,457 - __main__ - INFO - ============================================================
2025-09-19 16:23:53,457 - __main__ - INFO - ✅ 상품 데이터: (21522, 9)
2025-09-19 16:23:53,457 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-19 16:23:53,457 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-19 16:23:53,457 - __main__ - INFO - ✅ 정지어: 166개
2025-09-19 16:23:53,457 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-19 16:23:53,458 - __main__ - INFO - 고유 상품명 수: 6847개
2025-09-19 16:23:53,460 - __main__ - INFO - 고유 별칭 수: 16403개
2025-09-19 16:23:53,461 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-19 16:23:53,461 - __main__ - INFO - _load_data 실행완료: 0.48초
2025-09-19 16:23:53,461 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-19 16:23:53,461 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-19 16:23:53,461 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-19 16:23:53,461 - __main__ - INFO - ============================================================
2025-09-19 16:23:53,461 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-19 16:23:53,461 - __main__ - INFO - ============================================================
2025-09-19 16:23:53,461 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-19 16:23:53,461 - __main__ - INFO - 메시지 길이: 421 문자
2025-09-19 16:23:53,461 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-19 16:23:53,461 - __main__ - INFO - 데이터 소스: local
2025-09-19 16:23:53,461 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-19 16:23:53,461 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-19 16:23:53,461 - __main__ - INFO - LLM 모델: ax
2025-09-19 16:23:53,461 - __main__ - INFO - 상품 데이터 크기: (21522, 9)
2025-09-19 16:23:53,461 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-19 16:23:53,461 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-19 16:23:53,461 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-19 16:23:53,461 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-19 16:23:53,463 - __main__ - INFO - 매칭할 상품 별칭 수: 16403개
2025-09-19 16:23:53,938 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-19 16:23:53,939 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-19 16:23:53,942 - __main__ - INFO - 전체 토큰 수: 155개
2025-09-19 16:23:53,942 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하', '갤럭시', 'A', '기기값', '아이폰', '을지로입구역', '하나은행', '명동']
2025-09-19 16:23:53,942 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['구매하', '아이폰', '명동', '을지로입구역', '하나은행', '갤럭시', '기기값']
2025-09-19 16:23:53,942 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-19 16:23:54,762 - __main__ - INFO - 퍼지 매칭 결과 크기: (1047, 3)
2025-09-19 16:23:54,763 - __main__ - INFO - 퍼지 매칭 성공: 1047개 결과
2025-09-19 16:23:54,763 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-19 16:23:54,763 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-19 16:23:54,915 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1047, 3)
2025-09-19 16:23:54,916 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-19 16:23:54,916 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-19 16:23:54,918 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 1개
2025-09-19 16:23:54,920 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 1개
2025-09-19 16:23:54,920 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-09-19 16:23:54,922 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시']
2025-09-19 16:23:54,923 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (1, 2)
2025-09-19 16:23:54,924 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-19 16:23:54,924 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.46초
2025-09-19 16:23:54,924 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시']
2025-09-19 16:23:54,924 - __main__ - INFO - 매칭된 상품 정보: (1, 2)
2025-09-19 16:23:54,924 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-19 16:23:55,113 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-19 16:23:55,113 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-19 16:23:55,113 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-19 16:23:55,113 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-19 16:23:55,113 - __main__ - INFO - 후보 아이템 리스트 크기: 1개
2025-09-19 16:23:55,113 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시']
2025-09-19 16:23:55,113 - __main__ - INFO - extra_item_pdf 크기: (1, 2)
2025-09-19 16:23:55,113 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-19 16:23:55,113 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-19 16:23:55,114 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 1개
2025-09-19 16:23:55,114 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': 'GALAXY', 'action': '기타'}]
2025-09-19 16:23:55,114 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-19 16:23:55,114 - __main__ - INFO - 구성된 프롬프트 길이: 5000 문자
2025-09-19 16:23:55,114 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-19 16:23:55,114 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 5000)
2025-09-19 16:23:55,114 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-19 16:23:55,114 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-19 16:24:04,850 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-19 16:24:04,866 - __main__ - INFO - LLM 응답 길이: 1245 문자
2025-09-19 16:24:04,866 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "갤럭시 S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        },
        {
            "name"...
2025-09-19 16:24:04,866 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-19 16:24:04,867 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-19 16:24:04,867 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-19 16:24:04,867 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': '갤럭시 S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}, {'name': '인터넷+TV', 'action': '가입'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '가입'}, {'type': '전화번호', 'value': '080-801-0011', 'action': '수신 거부'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-19 16:24:04,867 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-19 16:24:04,867 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', '갤럭시 S24 FE', '아이폰17', '인터넷+TV']
2025-09-19 16:24:05,361 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-19 16:24:05,361 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 17480)
2025-09-19 16:24:05,361 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-19 16:24:05,361 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-19 16:24:06,910 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-19 16:24:07,182 - __main__ - INFO - extract_entities_by_llm 실행완료: 2.31초
2025-09-19 16:24:07,238 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-19 16:24:07,238 - __main__ - INFO - ============================================================
2025-09-19 16:24:07,238 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-19 16:24:07,238 - __main__ - INFO - ============================================================
2025-09-19 16:24:07,238 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-19 16:24:07,238 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-19 16:24:07,238 - __main__ - INFO - 상품 수: 1개
2025-09-19 16:24:07,238 - __main__ - INFO - 채널 수: 5개
2025-09-19 16:24:07,238 - __main__ - INFO - 프로그램 수: 2개
2025-09-19 16:24:07,238 - __main__ - INFO - process_message 실행완료: 13.78초
2025-09-19 16:24:07,238 - __main__ - INFO - 순차적 처리로 메인 추출 및 DAG 추출 수행
2025-09-19 16:24:07,238 - __main__ - INFO - ============================== DAG 추출 시작 ==============================
2025-09-19 16:24:07,238 - entity_dag_extractor - INFO - 🚀 DAG 추출 프로세스 시작
2025-09-19 16:24:07,238 - entity_dag_extractor - INFO - 📝 입력 메시지 길이: 421자
2025-09-19 16:24:07,239 - entity_dag_extractor - INFO - 🤖 사용 LLM 모델: client=<openai.resources.chat.completions.completions.Completions object at 0x3315a3080> async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x3472388f0> root_client=<openai.OpenAI object at 0x3315d02c0> root_async_client=<openai.AsyncOpenAI object at 0x3315a0b30> model_name='skt/ax4' temperature=0.0 model_kwargs={} openai_api_key=SecretStr('**********') openai_api_base='https://api.platform.a15t.com/v1' max_tokens=4000
2025-09-19 16:24:07,239 - entity_dag_extractor - INFO - 🤖 LLM에 DAG 추출 요청 중...
2025-09-19 16:24:07,239 - entity_dag_extractor - INFO - 📏 프롬프트 길이: 3406자
2025-09-19 16:24:37,343 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-19 16:24:37,346 - entity_dag_extractor - INFO - 📝 LLM 응답 길이: 3010자
2025-09-19 16:24:37,346 - entity_dag_extractor - INFO - 📄 LLM 응답 미리보기: ## 1. 메시지 분석

```
[메시지 요약 및 핵심 의도]
SKT 을지로점에서 9월 중 갤럭시 시리즈와 아이폰17에 대한 특별 할인 및 혜택을 제공하며, SK로 통신사 이동 시 추가 혜택을 안내함. 매장 방문과 온라인 사전예약을 통해 기기 구매 및 통신사 이동을 유도하고 있음.

[식별된 가치 제안 목록]
- 갤럭시 시리즈(와이드8, A36, S24 F...
2025-09-19 16:24:37,346 - entity_dag_extractor - INFO - 🔍 DAG 섹션 추출 중...
2025-09-19 16:24:37,347 - entity_dag_extractor - INFO - 📄 추출된 DAG 섹션 길이: 295자
2025-09-19 16:24:37,347 - entity_dag_extractor - INFO - 🔗 DAG 파싱 중...
2025-09-19 16:24:37,348 - entity_dag_extractor - INFO - 📊 파싱된 DAG - 노드 수: 11, 엣지 수: 9
2025-09-19 16:24:37,349 - entity_dag_extractor - INFO - 🎯 DAG 노드 목록: ['을지로점:방문', '갤럭시:구매', '기기값할인:수령', '추가할인:수령', '통신사:이동', '상품권:수령', '인터넷+TV혜택:수령', '온라인링크:접속', '아이폰17:사전예약', '아이폰17:구매', '바로개통:수령']
2025-09-19 16:24:37,349 - entity_dag_extractor - INFO - 🔗 DAG 엣지 목록: [('을지로점:방문', '갤럭시:구매'), ('을지로점:방문', '통신사:이동'), ('갤럭시:구매', '기기값할인:수령'), ('갤럭시:구매', '추가할인:수령'), ('통신사:이동', '상품권:수령'), ('통신사:이동', '인터넷+TV혜택:수령'), ('온라인링크:접속', '아이폰17:사전예약'), ('아이폰17:사전예약', '아이폰17:구매'), ('아이폰17:구매', '바로개통:수령')]
2025-09-19 16:24:37,349 - entity_dag_extractor - INFO - ✅ DAG 추출 프로세스 완료
2025-09-19 16:24:37,350 - utils - INFO - 🎨 DAG 다이어그램 생성 시작 - 파일명: dag_ea42c65e2727ae609ac65fcfbeae8a3ccd3131f39e75b2236c29bf21305dca18
2025-09-19 16:24:37,350 - utils - INFO - 📊 입력 그래프 - 노드 수: 11, 엣지 수: 9
2025-09-19 16:24:37,352 - utils - INFO - 🖼️ DAG 이미지 렌더링 중...
2025-09-19 16:24:37,945 - utils - INFO - ✅ DAG 다이어그램 생성 완료: dag_images/dag_ea42c65e2727ae609ac65fcfbeae8a3ccd3131f39e75b2236c29bf21305dca18.png
2025-09-19 16:24:37,945 - __main__ - INFO - ✅ DAG 추출 완료: dag_ea42c65e2727ae609ac65fcfbeae8a3ccd3131f39e75b2236c29bf21305dca18
2025-09-19 16:24:37,945 - __main__ - INFO - 🕒 DAG 처리 시간: 30.706초
2025-09-19 16:24:37,945 - __main__ - INFO - 📏 DAG 섹션 길이: 295자
2025-09-19 16:24:37,945 - __main__ - INFO - 📄 DAG 내용 미리보기: (을지로점:방문) -[방문하면]-> (갤럭시:구매)
(갤럭시:구매) -[구매하면]-> (기기값할인:수령)
(갤럭시:구매) -[구매후, 제휴카드사용하면]-> (추가할인:수령)
(을지로점:방문) -[방문하면]-> (통신사:이동)
(통신사:이동) -[이동하면]-> (상품권:수령)
(통신사:이동) -[이동후, 인터넷+TV가입하면]-> (인터넷+TV혜택:수령)
(온...
2025-09-19 16:24:37,945 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-19 16:24:38,386 - mongodb_utils - INFO - MongoDB 연결 성공: aos.mmsext
2025-09-19 16:24:38,388 - mongodb_utils - INFO - 문서 저장 성공: 68cd0536ca3b4a824cfb485d
2025-09-19 16:24:38,388 - mongodb_utils - INFO - MongoDB 연결 해제
2025-09-22 20:50:18,364 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-22 20:50:18,364 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-22 20:50:18,364 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-22 20:50:18,364 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-09-22 20:50:18,364 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-22 20:50:18,366 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-22 20:50:18,433 - __main__ - INFO - Using device: mps
2025-09-22 20:50:18,433 - __main__ - INFO - _initialize_device 실행완료: 0.07초
2025-09-22 20:50:18,433 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-22 20:50:18,434 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-22 20:50:18,434 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-22 20:50:18,434 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-22 20:50:18,434 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-22 20:50:18,434 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-22 20:50:18,434 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-22 20:50:22,573 - __main__ - INFO - Model loaded on mps
2025-09-22 20:50:22,573 - __main__ - INFO - _initialize_embedding_model 실행완료: 4.14초
2025-09-22 20:50:22,573 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-22 20:50:23,055 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-22 20:50:23,055 - __main__ - INFO - _initialize_kiwi 실행완료: 0.48초
2025-09-22 20:50:23,055 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-22 20:50:23,055 - __main__ - INFO - ============================================================
2025-09-22 20:50:23,055 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-22 20:50:23,055 - __main__ - INFO - ============================================================
2025-09-22 20:50:23,055 - __main__ - INFO - 데이터 소스 모드: local
2025-09-22 20:50:23,055 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-22 20:50:23,055 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-22 20:50:23,055 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-22 20:50:23,055 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-22 20:50:23,128 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-22 20:50:23,128 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-22 20:50:23,128 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-22 20:50:23,135 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-22 20:50:23,136 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-22 20:50:23,136 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-22 20:50:23,137 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-22 20:50:23,137 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-22 20:50:23,137 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-22 20:50:23,145 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-22 20:50:23,147 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-22 20:50:23,147 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-22 20:50:23,147 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-22 20:50:23,147 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-22 20:50:23,147 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-22 20:50:23,147 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-22 20:50:23,147 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-22 20:50:23,147 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-22 20:50:23,147 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-22 20:50:23,147 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-22 20:50:23,155 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-22 20:50:23,155 - __main__ - INFO - null이 아닌 상품명 수: 10551개
2025-09-22 20:50:23,156 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-22 20:50:23,156 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-22 20:50:23,156 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-22 20:50:23,281 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-22 20:50:23,285 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 21522
2025-09-22 20:50:23,286 - __main__ - INFO - 별칭 적용 후 샘플: ['우주Pass Netflix 인증', '우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증']
2025-09-22 20:50:23,286 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-22 20:50:23,286 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (21522, 9)
2025-09-22 20:50:23,286 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-22 20:50:23,287 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-22 20:50:23,287 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-22 20:50:23,287 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-22 20:50:23,287 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-22 20:50:23,289 - __main__ - INFO - 등록할 고유 별칭 수: 16403개
2025-09-22 20:50:23,290 - __main__ - INFO - 유효한 별칭 수: 16403개
2025-09-22 20:50:23,290 - __main__ - INFO - 등록할 별칭 샘플: ['우주Pass Netflix 인증', '우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증']
2025-09-22 20:50:23,304 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16403개 성공, 0개 실패
2025-09-22 20:50:23,304 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-22 20:50:23,304 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-22 20:50:23,317 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-22 20:50:23,317 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-22 20:50:23,558 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-22 20:50:23,558 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-22 20:50:23,558 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-22 20:50:23,558 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-09-22 20:50:23,558 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-09-22 20:50:23,558 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-22 20:50:23,626 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-09-22 20:50:23,626 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-22 20:50:23,628 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-09-22 20:50:23,629 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-09-22 20:50:23,629 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-09-22 20:50:23,629 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-22 20:50:23,629 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-09-22 20:50:23,629 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-22 20:50:23,629 - __main__ - INFO - ============================================================
2025-09-22 20:50:23,629 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-22 20:50:23,629 - __main__ - INFO - ============================================================
2025-09-22 20:50:23,629 - __main__ - INFO - ✅ 상품 데이터: (21522, 9)
2025-09-22 20:50:23,629 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-22 20:50:23,629 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-22 20:50:23,629 - __main__ - INFO - ✅ 정지어: 166개
2025-09-22 20:50:23,629 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-22 20:50:23,631 - __main__ - INFO - 고유 상품명 수: 6847개
2025-09-22 20:50:23,633 - __main__ - INFO - 고유 별칭 수: 16403개
2025-09-22 20:50:23,634 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-22 20:50:23,634 - __main__ - INFO - _load_data 실행완료: 0.58초
2025-09-22 20:50:23,634 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-22 20:50:23,634 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-22 20:50:23,634 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-22 20:50:23,634 - __main__ - INFO - ============================================================
2025-09-22 20:50:23,634 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-22 20:50:23,634 - __main__ - INFO - ============================================================
2025-09-22 20:50:23,634 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-22 20:50:23,634 - __main__ - INFO - 메시지 길이: 421 문자
2025-09-22 20:50:23,634 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-22 20:50:23,634 - __main__ - INFO - 데이터 소스: local
2025-09-22 20:50:23,634 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-22 20:50:23,634 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-22 20:50:23,634 - __main__ - INFO - LLM 모델: ax
2025-09-22 20:50:23,634 - __main__ - INFO - 상품 데이터 크기: (21522, 9)
2025-09-22 20:50:23,634 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-22 20:50:23,634 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-22 20:50:23,634 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-22 20:50:23,634 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-22 20:50:23,635 - __main__ - INFO - 매칭할 상품 별칭 수: 16403개
2025-09-22 20:50:24,104 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-22 20:50:24,105 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-22 20:50:24,108 - __main__ - INFO - 전체 토큰 수: 155개
2025-09-22 20:50:24,108 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하', '갤럭시', 'A', '기기값', '아이폰', '을지로입구역', '하나은행', '명동']
2025-09-22 20:50:24,108 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['하나은행', '아이폰', '갤럭시', '명동', '기기값', '을지로입구역', '구매하']
2025-09-22 20:50:24,108 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-22 20:50:24,921 - __main__ - INFO - 퍼지 매칭 결과 크기: (1047, 3)
2025-09-22 20:50:24,922 - __main__ - INFO - 퍼지 매칭 성공: 1047개 결과
2025-09-22 20:50:24,922 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-22 20:50:24,922 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-22 20:50:24,963 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1047, 3)
2025-09-22 20:50:24,963 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-22 20:50:24,963 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-22 20:50:24,966 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 1개
2025-09-22 20:50:24,968 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 1개
2025-09-22 20:50:24,968 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-09-22 20:50:24,971 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시']
2025-09-22 20:50:24,972 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (1, 2)
2025-09-22 20:50:24,973 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-22 20:50:24,973 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.34초
2025-09-22 20:50:24,973 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시']
2025-09-22 20:50:24,973 - __main__ - INFO - 매칭된 상품 정보: (1, 2)
2025-09-22 20:50:24,973 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-22 20:50:25,073 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-22 20:50:25,073 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-22 20:50:25,073 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-22 20:50:25,073 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-22 20:50:25,073 - __main__ - INFO - 후보 아이템 리스트 크기: 1개
2025-09-22 20:50:25,073 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시']
2025-09-22 20:50:25,073 - __main__ - INFO - extra_item_pdf 크기: (1, 2)
2025-09-22 20:50:25,073 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-22 20:50:25,074 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-22 20:50:25,075 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 1개
2025-09-22 20:50:25,075 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': 'GALAXY', 'action': '기타'}]
2025-09-22 20:50:25,075 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-22 20:50:25,075 - __main__ - INFO - 구성된 프롬프트 길이: 5000 문자
2025-09-22 20:50:25,075 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-22 20:50:25,075 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 5000)
2025-09-22 20:50:25,075 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-22 20:50:25,075 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-22 20:50:45,842 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-22 20:50:45,846 - __main__ - INFO - LLM 응답 길이: 1245 문자
2025-09-22 20:50:45,847 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "갤럭시 S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        },
        {
            "name"...
2025-09-22 20:50:45,847 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-22 20:50:45,847 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-22 20:50:45,847 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-22 20:50:45,847 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': '갤럭시 S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}, {'name': '인터넷+TV', 'action': '가입'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '가입'}, {'type': '전화번호', 'value': '080-801-0011', 'action': '수신 거부'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-22 20:50:45,848 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-22 20:50:45,848 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', '갤럭시 S24 FE', '아이폰17', '인터넷+TV']
2025-09-22 20:50:46,358 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 17480)
2025-09-22 20:50:46,358 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-22 20:50:46,358 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-22 20:50:46,358 - __main__ - INFO - 🔄 1개 LLM 모델로 엔티티 추출 시작
2025-09-22 20:50:46,358 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-22 20:50:49,255 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-22 20:50:49,256 - __main__ - INFO - ✅ LLM 추출 완료: 5개 후보 엔티티
2025-09-22 20:50:49,503 - __main__ - INFO - extract_entities_by_llm 실행완료: 3.65초
2025-09-22 20:50:49,560 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-22 20:50:49,560 - __main__ - INFO - ============================================================
2025-09-22 20:50:49,560 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-22 20:50:49,560 - __main__ - INFO - ============================================================
2025-09-22 20:50:49,560 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-22 20:50:49,560 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-22 20:50:49,560 - __main__ - INFO - 상품 수: 1개
2025-09-22 20:50:49,560 - __main__ - INFO - 채널 수: 5개
2025-09-22 20:50:49,560 - __main__ - INFO - 프로그램 수: 2개
2025-09-22 20:50:49,561 - __main__ - INFO - process_message 실행완료: 25.93초
2025-09-22 20:50:49,561 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-22 20:56:30,060 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-22 20:56:30,060 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-22 20:56:30,060 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-22 20:56:30,060 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-09-22 20:56:30,060 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-22 20:56:30,061 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-22 20:56:30,080 - __main__ - INFO - Using device: mps
2025-09-22 20:56:30,080 - __main__ - INFO - _initialize_device 실행완료: 0.02초
2025-09-22 20:56:30,080 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-22 20:56:30,081 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-22 20:56:30,081 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-22 20:56:30,081 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-22 20:56:30,081 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-22 20:56:30,081 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-22 20:56:30,081 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-22 20:56:31,042 - __main__ - INFO - Model loaded on mps
2025-09-22 20:56:31,042 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.96초
2025-09-22 20:56:31,042 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-22 20:56:31,471 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-22 20:56:31,471 - __main__ - INFO - _initialize_kiwi 실행완료: 0.43초
2025-09-22 20:56:31,471 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-22 20:56:31,471 - __main__ - INFO - ============================================================
2025-09-22 20:56:31,471 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-22 20:56:31,471 - __main__ - INFO - ============================================================
2025-09-22 20:56:31,471 - __main__ - INFO - 데이터 소스 모드: local
2025-09-22 20:56:31,471 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-22 20:56:31,471 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-22 20:56:31,471 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-22 20:56:31,471 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-22 20:56:31,539 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-22 20:56:31,539 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-22 20:56:31,539 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-22 20:56:31,542 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-22 20:56:31,543 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-22 20:56:31,543 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-22 20:56:31,544 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-22 20:56:31,544 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-22 20:56:31,544 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-22 20:56:31,547 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-22 20:56:31,549 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-22 20:56:31,549 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-22 20:56:31,549 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-22 20:56:31,549 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-22 20:56:31,549 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-22 20:56:31,549 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-22 20:56:31,549 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-22 20:56:31,549 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-22 20:56:31,549 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-22 20:56:31,550 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-22 20:56:31,551 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-22 20:56:31,551 - __main__ - INFO - null이 아닌 상품명 수: 10551개
2025-09-22 20:56:31,551 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-22 20:56:31,551 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-22 20:56:31,552 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-22 20:56:31,683 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-22 20:56:31,689 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 21522
2025-09-22 20:56:31,689 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증', '우주pass Netflix 인증']
2025-09-22 20:56:31,689 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-22 20:56:31,690 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (21522, 9)
2025-09-22 20:56:31,690 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-22 20:56:31,691 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-22 20:56:31,691 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-22 20:56:31,691 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-22 20:56:31,691 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-22 20:56:31,693 - __main__ - INFO - 등록할 고유 별칭 수: 16403개
2025-09-22 20:56:31,694 - __main__ - INFO - 유효한 별칭 수: 16403개
2025-09-22 20:56:31,694 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증', '우주pass Netflix 인증']
2025-09-22 20:56:31,709 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16403개 성공, 0개 실패
2025-09-22 20:56:31,709 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-22 20:56:31,709 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-22 20:56:31,711 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-22 20:56:31,711 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-22 20:56:31,891 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-22 20:56:31,891 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-22 20:56:31,891 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-22 20:56:31,891 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-09-22 20:56:31,891 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-09-22 20:56:31,891 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-22 20:56:31,959 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-09-22 20:56:31,959 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-22 20:56:31,962 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-09-22 20:56:31,962 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-09-22 20:56:31,962 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-09-22 20:56:31,962 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-22 20:56:31,962 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-09-22 20:56:31,963 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-22 20:56:31,963 - __main__ - INFO - ============================================================
2025-09-22 20:56:31,963 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-22 20:56:31,963 - __main__ - INFO - ============================================================
2025-09-22 20:56:31,963 - __main__ - INFO - ✅ 상품 데이터: (21522, 9)
2025-09-22 20:56:31,963 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-22 20:56:31,963 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-22 20:56:31,963 - __main__ - INFO - ✅ 정지어: 166개
2025-09-22 20:56:31,963 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-22 20:56:31,964 - __main__ - INFO - 고유 상품명 수: 6847개
2025-09-22 20:56:31,966 - __main__ - INFO - 고유 별칭 수: 16403개
2025-09-22 20:56:31,967 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-22 20:56:31,967 - __main__ - INFO - _load_data 실행완료: 0.50초
2025-09-22 20:56:31,967 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-22 20:56:31,967 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-22 20:56:31,967 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-22 20:56:31,967 - __main__ - INFO - ============================================================
2025-09-22 20:56:31,967 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-22 20:56:31,968 - __main__ - INFO - ============================================================
2025-09-22 20:56:31,968 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-22 20:56:31,968 - __main__ - INFO - 메시지 길이: 421 문자
2025-09-22 20:56:31,968 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-22 20:56:31,968 - __main__ - INFO - 데이터 소스: local
2025-09-22 20:56:31,968 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-22 20:56:31,968 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-22 20:56:31,968 - __main__ - INFO - LLM 모델: ax
2025-09-22 20:56:31,968 - __main__ - INFO - 상품 데이터 크기: (21522, 9)
2025-09-22 20:56:31,968 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-22 20:56:31,968 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-22 20:56:31,968 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-22 20:56:31,968 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-22 20:56:31,970 - __main__ - INFO - 매칭할 상품 별칭 수: 16403개
2025-09-22 20:56:32,441 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-22 20:56:32,441 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-22 20:56:32,444 - __main__ - INFO - 전체 토큰 수: 155개
2025-09-22 20:56:32,445 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하', '갤럭시', 'A', '기기값', '아이폰', '을지로입구역', '하나은행', '명동']
2025-09-22 20:56:32,445 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['을지로입구역', '갤럭시', '구매하', '기기값', '명동', '아이폰', '하나은행']
2025-09-22 20:56:32,445 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-22 20:56:33,247 - __main__ - INFO - 퍼지 매칭 결과 크기: (1047, 3)
2025-09-22 20:56:33,247 - __main__ - INFO - 퍼지 매칭 성공: 1047개 결과
2025-09-22 20:56:33,248 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-22 20:56:33,248 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-22 20:56:33,287 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1047, 3)
2025-09-22 20:56:33,288 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-22 20:56:33,288 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-22 20:56:33,290 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 1개
2025-09-22 20:56:33,292 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 1개
2025-09-22 20:56:33,292 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-09-22 20:56:33,295 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시']
2025-09-22 20:56:33,296 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (1, 2)
2025-09-22 20:56:33,297 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-22 20:56:33,297 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.33초
2025-09-22 20:56:33,297 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시']
2025-09-22 20:56:33,297 - __main__ - INFO - 매칭된 상품 정보: (1, 2)
2025-09-22 20:56:33,297 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-22 20:56:33,401 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-22 20:56:33,401 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-22 20:56:33,401 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-22 20:56:33,402 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-22 20:56:33,402 - __main__ - INFO - 후보 아이템 리스트 크기: 1개
2025-09-22 20:56:33,402 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시']
2025-09-22 20:56:33,402 - __main__ - INFO - extra_item_pdf 크기: (1, 2)
2025-09-22 20:56:33,402 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-22 20:56:33,402 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-22 20:56:33,403 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 1개
2025-09-22 20:56:33,403 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': 'GALAXY', 'action': '기타'}]
2025-09-22 20:56:33,403 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-22 20:56:33,403 - __main__ - INFO - 구성된 프롬프트 길이: 5000 문자
2025-09-22 20:56:33,403 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-22 20:56:33,403 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 5000)
2025-09-22 20:56:33,403 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-22 20:56:33,403 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-22 20:56:46,081 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-22 20:56:46,090 - __main__ - INFO - LLM 응답 길이: 1245 문자
2025-09-22 20:56:46,090 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "갤럭시 S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        },
        {
            "name"...
2025-09-22 20:56:46,090 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-22 20:56:46,091 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-22 20:56:46,091 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-22 20:56:46,091 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': '갤럭시 S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}, {'name': '인터넷+TV', 'action': '가입'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '가입'}, {'type': '전화번호', 'value': '080-801-0011', 'action': '수신 거부'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-22 20:56:46,091 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-22 20:56:46,091 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', '갤럭시 S24 FE', '아이폰17', '인터넷+TV']
2025-09-22 20:56:46,092 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-09-22 20:56:46,092 - __main__ - INFO - ✅ LLM 모델 초기화 완료: gpt (azure/openai/gpt-4o-2024-08-06)
2025-09-22 20:56:46,092 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-09-22 20:56:46,602 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 17480)
2025-09-22 20:56:46,602 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-22 20:56:46,602 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-22 20:56:46,602 - __main__ - INFO - 🔄 3개 LLM 모델로 엔티티 추출 시작
2025-09-22 20:56:46,616 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-22 20:56:46,616 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-22 20:56:46,617 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-22 20:56:47,983 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-22 20:56:48,144 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-22 20:56:50,348 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-22 20:56:50,353 - __main__ - INFO - ✅ LLM 추출 완료: 7개 후보 엔티티
2025-09-22 20:56:50,656 - __main__ - INFO - extract_entities_by_llm 실행완료: 4.56초
2025-09-22 20:56:50,716 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-22 20:56:50,716 - __main__ - INFO - ============================================================
2025-09-22 20:56:50,716 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-22 20:56:50,716 - __main__ - INFO - ============================================================
2025-09-22 20:56:50,716 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-22 20:56:50,716 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-22 20:56:50,716 - __main__ - INFO - 상품 수: 2개
2025-09-22 20:56:50,716 - __main__ - INFO - 채널 수: 5개
2025-09-22 20:56:50,716 - __main__ - INFO - 프로그램 수: 2개
2025-09-22 20:56:50,716 - __main__ - INFO - process_message 실행완료: 18.75초
2025-09-22 20:56:50,716 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-22 21:00:22,098 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-22 21:00:22,099 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-22 21:00:22,099 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-22 21:00:22,099 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-09-22 21:00:22,099 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-22 21:00:22,100 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-22 21:00:22,118 - __main__ - INFO - Using device: mps
2025-09-22 21:00:22,118 - __main__ - INFO - _initialize_device 실행완료: 0.02초
2025-09-22 21:00:22,118 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-22 21:00:22,118 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-22 21:00:22,118 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-22 21:00:22,118 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-22 21:00:22,118 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-22 21:00:22,119 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-22 21:00:22,119 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-22 21:00:23,172 - __main__ - INFO - Model loaded on mps
2025-09-22 21:00:23,173 - __main__ - INFO - _initialize_embedding_model 실행완료: 1.05초
2025-09-22 21:00:23,173 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-22 21:00:23,607 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-22 21:00:23,607 - __main__ - INFO - _initialize_kiwi 실행완료: 0.43초
2025-09-22 21:00:23,607 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-22 21:00:23,607 - __main__ - INFO - ============================================================
2025-09-22 21:00:23,607 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-22 21:00:23,607 - __main__ - INFO - ============================================================
2025-09-22 21:00:23,607 - __main__ - INFO - 데이터 소스 모드: local
2025-09-22 21:00:23,607 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-22 21:00:23,607 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-22 21:00:23,607 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-22 21:00:23,607 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-22 21:00:23,677 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-22 21:00:23,677 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-22 21:00:23,677 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-22 21:00:23,681 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-22 21:00:23,682 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-22 21:00:23,682 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-22 21:00:23,683 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-22 21:00:23,683 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-22 21:00:23,683 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-22 21:00:23,687 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-22 21:00:23,690 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-22 21:00:23,690 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-22 21:00:23,690 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-22 21:00:23,690 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-22 21:00:23,691 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-22 21:00:23,691 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-22 21:00:23,691 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-22 21:00:23,691 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-22 21:00:23,691 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-22 21:00:23,691 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-22 21:00:23,693 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-22 21:00:23,693 - __main__ - INFO - null이 아닌 상품명 수: 10551개
2025-09-22 21:00:23,693 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-22 21:00:23,693 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-22 21:00:23,694 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-22 21:00:23,818 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-22 21:00:23,823 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 21522
2025-09-22 21:00:23,824 - __main__ - INFO - 별칭 적용 후 샘플: ['우주pass Netflix 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주패스 넷플릭스 인증']
2025-09-22 21:00:23,824 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-22 21:00:23,824 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (21522, 9)
2025-09-22 21:00:23,824 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-22 21:00:23,825 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-22 21:00:23,825 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-22 21:00:23,825 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-22 21:00:23,825 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-22 21:00:23,827 - __main__ - INFO - 등록할 고유 별칭 수: 16403개
2025-09-22 21:00:23,828 - __main__ - INFO - 유효한 별칭 수: 16403개
2025-09-22 21:00:23,828 - __main__ - INFO - 등록할 별칭 샘플: ['우주pass Netflix 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주패스 넷플릭스 인증']
2025-09-22 21:00:23,841 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16403개 성공, 0개 실패
2025-09-22 21:00:23,841 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-22 21:00:23,841 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-22 21:00:23,844 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-22 21:00:23,844 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-22 21:00:24,016 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-22 21:00:24,016 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-22 21:00:24,016 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-22 21:00:24,016 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-09-22 21:00:24,016 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-09-22 21:00:24,016 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-22 21:00:24,085 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-09-22 21:00:24,085 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-22 21:00:24,088 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-09-22 21:00:24,088 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-09-22 21:00:24,088 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-09-22 21:00:24,088 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-22 21:00:24,088 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-09-22 21:00:24,089 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-22 21:00:24,089 - __main__ - INFO - ============================================================
2025-09-22 21:00:24,089 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-22 21:00:24,089 - __main__ - INFO - ============================================================
2025-09-22 21:00:24,089 - __main__ - INFO - ✅ 상품 데이터: (21522, 9)
2025-09-22 21:00:24,089 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-22 21:00:24,089 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-22 21:00:24,089 - __main__ - INFO - ✅ 정지어: 166개
2025-09-22 21:00:24,089 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-22 21:00:24,090 - __main__ - INFO - 고유 상품명 수: 6847개
2025-09-22 21:00:24,092 - __main__ - INFO - 고유 별칭 수: 16403개
2025-09-22 21:00:24,093 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-22 21:00:24,093 - __main__ - INFO - _load_data 실행완료: 0.49초
2025-09-22 21:00:24,093 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-22 21:00:24,093 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-22 21:00:24,093 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-22 21:00:24,093 - __main__ - INFO - ============================================================
2025-09-22 21:00:24,093 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-22 21:00:24,093 - __main__ - INFO - ============================================================
2025-09-22 21:00:24,093 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-22 21:00:24,093 - __main__ - INFO - 메시지 길이: 421 문자
2025-09-22 21:00:24,093 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-22 21:00:24,093 - __main__ - INFO - 데이터 소스: local
2025-09-22 21:00:24,093 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-22 21:00:24,093 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-22 21:00:24,093 - __main__ - INFO - LLM 모델: ax
2025-09-22 21:00:24,093 - __main__ - INFO - 상품 데이터 크기: (21522, 9)
2025-09-22 21:00:24,093 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-22 21:00:24,093 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-22 21:00:24,093 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-22 21:00:24,093 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-22 21:00:24,095 - __main__ - INFO - 매칭할 상품 별칭 수: 16403개
2025-09-22 21:00:24,566 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-22 21:00:24,566 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-22 21:00:24,570 - __main__ - INFO - 전체 토큰 수: 155개
2025-09-22 21:00:24,570 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하', '갤럭시', 'A', '기기값', '아이폰', '을지로입구역', '하나은행', '명동']
2025-09-22 21:00:24,570 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['명동', '아이폰', '구매하', '을지로입구역', '하나은행', '기기값', '갤럭시']
2025-09-22 21:00:24,570 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-22 21:00:25,369 - __main__ - INFO - 퍼지 매칭 결과 크기: (1047, 3)
2025-09-22 21:00:25,369 - __main__ - INFO - 퍼지 매칭 성공: 1047개 결과
2025-09-22 21:00:25,370 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-22 21:00:25,370 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-22 21:00:25,408 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1047, 3)
2025-09-22 21:00:25,409 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-22 21:00:25,409 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-22 21:00:25,411 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 1개
2025-09-22 21:00:25,412 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 1개
2025-09-22 21:00:25,413 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-09-22 21:00:25,415 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시']
2025-09-22 21:00:25,417 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (1, 2)
2025-09-22 21:00:25,417 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-22 21:00:25,417 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.32초
2025-09-22 21:00:25,417 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시']
2025-09-22 21:00:25,417 - __main__ - INFO - 매칭된 상품 정보: (1, 2)
2025-09-22 21:00:25,418 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-22 21:00:25,529 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-22 21:00:25,529 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-22 21:00:25,529 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-22 21:00:25,529 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-22 21:00:25,529 - __main__ - INFO - 후보 아이템 리스트 크기: 1개
2025-09-22 21:00:25,529 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시']
2025-09-22 21:00:25,530 - __main__ - INFO - extra_item_pdf 크기: (1, 2)
2025-09-22 21:00:25,530 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-22 21:00:25,530 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-22 21:00:25,531 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 1개
2025-09-22 21:00:25,531 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': 'GALAXY', 'action': '기타'}]
2025-09-22 21:00:25,531 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-22 21:00:25,531 - __main__ - INFO - 구성된 프롬프트 길이: 5000 문자
2025-09-22 21:00:25,531 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-22 21:00:25,531 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 5000)
2025-09-22 21:00:25,531 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-22 21:00:25,531 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-22 21:00:41,204 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-22 21:00:41,219 - __main__ - INFO - LLM 응답 길이: 1245 문자
2025-09-22 21:00:41,219 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "갤럭시 S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        },
        {
            "name"...
2025-09-22 21:00:41,219 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-22 21:00:41,219 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-22 21:00:41,219 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-22 21:00:41,220 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': '갤럭시 S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}, {'name': '인터넷+TV', 'action': '가입'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '가입'}, {'type': '전화번호', 'value': '080-801-0011', 'action': '수신 거부'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-22 21:00:41,220 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-22 21:00:41,220 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', '갤럭시 S24 FE', '아이폰17', '인터넷+TV']
2025-09-22 21:00:41,222 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-09-22 21:00:41,222 - __main__ - INFO - ✅ LLM 모델 초기화 완료: gpt (azure/openai/gpt-4o-2024-08-06)
2025-09-22 21:00:41,223 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-09-22 21:00:41,724 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 17480)
2025-09-22 21:00:41,724 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-22 21:00:41,724 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-22 21:00:41,724 - __main__ - INFO - 🔄 3개 LLM 모델로 엔티티 추출 시작
2025-09-22 21:00:41,727 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-22 21:00:41,727 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-22 21:00:41,727 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-22 21:00:42,852 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-22 21:00:43,652 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-22 21:00:45,232 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-22 21:00:45,244 - __main__ - INFO - ✅ LLM 추출 완료: ['와이드8', 'S24 FE', '아이폰17 사전예약', '아이폰17', '인터넷+TV', 'A36', '갤럭시']
2025-09-22 21:00:45,556 - __main__ - INFO - extract_entities_by_llm 실행완료: 4.33초
2025-09-22 21:00:45,616 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-22 21:00:45,616 - __main__ - INFO - ============================================================
2025-09-22 21:00:45,616 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-22 21:00:45,616 - __main__ - INFO - ============================================================
2025-09-22 21:00:45,616 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-22 21:00:45,616 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-22 21:00:45,616 - __main__ - INFO - 상품 수: 2개
2025-09-22 21:00:45,616 - __main__ - INFO - 채널 수: 5개
2025-09-22 21:00:45,616 - __main__ - INFO - 프로그램 수: 2개
2025-09-22 21:00:45,616 - __main__ - INFO - process_message 실행완료: 21.52초
2025-09-22 21:00:45,616 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-23 10:09:40,609 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-23 10:09:40,609 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-23 10:09:40,609 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-23 10:09:40,609 - __main__ - INFO - 🎯 DAG 추출 모드 활성화됨
2025-09-23 10:09:40,609 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-23 10:09:40,610 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-23 10:09:40,627 - __main__ - INFO - Using device: mps
2025-09-23 10:09:40,627 - __main__ - INFO - _initialize_device 실행완료: 0.02초
2025-09-23 10:09:40,627 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-23 10:09:40,628 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-23 10:09:40,628 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-23 10:09:40,628 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-23 10:09:40,628 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-23 10:09:40,628 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-23 10:09:40,628 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-23 10:09:44,134 - __main__ - INFO - Model loaded on mps
2025-09-23 10:09:44,134 - __main__ - INFO - _initialize_embedding_model 실행완료: 3.51초
2025-09-23 10:09:44,134 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-23 10:09:44,700 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-23 10:09:44,700 - __main__ - INFO - _initialize_kiwi 실행완료: 0.57초
2025-09-23 10:09:44,700 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-23 10:09:44,700 - __main__ - INFO - ============================================================
2025-09-23 10:09:44,700 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-23 10:09:44,700 - __main__ - INFO - ============================================================
2025-09-23 10:09:44,700 - __main__ - INFO - 데이터 소스 모드: local
2025-09-23 10:09:44,700 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-23 10:09:44,700 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-23 10:09:44,700 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-23 10:09:44,700 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-23 10:09:44,770 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-23 10:09:44,770 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-23 10:09:44,770 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-23 10:09:44,775 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-23 10:09:44,776 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-23 10:09:44,776 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-23 10:09:44,777 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-23 10:09:44,777 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-23 10:09:44,777 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-23 10:09:44,804 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-23 10:09:44,809 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-23 10:09:44,809 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-23 10:09:44,809 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-23 10:09:44,809 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-23 10:09:44,809 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-23 10:09:44,810 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-23 10:09:44,810 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-23 10:09:44,810 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-23 10:09:44,810 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-23 10:09:44,810 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-23 10:09:44,813 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-23 10:09:44,813 - __main__ - INFO - null이 아닌 상품명 수: 10551개
2025-09-23 10:09:44,813 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-23 10:09:44,814 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-23 10:09:44,814 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-23 10:09:44,937 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-23 10:09:44,944 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 21522
2025-09-23 10:09:44,945 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 넷플릭스 인증', '우주PASS Netflix 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증']
2025-09-23 10:09:44,945 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-23 10:09:44,945 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (21522, 9)
2025-09-23 10:09:44,945 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-23 10:09:44,947 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-23 10:09:44,947 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-23 10:09:44,947 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-23 10:09:44,947 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-23 10:09:44,949 - __main__ - INFO - 등록할 고유 별칭 수: 16403개
2025-09-23 10:09:44,949 - __main__ - INFO - 유효한 별칭 수: 16403개
2025-09-23 10:09:44,949 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 넷플릭스 인증', '우주PASS Netflix 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증']
2025-09-23 10:09:44,964 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16403개 성공, 0개 실패
2025-09-23 10:09:44,965 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-23 10:09:44,965 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-23 10:09:44,974 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-23 10:09:44,974 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-23 10:09:46,765 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-23 10:09:46,765 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-23 10:09:46,765 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-23 10:09:46,765 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-09-23 10:09:46,765 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-09-23 10:09:46,765 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-23 10:09:46,829 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-09-23 10:09:46,829 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-23 10:09:46,831 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-09-23 10:09:46,831 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-09-23 10:09:46,831 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-09-23 10:09:46,831 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-23 10:09:46,831 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-09-23 10:09:46,832 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-23 10:09:46,832 - __main__ - INFO - ============================================================
2025-09-23 10:09:46,832 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-23 10:09:46,832 - __main__ - INFO - ============================================================
2025-09-23 10:09:46,832 - __main__ - INFO - ✅ 상품 데이터: (21522, 9)
2025-09-23 10:09:46,832 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-23 10:09:46,832 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-23 10:09:46,832 - __main__ - INFO - ✅ 정지어: 166개
2025-09-23 10:09:46,832 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-23 10:09:46,833 - __main__ - INFO - 고유 상품명 수: 6847개
2025-09-23 10:09:46,835 - __main__ - INFO - 고유 별칭 수: 16403개
2025-09-23 10:09:46,836 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-23 10:09:46,836 - __main__ - INFO - _load_data 실행완료: 2.14초
2025-09-23 10:09:46,836 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-23 10:09:46,836 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-23 10:09:46,836 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-23 10:09:46,836 - __main__ - INFO - ============================================================
2025-09-23 10:09:46,836 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-23 10:09:46,837 - __main__ - INFO - ============================================================
2025-09-23 10:09:46,837 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-23 10:09:46,837 - __main__ - INFO - 메시지 길이: 421 문자
2025-09-23 10:09:46,837 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-23 10:09:46,837 - __main__ - INFO - 데이터 소스: local
2025-09-23 10:09:46,837 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-23 10:09:46,837 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-23 10:09:46,837 - __main__ - INFO - LLM 모델: ax
2025-09-23 10:09:46,837 - __main__ - INFO - 상품 데이터 크기: (21522, 9)
2025-09-23 10:09:46,837 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-23 10:09:46,837 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-23 10:09:46,837 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-23 10:09:46,837 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-23 10:09:46,838 - __main__ - INFO - 매칭할 상품 별칭 수: 16403개
2025-09-23 10:09:47,295 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-23 10:09:47,296 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-23 10:09:47,299 - __main__ - INFO - 전체 토큰 수: 155개
2025-09-23 10:09:47,299 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하', '갤럭시', 'A', '기기값', '아이폰', '을지로입구역', '하나은행', '명동']
2025-09-23 10:09:47,299 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['하나은행', '을지로입구역', '명동', '갤럭시', '기기값', '구매하', '아이폰']
2025-09-23 10:09:47,299 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-23 10:09:48,157 - __main__ - INFO - 퍼지 매칭 결과 크기: (1047, 3)
2025-09-23 10:09:48,157 - __main__ - INFO - 퍼지 매칭 성공: 1047개 결과
2025-09-23 10:09:48,158 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-23 10:09:48,158 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-23 10:09:48,197 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1047, 3)
2025-09-23 10:09:48,197 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-23 10:09:48,197 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-23 10:09:48,200 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 1개
2025-09-23 10:09:48,201 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 1개
2025-09-23 10:09:48,202 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-09-23 10:09:48,205 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시']
2025-09-23 10:09:48,207 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (1, 2)
2025-09-23 10:09:48,208 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-23 10:09:48,208 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.37초
2025-09-23 10:09:48,208 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시']
2025-09-23 10:09:48,208 - __main__ - INFO - 매칭된 상품 정보: (1, 2)
2025-09-23 10:09:48,208 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-23 10:09:49,234 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-23 10:09:49,234 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-23 10:09:49,234 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-23 10:09:49,234 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-23 10:09:49,234 - __main__ - INFO - 후보 아이템 리스트 크기: 1개
2025-09-23 10:09:49,234 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시']
2025-09-23 10:09:49,234 - __main__ - INFO - extra_item_pdf 크기: (1, 2)
2025-09-23 10:09:49,234 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-23 10:09:49,234 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-23 10:09:49,236 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 1개
2025-09-23 10:09:49,236 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': 'GALAXY', 'action': '기타'}]
2025-09-23 10:09:49,236 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-23 10:09:49,236 - __main__ - INFO - 구성된 프롬프트 길이: 5000 문자
2025-09-23 10:09:49,236 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-23 10:09:49,236 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 5000)
2025-09-23 10:09:49,236 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-23 10:09:49,236 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-23 10:09:57,777 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-23 10:09:57,790 - __main__ - INFO - LLM 응답 길이: 1245 문자
2025-09-23 10:09:57,790 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "갤럭시 S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        },
        {
            "name"...
2025-09-23 10:09:57,791 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-23 10:09:57,792 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-23 10:09:57,792 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-23 10:09:57,792 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': '갤럭시 S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}, {'name': '인터넷+TV', 'action': '가입'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '가입'}, {'type': '전화번호', 'value': '080-801-0011', 'action': '수신 거부'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-23 10:09:57,792 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-23 10:09:57,792 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', '갤럭시 S24 FE', '아이폰17', '인터넷+TV']
2025-09-23 10:09:57,793 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-09-23 10:09:57,793 - __main__ - INFO - ✅ LLM 모델 초기화 완료: gpt (azure/openai/gpt-4o-2024-08-06)
2025-09-23 10:09:57,793 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-09-23 10:09:58,301 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 17480)
2025-09-23 10:09:58,301 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-23 10:09:58,301 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-23 10:09:58,301 - __main__ - INFO - 🔄 3개 LLM 모델로 엔티티 추출 시작
2025-09-23 10:09:58,315 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-23 10:09:58,315 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-23 10:09:58,315 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-23 10:09:59,784 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-23 10:10:00,126 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-23 10:10:01,699 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-23 10:10:01,701 - __main__ - INFO - ✅ LLM 추출 완료: ['아이폰17', 'A36', '와이드8', '인터넷+TV', 'S24 FE', '아이폰17 사전예약', '갤럭시']
2025-09-23 10:10:02,002 - __main__ - INFO - extract_entities_by_llm 실행완료: 4.21초
2025-09-23 10:10:02,060 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-23 10:10:02,060 - __main__ - INFO - ============================================================
2025-09-23 10:10:02,060 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-23 10:10:02,060 - __main__ - INFO - ============================================================
2025-09-23 10:10:02,061 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-23 10:10:02,061 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-23 10:10:02,061 - __main__ - INFO - 상품 수: 2개
2025-09-23 10:10:02,061 - __main__ - INFO - 채널 수: 5개
2025-09-23 10:10:02,061 - __main__ - INFO - 프로그램 수: 2개
2025-09-23 10:10:02,061 - __main__ - INFO - process_message 실행완료: 15.22초
2025-09-23 10:10:02,061 - __main__ - INFO - 순차적 처리로 메인 추출 및 DAG 추출 수행
2025-09-23 10:10:02,061 - __main__ - INFO - ============================== DAG 추출 시작 ==============================
2025-09-23 10:10:02,061 - entity_dag_extractor - INFO - 🚀 DAG 추출 프로세스 시작
2025-09-23 10:10:02,061 - entity_dag_extractor - INFO - 📝 입력 메시지 길이: 421자
2025-09-23 10:10:02,061 - entity_dag_extractor - INFO - 🤖 사용 LLM 모델: client=<openai.resources.chat.completions.completions.Completions object at 0x334986480> async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x334986d20> root_client=<openai.OpenAI object at 0x32a276030> root_async_client=<openai.AsyncOpenAI object at 0x334986a80> model_name='skt/ax4' temperature=0.0 model_kwargs={} openai_api_key=SecretStr('**********') openai_api_base='https://api.platform.a15t.com/v1' max_tokens=4000
2025-09-23 10:10:02,061 - entity_dag_extractor - INFO - 🤖 LLM에 DAG 추출 요청 중...
2025-09-23 10:10:02,061 - entity_dag_extractor - INFO - 📏 프롬프트 길이: 3406자
2025-09-23 10:10:29,471 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-23 10:10:29,473 - entity_dag_extractor - INFO - 📝 LLM 응답 길이: 2992자
2025-09-23 10:10:29,473 - entity_dag_extractor - INFO - 📄 LLM 응답 미리보기: ## 1. 메시지 분석

```
[메시지 요약 및 핵심 의도]
SKT 을지로점에서 9월 중 갤럭시 시리즈와 아이폰17에 대한 특별 할인 및 혜택을 제공하며, SK로 통신사 이동 시 추가 혜택을 안내함. 매장 방문과 온라인 사전예약을 통해 기기 구매 및 통신사 이동을 유도하고 있음.

[식별된 가치 제안 목록]
- 갤럭시 시리즈(와이드8, A36, S24 F...
2025-09-23 10:10:29,474 - entity_dag_extractor - INFO - 🔍 DAG 섹션 추출 중...
2025-09-23 10:10:29,474 - entity_dag_extractor - INFO - 📄 추출된 DAG 섹션 길이: 263자
2025-09-23 10:10:29,474 - entity_dag_extractor - INFO - 🔗 DAG 파싱 중...
2025-09-23 10:10:29,475 - entity_dag_extractor - INFO - 📊 파싱된 DAG - 노드 수: 10, 엣지 수: 8
2025-09-23 10:10:29,475 - entity_dag_extractor - INFO - 🎯 DAG 노드 목록: ['을지로점:방문', '갤럭시:구매', '기기값할인:수령', '추가할인:수령', '통신사:이동', '상품권:수령', '현금지원:수령', '온라인링크:접속', '아이폰17:사전예약', '바로개통:수령']
2025-09-23 10:10:29,475 - entity_dag_extractor - INFO - 🔗 DAG 엣지 목록: [('을지로점:방문', '갤럭시:구매'), ('을지로점:방문', '통신사:이동'), ('갤럭시:구매', '기기값할인:수령'), ('갤럭시:구매', '추가할인:수령'), ('통신사:이동', '상품권:수령'), ('통신사:이동', '현금지원:수령'), ('온라인링크:접속', '아이폰17:사전예약'), ('아이폰17:사전예약', '바로개통:수령')]
2025-09-23 10:10:29,475 - entity_dag_extractor - INFO - ✅ DAG 추출 프로세스 완료
2025-09-23 10:10:29,475 - utils - INFO - 🎨 DAG 다이어그램 생성 시작 - 파일명: dag_ea42c65e2727ae609ac65fcfbeae8a3ccd3131f39e75b2236c29bf21305dca18
2025-09-23 10:10:29,475 - utils - INFO - 📊 입력 그래프 - 노드 수: 10, 엣지 수: 8
2025-09-23 10:10:29,476 - utils - INFO - 🖼️ DAG 이미지 렌더링 중...
2025-09-23 10:10:30,361 - utils - INFO - ✅ DAG 다이어그램 생성 완료: dag_images/dag_ea42c65e2727ae609ac65fcfbeae8a3ccd3131f39e75b2236c29bf21305dca18.png
2025-09-23 10:10:30,361 - __main__ - INFO - ✅ DAG 추출 완료: dag_ea42c65e2727ae609ac65fcfbeae8a3ccd3131f39e75b2236c29bf21305dca18
2025-09-23 10:10:30,361 - __main__ - INFO - 🕒 DAG 처리 시간: 28.301초
2025-09-23 10:10:30,361 - __main__ - INFO - 📏 DAG 섹션 길이: 263자
2025-09-23 10:10:30,361 - __main__ - INFO - 📄 DAG 내용 미리보기: (을지로점:방문) -[방문하면]-> (갤럭시:구매)
(갤럭시:구매) -[구매하면]-> (기기값할인:수령)
(갤럭시:구매) -[구매하면, 제휴카드사용시]-> (추가할인:수령)
(을지로점:방문) -[방문하면]-> (통신사:이동)
(통신사:이동) -[이동하면]-> (상품권:수령)
(통신사:이동) -[이동하면, 인터넷TV동시가입시]-> (현금지원:수령)
(온라인링...
2025-09-23 10:10:30,362 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-23 10:10:30,892 - mongodb_utils - INFO - MongoDB 연결 성공: aos.mmsext
2025-09-23 10:10:30,896 - mongodb_utils - INFO - 문서 저장 성공: 68d1f3868430cadd04a7c9b0
2025-09-23 10:10:30,897 - mongodb_utils - INFO - MongoDB 연결 해제
2025-09-23 14:08:41,944 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-23 14:08:41,944 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-23 14:08:41,944 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-23 14:08:41,944 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-09-23 14:08:41,944 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-23 14:08:41,945 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-23 14:08:42,009 - __main__ - INFO - Using device: mps
2025-09-23 14:08:42,009 - __main__ - INFO - _initialize_device 실행완료: 0.06초
2025-09-23 14:08:42,010 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-23 14:08:42,010 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-23 14:08:42,010 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-23 14:08:42,010 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-23 14:08:42,010 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-23 14:08:42,010 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-23 14:08:42,010 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-23 14:08:44,203 - __main__ - INFO - Model loaded on mps
2025-09-23 14:08:44,203 - __main__ - INFO - _initialize_embedding_model 실행완료: 2.19초
2025-09-23 14:08:44,203 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-23 14:08:44,693 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-23 14:08:44,693 - __main__ - INFO - _initialize_kiwi 실행완료: 0.49초
2025-09-23 14:08:44,693 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-23 14:08:44,693 - __main__ - INFO - ============================================================
2025-09-23 14:08:44,693 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-23 14:08:44,693 - __main__ - INFO - ============================================================
2025-09-23 14:08:44,693 - __main__ - INFO - 데이터 소스 모드: local
2025-09-23 14:08:44,693 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-23 14:08:44,693 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-23 14:08:44,693 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-23 14:08:44,693 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-23 14:08:44,798 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-23 14:08:44,798 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-23 14:08:44,798 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-23 14:08:44,802 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-23 14:08:44,803 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-23 14:08:44,803 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-23 14:08:44,804 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-23 14:08:44,804 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-23 14:08:44,804 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-23 14:08:44,808 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-23 14:08:44,811 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-23 14:08:44,811 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-23 14:08:44,811 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-23 14:08:44,811 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-23 14:08:44,811 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-23 14:08:44,812 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-23 14:08:44,812 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-23 14:08:44,812 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-23 14:08:44,812 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-23 14:08:44,812 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-23 14:08:44,816 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-23 14:08:44,816 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-09-23 14:08:44,816 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-23 14:08:44,816 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-23 14:08:44,816 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-23 14:08:44,946 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-23 14:08:44,950 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-09-23 14:08:44,951 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주pass Netflix 인증']
2025-09-23 14:08:44,951 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-23 14:08:44,951 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-09-23 14:08:44,951 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-23 14:08:44,952 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-23 14:08:44,952 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-23 14:08:44,952 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-23 14:08:44,952 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-23 14:08:44,953 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-09-23 14:08:44,954 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-09-23 14:08:44,954 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주pass Netflix 인증']
2025-09-23 14:08:44,967 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-09-23 14:08:44,967 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-23 14:08:44,967 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-23 14:08:44,969 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-23 14:08:44,969 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-23 14:08:46,571 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-23 14:08:46,572 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-23 14:08:46,572 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-23 14:08:46,572 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-09-23 14:08:46,572 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-09-23 14:08:46,572 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-23 14:08:46,636 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-09-23 14:08:46,636 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-23 14:08:46,637 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-09-23 14:08:46,638 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-09-23 14:08:46,638 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-09-23 14:08:46,638 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-23 14:08:46,638 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-09-23 14:08:46,638 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-23 14:08:46,638 - __main__ - INFO - ============================================================
2025-09-23 14:08:46,638 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-23 14:08:46,638 - __main__ - INFO - ============================================================
2025-09-23 14:08:46,638 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-09-23 14:08:46,638 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-23 14:08:46,638 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-23 14:08:46,638 - __main__ - INFO - ✅ 정지어: 166개
2025-09-23 14:08:46,638 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-23 14:08:46,639 - __main__ - INFO - 고유 상품명 수: 6586개
2025-09-23 14:08:46,640 - __main__ - INFO - 고유 별칭 수: 16948개
2025-09-23 14:08:46,641 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-23 14:08:46,641 - __main__ - INFO - _load_data 실행완료: 1.95초
2025-09-23 14:08:46,641 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-23 14:08:46,641 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-23 14:08:46,641 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-23 14:08:46,641 - __main__ - INFO - ============================================================
2025-09-23 14:08:46,641 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-23 14:08:46,641 - __main__ - INFO - ============================================================
2025-09-23 14:08:46,641 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-23 14:08:46,641 - __main__ - INFO - 메시지 길이: 421 문자
2025-09-23 14:08:46,641 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-23 14:08:46,641 - __main__ - INFO - 데이터 소스: local
2025-09-23 14:08:46,641 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-23 14:08:46,641 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-23 14:08:46,641 - __main__ - INFO - LLM 모델: ax
2025-09-23 14:08:46,641 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-09-23 14:08:46,641 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-23 14:08:46,641 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-23 14:08:46,641 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-23 14:08:46,641 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-23 14:08:46,642 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-09-23 14:08:47,097 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-23 14:08:47,098 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-23 14:08:47,100 - __main__ - INFO - 전체 토큰 수: 154개
2025-09-23 14:08:47,101 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하9', '갤럭시', '아이폰 17', '을지로입구역', '하나은행', '명동']
2025-09-23 14:08:47,101 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['을지로입구역', '갤럭시', '아이폰 17', '구매하9', '명동', '하나은행']
2025-09-23 14:08:47,101 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-23 14:08:47,561 - __main__ - INFO - 퍼지 매칭 결과 크기: (1242, 3)
2025-09-23 14:08:47,561 - __main__ - INFO - 퍼지 매칭 성공: 1242개 결과
2025-09-23 14:08:47,562 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-23 14:08:47,562 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-23 14:08:47,603 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1242, 3)
2025-09-23 14:08:47,603 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-23 14:08:47,603 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-23 14:08:47,605 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 14개
2025-09-23 14:08:47,606 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 5개
2025-09-23 14:08:47,607 - __main__ - INFO - 통합된 후보 아이템 수: 19개
2025-09-23 14:08:47,609 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-23 14:08:47,611 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (13, 2)
2025-09-23 14:08:47,611 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '(KTF)갤럭시 S24 FE', 'item_id': ['A5V7']}, {'item_nm': '(LGU)갤럭시 S24 FE', 'item_id': ['A5V8']}, {'item_nm': 'IPHONE 17', 'item_id': ['A6UD', 'A6SQ', 'A6U2', 'A6U7', 'A6SV']}]
2025-09-23 14:08:47,611 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 0.97초
2025-09-23 14:08:47,611 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-23 14:08:47,611 - __main__ - INFO - 매칭된 상품 정보: (13, 2)
2025-09-23 14:08:47,611 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-23 14:08:48,608 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-23 14:08:48,608 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-23 14:08:48,608 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-23 14:08:48,608 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-23 14:08:48,608 - __main__ - INFO - 후보 아이템 리스트 크기: 15개
2025-09-23 14:08:48,608 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-23 14:08:48,608 - __main__ - INFO - extra_item_pdf 크기: (13, 2)
2025-09-23 14:08:48,608 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-23 14:08:48,608 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '(KTF)갤럭시 S24 FE', 'item_id': ['A5V7']}, {'item_nm': '(LGU)갤럭시 S24 FE', 'item_id': ['A5V8']}]
2025-09-23 14:08:48,609 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 13개
2025-09-23 14:08:48,609 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': '(KTF)갤럭시 S24 FE', 'action': '기타'}, {'name': '(LGU)갤럭시 S24 FE', 'action': '기타'}]
2025-09-23 14:08:48,609 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-23 14:08:48,609 - __main__ - INFO - 구성된 프롬프트 길이: 6000 문자
2025-09-23 14:08:48,609 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-23 14:08:48,609 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 6000)
2025-09-23 14:08:48,609 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-23 14:08:48,609 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-23 14:08:56,661 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-23 14:08:56,677 - __main__ - INFO - LLM 응답 길이: 1163 문자
2025-09-23 14:08:56,677 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        }
    ],
    "channel": [
        {...
2025-09-23 14:08:56,677 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-23 14:08:56,678 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-23 14:08:56,678 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-23 14:08:56,678 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': 'S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '방문'}, {'type': '전화번호', 'value': '080-801-0011', 'action': '수신 거부'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-23 14:08:56,678 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-23 14:08:56,678 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', 'S24 FE', '아이폰17']
2025-09-23 14:08:56,679 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-09-23 14:08:57,036 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 18377)
2025-09-23 14:08:57,036 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-23 14:08:57,036 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-23 14:08:57,036 - __main__ - INFO - 🔄 1개 LLM 모델로 엔티티 추출 시작
2025-09-23 14:08:57,036 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-23 14:09:01,123 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-23 14:09:01,126 - __main__ - INFO - ✅ LLM 추출 완료: ['와이드8', '아이폰17', 'S24 FE', 'A36']
2025-09-23 14:09:01,294 - __main__ - INFO - extract_entities_by_llm 실행완료: 4.61초
2025-09-23 14:09:01,336 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-23 14:09:01,336 - __main__ - INFO - ============================================================
2025-09-23 14:09:01,336 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-23 14:09:01,336 - __main__ - INFO - ============================================================
2025-09-23 14:09:01,336 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-23 14:09:01,336 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-23 14:09:01,336 - __main__ - INFO - 상품 수: 3개
2025-09-23 14:09:01,336 - __main__ - INFO - 채널 수: 5개
2025-09-23 14:09:01,336 - __main__ - INFO - 프로그램 수: 2개
2025-09-23 14:09:01,336 - __main__ - INFO - process_message 실행완료: 14.70초
2025-09-23 14:09:01,336 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-23 14:09:01,989 - mongodb_utils - INFO - MongoDB 연결 성공: aos.mmsext
2025-09-23 14:09:01,991 - mongodb_utils - INFO - 문서 저장 성공: 68d22b6d9493e4c84581d749
2025-09-23 14:09:01,992 - mongodb_utils - INFO - MongoDB 연결 해제
2025-09-24 09:14:06,735 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-24 09:14:06,736 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-24 09:14:06,736 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-24 09:14:06,736 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-09-24 09:14:06,736 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-24 09:14:06,737 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-24 09:14:06,799 - __main__ - INFO - Using device: mps
2025-09-24 09:14:06,799 - __main__ - INFO - _initialize_device 실행완료: 0.06초
2025-09-24 09:14:06,799 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-24 09:14:06,799 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-24 09:14:06,799 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-24 09:14:06,799 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-24 09:14:06,799 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-24 09:14:06,799 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-24 09:14:06,799 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-24 09:14:12,569 - __main__ - INFO - Model loaded on mps
2025-09-24 09:14:12,570 - __main__ - INFO - _initialize_embedding_model 실행완료: 5.77초
2025-09-24 09:14:12,570 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-24 09:14:13,152 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-24 09:14:13,152 - __main__ - INFO - _initialize_kiwi 실행완료: 0.58초
2025-09-24 09:14:13,153 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-24 09:14:13,153 - __main__ - INFO - ============================================================
2025-09-24 09:14:13,153 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-24 09:14:13,153 - __main__ - INFO - ============================================================
2025-09-24 09:14:13,153 - __main__ - INFO - 데이터 소스 모드: local
2025-09-24 09:14:13,153 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-24 09:14:13,153 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-24 09:14:13,153 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-24 09:14:13,153 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-24 09:14:13,261 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-24 09:14:13,262 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-24 09:14:13,262 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-24 09:14:13,266 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-24 09:14:13,266 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-24 09:14:13,267 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-24 09:14:13,268 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-24 09:14:13,268 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-24 09:14:13,268 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-24 09:14:13,276 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-24 09:14:13,279 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-24 09:14:13,279 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-24 09:14:13,279 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-24 09:14:13,279 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-24 09:14:13,279 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-24 09:14:13,280 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-24 09:14:13,280 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-24 09:14:13,280 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-24 09:14:13,280 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-24 09:14:13,280 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-24 09:14:13,286 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-24 09:14:13,287 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-09-24 09:14:13,287 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-24 09:14:13,287 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-24 09:14:13,287 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-24 09:14:13,419 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-24 09:14:13,423 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-09-24 09:14:13,424 - __main__ - INFO - 별칭 적용 후 샘플: ['우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주Pass Netflix 인증']
2025-09-24 09:14:13,424 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-24 09:14:13,424 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-09-24 09:14:13,424 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-24 09:14:13,425 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-24 09:14:13,425 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-24 09:14:13,425 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-24 09:14:13,426 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-24 09:14:13,426 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-09-24 09:14:13,427 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-09-24 09:14:13,427 - __main__ - INFO - 등록할 별칭 샘플: ['우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주Pass Netflix 인증']
2025-09-24 09:14:13,439 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-09-24 09:14:13,439 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-24 09:14:13,439 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-24 09:14:13,449 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-24 09:14:13,449 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-24 09:14:13,713 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-24 09:14:13,713 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-24 09:14:13,713 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-24 09:14:13,713 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-09-24 09:14:13,713 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-09-24 09:14:13,713 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-24 09:14:13,779 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-09-24 09:14:13,779 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-24 09:14:13,780 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-09-24 09:14:13,781 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-09-24 09:14:13,781 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-09-24 09:14:13,781 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-24 09:14:13,781 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-09-24 09:14:13,781 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-24 09:14:13,781 - __main__ - INFO - ============================================================
2025-09-24 09:14:13,781 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-24 09:14:13,781 - __main__ - INFO - ============================================================
2025-09-24 09:14:13,781 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-09-24 09:14:13,781 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-24 09:14:13,781 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-24 09:14:13,781 - __main__ - INFO - ✅ 정지어: 166개
2025-09-24 09:14:13,781 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-24 09:14:13,782 - __main__ - INFO - 고유 상품명 수: 6586개
2025-09-24 09:14:13,783 - __main__ - INFO - 고유 별칭 수: 16948개
2025-09-24 09:14:13,784 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-24 09:14:13,784 - __main__ - INFO - _load_data 실행완료: 0.63초
2025-09-24 09:14:13,784 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-24 09:14:13,784 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-24 09:14:13,784 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-24 09:14:13,784 - __main__ - INFO - ============================================================
2025-09-24 09:14:13,784 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-24 09:14:13,784 - __main__ - INFO - ============================================================
2025-09-24 09:14:13,784 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-24 09:14:13,784 - __main__ - INFO - 메시지 길이: 421 문자
2025-09-24 09:14:13,784 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-24 09:14:13,784 - __main__ - INFO - 데이터 소스: local
2025-09-24 09:14:13,784 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-24 09:14:13,784 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-24 09:14:13,784 - __main__ - INFO - LLM 모델: ax
2025-09-24 09:14:13,784 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-09-24 09:14:13,784 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-24 09:14:13,784 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-24 09:14:13,784 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-24 09:14:13,784 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-24 09:14:13,785 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-09-24 09:14:14,214 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-24 09:14:14,215 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-24 09:14:14,217 - __main__ - INFO - 전체 토큰 수: 154개
2025-09-24 09:14:14,218 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하9', '갤럭시', '아이폰 17', '을지로입구역', '하나은행', '명동']
2025-09-24 09:14:14,218 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['아이폰 17', '갤럭시', '하나은행', '구매하9', '을지로입구역', '명동']
2025-09-24 09:14:14,218 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-24 09:14:14,667 - __main__ - INFO - 퍼지 매칭 결과 크기: (1242, 3)
2025-09-24 09:14:14,668 - __main__ - INFO - 퍼지 매칭 성공: 1242개 결과
2025-09-24 09:14:14,668 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-24 09:14:14,668 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-24 09:14:14,709 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1242, 3)
2025-09-24 09:14:14,710 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-24 09:14:14,710 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-24 09:14:14,711 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 14개
2025-09-24 09:14:14,713 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 5개
2025-09-24 09:14:14,713 - __main__ - INFO - 통합된 후보 아이템 수: 19개
2025-09-24 09:14:14,715 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-24 09:14:14,717 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (13, 2)
2025-09-24 09:14:14,717 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '(KTF)갤럭시 S24 FE', 'item_id': ['A5V7']}, {'item_nm': '(LGU)갤럭시 S24 FE', 'item_id': ['A5V8']}, {'item_nm': 'IPHONE 17', 'item_id': ['A6UD', 'A6SQ', 'A6U2', 'A6U7', 'A6SV']}]
2025-09-24 09:14:14,717 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 0.93초
2025-09-24 09:14:14,717 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-24 09:14:14,717 - __main__ - INFO - 매칭된 상품 정보: (13, 2)
2025-09-24 09:14:14,717 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-24 09:14:14,796 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-24 09:14:14,796 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-24 09:14:14,796 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-24 09:14:14,796 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-24 09:14:14,796 - __main__ - INFO - 후보 아이템 리스트 크기: 15개
2025-09-24 09:14:14,796 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-24 09:14:14,796 - __main__ - INFO - extra_item_pdf 크기: (13, 2)
2025-09-24 09:14:14,796 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-24 09:14:14,796 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '(KTF)갤럭시 S24 FE', 'item_id': ['A5V7']}, {'item_nm': '(LGU)갤럭시 S24 FE', 'item_id': ['A5V8']}]
2025-09-24 09:14:14,797 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 13개
2025-09-24 09:14:14,797 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': '(KTF)갤럭시 S24 FE', 'action': '기타'}, {'name': '(LGU)갤럭시 S24 FE', 'action': '기타'}]
2025-09-24 09:14:14,797 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-24 09:14:14,797 - __main__ - INFO - 구성된 프롬프트 길이: 6000 문자
2025-09-24 09:14:14,797 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-24 09:14:14,797 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 6000)
2025-09-24 09:14:14,797 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-24 09:14:14,798 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-24 09:14:27,434 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-24 09:14:27,448 - __main__ - INFO - LLM 응답 길이: 1163 문자
2025-09-24 09:14:27,448 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        }
    ],
    "channel": [
        {...
2025-09-24 09:14:27,449 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-24 09:14:27,449 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-24 09:14:27,449 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-24 09:14:27,449 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': 'S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '방문'}, {'type': '전화번호', 'value': '080-801-0011', 'action': '수신 거부'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-24 09:14:27,449 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-24 09:14:27,449 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', 'S24 FE', '아이폰17']
2025-09-24 09:14:27,450 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-09-24 09:14:27,806 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 18377)
2025-09-24 09:14:27,806 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-24 09:14:27,806 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-24 09:14:27,806 - __main__ - INFO - 🔄 1개 LLM 모델로 엔티티 추출 시작
2025-09-24 09:14:27,806 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-24 09:14:30,563 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-24 09:14:30,563 - __main__ - INFO - ✅ LLM 추출 완료: ['아이폰17', 'S24 FE', '와이드8', 'A36']
2025-09-24 09:14:30,742 - __main__ - INFO - extract_entities_by_llm 실행완료: 3.29초
2025-09-24 09:14:30,788 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-24 09:14:30,788 - __main__ - INFO - ============================================================
2025-09-24 09:14:30,788 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-24 09:14:30,788 - __main__ - INFO - ============================================================
2025-09-24 09:14:30,788 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-24 09:14:30,788 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-24 09:14:30,788 - __main__ - INFO - 상품 수: 3개
2025-09-24 09:14:30,788 - __main__ - INFO - 채널 수: 5개
2025-09-24 09:14:30,788 - __main__ - INFO - 프로그램 수: 2개
2025-09-24 09:14:30,788 - __main__ - INFO - process_message 실행완료: 17.00초
2025-09-24 09:14:30,788 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-24 09:14:31,124 - mongodb_utils - INFO - MongoDB 연결 성공: aos.mmsext
2025-09-24 09:14:31,126 - mongodb_utils - INFO - 문서 저장 성공: 68d337e7e34e9ccf297f1cd9
2025-09-24 09:14:31,127 - mongodb_utils - INFO - MongoDB 연결 해제
2025-09-24 09:16:52,603 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-24 09:16:52,603 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-24 09:16:52,603 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-24 09:16:52,603 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-09-24 09:16:52,603 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-24 09:16:52,605 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-24 09:16:52,659 - __main__ - INFO - Using device: mps
2025-09-24 09:16:52,659 - __main__ - INFO - _initialize_device 실행완료: 0.05초
2025-09-24 09:16:52,659 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-24 09:16:52,660 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-24 09:16:52,660 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-24 09:16:52,660 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-24 09:16:52,660 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-24 09:16:52,660 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-24 09:16:52,660 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-24 09:16:56,802 - __main__ - INFO - Model loaded on mps
2025-09-24 09:16:56,802 - __main__ - INFO - _initialize_embedding_model 실행완료: 4.14초
2025-09-24 09:16:56,802 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-24 09:16:57,259 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-24 09:16:57,260 - __main__ - INFO - _initialize_kiwi 실행완료: 0.46초
2025-09-24 09:16:57,260 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-24 09:16:57,260 - __main__ - INFO - ============================================================
2025-09-24 09:16:57,260 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-24 09:16:57,260 - __main__ - INFO - ============================================================
2025-09-24 09:16:57,260 - __main__ - INFO - 데이터 소스 모드: local
2025-09-24 09:16:57,260 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-24 09:16:57,260 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-24 09:16:57,260 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-24 09:16:57,260 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-24 09:16:57,365 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-24 09:16:57,365 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-24 09:16:57,365 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-24 09:16:57,368 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-24 09:16:57,369 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-24 09:16:57,369 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-24 09:16:57,370 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-24 09:16:57,370 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-24 09:16:57,370 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-24 09:16:57,376 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-24 09:16:57,378 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-24 09:16:57,378 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-24 09:16:57,378 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-24 09:16:57,378 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-24 09:16:57,378 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-24 09:16:57,379 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-24 09:16:57,379 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-24 09:16:57,379 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-24 09:16:57,379 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-24 09:16:57,379 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-24 09:16:57,384 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-24 09:16:57,384 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-09-24 09:16:57,384 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-24 09:16:57,384 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-24 09:16:57,385 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-24 09:16:57,514 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-24 09:16:57,519 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-09-24 09:16:57,519 - __main__ - INFO - 별칭 적용 후 샘플: ['우주pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 넷플릭스 인증', '우주패스 Netflix 인증', '우주Pass Netflix 인증']
2025-09-24 09:16:57,519 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-24 09:16:57,519 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-09-24 09:16:57,519 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-24 09:16:57,520 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-24 09:16:57,520 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-24 09:16:57,520 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-24 09:16:57,520 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-24 09:16:57,521 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-09-24 09:16:57,522 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-09-24 09:16:57,522 - __main__ - INFO - 등록할 별칭 샘플: ['우주pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 넷플릭스 인증', '우주패스 Netflix 인증', '우주Pass Netflix 인증']
2025-09-24 09:16:57,535 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-09-24 09:16:57,535 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-24 09:16:57,535 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-24 09:16:57,548 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-24 09:16:57,548 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-24 09:16:57,702 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-24 09:16:57,702 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-24 09:16:57,702 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-24 09:16:57,702 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-09-24 09:16:57,702 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-09-24 09:16:57,702 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-24 09:16:57,766 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-09-24 09:16:57,766 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-24 09:16:57,768 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-09-24 09:16:57,768 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-09-24 09:16:57,768 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-09-24 09:16:57,768 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-24 09:16:57,768 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-09-24 09:16:57,768 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-24 09:16:57,768 - __main__ - INFO - ============================================================
2025-09-24 09:16:57,768 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-24 09:16:57,768 - __main__ - INFO - ============================================================
2025-09-24 09:16:57,768 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-09-24 09:16:57,769 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-24 09:16:57,769 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-24 09:16:57,769 - __main__ - INFO - ✅ 정지어: 166개
2025-09-24 09:16:57,769 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-24 09:16:57,769 - __main__ - INFO - 고유 상품명 수: 6586개
2025-09-24 09:16:57,770 - __main__ - INFO - 고유 별칭 수: 16948개
2025-09-24 09:16:57,771 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-24 09:16:57,771 - __main__ - INFO - _load_data 실행완료: 0.51초
2025-09-24 09:16:57,771 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-24 09:16:57,771 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-24 09:16:57,771 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-24 09:16:57,771 - __main__ - INFO - ============================================================
2025-09-24 09:16:57,771 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-24 09:16:57,771 - __main__ - INFO - ============================================================
2025-09-24 09:16:57,771 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-24 09:16:57,771 - __main__ - INFO - 메시지 길이: 421 문자
2025-09-24 09:16:57,771 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-24 09:16:57,771 - __main__ - INFO - 데이터 소스: local
2025-09-24 09:16:57,771 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-24 09:16:57,771 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-24 09:16:57,771 - __main__ - INFO - LLM 모델: ax
2025-09-24 09:16:57,771 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-09-24 09:16:57,772 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-24 09:16:57,772 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-24 09:16:57,772 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-24 09:16:57,772 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-24 09:16:57,772 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-09-24 09:16:58,193 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-24 09:16:58,193 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-24 09:16:58,196 - __main__ - INFO - 전체 토큰 수: 154개
2025-09-24 09:16:58,196 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하9', '갤럭시', '아이폰 17', '을지로입구역', '하나은행', '명동']
2025-09-24 09:16:58,196 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['명동', '을지로입구역', '구매하9', '아이폰 17', '하나은행', '갤럭시']
2025-09-24 09:16:58,196 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-24 09:16:58,632 - __main__ - INFO - 퍼지 매칭 결과 크기: (1242, 3)
2025-09-24 09:16:58,632 - __main__ - INFO - 퍼지 매칭 성공: 1242개 결과
2025-09-24 09:16:58,633 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-24 09:16:58,633 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-24 09:16:58,673 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1242, 3)
2025-09-24 09:16:58,673 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-24 09:16:58,673 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-24 09:16:58,675 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 14개
2025-09-24 09:16:58,676 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 5개
2025-09-24 09:16:58,677 - __main__ - INFO - 통합된 후보 아이템 수: 19개
2025-09-24 09:16:58,678 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-24 09:16:58,680 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (13, 2)
2025-09-24 09:16:58,680 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '(KTF)갤럭시 S24 FE', 'item_id': ['A5V7']}, {'item_nm': '(LGU)갤럭시 S24 FE', 'item_id': ['A5V8']}, {'item_nm': 'IPHONE 17', 'item_id': ['A6UD', 'A6SQ', 'A6U2', 'A6U7', 'A6SV']}]
2025-09-24 09:16:58,680 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 0.91초
2025-09-24 09:16:58,680 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-24 09:16:58,680 - __main__ - INFO - 매칭된 상품 정보: (13, 2)
2025-09-24 09:16:58,680 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-24 09:16:58,752 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-24 09:16:58,752 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-24 09:16:58,752 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-24 09:16:58,752 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-24 09:16:58,752 - __main__ - INFO - 후보 아이템 리스트 크기: 15개
2025-09-24 09:16:58,752 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-24 09:16:58,752 - __main__ - INFO - extra_item_pdf 크기: (13, 2)
2025-09-24 09:16:58,752 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-24 09:16:58,752 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '(KTF)갤럭시 S24 FE', 'item_id': ['A5V7']}, {'item_nm': '(LGU)갤럭시 S24 FE', 'item_id': ['A5V8']}]
2025-09-24 09:16:58,753 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 13개
2025-09-24 09:16:58,753 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': '(KTF)갤럭시 S24 FE', 'action': '기타'}, {'name': '(LGU)갤럭시 S24 FE', 'action': '기타'}]
2025-09-24 09:16:58,753 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-24 09:16:58,753 - __main__ - INFO - 구성된 프롬프트 길이: 6000 문자
2025-09-24 09:16:58,753 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-24 09:16:58,753 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 6000)
2025-09-24 09:16:58,754 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-24 09:16:58,754 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-24 09:17:09,084 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-24 09:17:09,098 - __main__ - INFO - LLM 응답 길이: 1047 문자
2025-09-24 09:17:09,099 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        }
    ],
    "channel": [
        {...
2025-09-24 09:17:09,099 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-24 09:17:09,099 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-24 09:17:09,099 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-24 09:17:09,099 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': 'S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '방문'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-24 09:17:09,099 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-24 09:17:09,099 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', 'S24 FE', '아이폰17']
2025-09-24 09:17:09,100 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-09-24 09:17:09,101 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-09-24 09:17:09,460 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 18377)
2025-09-24 09:17:09,460 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-24 09:17:09,460 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-24 09:17:09,460 - __main__ - INFO - 🔄 2개 LLM 모델로 엔티티 추출 시작
2025-09-24 09:17:09,481 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-24 09:17:09,481 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-24 09:17:11,744 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-24 09:17:12,921 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-24 09:17:12,929 - __main__ - INFO - ✅ LLM 추출 완료: ['S24 FE', '아이폰17', '갤럭시 와이드8', '와이드8', 'A36']
2025-09-24 09:17:13,114 - __main__ - INFO - extract_entities_by_llm 실행완료: 4.01초
2025-09-24 09:17:13,146 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-24 09:17:13,147 - __main__ - INFO - ============================================================
2025-09-24 09:17:13,147 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-24 09:17:13,147 - __main__ - INFO - ============================================================
2025-09-24 09:17:13,147 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-24 09:17:13,147 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-24 09:17:13,147 - __main__ - INFO - 상품 수: 4개
2025-09-24 09:17:13,147 - __main__ - INFO - 채널 수: 4개
2025-09-24 09:17:13,147 - __main__ - INFO - 프로그램 수: 2개
2025-09-24 09:17:13,147 - __main__ - INFO - process_message 실행완료: 15.38초
2025-09-24 09:17:13,147 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-24 09:17:13,737 - mongodb_utils - INFO - MongoDB 연결 성공: aos.mmsext
2025-09-24 09:17:13,739 - mongodb_utils - INFO - 문서 저장 성공: 68d338892a0986220a571492
2025-09-24 09:17:13,740 - mongodb_utils - INFO - MongoDB 연결 해제
2025-09-24 13:40:15,467 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-24 13:40:15,467 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-24 13:40:15,467 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-24 13:40:15,467 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-09-24 13:40:15,467 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-24 13:40:15,469 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-24 13:40:15,546 - __main__ - INFO - Using device: mps
2025-09-24 13:40:15,546 - __main__ - INFO - _initialize_device 실행완료: 0.08초
2025-09-24 13:40:15,546 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-24 13:40:15,546 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-24 13:40:15,546 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-24 13:40:15,546 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-24 13:40:15,546 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-24 13:40:15,547 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-24 13:40:15,547 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-24 13:40:19,538 - __main__ - INFO - Model loaded on mps
2025-09-24 13:40:19,538 - __main__ - INFO - _initialize_embedding_model 실행완료: 3.99초
2025-09-24 13:40:19,538 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-24 13:40:20,043 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-24 13:40:20,043 - __main__ - INFO - _initialize_kiwi 실행완료: 0.51초
2025-09-24 13:40:20,043 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-24 13:40:20,043 - __main__ - INFO - ============================================================
2025-09-24 13:40:20,043 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-24 13:40:20,043 - __main__ - INFO - ============================================================
2025-09-24 13:40:20,043 - __main__ - INFO - 데이터 소스 모드: local
2025-09-24 13:40:20,043 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-24 13:40:20,043 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-24 13:40:20,043 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-24 13:40:20,043 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-24 13:40:20,153 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-24 13:40:20,153 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-24 13:40:20,153 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-24 13:40:20,156 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-24 13:40:20,157 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-24 13:40:20,158 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-24 13:40:20,158 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-24 13:40:20,159 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-24 13:40:20,159 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-24 13:40:20,163 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-24 13:40:20,165 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-24 13:40:20,165 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-24 13:40:20,165 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-24 13:40:20,165 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-24 13:40:20,165 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-24 13:40:20,166 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-24 13:40:20,166 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-24 13:40:20,166 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-24 13:40:20,166 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-24 13:40:20,166 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-24 13:40:20,169 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-24 13:40:20,169 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-09-24 13:40:20,169 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-24 13:40:20,170 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-24 13:40:20,170 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-24 13:40:20,301 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-24 13:40:20,305 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-09-24 13:40:20,306 - __main__ - INFO - 별칭 적용 후 샘플: ['우주pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증']
2025-09-24 13:40:20,306 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-24 13:40:20,306 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-09-24 13:40:20,306 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-24 13:40:20,307 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-24 13:40:20,307 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-24 13:40:20,307 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-24 13:40:20,307 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-24 13:40:20,308 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-09-24 13:40:20,309 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-09-24 13:40:20,309 - __main__ - INFO - 등록할 별칭 샘플: ['우주pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증']
2025-09-24 13:40:20,323 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-09-24 13:40:20,323 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-24 13:40:20,323 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-24 13:40:20,328 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-24 13:40:20,328 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-24 13:40:20,496 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-24 13:40:20,497 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-24 13:40:20,497 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-24 13:40:20,497 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-09-24 13:40:20,497 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-09-24 13:40:20,497 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-24 13:40:20,565 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-09-24 13:40:20,565 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-24 13:40:20,567 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-09-24 13:40:20,567 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-09-24 13:40:20,567 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-09-24 13:40:20,567 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-24 13:40:20,567 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-09-24 13:40:20,568 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-24 13:40:20,568 - __main__ - INFO - ============================================================
2025-09-24 13:40:20,568 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-24 13:40:20,568 - __main__ - INFO - ============================================================
2025-09-24 13:40:20,568 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-09-24 13:40:20,568 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-24 13:40:20,568 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-24 13:40:20,568 - __main__ - INFO - ✅ 정지어: 166개
2025-09-24 13:40:20,568 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-24 13:40:20,569 - __main__ - INFO - 고유 상품명 수: 6586개
2025-09-24 13:40:20,570 - __main__ - INFO - 고유 별칭 수: 16948개
2025-09-24 13:40:20,571 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-24 13:40:20,571 - __main__ - INFO - _load_data 실행완료: 0.53초
2025-09-24 13:40:20,571 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-24 13:40:20,571 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-24 13:40:20,571 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-24 13:40:20,571 - __main__ - INFO - ============================================================
2025-09-24 13:40:20,571 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-24 13:40:20,571 - __main__ - INFO - ============================================================
2025-09-24 13:40:20,571 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-24 13:40:20,571 - __main__ - INFO - 메시지 길이: 421 문자
2025-09-24 13:40:20,571 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-24 13:40:20,571 - __main__ - INFO - 데이터 소스: local
2025-09-24 13:40:20,571 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-24 13:40:20,571 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-24 13:40:20,571 - __main__ - INFO - LLM 모델: ax
2025-09-24 13:40:20,571 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-09-24 13:40:20,571 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-24 13:40:20,571 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-24 13:40:20,571 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-24 13:40:20,571 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-24 13:40:20,572 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-09-24 13:40:21,022 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-24 13:40:21,023 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-24 13:40:21,026 - __main__ - INFO - 전체 토큰 수: 154개
2025-09-24 13:40:21,026 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하9', '갤럭시', '아이폰 17', '을지로입구역', '하나은행', '명동']
2025-09-24 13:40:21,026 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['을지로입구역', '하나은행', '구매하9', '아이폰 17', '명동', '갤럭시']
2025-09-24 13:40:21,026 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-24 13:40:21,460 - __main__ - INFO - 퍼지 매칭 결과 크기: (1242, 3)
2025-09-24 13:40:21,460 - __main__ - INFO - 퍼지 매칭 성공: 1242개 결과
2025-09-24 13:40:21,460 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-24 13:40:21,460 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-24 13:40:21,499 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1242, 3)
2025-09-24 13:40:21,500 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-24 13:40:21,500 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-24 13:40:21,501 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 14개
2025-09-24 13:40:21,503 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 5개
2025-09-24 13:40:21,503 - __main__ - INFO - 통합된 후보 아이템 수: 19개
2025-09-24 13:40:21,505 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-24 13:40:21,506 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (13, 2)
2025-09-24 13:40:21,507 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '(KTF)갤럭시 S24 FE', 'item_id': ['A5V7']}, {'item_nm': '(LGU)갤럭시 S24 FE', 'item_id': ['A5V8']}, {'item_nm': 'IPHONE 17', 'item_id': ['A6UD', 'A6SQ', 'A6U2', 'A6U7', 'A6SV']}]
2025-09-24 13:40:21,507 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 0.94초
2025-09-24 13:40:21,507 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-24 13:40:21,507 - __main__ - INFO - 매칭된 상품 정보: (13, 2)
2025-09-24 13:40:21,507 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-24 13:40:21,590 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-24 13:40:21,590 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-24 13:40:21,590 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-24 13:40:21,590 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-24 13:40:21,590 - __main__ - INFO - 후보 아이템 리스트 크기: 15개
2025-09-24 13:40:21,590 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-24 13:40:21,591 - __main__ - INFO - extra_item_pdf 크기: (13, 2)
2025-09-24 13:40:21,591 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-24 13:40:21,591 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '(KTF)갤럭시 S24 FE', 'item_id': ['A5V7']}, {'item_nm': '(LGU)갤럭시 S24 FE', 'item_id': ['A5V8']}]
2025-09-24 13:40:21,592 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 13개
2025-09-24 13:40:21,592 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': '(KTF)갤럭시 S24 FE', 'action': '기타'}, {'name': '(LGU)갤럭시 S24 FE', 'action': '기타'}]
2025-09-24 13:40:21,592 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-24 13:40:21,592 - __main__ - INFO - 구성된 프롬프트 길이: 6000 문자
2025-09-24 13:40:21,592 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-24 13:40:21,592 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-09-24 13:40:21,592 - __main__ - INFO - 📝 프롬프트 길이: 6,000 문자
2025-09-24 13:40:21,592 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-09-24 13:40:21,592 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-24 13:40:36,750 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-24 13:40:36,764 - __main__ - INFO - LLM 응답 길이: 1163 문자
2025-09-24 13:40:36,765 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        }
    ],
    "channel": [
        {...
2025-09-24 13:40:36,765 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-24 13:40:36,765 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-24 13:40:36,765 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-24 13:40:36,765 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': 'S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '방문'}, {'type': '전화번호', 'value': '080-801-0011', 'action': '수신 거부'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-24 13:40:36,765 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-24 13:40:36,766 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', 'S24 FE', '아이폰17']
2025-09-24 13:40:36,766 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-09-24 13:40:36,766 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-09-24 13:40:36,766 - __main__ - INFO - === 후보 엔티티 추출 시작 ===
2025-09-24 13:40:36,766 - __main__ - INFO - 퍼지 매칭 임계값: 0.4
2025-09-24 13:40:37,116 - __main__ - INFO - 로직 기반 추출 원본 엔티티 수: 1052개
2025-09-24 13:40:37,116 - __main__ - INFO - 원본 엔티티 샘플 (최대 10개): ['(KTF)갤럭시 Z 폴드7 512기가', '(LGU)갤럭시 Z 폴드7 256기가', '(LGU)갤럭시 Z 폴드7 512기가', '0 청년 37', '0 청년 43', '0 청년 43 DATA 충전 2GB', '0 청년 43 Data 충전 2GB', '0 청년 43 data 충전 2GB', '0 청년 43 데이터 충전 2GB', '0 청년 43 데이터 충전 2기가']
2025-09-24 13:40:37,117 - __main__ - INFO - 필터링 후 엔티티 수: 1048개
2025-09-24 13:40:37,117 - __main__ - INFO - 제거된 엔티티 수: 4개
2025-09-24 13:40:37,117 - __main__ - INFO - 최종 후보 엔티티 수: 1048개
2025-09-24 13:40:37,117 - __main__ - WARNING - ⚠️ 후보 엔티티가 매우 많습니다: 1048개
2025-09-24 13:40:37,117 - __main__ - WARNING - 이는 프롬프트 길이를 크게 증가시킬 수 있습니다.
2025-09-24 13:40:37,117 - __main__ - WARNING - 성능을 위해 상위 50개만 사용합니다. (원본: 1048개)
2025-09-24 13:40:37,117 - __main__ - INFO - 최종 후보 엔티티 샘플 (최대 10개): ['(KTF)갤럭시 Z 폴드7 512기가', '(LGU)갤럭시 Z 폴드7 256기가', '(LGU)갤럭시 Z 폴드7 512기가', '0 청년 37', '0 청년 43', '0 청년 43 DATA 충전 2GB', '0 청년 43 Data 충전 2GB', '0 청년 43 data 충전 2GB', '0 청년 43 데이터 충전 2GB', '0 청년 43 데이터 충전 2기가']
2025-09-24 13:40:37,117 - __main__ - INFO - === 후보 엔티티 추출 완료 ===
2025-09-24 13:40:37,117 - __main__ - INFO - 🔍 프롬프트에 추가될 엔티티 섹션 길이: 896 문자
2025-09-24 13:40:37,117 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 3,720 문자
2025-09-24 13:40:37,117 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-09-24 13:40:37,117 - __main__ - INFO - 📝 프롬프트 길이: 3,720 문자
2025-09-24 13:40:37,117 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-09-24 13:40:37,117 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-24 13:40:37,117 - __main__ - INFO - 🔄 2개 LLM 모델로 엔티티 추출 시작
2025-09-24 13:40:37,129 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-24 13:40:37,129 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-24 13:40:37,129 - __main__ - INFO - 🔍 프롬프트 구성 중 - LLM 모델: client=<openai.resources.chat.completions.completions.Completions object at 0x13af2e580> async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x13af2f790> root_client=<openai.OpenAI object at 0x13af2e360> root_async_client=<openai.AsyncOpenAI object at 0x13af2e470> model_name='skt/ax4' temperature=0.0 model_kwargs={} openai_api_key=SecretStr('**********') openai_api_base='https://api.platform.a15t.com/v1' max_tokens=4000
2025-09-24 13:40:37,129 - __main__ - INFO - 🔍 프롬프트 구성 중 - LLM 모델: client=<openai.resources.chat.completions.completions.Completions object at 0x13e18e9c0> async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x13e18e690> root_client=<openai.OpenAI object at 0x13b002550> root_async_client=<openai.AsyncOpenAI object at 0x13e18e7a0> model_name='amazon/anthropic/claude-sonnet-4-20250514' temperature=0.0 model_kwargs={} openai_api_key=SecretStr('**********') openai_api_base='https://api.platform.a15t.com/v1' max_tokens=4000
2025-09-24 13:40:37,129 - __main__ - INFO - 🔍 후보 엔티티 개수: 50개
2025-09-24 13:40:37,129 - __main__ - INFO - 🔍 후보 엔티티 개수: 50개
2025-09-24 13:40:37,129 - __main__ - INFO - 🔍 후보 엔티티 문자열 길이: 783 문자
2025-09-24 13:40:37,130 - __main__ - INFO - 🔍 후보 엔티티 문자열 길이: 783 문자
2025-09-24 13:40:37,130 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-09-24 13:40:37,130 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-09-24 13:40:37,130 - __main__ - INFO - 🔍 메시지 길이: 407 문자
2025-09-24 13:40:37,130 - __main__ - INFO - 🔍 메시지 길이: 407 문자
2025-09-24 13:40:37,130 - __main__ - INFO - 🔍 예상 전체 프롬프트 길이: 3,638 문자
2025-09-24 13:40:37,130 - __main__ - INFO - 🔍 예상 전체 프롬프트 길이: 3,638 문자
2025-09-24 13:40:38,389 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-24 13:40:38,583 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-24 13:40:38,591 - __main__ - INFO - ✅ LLM 추출 완료: ['아이폰17', 'A36', 'S24 FE', '와이드8', '인터넷+TV']
2025-09-24 13:40:38,782 - __main__ - INFO - extract_entities_by_llm 실행완료: 2.02초
2025-09-24 13:40:38,814 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-24 13:40:38,814 - __main__ - INFO - ============================================================
2025-09-24 13:40:38,814 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-24 13:40:38,814 - __main__ - INFO - ============================================================
2025-09-24 13:40:38,814 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-24 13:40:38,814 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-24 13:40:38,814 - __main__ - INFO - 상품 수: 3개
2025-09-24 13:40:38,814 - __main__ - INFO - 채널 수: 5개
2025-09-24 13:40:38,814 - __main__ - INFO - 프로그램 수: 2개
2025-09-24 13:40:38,814 - __main__ - INFO - process_message 실행완료: 18.24초
2025-09-24 13:40:38,814 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-24 13:40:39,403 - mongodb_utils - INFO - MongoDB 연결 성공: aos.mmsext
2025-09-24 13:40:39,405 - mongodb_utils - INFO - 문서 저장 성공: 68d37647f46c635bf6da5648
2025-09-24 13:40:39,407 - mongodb_utils - INFO - MongoDB 연결 해제
2025-09-25 13:24:25,395 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-25 13:24:25,395 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-25 13:24:25,396 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-25 13:24:25,396 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-09-25 13:24:25,396 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-25 13:24:25,397 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-25 13:24:25,434 - __main__ - INFO - Using device: mps
2025-09-25 13:24:25,434 - __main__ - INFO - _initialize_device 실행완료: 0.04초
2025-09-25 13:24:25,434 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-25 13:24:25,435 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-25 13:24:25,435 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-25 13:24:25,435 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-25 13:24:25,435 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-25 13:24:25,435 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-25 13:24:25,435 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-25 13:24:26,079 - __main__ - INFO - Model loaded on mps
2025-09-25 13:24:26,080 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.64초
2025-09-25 13:24:26,080 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-25 13:24:26,716 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-25 13:24:26,717 - __main__ - INFO - _initialize_kiwi 실행완료: 0.64초
2025-09-25 13:24:26,717 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-25 13:24:26,717 - __main__ - INFO - ============================================================
2025-09-25 13:24:26,717 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-25 13:24:26,717 - __main__ - INFO - ============================================================
2025-09-25 13:24:26,717 - __main__ - INFO - 데이터 소스 모드: local
2025-09-25 13:24:26,717 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-25 13:24:26,717 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-25 13:24:26,717 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-25 13:24:26,717 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-25 13:24:26,866 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-25 13:24:26,866 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-25 13:24:26,866 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-25 13:24:26,873 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-25 13:24:26,874 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-25 13:24:26,875 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-25 13:24:26,875 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-25 13:24:26,876 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-25 13:24:26,876 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-25 13:24:26,888 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-25 13:24:26,891 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-25 13:24:26,891 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-25 13:24:26,891 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-25 13:24:26,891 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-25 13:24:26,891 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-25 13:24:26,892 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-25 13:24:26,892 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-25 13:24:26,892 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-25 13:24:26,892 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-25 13:24:26,892 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-25 13:24:26,899 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-25 13:24:26,899 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-09-25 13:24:26,899 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-25 13:24:26,900 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-25 13:24:26,900 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-25 13:24:27,093 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-25 13:24:27,103 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-09-25 13:24:27,103 - __main__ - INFO - 별칭 적용 후 샘플: ['우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증']
2025-09-25 13:24:27,103 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-25 13:24:27,104 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-09-25 13:24:27,104 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-25 13:24:27,108 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-25 13:24:27,108 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-25 13:24:27,108 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-25 13:24:27,108 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-25 13:24:27,109 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-09-25 13:24:27,110 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-09-25 13:24:27,110 - __main__ - INFO - 등록할 별칭 샘플: ['우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증']
2025-09-25 13:24:27,131 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-09-25 13:24:27,131 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-25 13:24:27,131 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-25 13:24:27,142 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-25 13:24:27,142 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-25 13:24:29,009 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-25 13:24:29,010 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-25 13:24:29,010 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-25 13:24:29,010 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-09-25 13:24:29,010 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-09-25 13:24:29,010 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-25 13:24:29,099 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-09-25 13:24:29,099 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-25 13:24:29,102 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-09-25 13:24:29,102 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-09-25 13:24:29,102 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-09-25 13:24:29,102 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-25 13:24:29,102 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-09-25 13:24:29,103 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-25 13:24:29,103 - __main__ - INFO - ============================================================
2025-09-25 13:24:29,103 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-25 13:24:29,103 - __main__ - INFO - ============================================================
2025-09-25 13:24:29,103 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-09-25 13:24:29,103 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-25 13:24:29,103 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-25 13:24:29,103 - __main__ - INFO - ✅ 정지어: 166개
2025-09-25 13:24:29,103 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-25 13:24:29,104 - __main__ - INFO - 고유 상품명 수: 6586개
2025-09-25 13:24:29,106 - __main__ - INFO - 고유 별칭 수: 16948개
2025-09-25 13:24:29,108 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-25 13:24:29,108 - __main__ - INFO - _load_data 실행완료: 2.39초
2025-09-25 13:24:29,108 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-25 13:24:29,108 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-25 13:24:29,108 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-25 13:24:29,108 - __main__ - INFO - ============================================================
2025-09-25 13:24:29,108 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-25 13:24:29,108 - __main__ - INFO - ============================================================
2025-09-25 13:24:29,108 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-25 13:24:29,108 - __main__ - INFO - 메시지 길이: 421 문자
2025-09-25 13:24:29,108 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-25 13:24:29,108 - __main__ - INFO - 데이터 소스: local
2025-09-25 13:24:29,109 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-25 13:24:29,109 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-25 13:24:29,109 - __main__ - INFO - LLM 모델: ax
2025-09-25 13:24:29,109 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-09-25 13:24:29,109 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-25 13:24:29,109 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-25 13:24:29,109 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-25 13:24:29,109 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-25 13:24:29,110 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-09-25 13:24:29,767 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-25 13:24:29,768 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-25 13:24:29,772 - __main__ - INFO - 전체 토큰 수: 154개
2025-09-25 13:24:29,772 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하9', '갤럭시', '아이폰 17', '을지로입구역', '하나은행', '명동']
2025-09-25 13:24:29,772 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['하나은행', '아이폰 17', '구매하9', '명동', '갤럭시', '을지로입구역']
2025-09-25 13:24:29,772 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-25 13:24:30,678 - __main__ - INFO - 퍼지 매칭 결과 크기: (1242, 3)
2025-09-25 13:24:30,678 - __main__ - INFO - 퍼지 매칭 성공: 1242개 결과
2025-09-25 13:24:30,679 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-25 13:24:30,679 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-25 13:24:30,749 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1242, 3)
2025-09-25 13:24:30,750 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-25 13:24:30,750 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-25 13:24:30,753 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 14개
2025-09-25 13:24:30,755 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 5개
2025-09-25 13:24:30,756 - __main__ - INFO - 통합된 후보 아이템 수: 19개
2025-09-25 13:24:30,759 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-25 13:24:30,762 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (13, 2)
2025-09-25 13:24:30,762 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '(KTF)갤럭시 S24 FE', 'item_id': ['A5V7']}, {'item_nm': '(LGU)갤럭시 S24 FE', 'item_id': ['A5V8']}, {'item_nm': 'IPHONE 17', 'item_id': ['A6UD', 'A6SQ', 'A6U2', 'A6U7', 'A6SV']}]
2025-09-25 13:24:30,762 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.65초
2025-09-25 13:24:30,762 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-25 13:24:30,762 - __main__ - INFO - 매칭된 상품 정보: (13, 2)
2025-09-25 13:24:30,762 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-25 13:24:31,905 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-25 13:24:31,905 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-25 13:24:31,905 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-25 13:24:31,905 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-25 13:24:31,905 - __main__ - INFO - 후보 아이템 리스트 크기: 15개
2025-09-25 13:24:31,905 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-25 13:24:31,905 - __main__ - INFO - extra_item_pdf 크기: (13, 2)
2025-09-25 13:24:31,905 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-25 13:24:31,906 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '(KTF)갤럭시 S24 FE', 'item_id': ['A5V7']}, {'item_nm': '(LGU)갤럭시 S24 FE', 'item_id': ['A5V8']}]
2025-09-25 13:24:31,907 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 13개
2025-09-25 13:24:31,907 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': '(KTF)갤럭시 S24 FE', 'action': '기타'}, {'name': '(LGU)갤럭시 S24 FE', 'action': '기타'}]
2025-09-25 13:24:31,907 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-25 13:24:31,907 - __main__ - INFO - 구성된 프롬프트 길이: 6000 문자
2025-09-25 13:24:31,907 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-25 13:24:31,907 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-09-25 13:24:31,907 - __main__ - INFO - 📝 프롬프트 길이: 6,000 문자
2025-09-25 13:24:31,908 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-09-25 13:24:31,908 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-25 13:24:45,924 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-25 13:24:45,943 - __main__ - INFO - LLM 응답 길이: 1047 문자
2025-09-25 13:24:45,944 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        }
    ],
    "channel": [
        {...
2025-09-25 13:24:45,944 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-25 13:24:45,944 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-25 13:24:45,945 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-25 13:24:45,945 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': 'S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '방문'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-25 13:24:45,945 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-25 13:24:45,945 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', 'S24 FE', '아이폰17']
2025-09-25 13:24:45,946 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-09-25 13:24:45,946 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-09-25 13:24:45,946 - __main__ - INFO - === 후보 엔티티 추출 시작 ===
2025-09-25 13:24:45,946 - __main__ - INFO - 퍼지 매칭 임계값: 0.4
2025-09-25 13:24:46,654 - __main__ - INFO - 로직 기반 추출 원본 엔티티 수: 1052개
2025-09-25 13:24:46,654 - __main__ - INFO - 원본 엔티티 샘플 (최대 10개): ['(KTF)갤럭시 Z 폴드7 512기가', '(LGU)갤럭시 Z 폴드7 256기가', '(LGU)갤럭시 Z 폴드7 512기가', '0 청년 37', '0 청년 43', '0 청년 43 DATA 충전 2GB', '0 청년 43 Data 충전 2GB', '0 청년 43 data 충전 2GB', '0 청년 43 데이터 충전 2GB', '0 청년 43 데이터 충전 2기가']
2025-09-25 13:24:46,656 - __main__ - INFO - 필터링 후 엔티티 수: 1048개
2025-09-25 13:24:46,656 - __main__ - INFO - 제거된 엔티티 수: 4개
2025-09-25 13:24:46,656 - __main__ - INFO - 최종 후보 엔티티 수: 1048개
2025-09-25 13:24:46,656 - __main__ - WARNING - ⚠️ 후보 엔티티가 매우 많습니다: 1048개
2025-09-25 13:24:46,656 - __main__ - WARNING - 이는 프롬프트 길이를 크게 증가시킬 수 있습니다.
2025-09-25 13:24:46,656 - __main__ - WARNING - 성능을 위해 상위 100개만 사용합니다. (원본: 1048개)
2025-09-25 13:24:46,656 - __main__ - INFO - 최종 후보 엔티티 샘플 (최대 10개): ['(KTF)갤럭시 Z 폴드7 512기가', '(LGU)갤럭시 Z 폴드7 256기가', '(LGU)갤럭시 Z 폴드7 512기가', '0 청년 37', '0 청년 43', '0 청년 43 DATA 충전 2GB', '0 청년 43 Data 충전 2GB', '0 청년 43 data 충전 2GB', '0 청년 43 데이터 충전 2GB', '0 청년 43 데이터 충전 2기가']
2025-09-25 13:24:46,656 - __main__ - INFO - === 후보 엔티티 추출 완료 ===
2025-09-25 13:24:46,656 - __main__ - INFO - 🔍 프롬프트에 추가될 엔티티 섹션 길이: 1,528 문자
2025-09-25 13:24:46,656 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 4,352 문자
2025-09-25 13:24:46,656 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-09-25 13:24:46,656 - __main__ - INFO - 📝 프롬프트 길이: 4,352 문자
2025-09-25 13:24:46,656 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-09-25 13:24:46,656 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-25 13:24:46,656 - __main__ - INFO - 🔄 2개 LLM 모델로 엔티티 추출 시작
2025-09-25 13:24:46,668 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-25 13:24:46,668 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-25 13:24:46,668 - __main__ - INFO - 🔍 프롬프트 구성 중 - LLM 모델: client=<openai.resources.chat.completions.completions.Completions object at 0x1630042c0> async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x1630e9280> root_client=<openai.OpenAI object at 0x163291670> root_async_client=<openai.AsyncOpenAI object at 0x1b1dbaea0> model_name='skt/ax4' temperature=0.0 model_kwargs={} openai_api_key=SecretStr('**********') openai_api_base='https://api.platform.a15t.com/v1' max_tokens=4000
2025-09-25 13:24:46,669 - __main__ - INFO - 🔍 프롬프트 구성 중 - LLM 모델: client=<openai.resources.chat.completions.completions.Completions object at 0x1b1dcf7d0> async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x1694c28a0> root_client=<openai.OpenAI object at 0x1630d5190> root_async_client=<openai.AsyncOpenAI object at 0x1694c0dd0> model_name='amazon/anthropic/claude-sonnet-4-20250514' temperature=0.0 model_kwargs={} openai_api_key=SecretStr('**********') openai_api_base='https://api.platform.a15t.com/v1' max_tokens=4000
2025-09-25 13:24:46,669 - __main__ - INFO - 🔍 후보 엔티티 개수: 100개
2025-09-25 13:24:46,669 - __main__ - INFO - 🔍 후보 엔티티 개수: 100개
2025-09-25 13:24:46,669 - __main__ - INFO - 🔍 후보 엔티티 문자열 길이: 1,365 문자
2025-09-25 13:24:46,669 - __main__ - INFO - 🔍 후보 엔티티 문자열 길이: 1,365 문자
2025-09-25 13:24:46,669 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-09-25 13:24:46,669 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-09-25 13:24:46,669 - __main__ - INFO - 🔍 메시지 길이: 407 문자
2025-09-25 13:24:46,669 - __main__ - INFO - 🔍 메시지 길이: 407 문자
2025-09-25 13:24:46,669 - __main__ - INFO - 🔍 예상 전체 프롬프트 길이: 4,220 문자
2025-09-25 13:24:46,669 - __main__ - INFO - 🔍 예상 전체 프롬프트 길이: 4,220 문자
2025-09-25 13:24:47,841 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-25 13:24:48,480 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-25 13:24:48,493 - __main__ - INFO - ✅ LLM 추출 완료: ['S24 FE', '와이드8', 'A36', '아이폰17']
2025-09-25 13:24:48,810 - __main__ - INFO - extract_entities_by_llm 실행완료: 2.86초
2025-09-25 13:24:48,874 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-25 13:24:48,874 - __main__ - INFO - ============================================================
2025-09-25 13:24:48,874 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-25 13:24:48,874 - __main__ - INFO - ============================================================
2025-09-25 13:24:48,874 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-25 13:24:48,874 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-25 13:24:48,874 - __main__ - INFO - 상품 수: 3개
2025-09-25 13:24:48,874 - __main__ - INFO - 채널 수: 4개
2025-09-25 13:24:48,874 - __main__ - INFO - 프로그램 수: 2개
2025-09-25 13:24:48,874 - __main__ - INFO - process_message 실행완료: 19.77초
2025-09-25 13:24:48,874 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-25 13:24:49,489 - mongodb_utils - INFO - MongoDB 연결 성공: aos.mmsext
2025-09-25 13:24:49,519 - mongodb_utils - INFO - 문서 저장 성공: 68d4c411de02ac3d9dd10d12
2025-09-25 13:24:49,520 - mongodb_utils - INFO - MongoDB 연결 해제
2025-10-20 14:21:01,298 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 14:21:01,298 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 14:21:01,298 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 14:21:01,298 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 14:21:01,298 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 14:21:01,300 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 14:21:01,351 - __main__ - INFO - Using device: mps
2025-10-20 14:21:01,351 - __main__ - INFO - _initialize_device 실행완료: 0.05초
2025-10-20 14:21:01,351 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 14:21:01,352 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 14:21:01,352 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 14:21:01,352 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 14:21:01,352 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 14:21:01,353 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 14:21:01,353 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 14:21:02,095 - __main__ - INFO - Model loaded on mps
2025-10-20 14:21:02,095 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.74초
2025-10-20 14:21:02,095 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 14:21:02,708 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 14:21:02,708 - __main__ - INFO - _initialize_kiwi 실행완료: 0.61초
2025-10-20 14:21:02,708 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 14:21:02,708 - __main__ - INFO - ============================================================
2025-10-20 14:21:02,708 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 14:21:02,708 - __main__ - INFO - ============================================================
2025-10-20 14:21:02,708 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 14:21:02,708 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 14:21:02,708 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 14:21:02,708 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 14:21:02,708 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:21:02,881 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 14:21:02,881 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:21:02,881 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 14:21:02,890 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 14:21:02,891 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 14:21:02,891 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:21:02,892 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:21:02,893 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 14:21:02,893 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 14:21:02,894 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 14:21:02,899 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 14:21:02,899 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 14:21:02,899 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:21:02,899 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 14:21:02,899 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 14:21:02,899 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 14:21:02,899 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:21:02,899 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 14:21:02,899 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 14:21:02,899 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 14:21:02,901 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 14:21:02,902 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 14:21:02,902 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:21:02,902 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 14:21:02,903 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:21:03,130 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 14:21:03,140 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 14:21:03,141 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 넷플릭스 인증', '우주pass Netflix 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증']
2025-10-20 14:21:03,141 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 14:21:03,141 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 14:21:03,141 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 14:21:03,142 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 14:21:03,142 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 14:21:03,142 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 14:21:03,142 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 14:21:03,144 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 14:21:03,145 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 14:21:03,145 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 넷플릭스 인증', '우주pass Netflix 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증']
2025-10-20 14:21:03,165 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 14:21:03,166 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 14:21:03,166 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 14:21:03,167 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 14:21:03,167 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 14:21:05,136 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 14:21:05,136 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 14:21:05,136 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 14:21:05,136 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 14:21:05,136 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 14:21:05,136 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:21:05,236 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 14:21:05,236 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:21:05,239 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 14:21:05,239 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 14:21:05,239 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 14:21:05,239 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:21:05,239 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 14:21:05,240 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 14:21:05,240 - __main__ - INFO - ============================================================
2025-10-20 14:21:05,240 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 14:21:05,240 - __main__ - INFO - ============================================================
2025-10-20 14:21:05,240 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 14:21:05,240 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 14:21:05,240 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 14:21:05,240 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 14:21:05,240 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 14:21:05,242 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 14:21:05,244 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 14:21:05,246 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 14:21:05,247 - __main__ - INFO - _load_data 실행완료: 2.54초
2025-10-20 14:21:05,247 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 14:21:05,247 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 14:21:05,247 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
(광고)[SKT] 아...
2025-10-20 14:21:05,247 - __main__ - INFO - ============================================================
2025-10-20 14:21:05,247 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 14:21:05,247 - __main__ - INFO - ============================================================
2025-10-20 14:21:05,247 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
(광고)[SKT] 아이폰 12/12 Pro 사전예약 안내  #04 고객님, 안녕하세요. 최고의 스마트폰 칩과 카메라, 견고한 세라믹 실드에 5G 기술까지! 이 모든 것을 갖춘 아이폰 12/12 Pro를 만나 보세요.  ▶ 혜택받고 사전예약하기: http://t-mms.kr/t.do?m=#...
2025-10-20 14:21:05,247 - __main__ - INFO - 메시지 길이: 822 문자
2025-10-20 14:21:05,247 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 14:21:05,247 - __main__ - INFO - 데이터 소스: local
2025-10-20 14:21:05,247 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 14:21:05,247 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-20 14:21:05,247 - __main__ - INFO - LLM 모델: ax
2025-10-20 14:21:05,247 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 14:21:05,247 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 14:21:05,247 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 14:21:05,247 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 14:21:05,247 - __main__ - INFO - 처리할 메시지 길이: 815 문자
2025-10-20 14:21:05,249 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 14:21:05,935 - __main__ - INFO - 분할된 문장 수: 9개
2025-10-20 14:21:05,937 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 반가워요', '5G 아이폰 Pro 사전예약 안내 광고 SKT 아이폰 Pro 사전예약 안내 고객님 안녕하세요 ', '최고의 스마트폰 칩과 카메라 견고 세라믹 실드에 5G 기술까지 ']...
2025-10-20 14:21:05,944 - __main__ - INFO - 전체 토큰 수: 310개
2025-10-20 14:21:05,944 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '아이폰', '아이폰', '실드', '아이폰', '아이폰', '스펙', '아이폰', '스마트폰', '택1', '사죠영', '죠르디', '한정판', '기프트', '프리디', '충전기', '에이프릴', '스톤', '충전', '기프트', '.', '카카오톡', '코로나']
2025-10-20 14:21:05,944 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['한정판', '에이프릴', '스톤', '아이폰', '코로나', '프리디', '충전기', '사죠영', '죠르디', '실드', '기프트', '카카오톡', '스펙', '택1']
2025-10-20 14:21:05,944 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 14:21:07,058 - __main__ - INFO - 퍼지 매칭 결과 크기: (2116, 3)
2025-10-20 14:21:07,058 - __main__ - INFO - 퍼지 매칭 성공: 2116개 결과
2025-10-20 14:21:07,059 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.4285714285714286}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.4}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.4}]
2025-10-20 14:21:07,059 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 14:21:07,217 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2116, 3)
2025-10-20 14:21:07,218 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.18461538461538463}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.15000000000000002}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.15000000000000002}]
2025-10-20 14:21:07,218 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 14:21:07,221 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 11개
2025-10-20 14:21:07,223 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 14:21:07,224 - __main__ - INFO - 통합된 후보 아이템 수: 11개
2025-10-20 14:21:07,227 - __main__ - INFO - 최종 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:21:07,230 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (10, 2)
2025-10-20 14:21:07,230 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}, {'item_nm': 'IPHONE 16 PRO', 'item_id': ['A5XE', 'A643', 'A5XN', 'A64C', 'A647', 'A63Y', 'A5XJ', 'A5X9']}]
2025-10-20 14:21:07,231 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.98초
2025-10-20 14:21:07,231 - __main__ - INFO - 추출된 후보 엔티티: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:21:07,231 - __main__ - INFO - 매칭된 상품 정보: (10, 2)
2025-10-20 14:21:07,231 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 14:21:08,298 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 14:21:08,298 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 14:21:08,298 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 400 문자
2025-10-20 14:21:08,299 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 14:21:08,299 - __main__ - INFO - 후보 아이템 리스트 크기: 11개
2025-10-20 14:21:08,299 - __main__ - INFO - 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:21:08,299 - __main__ - INFO - extra_item_pdf 크기: (10, 2)
2025-10-20 14:21:08,299 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 14:21:08,299 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}]
2025-10-20 14:21:08,299 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 14:21:08,299 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 14:21:08,299 - __main__ - INFO - 구성된 프롬프트 길이: 6734 문자
2025-10-20 14:21:08,299 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 14:21:08,299 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 14:21:08,299 - __main__ - INFO - 📝 프롬프트 길이: 6,734 문자
2025-10-20 14:21:08,299 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 14:21:08,299 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 14:21:18,314 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 14:21:18,338 - __main__ - INFO - LLM 응답 길이: 1419 문자
2025-10-20 14:21:18,339 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내"
    ],
    "product": [
        {
            "name": "아이폰 12",
            "action": "구매"
        },
        {
            "name": "아이폰 12 Pro",
            "action": "구매"
        },
        {
            "name": "아이폰 17",
            "action": "구매"
        },
        {
            "name": "아이폰 17 Pro",
            "action": "구매"
        },
        {
            "name": "죠르디 한정판 ...
2025-10-20 14:21:18,339 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 14:21:18,340 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 14:21:18,340 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 14:21:18,340 - __main__ - INFO - 파싱된 JSON 내용: {'title': '[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내', 'purpose': ['상품 가입 유도', '혜택 안내'], 'product': [{'name': '아이폰 12', 'action': '구매'}, {'name': '아이폰 12 Pro', 'action': '구매'}, {'name': '아이폰 17', 'action': '구매'}, {'name': '아이폰 17 Pro', 'action': '구매'}, {'name': '죠르디 한정판 기프트', 'action': '기타'}, {'name': '멀티 무선 충전기', 'action': '기타'}, {'name': '보조배터리+멀티백', 'action': '기타'}, {'name': '3in1 무선 충전 살균기', 'action': '기타'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/2HeWcdx', 'action': '추가 정보'}, {'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/3o7zOnA', 'action': '추가 정보'}, {'type': '전화번호', 'value': '1558', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['상품및부가서비스가입유도_단말', '사용법/혜택/이벤트안내_단말']}
2025-10-20 14:21:18,340 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 14:21:18,340 - __main__ - INFO - LLM 추출 엔티티: ['아이폰 12', '아이폰 12 Pro', '아이폰 17', '아이폰 17 Pro', '죠르디 한정판 기프트', '멀티 무선 충전기', '보조배터리+멀티백', '3in1 무선 충전 살균기']
2025-10-20 14:21:18,341 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-10-20 14:21:18,342 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-10-20 14:21:18,342 - __main__ - INFO - === 후보 엔티티 추출 시작 ===
2025-10-20 14:21:18,342 - __main__ - INFO - 퍼지 매칭 임계값: 0.4
2025-10-20 14:21:19,847 - __main__ - ERROR - 결합 유사도 계산 실패: DataFrame.reset_index() got an unexpected keyword argument 'name'
2025-10-20 14:21:19,848 - __main__ - ERROR - LLM 기반 엔티티 추출 실패: 'item_nm_alias'
2025-10-20 14:21:19,848 - __main__ - INFO - extract_entities_by_llm 실행완료: 1.51초
2025-10-20 14:21:19,849 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 14:21:19,849 - __main__ - INFO - ============================================================
2025-10-20 14:21:19,849 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 14:21:19,849 - __main__ - INFO - ============================================================
2025-10-20 14:21:19,849 - __main__ - INFO - 제목: [SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
2025-10-20 14:21:19,849 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내']
2025-10-20 14:21:19,849 - __main__ - INFO - 상품 수: 8개
2025-10-20 14:21:19,849 - __main__ - INFO - 채널 수: 4개
2025-10-20 14:21:19,849 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 14:21:19,849 - __main__ - INFO - process_message 실행완료: 14.60초
2025-10-20 14:21:19,849 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 14:22:09,249 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 14:22:09,249 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 14:22:09,249 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 14:22:09,249 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 14:22:09,249 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 14:22:09,251 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 14:22:09,281 - __main__ - INFO - Using device: mps
2025-10-20 14:22:09,281 - __main__ - INFO - _initialize_device 실행완료: 0.03초
2025-10-20 14:22:09,281 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 14:22:09,281 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 14:22:09,281 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 14:22:09,281 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 14:22:09,281 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 14:22:09,282 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 14:22:09,282 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 14:22:09,712 - __main__ - INFO - Model loaded on mps
2025-10-20 14:22:09,712 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.43초
2025-10-20 14:22:09,712 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 14:22:10,325 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 14:22:10,325 - __main__ - INFO - _initialize_kiwi 실행완료: 0.61초
2025-10-20 14:22:10,325 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 14:22:10,325 - __main__ - INFO - ============================================================
2025-10-20 14:22:10,325 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 14:22:10,325 - __main__ - INFO - ============================================================
2025-10-20 14:22:10,325 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 14:22:10,325 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 14:22:10,325 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 14:22:10,326 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 14:22:10,326 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:22:10,484 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 14:22:10,484 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:22:10,484 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 14:22:10,491 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 14:22:10,492 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 14:22:10,493 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:22:10,494 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:22:10,494 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 14:22:10,494 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 14:22:10,496 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 14:22:10,501 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 14:22:10,501 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 14:22:10,501 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:22:10,501 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 14:22:10,501 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 14:22:10,501 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 14:22:10,501 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:22:10,501 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 14:22:10,501 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 14:22:10,501 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 14:22:10,503 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 14:22:10,503 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 14:22:10,503 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:22:10,504 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 14:22:10,504 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:22:10,727 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 14:22:10,738 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 14:22:10,739 - __main__ - INFO - 별칭 적용 후 샘플: ['우주pass Netflix 인증', '우주Pass Netflix 인증', '우주패스 넷플릭스 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증']
2025-10-20 14:22:10,739 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 14:22:10,739 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 14:22:10,739 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 14:22:10,740 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 14:22:10,741 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 14:22:10,741 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 14:22:10,741 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 14:22:10,742 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 14:22:10,743 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 14:22:10,743 - __main__ - INFO - 등록할 별칭 샘플: ['우주pass Netflix 인증', '우주Pass Netflix 인증', '우주패스 넷플릭스 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증']
2025-10-20 14:22:10,763 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 14:22:10,763 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 14:22:10,763 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 14:22:10,765 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 14:22:10,765 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 14:22:11,041 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 14:22:11,042 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 14:22:11,042 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 14:22:11,042 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 14:22:11,042 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 14:22:11,042 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:22:11,127 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 14:22:11,128 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:22:11,130 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 14:22:11,131 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 14:22:11,131 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 14:22:11,131 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:22:11,131 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 14:22:11,131 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 14:22:11,131 - __main__ - INFO - ============================================================
2025-10-20 14:22:11,131 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 14:22:11,131 - __main__ - INFO - ============================================================
2025-10-20 14:22:11,132 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 14:22:11,132 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 14:22:11,132 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 14:22:11,132 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 14:22:11,132 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 14:22:11,133 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 14:22:11,135 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 14:22:11,137 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 14:22:11,137 - __main__ - INFO - _load_data 실행완료: 0.81초
2025-10-20 14:22:11,137 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 14:22:11,137 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 14:22:11,137 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
(광고)[SKT] 아...
2025-10-20 14:22:11,137 - __main__ - INFO - ============================================================
2025-10-20 14:22:11,137 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 14:22:11,137 - __main__ - INFO - ============================================================
2025-10-20 14:22:11,137 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
(광고)[SKT] 아이폰 12/12 Pro 사전예약 안내  #04 고객님, 안녕하세요. 최고의 스마트폰 칩과 카메라, 견고한 세라믹 실드에 5G 기술까지! 이 모든 것을 갖춘 아이폰 12/12 Pro를 만나 보세요.  ▶ 혜택받고 사전예약하기: http://t-mms.kr/t.do?m=#...
2025-10-20 14:22:11,137 - __main__ - INFO - 메시지 길이: 822 문자
2025-10-20 14:22:11,137 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 14:22:11,137 - __main__ - INFO - 데이터 소스: local
2025-10-20 14:22:11,137 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 14:22:11,137 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-20 14:22:11,138 - __main__ - INFO - LLM 모델: ax
2025-10-20 14:22:11,138 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 14:22:11,138 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 14:22:11,138 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 14:22:11,138 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 14:22:11,138 - __main__ - INFO - 처리할 메시지 길이: 815 문자
2025-10-20 14:22:11,139 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 14:22:11,843 - __main__ - INFO - 분할된 문장 수: 9개
2025-10-20 14:22:11,844 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 반가워요', '5G 아이폰 Pro 사전예약 안내 광고 SKT 아이폰 Pro 사전예약 안내 고객님 안녕하세요 ', '최고의 스마트폰 칩과 카메라 견고 세라믹 실드에 5G 기술까지 ']...
2025-10-20 14:22:11,851 - __main__ - INFO - 전체 토큰 수: 310개
2025-10-20 14:22:11,851 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '아이폰', '아이폰', '실드', '아이폰', '아이폰', '스펙', '아이폰', '스마트폰', '택1', '사죠영', '죠르디', '한정판', '기프트', '프리디', '충전기', '에이프릴', '스톤', '충전', '기프트', '.', '카카오톡', '코로나']
2025-10-20 14:22:11,852 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['충전기', '한정판', '죠르디', '프리디', '스펙', '택1', '카카오톡', '실드', '스톤', '아이폰', '기프트', '사죠영', '에이프릴', '코로나']
2025-10-20 14:22:11,852 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 14:22:12,843 - __main__ - INFO - 퍼지 매칭 결과 크기: (2116, 3)
2025-10-20 14:22:12,843 - __main__ - INFO - 퍼지 매칭 성공: 2116개 결과
2025-10-20 14:22:12,844 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.4285714285714286}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.4}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.4}]
2025-10-20 14:22:12,844 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 14:22:13,010 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2116, 3)
2025-10-20 14:22:13,011 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.18461538461538463}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.15000000000000002}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.15000000000000002}]
2025-10-20 14:22:13,011 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 14:22:13,014 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 11개
2025-10-20 14:22:13,016 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 14:22:13,017 - __main__ - INFO - 통합된 후보 아이템 수: 11개
2025-10-20 14:22:13,020 - __main__ - INFO - 최종 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:22:13,023 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (10, 2)
2025-10-20 14:22:13,024 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}, {'item_nm': 'IPHONE 16 PRO', 'item_id': ['A5XE', 'A643', 'A5XN', 'A64C', 'A647', 'A63Y', 'A5XJ', 'A5X9']}]
2025-10-20 14:22:13,024 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.89초
2025-10-20 14:22:13,024 - __main__ - INFO - 추출된 후보 엔티티: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:22:13,024 - __main__ - INFO - 매칭된 상품 정보: (10, 2)
2025-10-20 14:22:13,024 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 14:22:13,180 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 14:22:13,180 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 14:22:13,180 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 400 문자
2025-10-20 14:22:13,180 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 14:22:13,180 - __main__ - INFO - 후보 아이템 리스트 크기: 11개
2025-10-20 14:22:13,180 - __main__ - INFO - 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:22:13,180 - __main__ - INFO - extra_item_pdf 크기: (10, 2)
2025-10-20 14:22:13,180 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 14:22:13,180 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}]
2025-10-20 14:22:13,180 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 14:22:13,180 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 14:22:13,180 - __main__ - INFO - 구성된 프롬프트 길이: 6734 문자
2025-10-20 14:22:13,180 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 14:22:13,180 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 14:22:13,180 - __main__ - INFO - 📝 프롬프트 길이: 6,734 문자
2025-10-20 14:22:13,181 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 14:22:13,181 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 14:22:24,894 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 14:22:24,916 - __main__ - INFO - LLM 응답 길이: 1746 문자
2025-10-20 14:22:24,917 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내"
    ],
    "product": [
        {
            "name": "아이폰 12",
            "action": "구매"
        },
        {
            "name": "아이폰 12 Pro",
            "action": "구매"
        },
        {
            "name": "아이폰 17",
            "action": "구매"
        },
        {
            "name": "아이폰 17 Pro",
            "action": "구매"
        },
        {
            "name": "5G",
   ...
2025-10-20 14:22:24,917 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 14:22:24,918 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 14:22:24,918 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 14:22:24,918 - __main__ - INFO - 파싱된 JSON 내용: {'title': '[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내', 'purpose': ['상품 가입 유도', '혜택 안내'], 'product': [{'name': '아이폰 12', 'action': '구매'}, {'name': '아이폰 12 Pro', 'action': '구매'}, {'name': '아이폰 17', 'action': '구매'}, {'name': '아이폰 17 Pro', 'action': '구매'}, {'name': '5G', 'action': '사용'}, {'name': 'A14 Bionic 칩', 'action': '사용'}, {'name': '세라믹 실드', 'action': '사용'}, {'name': 'Dolby Vision 영상 카메라', 'action': '사용'}, {'name': '죠르디 한정판 기프트', 'action': '기타'}, {'name': '멀티 무선 충전기', 'action': '기타'}, {'name': '보조배터리+멀티백', 'action': '기타'}, {'name': '3in1 무선 충전 살균기', 'action': '기타'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/2HeWcdx', 'action': '추가 정보'}, {'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/3o7zOnA', 'action': '추가 정보'}, {'type': '전화번호', 'value': '1558', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['상품및부가서비스가입유도_단말', '사용법/혜택/이벤트안내_단말']}
2025-10-20 14:22:24,918 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 14:22:24,918 - __main__ - INFO - LLM 추출 엔티티: ['아이폰 12', '아이폰 12 Pro', '아이폰 17', '아이폰 17 Pro', '5G', 'A14 Bionic 칩', '세라믹 실드', 'Dolby Vision 영상 카메라', '죠르디 한정판 기프트', '멀티 무선 충전기', '보조배터리+멀티백', '3in1 무선 충전 살균기']
2025-10-20 14:22:24,919 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-10-20 14:22:24,919 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-10-20 14:22:24,920 - __main__ - INFO - === 후보 엔티티 추출 시작 ===
2025-10-20 14:22:24,920 - __main__ - INFO - 퍼지 매칭 임계값: 0.4
2025-10-20 14:22:26,449 - __main__ - ERROR - 결합 유사도 계산 실패: DataFrame.reset_index() got an unexpected keyword argument 'name'
2025-10-20 14:22:26,449 - __main__ - ERROR - LLM 기반 엔티티 추출 실패: 'item_nm_alias'
2025-10-20 14:22:26,449 - __main__ - INFO - extract_entities_by_llm 실행완료: 1.53초
2025-10-20 14:22:26,450 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 14:22:26,450 - __main__ - INFO - ============================================================
2025-10-20 14:22:26,450 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 14:22:26,450 - __main__ - INFO - ============================================================
2025-10-20 14:22:26,450 - __main__ - INFO - 제목: [SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
2025-10-20 14:22:26,450 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내']
2025-10-20 14:22:26,450 - __main__ - INFO - 상품 수: 12개
2025-10-20 14:22:26,450 - __main__ - INFO - 채널 수: 4개
2025-10-20 14:22:26,450 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 14:22:26,451 - __main__ - INFO - process_message 실행완료: 15.31초
2025-10-20 14:22:26,451 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 14:24:31,514 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 14:24:31,514 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 14:24:31,514 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 14:24:31,514 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 14:24:31,514 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 14:24:31,516 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 14:24:31,553 - __main__ - INFO - Using device: mps
2025-10-20 14:24:31,553 - __main__ - INFO - _initialize_device 실행완료: 0.04초
2025-10-20 14:24:31,553 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 14:24:31,553 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 14:24:31,554 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 14:24:31,554 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 14:24:31,554 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 14:24:31,554 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 14:24:31,554 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 14:24:31,809 - __main__ - INFO - Model loaded on mps
2025-10-20 14:24:31,809 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.26초
2025-10-20 14:24:31,809 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 14:24:32,375 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 14:24:32,375 - __main__ - INFO - _initialize_kiwi 실행완료: 0.57초
2025-10-20 14:24:32,375 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 14:24:32,375 - __main__ - INFO - ============================================================
2025-10-20 14:24:32,375 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 14:24:32,375 - __main__ - INFO - ============================================================
2025-10-20 14:24:32,375 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 14:24:32,375 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 14:24:32,375 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 14:24:32,375 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 14:24:32,375 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:24:32,531 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 14:24:32,531 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:24:32,531 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 14:24:32,538 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 14:24:32,539 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 14:24:32,540 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:24:32,540 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:24:32,541 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 14:24:32,541 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 14:24:32,542 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 14:24:32,546 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 14:24:32,546 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 14:24:32,546 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:24:32,546 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 14:24:32,546 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 14:24:32,547 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 14:24:32,547 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:24:32,547 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 14:24:32,547 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 14:24:32,547 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 14:24:32,548 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 14:24:32,548 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 14:24:32,548 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:24:32,549 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 14:24:32,549 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:24:32,780 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 14:24:32,791 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 14:24:32,792 - __main__ - INFO - 별칭 적용 후 샘플: ['우주Pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주pass Netflix 인증', '우주패스 넷플릭스 인증']
2025-10-20 14:24:32,792 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 14:24:32,792 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 14:24:32,792 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 14:24:32,793 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 14:24:32,793 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 14:24:32,793 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 14:24:32,793 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 14:24:32,794 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 14:24:32,796 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 14:24:32,796 - __main__ - INFO - 등록할 별칭 샘플: ['우주Pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주pass Netflix 인증', '우주패스 넷플릭스 인증']
2025-10-20 14:24:32,816 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 14:24:32,816 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 14:24:32,816 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 14:24:32,818 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 14:24:32,818 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 14:24:33,063 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 14:24:33,063 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 14:24:33,063 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 14:24:33,063 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 14:24:33,063 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 14:24:33,063 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:24:33,146 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 14:24:33,146 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:24:33,149 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 14:24:33,149 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 14:24:33,149 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 14:24:33,149 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:24:33,149 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 14:24:33,150 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 14:24:33,150 - __main__ - INFO - ============================================================
2025-10-20 14:24:33,150 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 14:24:33,150 - __main__ - INFO - ============================================================
2025-10-20 14:24:33,150 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 14:24:33,150 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 14:24:33,150 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 14:24:33,150 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 14:24:33,150 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 14:24:33,151 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 14:24:33,153 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 14:24:33,155 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 14:24:33,155 - __main__ - INFO - _load_data 실행완료: 0.78초
2025-10-20 14:24:33,155 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 14:24:33,155 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 14:24:33,155 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
(광고)[SKT] 아...
2025-10-20 14:24:33,155 - __main__ - INFO - ============================================================
2025-10-20 14:24:33,155 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 14:24:33,155 - __main__ - INFO - ============================================================
2025-10-20 14:24:33,155 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
(광고)[SKT] 아이폰 12/12 Pro 사전예약 안내  #04 고객님, 안녕하세요. 최고의 스마트폰 칩과 카메라, 견고한 세라믹 실드에 5G 기술까지! 이 모든 것을 갖춘 아이폰 12/12 Pro를 만나 보세요.  ▶ 혜택받고 사전예약하기: http://t-mms.kr/t.do?m=#...
2025-10-20 14:24:33,155 - __main__ - INFO - 메시지 길이: 822 문자
2025-10-20 14:24:33,155 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 14:24:33,155 - __main__ - INFO - 데이터 소스: local
2025-10-20 14:24:33,155 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 14:24:33,155 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-20 14:24:33,155 - __main__ - INFO - LLM 모델: ax
2025-10-20 14:24:33,155 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 14:24:33,155 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 14:24:33,155 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 14:24:33,155 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 14:24:33,156 - __main__ - INFO - 처리할 메시지 길이: 815 문자
2025-10-20 14:24:33,157 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 14:24:33,819 - __main__ - INFO - 분할된 문장 수: 9개
2025-10-20 14:24:33,820 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 반가워요', '5G 아이폰 Pro 사전예약 안내 광고 SKT 아이폰 Pro 사전예약 안내 고객님 안녕하세요 ', '최고의 스마트폰 칩과 카메라 견고 세라믹 실드에 5G 기술까지 ']...
2025-10-20 14:24:33,827 - __main__ - INFO - 전체 토큰 수: 310개
2025-10-20 14:24:33,827 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '아이폰', '아이폰', '실드', '아이폰', '아이폰', '스펙', '아이폰', '스마트폰', '택1', '사죠영', '죠르디', '한정판', '기프트', '프리디', '충전기', '에이프릴', '스톤', '충전', '기프트', '.', '카카오톡', '코로나']
2025-10-20 14:24:33,827 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['아이폰', '프리디', '죠르디', '기프트', '택1', '실드', '카카오톡', '에이프릴', '한정판', '코로나', '스펙', '스톤', '사죠영', '충전기']
2025-10-20 14:24:33,827 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 14:24:34,799 - __main__ - INFO - 퍼지 매칭 결과 크기: (2116, 3)
2025-10-20 14:24:34,799 - __main__ - INFO - 퍼지 매칭 성공: 2116개 결과
2025-10-20 14:24:34,800 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.4285714285714286}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.4}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.4}]
2025-10-20 14:24:34,800 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 14:24:34,961 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2116, 3)
2025-10-20 14:24:34,962 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.18461538461538463}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.15000000000000002}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.15000000000000002}]
2025-10-20 14:24:34,962 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 14:24:34,965 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 11개
2025-10-20 14:24:34,967 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 14:24:34,968 - __main__ - INFO - 통합된 후보 아이템 수: 11개
2025-10-20 14:24:34,971 - __main__ - INFO - 최종 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:24:34,974 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (10, 2)
2025-10-20 14:24:34,975 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}, {'item_nm': 'IPHONE 16 PRO', 'item_id': ['A5XE', 'A643', 'A5XN', 'A64C', 'A647', 'A63Y', 'A5XJ', 'A5X9']}]
2025-10-20 14:24:34,975 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.82초
2025-10-20 14:24:34,975 - __main__ - INFO - 추출된 후보 엔티티: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:24:34,975 - __main__ - INFO - 매칭된 상품 정보: (10, 2)
2025-10-20 14:24:34,975 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 14:24:35,134 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 14:24:35,134 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 14:24:35,134 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 400 문자
2025-10-20 14:24:35,134 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 14:24:35,134 - __main__ - INFO - 후보 아이템 리스트 크기: 11개
2025-10-20 14:24:35,134 - __main__ - INFO - 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:24:35,134 - __main__ - INFO - extra_item_pdf 크기: (10, 2)
2025-10-20 14:24:35,134 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 14:24:35,134 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}]
2025-10-20 14:24:35,134 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 14:24:35,134 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 14:24:35,134 - __main__ - INFO - 구성된 프롬프트 길이: 6734 문자
2025-10-20 14:24:35,134 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 14:24:35,135 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 14:24:35,135 - __main__ - INFO - 📝 프롬프트 길이: 6,734 문자
2025-10-20 14:24:35,135 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 14:24:35,135 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 14:24:46,958 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 14:24:46,981 - __main__ - INFO - LLM 응답 길이: 1746 문자
2025-10-20 14:24:46,981 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내"
    ],
    "product": [
        {
            "name": "아이폰 12",
            "action": "구매"
        },
        {
            "name": "아이폰 12 Pro",
            "action": "구매"
        },
        {
            "name": "아이폰 17",
            "action": "구매"
        },
        {
            "name": "아이폰 17 Pro",
            "action": "구매"
        },
        {
            "name": "5G",
   ...
2025-10-20 14:24:46,982 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 14:24:46,983 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 14:24:46,983 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 14:24:46,983 - __main__ - INFO - 파싱된 JSON 내용: {'title': '[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내', 'purpose': ['상품 가입 유도', '혜택 안내'], 'product': [{'name': '아이폰 12', 'action': '구매'}, {'name': '아이폰 12 Pro', 'action': '구매'}, {'name': '아이폰 17', 'action': '구매'}, {'name': '아이폰 17 Pro', 'action': '구매'}, {'name': '5G', 'action': '사용'}, {'name': 'A14 Bionic 칩', 'action': '사용'}, {'name': '세라믹 실드', 'action': '사용'}, {'name': 'Dolby Vision 영상 카메라', 'action': '사용'}, {'name': '죠르디 한정판 기프트', 'action': '기타'}, {'name': '멀티 무선 충전기', 'action': '기타'}, {'name': '보조배터리+멀티백', 'action': '기타'}, {'name': '3in1 무선 충전 살균기', 'action': '기타'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/2HeWcdx', 'action': '추가 정보'}, {'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/3o7zOnA', 'action': '추가 정보'}, {'type': '전화번호', 'value': '1558', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['상품및부가서비스가입유도_단말', '사용법/혜택/이벤트안내_단말']}
2025-10-20 14:24:46,984 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 14:24:46,984 - __main__ - INFO - LLM 추출 엔티티: ['아이폰 12', '아이폰 12 Pro', '아이폰 17', '아이폰 17 Pro', '5G', 'A14 Bionic 칩', '세라믹 실드', 'Dolby Vision 영상 카메라', '죠르디 한정판 기프트', '멀티 무선 충전기', '보조배터리+멀티백', '3in1 무선 충전 살균기']
2025-10-20 14:24:46,985 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-10-20 14:24:46,985 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-10-20 14:24:46,985 - __main__ - INFO - === 후보 엔티티 추출 시작 ===
2025-10-20 14:24:46,985 - __main__ - INFO - 퍼지 매칭 임계값: 0.4
2025-10-20 14:24:48,500 - __main__ - ERROR - 결합 유사도 계산 실패: DataFrame.reset_index() got an unexpected keyword argument 'name'
2025-10-20 14:24:48,500 - __main__ - ERROR - LLM 기반 엔티티 추출 실패: 'item_nm_alias'
2025-10-20 14:24:48,501 - __main__ - INFO - extract_entities_by_llm 실행완료: 1.52초
2025-10-20 14:24:48,502 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 14:24:48,502 - __main__ - INFO - ============================================================
2025-10-20 14:24:48,502 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 14:24:48,502 - __main__ - INFO - ============================================================
2025-10-20 14:24:48,502 - __main__ - INFO - 제목: [SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
2025-10-20 14:24:48,502 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내']
2025-10-20 14:24:48,502 - __main__ - INFO - 상품 수: 12개
2025-10-20 14:24:48,502 - __main__ - INFO - 채널 수: 4개
2025-10-20 14:24:48,502 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 14:24:48,502 - __main__ - INFO - process_message 실행완료: 15.35초
2025-10-20 14:24:48,502 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 14:25:33,508 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 14:25:33,509 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 14:25:33,509 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 14:25:33,509 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 14:25:33,509 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 14:25:33,511 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 14:25:33,549 - __main__ - INFO - Using device: mps
2025-10-20 14:25:33,550 - __main__ - INFO - _initialize_device 실행완료: 0.04초
2025-10-20 14:25:33,550 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 14:25:33,550 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 14:25:33,550 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 14:25:33,550 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 14:25:33,550 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 14:25:33,551 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 14:25:33,551 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 14:25:33,813 - __main__ - INFO - Model loaded on mps
2025-10-20 14:25:33,813 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.26초
2025-10-20 14:25:33,813 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 14:25:34,385 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 14:25:34,385 - __main__ - INFO - _initialize_kiwi 실행완료: 0.57초
2025-10-20 14:25:34,385 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 14:25:34,385 - __main__ - INFO - ============================================================
2025-10-20 14:25:34,385 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 14:25:34,385 - __main__ - INFO - ============================================================
2025-10-20 14:25:34,385 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 14:25:34,385 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 14:25:34,385 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 14:25:34,385 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 14:25:34,385 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:25:34,554 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 14:25:34,554 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:25:34,554 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 14:25:34,561 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 14:25:34,562 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 14:25:34,563 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:25:34,563 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:25:34,564 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 14:25:34,564 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 14:25:34,565 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 14:25:34,569 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 14:25:34,569 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 14:25:34,569 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:25:34,569 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 14:25:34,569 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 14:25:34,570 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 14:25:34,570 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:25:34,570 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 14:25:34,570 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 14:25:34,570 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 14:25:34,571 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 14:25:34,572 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 14:25:34,572 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:25:34,572 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 14:25:34,572 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:25:34,803 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 14:25:34,812 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 14:25:34,813 - __main__ - INFO - 별칭 적용 후 샘플: ['우주PASS Netflix 인증', '우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증', '우주pass Netflix 인증']
2025-10-20 14:25:34,813 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 14:25:34,813 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 14:25:34,813 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 14:25:34,815 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 14:25:34,815 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 14:25:34,815 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 14:25:34,815 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 14:25:34,816 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 14:25:34,817 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 14:25:34,817 - __main__ - INFO - 등록할 별칭 샘플: ['우주PASS Netflix 인증', '우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증', '우주pass Netflix 인증']
2025-10-20 14:25:34,841 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 14:25:34,841 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 14:25:34,841 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 14:25:34,843 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 14:25:34,843 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 14:25:35,101 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 14:25:35,101 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 14:25:35,101 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 14:25:35,101 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 14:25:35,101 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 14:25:35,101 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:25:35,200 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 14:25:35,200 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:25:35,202 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 14:25:35,203 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 14:25:35,203 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 14:25:35,203 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:25:35,203 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 14:25:35,204 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 14:25:35,204 - __main__ - INFO - ============================================================
2025-10-20 14:25:35,204 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 14:25:35,204 - __main__ - INFO - ============================================================
2025-10-20 14:25:35,204 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 14:25:35,204 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 14:25:35,204 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 14:25:35,204 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 14:25:35,204 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 14:25:35,205 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 14:25:35,207 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 14:25:35,209 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 14:25:35,209 - __main__ - INFO - _load_data 실행완료: 0.82초
2025-10-20 14:25:35,209 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 14:25:35,209 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 14:25:35,209 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
(광고)[SKT] 아...
2025-10-20 14:25:35,209 - __main__ - INFO - ============================================================
2025-10-20 14:25:35,209 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 14:25:35,209 - __main__ - INFO - ============================================================
2025-10-20 14:25:35,209 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
(광고)[SKT] 아이폰 12/12 Pro 사전예약 안내  #04 고객님, 안녕하세요. 최고의 스마트폰 칩과 카메라, 견고한 세라믹 실드에 5G 기술까지! 이 모든 것을 갖춘 아이폰 12/12 Pro를 만나 보세요.  ▶ 혜택받고 사전예약하기: http://t-mms.kr/t.do?m=#...
2025-10-20 14:25:35,209 - __main__ - INFO - 메시지 길이: 822 문자
2025-10-20 14:25:35,209 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 14:25:35,209 - __main__ - INFO - 데이터 소스: local
2025-10-20 14:25:35,209 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 14:25:35,209 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-20 14:25:35,209 - __main__ - INFO - LLM 모델: ax
2025-10-20 14:25:35,209 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 14:25:35,209 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 14:25:35,209 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 14:25:35,209 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 14:25:35,209 - __main__ - INFO - 처리할 메시지 길이: 815 문자
2025-10-20 14:25:35,211 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 14:25:35,877 - __main__ - INFO - 분할된 문장 수: 9개
2025-10-20 14:25:35,878 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 반가워요', '5G 아이폰 Pro 사전예약 안내 광고 SKT 아이폰 Pro 사전예약 안내 고객님 안녕하세요 ', '최고의 스마트폰 칩과 카메라 견고 세라믹 실드에 5G 기술까지 ']...
2025-10-20 14:25:35,886 - __main__ - INFO - 전체 토큰 수: 310개
2025-10-20 14:25:35,886 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '아이폰', '아이폰', '실드', '아이폰', '아이폰', '스펙', '아이폰', '스마트폰', '택1', '사죠영', '죠르디', '한정판', '기프트', '프리디', '충전기', '에이프릴', '스톤', '충전', '기프트', '.', '카카오톡', '코로나']
2025-10-20 14:25:35,886 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['아이폰', '택1', '코로나', '기프트', '사죠영', '스펙', '죠르디', '충전기', '카카오톡', '실드', '스톤', '프리디', '에이프릴', '한정판']
2025-10-20 14:25:35,886 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 14:25:36,879 - __main__ - INFO - 퍼지 매칭 결과 크기: (2116, 3)
2025-10-20 14:25:36,879 - __main__ - INFO - 퍼지 매칭 성공: 2116개 결과
2025-10-20 14:25:36,880 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.4285714285714286}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.4}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.4}]
2025-10-20 14:25:36,880 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 14:25:37,041 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2116, 3)
2025-10-20 14:25:37,042 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.18461538461538463}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.15000000000000002}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.15000000000000002}]
2025-10-20 14:25:37,042 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 14:25:37,045 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 11개
2025-10-20 14:25:37,047 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 14:25:37,048 - __main__ - INFO - 통합된 후보 아이템 수: 11개
2025-10-20 14:25:37,051 - __main__ - INFO - 최종 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:25:37,054 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (10, 2)
2025-10-20 14:25:37,054 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}, {'item_nm': 'IPHONE 16 PRO', 'item_id': ['A5XE', 'A643', 'A5XN', 'A64C', 'A647', 'A63Y', 'A5XJ', 'A5X9']}]
2025-10-20 14:25:37,055 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.85초
2025-10-20 14:25:37,055 - __main__ - INFO - 추출된 후보 엔티티: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:25:37,055 - __main__ - INFO - 매칭된 상품 정보: (10, 2)
2025-10-20 14:25:37,055 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 14:25:37,206 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 14:25:37,206 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 14:25:37,206 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 400 문자
2025-10-20 14:25:37,206 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 14:25:37,206 - __main__ - INFO - 후보 아이템 리스트 크기: 11개
2025-10-20 14:25:37,206 - __main__ - INFO - 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:25:37,207 - __main__ - INFO - extra_item_pdf 크기: (10, 2)
2025-10-20 14:25:37,207 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 14:25:37,207 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}]
2025-10-20 14:25:37,207 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 14:25:37,207 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 14:25:37,207 - __main__ - INFO - 구성된 프롬프트 길이: 6734 문자
2025-10-20 14:25:37,207 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 14:25:37,207 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 14:25:37,207 - __main__ - INFO - 📝 프롬프트 길이: 6,734 문자
2025-10-20 14:25:37,207 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 14:25:37,207 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 14:25:48,848 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 14:25:48,871 - __main__ - INFO - LLM 응답 길이: 1746 문자
2025-10-20 14:25:48,872 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내"
    ],
    "product": [
        {
            "name": "아이폰 12",
            "action": "구매"
        },
        {
            "name": "아이폰 12 Pro",
            "action": "구매"
        },
        {
            "name": "아이폰 17",
            "action": "구매"
        },
        {
            "name": "아이폰 17 Pro",
            "action": "구매"
        },
        {
            "name": "5G",
   ...
2025-10-20 14:25:48,872 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 14:25:48,873 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 14:25:48,873 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 14:25:48,873 - __main__ - INFO - 파싱된 JSON 내용: {'title': '[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내', 'purpose': ['상품 가입 유도', '혜택 안내'], 'product': [{'name': '아이폰 12', 'action': '구매'}, {'name': '아이폰 12 Pro', 'action': '구매'}, {'name': '아이폰 17', 'action': '구매'}, {'name': '아이폰 17 Pro', 'action': '구매'}, {'name': '5G', 'action': '사용'}, {'name': 'A14 Bionic 칩', 'action': '사용'}, {'name': '세라믹 실드', 'action': '사용'}, {'name': 'Dolby Vision 영상 카메라', 'action': '사용'}, {'name': '죠르디 한정판 기프트', 'action': '기타'}, {'name': '멀티 무선 충전기', 'action': '기타'}, {'name': '보조배터리+멀티백', 'action': '기타'}, {'name': '3in1 무선 충전 살균기', 'action': '기타'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/2HeWcdx', 'action': '추가 정보'}, {'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/3o7zOnA', 'action': '추가 정보'}, {'type': '전화번호', 'value': '1558', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['상품및부가서비스가입유도_단말', '사용법/혜택/이벤트안내_단말']}
2025-10-20 14:25:48,873 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 14:25:48,873 - __main__ - INFO - LLM 추출 엔티티: ['아이폰 12', '아이폰 12 Pro', '아이폰 17', '아이폰 17 Pro', '5G', 'A14 Bionic 칩', '세라믹 실드', 'Dolby Vision 영상 카메라', '죠르디 한정판 기프트', '멀티 무선 충전기', '보조배터리+멀티백', '3in1 무선 충전 살균기']
2025-10-20 14:25:48,874 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-10-20 14:25:48,875 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-10-20 14:25:48,875 - __main__ - INFO - === 후보 엔티티 추출 시작 ===
2025-10-20 14:25:48,875 - __main__ - INFO - 퍼지 매칭 임계값: 0.4
2025-10-20 14:25:50,465 - __main__ - INFO - 로직 기반 추출 원본 엔티티 수: 1306개
2025-10-20 14:25:50,466 - __main__ - INFO - 원본 엔티티 샘플 (최대 10개): ['(KTF)아이폰 16E', '(LGU)아이폰 16E', '0 청년 109(T 우주)', '0 청년 109(TVING)', '0 청년 109(tving)', '0 청년 109(스마트기기)', '0 청년 109(티빙)', '0 청년 37', '0 청년 37 DATA 충전 1GB', '0 청년 37 Data 충전 1GB']
2025-10-20 14:25:50,467 - __main__ - INFO - 필터링 후 엔티티 수: 1301개
2025-10-20 14:25:50,467 - __main__ - INFO - 제거된 엔티티 수: 5개
2025-10-20 14:25:50,467 - __main__ - INFO - 최종 후보 엔티티 수: 1301개
2025-10-20 14:25:50,467 - __main__ - WARNING - ⚠️ 후보 엔티티가 매우 많습니다: 1301개
2025-10-20 14:25:50,467 - __main__ - WARNING - 이는 프롬프트 길이를 크게 증가시킬 수 있습니다.
2025-10-20 14:25:50,467 - __main__ - WARNING - 성능을 위해 상위 100개만 사용합니다. (원본: 1301개)
2025-10-20 14:25:50,467 - __main__ - INFO - 최종 후보 엔티티 샘플 (최대 10개): ['(KTF)아이폰 16E', '(LGU)아이폰 16E', '0 청년 109(T 우주)', '0 청년 109(TVING)', '0 청년 109(tving)', '0 청년 109(스마트기기)', '0 청년 109(티빙)', '0 청년 37', '0 청년 37 DATA 충전 1GB', '0 청년 37 Data 충전 1GB']
2025-10-20 14:25:50,467 - __main__ - INFO - === 후보 엔티티 추출 완료 ===
2025-10-20 14:25:50,468 - __main__ - INFO - 🔍 프롬프트에 추가될 엔티티 섹션 길이: 1,715 문자
2025-10-20 14:25:50,468 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 4,947 문자
2025-10-20 14:25:50,468 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-10-20 14:25:50,468 - __main__ - INFO - 📝 프롬프트 길이: 4,947 문자
2025-10-20 14:25:50,468 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-10-20 14:25:50,468 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-10-20 14:25:50,468 - __main__ - INFO - 🔄 2개 LLM 모델로 엔티티 추출 시작
2025-10-20 14:25:50,477 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-20 14:25:50,477 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-20 14:25:50,477 - __main__ - INFO - 🔍 프롬프트 구성 중 - LLM 모델: client=<openai.resources.chat.completions.completions.Completions object at 0x162736ae0> async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x1ac319b80> root_client=<openai.OpenAI object at 0x162737860> root_async_client=<openai.AsyncOpenAI object at 0x162737350> model_name='skt/ax4' temperature=0.0 model_kwargs={} openai_api_key=SecretStr('**********') openai_api_base='https://api.platform.a15t.com/v1' max_tokens=4000
2025-10-20 14:25:50,477 - __main__ - INFO - 🔍 프롬프트 구성 중 - LLM 모델: client=<openai.resources.chat.completions.completions.Completions object at 0x163bd0410> async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x163bd0c20> root_client=<openai.OpenAI object at 0x1639d6c30> root_async_client=<openai.AsyncOpenAI object at 0x163bd0ce0> model_name='amazon/anthropic/claude-sonnet-4-20250514' temperature=0.0 model_kwargs={} openai_api_key=SecretStr('**********') openai_api_base='https://api.platform.a15t.com/v1' max_tokens=4000
2025-10-20 14:25:50,477 - __main__ - INFO - 🔍 후보 엔티티 개수: 100개
2025-10-20 14:25:50,477 - __main__ - INFO - 🔍 후보 엔티티 개수: 100개
2025-10-20 14:25:50,477 - __main__ - INFO - 🔍 후보 엔티티 문자열 길이: 1,552 문자
2025-10-20 14:25:50,477 - __main__ - INFO - 🔍 후보 엔티티 문자열 길이: 1,552 문자
2025-10-20 14:25:50,477 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-20 14:25:50,477 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-20 14:25:50,478 - __main__ - INFO - 🔍 메시지 길이: 815 문자
2025-10-20 14:25:50,478 - __main__ - INFO - 🔍 메시지 길이: 815 문자
2025-10-20 14:25:50,478 - __main__ - INFO - 🔍 예상 전체 프롬프트 길이: 4,815 문자
2025-10-20 14:25:50,478 - __main__ - INFO - 🔍 예상 전체 프롬프트 길이: 4,815 문자
2025-10-20 14:25:52,025 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 14:25:53,737 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 14:25:53,746 - __main__ - INFO - ✅ LLM 추출 완료: ['[크레앙] 3in1 무선 충전 살균기', '[사죠영] 죠르디 한정판 기프트', '5G 아이폰17', '아이폰 12 Pro', '12 Pro', '17 Pro', 'T기프트', '[프리디] 멀티 무선 충전기', '[에이프릴스톤] 보조배터리+멀티백', 'T다이렉트샵', '아이폰 12']
2025-10-20 14:25:54,315 - __main__ - INFO - extract_entities_by_llm 실행완료: 5.44초
2025-10-20 14:25:54,322 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 14:25:54,322 - __main__ - INFO - ============================================================
2025-10-20 14:25:54,322 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 14:25:54,322 - __main__ - INFO - ============================================================
2025-10-20 14:25:54,322 - __main__ - INFO - 제목: [SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
2025-10-20 14:25:54,322 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내']
2025-10-20 14:25:54,322 - __main__ - INFO - 상품 수: 3개
2025-10-20 14:25:54,322 - __main__ - INFO - 채널 수: 4개
2025-10-20 14:25:54,322 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 14:25:54,322 - __main__ - INFO - process_message 실행완료: 19.11초
2025-10-20 14:25:54,322 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 14:27:28,315 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 14:27:28,315 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 14:27:28,315 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 14:27:28,315 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 14:27:28,315 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 14:27:28,317 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 14:27:28,346 - __main__ - INFO - Using device: mps
2025-10-20 14:27:28,346 - __main__ - INFO - _initialize_device 실행완료: 0.03초
2025-10-20 14:27:28,346 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 14:27:28,346 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 14:27:28,346 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 14:27:28,346 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 14:27:28,346 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 14:27:28,347 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 14:27:28,347 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 14:27:28,607 - __main__ - INFO - Model loaded on mps
2025-10-20 14:27:28,607 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.26초
2025-10-20 14:27:28,607 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 14:27:29,190 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 14:27:29,190 - __main__ - INFO - _initialize_kiwi 실행완료: 0.58초
2025-10-20 14:27:29,190 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 14:27:29,190 - __main__ - INFO - ============================================================
2025-10-20 14:27:29,190 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 14:27:29,190 - __main__ - INFO - ============================================================
2025-10-20 14:27:29,190 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 14:27:29,190 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 14:27:29,190 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 14:27:29,190 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 14:27:29,190 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:27:29,339 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 14:27:29,339 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:27:29,340 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 14:27:29,347 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 14:27:29,348 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 14:27:29,348 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:27:29,349 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:27:29,350 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 14:27:29,350 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 14:27:29,351 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 14:27:29,355 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 14:27:29,355 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 14:27:29,355 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:27:29,355 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 14:27:29,355 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 14:27:29,356 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 14:27:29,356 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:27:29,356 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 14:27:29,356 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 14:27:29,356 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 14:27:29,357 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 14:27:29,357 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 14:27:29,357 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:27:29,357 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 14:27:29,358 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:27:29,579 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 14:27:29,590 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 14:27:29,591 - __main__ - INFO - 별칭 적용 후 샘플: ['우주pass Netflix 인증', '우주Pass Netflix 인증', '우주패스 넷플릭스 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증']
2025-10-20 14:27:29,591 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 14:27:29,591 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 14:27:29,591 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 14:27:29,592 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 14:27:29,592 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 14:27:29,592 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 14:27:29,592 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 14:27:29,593 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 14:27:29,595 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 14:27:29,595 - __main__ - INFO - 등록할 별칭 샘플: ['우주pass Netflix 인증', '우주Pass Netflix 인증', '우주패스 넷플릭스 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증']
2025-10-20 14:27:29,615 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 14:27:29,615 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 14:27:29,615 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 14:27:29,616 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 14:27:29,616 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 14:27:29,863 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 14:27:29,864 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 14:27:29,864 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 14:27:29,864 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 14:27:29,864 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 14:27:29,864 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:27:29,947 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 14:27:29,947 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:27:29,949 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 14:27:29,950 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 14:27:29,950 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 14:27:29,950 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:27:29,950 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 14:27:29,951 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 14:27:29,951 - __main__ - INFO - ============================================================
2025-10-20 14:27:29,951 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 14:27:29,951 - __main__ - INFO - ============================================================
2025-10-20 14:27:29,951 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 14:27:29,951 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 14:27:29,951 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 14:27:29,951 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 14:27:29,951 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 14:27:29,952 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 14:27:29,954 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 14:27:29,956 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 14:27:29,956 - __main__ - INFO - _load_data 실행완료: 0.77초
2025-10-20 14:27:29,956 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 14:27:29,956 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 14:27:29,956 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] 반가워요 5G 아이폰 17 / 17 Pro 사전예약 안내
(광고)[SKT]...
2025-10-20 14:27:29,956 - __main__ - INFO - ============================================================
2025-10-20 14:27:29,956 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 14:27:29,956 - __main__ - INFO - ============================================================
2025-10-20 14:27:29,956 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] 반가워요 5G 아이폰 17 / 17 Pro 사전예약 안내
(광고)[SKT] 아이폰 12/12 Pro 사전예약 안내  #04 고객님, 안녕하세요. 최고의 스마트폰 칩과 카메라, 견고한 세라믹 실드에 5G 기술까지! 이 모든 것을 갖춘 아이폰 12/12 Pro를 만나 보세요.  ▶ 혜택받고 사전예약하기: http://t-mms.kr/t.do?m...
2025-10-20 14:27:29,956 - __main__ - INFO - 메시지 길이: 824 문자
2025-10-20 14:27:29,956 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 14:27:29,956 - __main__ - INFO - 데이터 소스: local
2025-10-20 14:27:29,956 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 14:27:29,956 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-20 14:27:29,956 - __main__ - INFO - LLM 모델: ax
2025-10-20 14:27:29,956 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 14:27:29,956 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 14:27:29,956 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 14:27:29,956 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 14:27:29,956 - __main__ - INFO - 처리할 메시지 길이: 817 문자
2025-10-20 14:27:29,958 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 14:27:30,632 - __main__ - INFO - 분할된 문장 수: 9개
2025-10-20 14:27:30,633 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 반가워요', '5G 아이폰 17 17 Pro 사전예약 안내 광고 SKT 아이폰 Pro 사전예약 안내 고객님 안녕하세요 ', '최고의 스마트폰 칩과 카메라 견고 세라믹 실드에 5G 기술까지 ']...
2025-10-20 14:27:30,640 - __main__ - INFO - 전체 토큰 수: 311개
2025-10-20 14:27:30,641 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '아이폰 17', '아이폰', '실드', '아이폰', '아이폰', '스펙', '아이폰', '스마트폰', '택1', '사죠영', '죠르디', '한정판', '기프트', '프리디', '충전기', '에이프릴', '스톤', '충전', '기프트', '.', '카카오톡', '코로나']
2025-10-20 14:27:30,641 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['프리디', '한정판', '아이폰 17', '충전기', '스펙', '택1', '죠르디', '실드', '스톤', '코로나', '에이프릴', '카카오톡', '기프트', '사죠영']
2025-10-20 14:27:30,641 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 14:27:31,607 - __main__ - INFO - 퍼지 매칭 결과 크기: (2185, 3)
2025-10-20 14:27:31,607 - __main__ - INFO - 퍼지 매칭 성공: 2185개 결과
2025-10-20 14:27:31,608 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.4285714285714286}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.4}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.4}]
2025-10-20 14:27:31,608 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 14:27:31,781 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2185, 3)
2025-10-20 14:27:31,782 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.18461538461538463}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.15000000000000002}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.15000000000000002}]
2025-10-20 14:27:31,782 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 14:27:31,785 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 14개
2025-10-20 14:27:31,787 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 5개
2025-10-20 14:27:31,788 - __main__ - INFO - 통합된 후보 아이템 수: 19개
2025-10-20 14:27:31,791 - __main__ - INFO - 최종 후보 아이템 리스트: ['아이폰 17', '아이폰 17 PRO', '충전', '아이폰 16 PRO', '스마트 사인', '아이폰 17 PRO MAX', '아이폰 16', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:27:31,794 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (11, 2)
2025-10-20 14:27:31,795 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}, {'item_nm': 'IPHONE 16 PRO', 'item_id': ['A5XE', 'A643', 'A5XN', 'A64C', 'A647', 'A63Y', 'A5XJ', 'A5X9']}]
2025-10-20 14:27:31,795 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.84초
2025-10-20 14:27:31,795 - __main__ - INFO - 추출된 후보 엔티티: ['아이폰 17', '아이폰 17 PRO', '충전', '아이폰 16 PRO', '스마트 사인', '아이폰 17 PRO MAX', '아이폰 16', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:27:31,795 - __main__ - INFO - 매칭된 상품 정보: (11, 2)
2025-10-20 14:27:31,795 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 14:27:31,959 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 14:27:31,959 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 14:27:31,959 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 400 문자
2025-10-20 14:27:31,959 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 14:27:31,959 - __main__ - INFO - 후보 아이템 리스트 크기: 12개
2025-10-20 14:27:31,959 - __main__ - INFO - 후보 아이템 리스트: ['아이폰 17', '아이폰 17 PRO', '충전', '아이폰 16 PRO', '스마트 사인', '아이폰 17 PRO MAX', '아이폰 16', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:27:31,959 - __main__ - INFO - extra_item_pdf 크기: (11, 2)
2025-10-20 14:27:31,960 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 14:27:31,960 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}]
2025-10-20 14:27:31,960 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 14:27:31,960 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 14:27:31,960 - __main__ - INFO - 구성된 프롬프트 길이: 6754 문자
2025-10-20 14:27:31,960 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 14:27:31,960 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 14:27:31,960 - __main__ - INFO - 📝 프롬프트 길이: 6,754 문자
2025-10-20 14:27:31,960 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 14:27:31,960 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 14:27:39,319 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 14:27:39,342 - __main__ - INFO - LLM 응답 길이: 930 문자
2025-10-20 14:27:39,342 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "[SK텔레콤] 반가워요 5G 아이폰 17 / 17 Pro 사전예약 안내",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내"
    ],
    "product": [
        {
            "name": "아이폰 17",
            "action": "구매"
        },
        {
            "name": "아이폰 17 Pro",
            "action": "구매"
        }
    ],
    "channel": [
        {
            "type": "URL",
            "value": "http://t-mms.kr/t.do?m=#61&u=https://bit.ly/2HeWcdx",
            "action": "추가 정보"
        },
        {
          ...
2025-10-20 14:27:39,342 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 14:27:39,343 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 14:27:39,343 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 14:27:39,343 - __main__ - INFO - 파싱된 JSON 내용: {'title': '[SK텔레콤] 반가워요 5G 아이폰 17 / 17 Pro 사전예약 안내', 'purpose': ['상품 가입 유도', '혜택 안내'], 'product': [{'name': '아이폰 17', 'action': '구매'}, {'name': '아이폰 17 Pro', 'action': '구매'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/2HeWcdx', 'action': '추가 정보'}, {'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/3o7zOnA', 'action': '추가 정보'}, {'type': '전화번호', 'value': '1558', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['상품및부가서비스가입유도_단말', '사용법/혜택/이벤트안내_단말']}
2025-10-20 14:27:39,343 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 14:27:39,343 - __main__ - INFO - LLM 추출 엔티티: ['아이폰 17', '아이폰 17 Pro']
2025-10-20 14:27:39,345 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-10-20 14:27:39,345 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-10-20 14:27:39,345 - __main__ - INFO - === 후보 엔티티 추출 시작 ===
2025-10-20 14:27:39,345 - __main__ - INFO - 퍼지 매칭 임계값: 0.4
2025-10-20 14:27:40,866 - __main__ - ERROR - 결합 유사도 계산 실패: DataFrame.reset_index() got an unexpected keyword argument 'name'
2025-10-20 14:27:40,867 - __main__ - ERROR - LLM 기반 엔티티 추출 실패: 'item_nm_alias'
2025-10-20 14:27:40,867 - __main__ - INFO - extract_entities_by_llm 실행완료: 1.52초
2025-10-20 14:27:40,868 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 14:27:40,868 - __main__ - INFO - ============================================================
2025-10-20 14:27:40,868 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 14:27:40,868 - __main__ - INFO - ============================================================
2025-10-20 14:27:40,868 - __main__ - INFO - 제목: [SK텔레콤] 반가워요 5G 아이폰 17 / 17 Pro 사전예약 안내
2025-10-20 14:27:40,868 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내']
2025-10-20 14:27:40,868 - __main__ - INFO - 상품 수: 2개
2025-10-20 14:27:40,868 - __main__ - INFO - 채널 수: 4개
2025-10-20 14:27:40,868 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 14:27:40,868 - __main__ - INFO - process_message 실행완료: 10.91초
2025-10-20 14:27:40,868 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 14:29:20,014 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 14:29:20,015 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 14:29:20,015 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 14:29:20,015 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 14:29:20,015 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 14:29:20,017 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 14:29:20,054 - __main__ - INFO - Using device: mps
2025-10-20 14:29:20,054 - __main__ - INFO - _initialize_device 실행완료: 0.04초
2025-10-20 14:29:20,054 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 14:29:20,054 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 14:29:20,054 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 14:29:20,054 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 14:29:20,054 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 14:29:20,055 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 14:29:20,055 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 14:29:20,748 - __main__ - INFO - Model loaded on mps
2025-10-20 14:29:20,748 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.69초
2025-10-20 14:29:20,748 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 14:29:21,356 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 14:29:21,356 - __main__ - INFO - _initialize_kiwi 실행완료: 0.61초
2025-10-20 14:29:21,356 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 14:29:21,356 - __main__ - INFO - ============================================================
2025-10-20 14:29:21,356 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 14:29:21,356 - __main__ - INFO - ============================================================
2025-10-20 14:29:21,357 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 14:29:21,357 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 14:29:21,357 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 14:29:21,357 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 14:29:21,357 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:29:21,511 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 14:29:21,511 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:29:21,511 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 14:29:21,519 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 14:29:21,520 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 14:29:21,521 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:29:21,521 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:29:21,522 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 14:29:21,522 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 14:29:21,524 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 14:29:21,528 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 14:29:21,528 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 14:29:21,528 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:29:21,529 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 14:29:21,529 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 14:29:21,529 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 14:29:21,529 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:29:21,529 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 14:29:21,529 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 14:29:21,529 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 14:29:21,531 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 14:29:21,531 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 14:29:21,531 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:29:21,532 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 14:29:21,532 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:29:21,756 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 14:29:21,766 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 14:29:21,767 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주pass Netflix 인증']
2025-10-20 14:29:21,767 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 14:29:21,767 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 14:29:21,767 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 14:29:21,768 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 14:29:21,768 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 14:29:21,768 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 14:29:21,769 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 14:29:21,770 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 14:29:21,771 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 14:29:21,771 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주pass Netflix 인증']
2025-10-20 14:29:21,792 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 14:29:21,792 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 14:29:21,792 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 14:29:21,794 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 14:29:21,794 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 14:29:22,062 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 14:29:22,062 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 14:29:22,062 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 14:29:22,062 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 14:29:22,062 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 14:29:22,063 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:29:22,150 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 14:29:22,151 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:29:22,153 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 14:29:22,154 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 14:29:22,154 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 14:29:22,154 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:29:22,154 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 14:29:22,154 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 14:29:22,154 - __main__ - INFO - ============================================================
2025-10-20 14:29:22,154 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 14:29:22,154 - __main__ - INFO - ============================================================
2025-10-20 14:29:22,154 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 14:29:22,155 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 14:29:22,155 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 14:29:22,155 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 14:29:22,155 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 14:29:22,156 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 14:29:22,158 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 14:29:22,160 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 14:29:22,160 - __main__ - INFO - _load_data 실행완료: 0.80초
2025-10-20 14:29:22,160 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 14:29:22,160 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 14:29:22,160 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
(광고)[SKT] 아...
2025-10-20 14:29:22,160 - __main__ - INFO - ============================================================
2025-10-20 14:29:22,160 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 14:29:22,160 - __main__ - INFO - ============================================================
2025-10-20 14:29:22,160 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
(광고)[SKT] 아이폰 12/12 Pro 사전예약 안내  #04 고객님, 안녕하세요. 최고의 스마트폰 칩과 카메라, 견고한 세라믹 실드에 5G 기술까지! 이 모든 것을 갖춘 아이폰 12/12 Pro를 만나 보세요.  ▶ 혜택받고 사전예약하기: http://t-mms.kr/t.do?m=#...
2025-10-20 14:29:22,160 - __main__ - INFO - 메시지 길이: 822 문자
2025-10-20 14:29:22,160 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 14:29:22,160 - __main__ - INFO - 데이터 소스: local
2025-10-20 14:29:22,160 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 14:29:22,160 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-20 14:29:22,160 - __main__ - INFO - LLM 모델: ax
2025-10-20 14:29:22,160 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 14:29:22,160 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 14:29:22,160 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 14:29:22,160 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 14:29:22,160 - __main__ - INFO - 처리할 메시지 길이: 815 문자
2025-10-20 14:29:22,161 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 14:29:22,852 - __main__ - INFO - 분할된 문장 수: 9개
2025-10-20 14:29:22,853 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 반가워요', '5G 아이폰 Pro 사전예약 안내 광고 SKT 아이폰 Pro 사전예약 안내 고객님 안녕하세요 ', '최고의 스마트폰 칩과 카메라 견고 세라믹 실드에 5G 기술까지 ']...
2025-10-20 14:29:22,861 - __main__ - INFO - 전체 토큰 수: 310개
2025-10-20 14:29:22,861 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '아이폰', '아이폰', '실드', '아이폰', '아이폰', '스펙', '아이폰', '스마트폰', '택1', '사죠영', '죠르디', '한정판', '기프트', '프리디', '충전기', '에이프릴', '스톤', '충전', '기프트', '.', '카카오톡', '코로나']
2025-10-20 14:29:22,861 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['죠르디', '카카오톡', '한정판', '실드', '스펙', '스톤', '택1', '사죠영', '충전기', '코로나', '에이프릴', '기프트', '아이폰', '프리디']
2025-10-20 14:29:22,861 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 14:29:23,906 - __main__ - INFO - 퍼지 매칭 결과 크기: (2116, 3)
2025-10-20 14:29:23,906 - __main__ - INFO - 퍼지 매칭 성공: 2116개 결과
2025-10-20 14:29:23,907 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.4285714285714286}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.4}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.4}]
2025-10-20 14:29:23,907 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 14:29:24,080 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2116, 3)
2025-10-20 14:29:24,080 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.18461538461538463}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.15000000000000002}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.15000000000000002}]
2025-10-20 14:29:24,080 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 14:29:24,083 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 11개
2025-10-20 14:29:24,086 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 14:29:24,086 - __main__ - INFO - 통합된 후보 아이템 수: 11개
2025-10-20 14:29:24,089 - __main__ - INFO - 최종 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:29:24,093 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (10, 2)
2025-10-20 14:29:24,093 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}, {'item_nm': 'IPHONE 16 PRO', 'item_id': ['A5XE', 'A643', 'A5XN', 'A64C', 'A647', 'A63Y', 'A5XJ', 'A5X9']}]
2025-10-20 14:29:24,093 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.93초
2025-10-20 14:29:24,093 - __main__ - INFO - 추출된 후보 엔티티: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:29:24,093 - __main__ - INFO - 매칭된 상품 정보: (10, 2)
2025-10-20 14:29:24,093 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 14:29:24,253 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 14:29:24,253 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 14:29:24,253 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 400 문자
2025-10-20 14:29:24,253 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 14:29:24,253 - __main__ - INFO - 후보 아이템 리스트 크기: 11개
2025-10-20 14:29:24,253 - __main__ - INFO - 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:29:24,253 - __main__ - INFO - extra_item_pdf 크기: (10, 2)
2025-10-20 14:29:24,253 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 14:29:24,253 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}]
2025-10-20 14:29:24,253 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 14:29:24,253 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 14:29:24,254 - __main__ - INFO - 구성된 프롬프트 길이: 6734 문자
2025-10-20 14:29:24,254 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 14:29:24,254 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 14:29:24,254 - __main__ - INFO - 📝 프롬프트 길이: 6,734 문자
2025-10-20 14:29:24,254 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 14:29:24,254 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 14:29:35,874 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 14:29:35,897 - __main__ - INFO - LLM 응답 길이: 1746 문자
2025-10-20 14:29:35,898 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내"
    ],
    "product": [
        {
            "name": "아이폰 12",
            "action": "구매"
        },
        {
            "name": "아이폰 12 Pro",
            "action": "구매"
        },
        {
            "name": "아이폰 17",
            "action": "구매"
        },
        {
            "name": "아이폰 17 Pro",
            "action": "구매"
        },
        {
            "name": "5G",
   ...
2025-10-20 14:29:35,898 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 14:29:35,899 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 14:29:35,899 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 14:29:35,899 - __main__ - INFO - 파싱된 JSON 내용: {'title': '[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내', 'purpose': ['상품 가입 유도', '혜택 안내'], 'product': [{'name': '아이폰 12', 'action': '구매'}, {'name': '아이폰 12 Pro', 'action': '구매'}, {'name': '아이폰 17', 'action': '구매'}, {'name': '아이폰 17 Pro', 'action': '구매'}, {'name': '5G', 'action': '사용'}, {'name': 'A14 Bionic 칩', 'action': '사용'}, {'name': '세라믹 실드', 'action': '사용'}, {'name': 'Dolby Vision 영상 카메라', 'action': '사용'}, {'name': '죠르디 한정판 기프트', 'action': '기타'}, {'name': '멀티 무선 충전기', 'action': '기타'}, {'name': '보조배터리+멀티백', 'action': '기타'}, {'name': '3in1 무선 충전 살균기', 'action': '기타'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/2HeWcdx', 'action': '추가 정보'}, {'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/3o7zOnA', 'action': '추가 정보'}, {'type': '전화번호', 'value': '1558', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['상품및부가서비스가입유도_단말', '사용법/혜택/이벤트안내_단말']}
2025-10-20 14:29:35,899 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 14:29:35,899 - __main__ - INFO - LLM 추출 엔티티: ['아이폰 12', '아이폰 12 Pro', '아이폰 17', '아이폰 17 Pro', '5G', 'A14 Bionic 칩', '세라믹 실드', 'Dolby Vision 영상 카메라', '죠르디 한정판 기프트', '멀티 무선 충전기', '보조배터리+멀티백', '3in1 무선 충전 살균기']
2025-10-20 14:29:35,901 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-10-20 14:29:35,901 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-10-20 14:29:35,901 - __main__ - INFO - === 후보 엔티티 추출 시작 ===
2025-10-20 14:29:35,901 - __main__ - INFO - 퍼지 매칭 임계값: 0.4
2025-10-20 14:29:37,496 - __main__ - INFO - 로직 기반 추출 원본 엔티티 수: 1306개
2025-10-20 14:29:37,496 - __main__ - INFO - 원본 엔티티 샘플 (최대 10개): ['(KTF)아이폰 16E', '(LGU)아이폰 16E', '0 청년 109(T 우주)', '0 청년 109(TVING)', '0 청년 109(tving)', '0 청년 109(스마트기기)', '0 청년 109(티빙)', '0 청년 37', '0 청년 37 DATA 충전 1GB', '0 청년 37 Data 충전 1GB']
2025-10-20 14:29:37,498 - __main__ - INFO - 필터링 후 엔티티 수: 1301개
2025-10-20 14:29:37,498 - __main__ - INFO - 제거된 엔티티 수: 5개
2025-10-20 14:29:37,498 - __main__ - INFO - 최종 후보 엔티티 수: 1301개
2025-10-20 14:29:37,498 - __main__ - WARNING - ⚠️ 후보 엔티티가 매우 많습니다: 1301개
2025-10-20 14:29:37,498 - __main__ - WARNING - 이는 프롬프트 길이를 크게 증가시킬 수 있습니다.
2025-10-20 14:29:37,498 - __main__ - WARNING - 성능을 위해 상위 100개만 사용합니다. (원본: 1301개)
2025-10-20 14:29:37,498 - __main__ - INFO - 최종 후보 엔티티 샘플 (최대 10개): ['(KTF)아이폰 16E', '(LGU)아이폰 16E', '0 청년 109(T 우주)', '0 청년 109(TVING)', '0 청년 109(tving)', '0 청년 109(스마트기기)', '0 청년 109(티빙)', '0 청년 37', '0 청년 37 DATA 충전 1GB', '0 청년 37 Data 충전 1GB']
2025-10-20 14:29:37,498 - __main__ - INFO - === 후보 엔티티 추출 완료 ===
2025-10-20 14:29:37,498 - __main__ - INFO - 🔍 프롬프트에 추가될 엔티티 섹션 길이: 1,715 문자
2025-10-20 14:29:37,498 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 4,947 문자
2025-10-20 14:29:37,498 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-10-20 14:29:37,498 - __main__ - INFO - 📝 프롬프트 길이: 4,947 문자
2025-10-20 14:29:37,498 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-10-20 14:29:37,498 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-10-20 14:29:37,499 - __main__ - INFO - 🔄 2개 LLM 모델로 엔티티 추출 시작
2025-10-20 14:29:37,502 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-20 14:29:37,502 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-20 14:29:37,502 - __main__ - INFO - 🔍 프롬프트 구성 중 - LLM 모델: client=<openai.resources.chat.completions.completions.Completions object at 0x162660dd0> async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x16118f470> root_client=<openai.OpenAI object at 0x162660ec0> root_async_client=<openai.AsyncOpenAI object at 0x168d06cc0> model_name='skt/ax4' temperature=0.0 model_kwargs={} openai_api_key=SecretStr('**********') openai_api_base='https://api.platform.a15t.com/v1' max_tokens=4000
2025-10-20 14:29:37,502 - __main__ - INFO - 🔍 프롬프트 구성 중 - LLM 모델: client=<openai.resources.chat.completions.completions.Completions object at 0x15e6dd520> async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x168cec890> root_client=<openai.OpenAI object at 0x168d064b0> root_async_client=<openai.AsyncOpenAI object at 0x168cef020> model_name='amazon/anthropic/claude-sonnet-4-20250514' temperature=0.0 model_kwargs={} openai_api_key=SecretStr('**********') openai_api_base='https://api.platform.a15t.com/v1' max_tokens=4000
2025-10-20 14:29:37,502 - __main__ - INFO - 🔍 후보 엔티티 개수: 100개
2025-10-20 14:29:37,502 - __main__ - INFO - 🔍 후보 엔티티 개수: 100개
2025-10-20 14:29:37,503 - __main__ - INFO - 🔍 후보 엔티티 문자열 길이: 1,552 문자
2025-10-20 14:29:37,503 - __main__ - INFO - 🔍 후보 엔티티 문자열 길이: 1,552 문자
2025-10-20 14:29:37,503 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-20 14:29:37,503 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-20 14:29:37,503 - __main__ - INFO - 🔍 메시지 길이: 815 문자
2025-10-20 14:29:37,503 - __main__ - INFO - 🔍 메시지 길이: 815 문자
2025-10-20 14:29:37,503 - __main__ - INFO - 🔍 예상 전체 프롬프트 길이: 4,815 문자
2025-10-20 14:29:37,503 - __main__ - INFO - 🔍 예상 전체 프롬프트 길이: 4,815 문자
2025-10-20 14:29:39,021 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 14:29:39,249 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 14:29:39,264 - __main__ - INFO - ✅ LLM 추출 완료: ['아이폰 12 Pro', '17 Pro', '[사죠영] 죠르디 한정판 기프트', '12 Pro', '[에이프릴스톤] 보조배터리+멀티백', '[크레앙] 3in1 무선 충전 살균기', '[프리디] 멀티 무선 충전기', '아이폰 12', '5G 아이폰17', 'T기프트', 'T다이렉트샵']
2025-10-20 14:29:39,917 - __main__ - INFO - extract_entities_by_llm 실행완료: 4.02초
2025-10-20 14:29:39,924 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 14:29:39,924 - __main__ - INFO - ============================================================
2025-10-20 14:29:39,924 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 14:29:39,924 - __main__ - INFO - ============================================================
2025-10-20 14:29:39,924 - __main__ - INFO - 제목: [SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
2025-10-20 14:29:39,924 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내']
2025-10-20 14:29:39,925 - __main__ - INFO - 상품 수: 3개
2025-10-20 14:29:39,925 - __main__ - INFO - 채널 수: 4개
2025-10-20 14:29:39,925 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 14:29:39,925 - __main__ - INFO - process_message 실행완료: 17.76초
2025-10-20 14:29:39,925 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 14:30:59,740 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 14:30:59,741 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 14:30:59,741 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 14:30:59,741 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 14:30:59,741 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 14:30:59,743 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 14:30:59,811 - __main__ - INFO - Using device: mps
2025-10-20 14:30:59,811 - __main__ - INFO - _initialize_device 실행완료: 0.07초
2025-10-20 14:30:59,811 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 14:30:59,812 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 14:30:59,812 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 14:30:59,812 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 14:30:59,812 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 14:30:59,812 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 14:30:59,812 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 14:31:00,454 - __main__ - INFO - Model loaded on mps
2025-10-20 14:31:00,454 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.64초
2025-10-20 14:31:00,455 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 14:31:01,096 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 14:31:01,096 - __main__ - INFO - _initialize_kiwi 실행완료: 0.64초
2025-10-20 14:31:01,096 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 14:31:01,096 - __main__ - INFO - ============================================================
2025-10-20 14:31:01,096 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 14:31:01,096 - __main__ - INFO - ============================================================
2025-10-20 14:31:01,096 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 14:31:01,096 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 14:31:01,096 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 14:31:01,096 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 14:31:01,096 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:31:01,261 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 14:31:01,261 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:31:01,261 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 14:31:01,268 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 14:31:01,270 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 14:31:01,271 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:31:01,271 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:31:01,272 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 14:31:01,272 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 14:31:01,277 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 14:31:01,281 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 14:31:01,281 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 14:31:01,281 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:31:01,281 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 14:31:01,281 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 14:31:01,281 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 14:31:01,281 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:31:01,281 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 14:31:01,281 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 14:31:01,281 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 14:31:01,286 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 14:31:01,286 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 14:31:01,286 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:31:01,287 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 14:31:01,287 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:31:01,511 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 14:31:01,521 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 14:31:01,522 - __main__ - INFO - 별칭 적용 후 샘플: ['우주Pass Netflix 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증', '우주패스 넷플릭스 인증', '우주pass Netflix 인증']
2025-10-20 14:31:01,522 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 14:31:01,522 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 14:31:01,522 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 14:31:01,524 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 14:31:01,524 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 14:31:01,524 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 14:31:01,524 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 14:31:01,525 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 14:31:01,526 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 14:31:01,526 - __main__ - INFO - 등록할 별칭 샘플: ['우주Pass Netflix 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증', '우주패스 넷플릭스 인증', '우주pass Netflix 인증']
2025-10-20 14:31:01,547 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 14:31:01,547 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 14:31:01,548 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 14:31:01,557 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 14:31:01,557 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 14:31:02,068 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 14:31:02,068 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 14:31:02,068 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 14:31:02,068 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 14:31:02,068 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 14:31:02,068 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:31:02,153 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 14:31:02,153 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:31:02,156 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 14:31:02,156 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 14:31:02,156 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 14:31:02,156 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:31:02,157 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 14:31:02,157 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 14:31:02,157 - __main__ - INFO - ============================================================
2025-10-20 14:31:02,157 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 14:31:02,157 - __main__ - INFO - ============================================================
2025-10-20 14:31:02,157 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 14:31:02,157 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 14:31:02,157 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 14:31:02,157 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 14:31:02,157 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 14:31:02,158 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 14:31:02,160 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 14:31:02,163 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 14:31:02,163 - __main__ - INFO - _load_data 실행완료: 1.07초
2025-10-20 14:31:02,163 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 14:31:02,163 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 14:31:02,163 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
(광고)[SKT] 아...
2025-10-20 14:31:02,163 - __main__ - INFO - ============================================================
2025-10-20 14:31:02,163 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 14:31:02,163 - __main__ - INFO - ============================================================
2025-10-20 14:31:02,163 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
(광고)[SKT] 아이폰 12/12 Pro 사전예약 안내  #04 고객님, 안녕하세요. 최고의 스마트폰 칩과 카메라, 견고한 세라믹 실드에 5G 기술까지! 이 모든 것을 갖춘 아이폰 12/12 Pro를 만나 보세요.  ▶ 혜택받고 사전예약하기: http://t-mms.kr/t.do?m=#...
2025-10-20 14:31:02,163 - __main__ - INFO - 메시지 길이: 822 문자
2025-10-20 14:31:02,163 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 14:31:02,163 - __main__ - INFO - 데이터 소스: local
2025-10-20 14:31:02,163 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 14:31:02,163 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-20 14:31:02,163 - __main__ - INFO - LLM 모델: ax
2025-10-20 14:31:02,163 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 14:31:02,163 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 14:31:02,163 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 14:31:02,163 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 14:31:02,164 - __main__ - INFO - 처리할 메시지 길이: 815 문자
2025-10-20 14:31:02,165 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 14:31:02,838 - __main__ - INFO - 분할된 문장 수: 9개
2025-10-20 14:31:02,840 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 반가워요', '5G 아이폰 Pro 사전예약 안내 광고 SKT 아이폰 Pro 사전예약 안내 고객님 안녕하세요 ', '최고의 스마트폰 칩과 카메라 견고 세라믹 실드에 5G 기술까지 ']...
2025-10-20 14:31:02,847 - __main__ - INFO - 전체 토큰 수: 310개
2025-10-20 14:31:02,847 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '아이폰', '아이폰', '실드', '아이폰', '아이폰', '스펙', '아이폰', '스마트폰', '택1', '사죠영', '죠르디', '한정판', '기프트', '프리디', '충전기', '에이프릴', '스톤', '충전', '기프트', '.', '카카오톡', '코로나']
2025-10-20 14:31:02,847 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['프리디', '택1', '한정판', '죠르디', '스펙', '사죠영', '카카오톡', '기프트', '충전기', '코로나', '스톤', '아이폰', '실드', '에이프릴']
2025-10-20 14:31:02,847 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 14:31:04,252 - __main__ - INFO - 퍼지 매칭 결과 크기: (2116, 3)
2025-10-20 14:31:04,253 - __main__ - INFO - 퍼지 매칭 성공: 2116개 결과
2025-10-20 14:31:04,254 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.4285714285714286}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.4}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.4}]
2025-10-20 14:31:04,254 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 14:31:04,419 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2116, 3)
2025-10-20 14:31:04,420 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.18461538461538463}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.15000000000000002}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.15000000000000002}]
2025-10-20 14:31:04,420 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 14:31:04,423 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 11개
2025-10-20 14:31:04,425 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 14:31:04,426 - __main__ - INFO - 통합된 후보 아이템 수: 11개
2025-10-20 14:31:04,429 - __main__ - INFO - 최종 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:31:04,432 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (10, 2)
2025-10-20 14:31:04,433 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}, {'item_nm': 'IPHONE 16 PRO', 'item_id': ['A5XE', 'A643', 'A5XN', 'A64C', 'A647', 'A63Y', 'A5XJ', 'A5X9']}]
2025-10-20 14:31:04,433 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 2.27초
2025-10-20 14:31:04,433 - __main__ - INFO - 추출된 후보 엔티티: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:31:04,433 - __main__ - INFO - 매칭된 상품 정보: (10, 2)
2025-10-20 14:31:04,433 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 14:31:04,588 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 14:31:04,588 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 14:31:04,588 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 400 문자
2025-10-20 14:31:04,588 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 14:31:04,588 - __main__ - INFO - 후보 아이템 리스트 크기: 11개
2025-10-20 14:31:04,588 - __main__ - INFO - 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:31:04,588 - __main__ - INFO - extra_item_pdf 크기: (10, 2)
2025-10-20 14:31:04,588 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 14:31:04,589 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}]
2025-10-20 14:31:04,589 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 14:31:04,589 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 14:31:04,589 - __main__ - INFO - 구성된 프롬프트 길이: 6734 문자
2025-10-20 14:31:04,589 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 14:31:04,589 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 14:31:04,589 - __main__ - INFO - 📝 프롬프트 길이: 6,734 문자
2025-10-20 14:31:04,589 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 14:31:04,589 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 14:31:14,906 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 14:31:14,923 - __main__ - INFO - LLM 응답 길이: 1419 문자
2025-10-20 14:31:14,923 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내"
    ],
    "product": [
        {
            "name": "아이폰 12",
            "action": "구매"
        },
        {
            "name": "아이폰 12 Pro",
            "action": "구매"
        },
        {
            "name": "아이폰 17",
            "action": "구매"
        },
        {
            "name": "아이폰 17 Pro",
            "action": "구매"
        },
        {
            "name": "죠르디 한정판 ...
2025-10-20 14:31:14,924 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 14:31:14,925 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 14:31:14,925 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 14:31:14,925 - __main__ - INFO - 파싱된 JSON 내용: {'title': '[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내', 'purpose': ['상품 가입 유도', '혜택 안내'], 'product': [{'name': '아이폰 12', 'action': '구매'}, {'name': '아이폰 12 Pro', 'action': '구매'}, {'name': '아이폰 17', 'action': '구매'}, {'name': '아이폰 17 Pro', 'action': '구매'}, {'name': '죠르디 한정판 기프트', 'action': '기타'}, {'name': '멀티 무선 충전기', 'action': '기타'}, {'name': '보조배터리+멀티백', 'action': '기타'}, {'name': '3in1 무선 충전 살균기', 'action': '기타'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/2HeWcdx', 'action': '추가 정보'}, {'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/3o7zOnA', 'action': '추가 정보'}, {'type': '전화번호', 'value': '1558', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['상품및부가서비스가입유도_단말', '사용법/혜택/이벤트안내_단말']}
2025-10-20 14:31:14,926 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 14:31:14,926 - __main__ - INFO - LLM 추출 엔티티: ['아이폰 12', '아이폰 12 Pro', '아이폰 17', '아이폰 17 Pro', '죠르디 한정판 기프트', '멀티 무선 충전기', '보조배터리+멀티백', '3in1 무선 충전 살균기']
2025-10-20 14:31:14,927 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-10-20 14:31:14,927 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-10-20 14:31:14,927 - __main__ - INFO - === 후보 엔티티 추출 시작 ===
2025-10-20 14:31:14,927 - __main__ - INFO - 퍼지 매칭 임계값: 0.4
2025-10-20 14:31:16,448 - __main__ - ERROR - 결합 유사도 계산 실패: DataFrame.reset_index() got an unexpected keyword argument 'name'
2025-10-20 14:31:16,449 - __main__ - ERROR - LLM 기반 엔티티 추출 실패: 'item_nm_alias'
2025-10-20 14:31:16,449 - __main__ - INFO - extract_entities_by_llm 실행완료: 1.52초
2025-10-20 14:31:16,450 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 14:31:16,450 - __main__ - INFO - ============================================================
2025-10-20 14:31:16,450 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 14:31:16,450 - __main__ - INFO - ============================================================
2025-10-20 14:31:16,450 - __main__ - INFO - 제목: [SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
2025-10-20 14:31:16,450 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내']
2025-10-20 14:31:16,450 - __main__ - INFO - 상품 수: 8개
2025-10-20 14:31:16,450 - __main__ - INFO - 채널 수: 4개
2025-10-20 14:31:16,450 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 14:31:16,450 - __main__ - INFO - process_message 실행완료: 14.29초
2025-10-20 14:31:16,450 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 14:33:35,583 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 14:33:35,583 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 14:33:35,583 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 14:33:35,583 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 14:33:35,583 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 14:33:35,585 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 14:33:35,614 - __main__ - INFO - Using device: mps
2025-10-20 14:33:35,614 - __main__ - INFO - _initialize_device 실행완료: 0.03초
2025-10-20 14:33:35,614 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 14:33:35,614 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 14:33:35,614 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 14:33:35,614 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 14:33:35,614 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 14:33:35,614 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 14:33:35,614 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 14:33:35,863 - __main__ - INFO - Model loaded on mps
2025-10-20 14:33:35,863 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.25초
2025-10-20 14:33:35,863 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 14:33:36,453 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 14:33:36,453 - __main__ - INFO - _initialize_kiwi 실행완료: 0.59초
2025-10-20 14:33:36,453 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 14:33:36,453 - __main__ - INFO - ============================================================
2025-10-20 14:33:36,453 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 14:33:36,453 - __main__ - INFO - ============================================================
2025-10-20 14:33:36,454 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 14:33:36,454 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 14:33:36,454 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 14:33:36,454 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 14:33:36,454 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:33:36,604 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 14:33:36,604 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:33:36,604 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 14:33:36,612 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 14:33:36,613 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 14:33:36,614 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:33:36,614 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:33:36,615 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 14:33:36,615 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 14:33:36,616 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 14:33:36,620 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 14:33:36,620 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 14:33:36,620 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:33:36,620 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 14:33:36,620 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 14:33:36,621 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 14:33:36,621 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:33:36,621 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 14:33:36,621 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 14:33:36,621 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 14:33:36,622 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 14:33:36,623 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 14:33:36,623 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:33:36,623 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 14:33:36,624 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:33:36,853 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 14:33:36,864 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 14:33:36,865 - __main__ - INFO - 별칭 적용 후 샘플: ['우주Pass Netflix 인증', '우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증']
2025-10-20 14:33:36,865 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 14:33:36,865 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 14:33:36,865 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 14:33:36,866 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 14:33:36,866 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 14:33:36,866 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 14:33:36,866 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 14:33:36,867 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 14:33:36,869 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 14:33:36,869 - __main__ - INFO - 등록할 별칭 샘플: ['우주Pass Netflix 인증', '우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증']
2025-10-20 14:33:36,891 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 14:33:36,891 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 14:33:36,891 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 14:33:36,893 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 14:33:36,893 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 14:33:37,166 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 14:33:37,166 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 14:33:37,166 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 14:33:37,166 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 14:33:37,166 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 14:33:37,167 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:33:37,257 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 14:33:37,257 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:33:37,260 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 14:33:37,261 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 14:33:37,261 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 14:33:37,261 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:33:37,261 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 14:33:37,262 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 14:33:37,262 - __main__ - INFO - ============================================================
2025-10-20 14:33:37,262 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 14:33:37,262 - __main__ - INFO - ============================================================
2025-10-20 14:33:37,262 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 14:33:37,262 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 14:33:37,262 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 14:33:37,262 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 14:33:37,262 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 14:33:37,263 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 14:33:37,265 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 14:33:37,267 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 14:33:37,267 - __main__ - INFO - _load_data 실행완료: 0.81초
2025-10-20 14:33:37,267 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 14:33:37,267 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 14:33:37,267 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
(광고)[SKT] 아...
2025-10-20 14:33:37,267 - __main__ - INFO - ============================================================
2025-10-20 14:33:37,267 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 14:33:37,267 - __main__ - INFO - ============================================================
2025-10-20 14:33:37,267 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
(광고)[SKT] 아이폰 12/12 Pro 사전예약 안내  #04 고객님, 안녕하세요. 최고의 스마트폰 칩과 카메라, 견고한 세라믹 실드에 5G 기술까지! 이 모든 것을 갖춘 아이폰 12/12 Pro를 만나 보세요.  ▶ 혜택받고 사전예약하기: http://t-mms.kr/t.do?m=#...
2025-10-20 14:33:37,267 - __main__ - INFO - 메시지 길이: 822 문자
2025-10-20 14:33:37,267 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 14:33:37,267 - __main__ - INFO - 데이터 소스: local
2025-10-20 14:33:37,267 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 14:33:37,267 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-20 14:33:37,267 - __main__ - INFO - LLM 모델: ax
2025-10-20 14:33:37,267 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 14:33:37,267 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 14:33:37,267 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 14:33:37,267 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 14:33:37,267 - __main__ - INFO - 처리할 메시지 길이: 815 문자
2025-10-20 14:33:37,268 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 14:33:37,939 - __main__ - INFO - 분할된 문장 수: 9개
2025-10-20 14:33:37,940 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 반가워요', '5G 아이폰 Pro 사전예약 안내 광고 SKT 아이폰 Pro 사전예약 안내 고객님 안녕하세요 ', '최고의 스마트폰 칩과 카메라 견고 세라믹 실드에 5G 기술까지 ']...
2025-10-20 14:33:37,948 - __main__ - INFO - 전체 토큰 수: 310개
2025-10-20 14:33:37,948 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '아이폰', '아이폰', '실드', '아이폰', '아이폰', '스펙', '아이폰', '스마트폰', '택1', '사죠영', '죠르디', '한정판', '기프트', '프리디', '충전기', '에이프릴', '스톤', '충전', '기프트', '.', '카카오톡', '코로나']
2025-10-20 14:33:37,948 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['죠르디', '코로나', '한정판', '택1', '에이프릴', '사죠영', '실드', '기프트', '충전기', '스펙', '카카오톡', '스톤', '아이폰', '프리디']
2025-10-20 14:33:37,948 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 14:33:38,918 - __main__ - INFO - 퍼지 매칭 결과 크기: (2116, 3)
2025-10-20 14:33:38,918 - __main__ - INFO - 퍼지 매칭 성공: 2116개 결과
2025-10-20 14:33:38,919 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.4285714285714286}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.4}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.4}]
2025-10-20 14:33:38,919 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 14:33:39,088 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2116, 3)
2025-10-20 14:33:39,088 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.18461538461538463}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.15000000000000002}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.15000000000000002}]
2025-10-20 14:33:39,088 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 14:33:39,091 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 11개
2025-10-20 14:33:39,093 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 14:33:39,094 - __main__ - INFO - 통합된 후보 아이템 수: 11개
2025-10-20 14:33:39,097 - __main__ - INFO - 최종 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:33:39,100 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (10, 2)
2025-10-20 14:33:39,100 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}, {'item_nm': 'IPHONE 16 PRO', 'item_id': ['A5XE', 'A643', 'A5XN', 'A64C', 'A647', 'A63Y', 'A5XJ', 'A5X9']}]
2025-10-20 14:33:39,100 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.83초
2025-10-20 14:33:39,100 - __main__ - INFO - 추출된 후보 엔티티: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:33:39,100 - __main__ - INFO - 매칭된 상품 정보: (10, 2)
2025-10-20 14:33:39,100 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 14:33:39,249 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 14:33:39,250 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 14:33:39,250 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 400 문자
2025-10-20 14:33:39,250 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 14:33:39,250 - __main__ - INFO - 후보 아이템 리스트 크기: 11개
2025-10-20 14:33:39,250 - __main__ - INFO - 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:33:39,250 - __main__ - INFO - extra_item_pdf 크기: (10, 2)
2025-10-20 14:33:39,250 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 14:33:39,250 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}]
2025-10-20 14:33:39,250 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 14:33:39,250 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 14:33:39,250 - __main__ - INFO - 구성된 프롬프트 길이: 6734 문자
2025-10-20 14:33:39,250 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 14:33:39,250 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 14:33:39,250 - __main__ - INFO - 📝 프롬프트 길이: 6,734 문자
2025-10-20 14:33:39,251 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 14:33:39,251 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 14:33:51,248 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 14:33:51,271 - __main__ - INFO - LLM 응답 길이: 1746 문자
2025-10-20 14:33:51,271 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내"
    ],
    "product": [
        {
            "name": "아이폰 12",
            "action": "구매"
        },
        {
            "name": "아이폰 12 Pro",
            "action": "구매"
        },
        {
            "name": "아이폰 17",
            "action": "구매"
        },
        {
            "name": "아이폰 17 Pro",
            "action": "구매"
        },
        {
            "name": "5G",
   ...
2025-10-20 14:33:51,271 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 14:33:51,272 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 14:33:51,272 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 14:33:51,272 - __main__ - INFO - 파싱된 JSON 내용: {'title': '[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내', 'purpose': ['상품 가입 유도', '혜택 안내'], 'product': [{'name': '아이폰 12', 'action': '구매'}, {'name': '아이폰 12 Pro', 'action': '구매'}, {'name': '아이폰 17', 'action': '구매'}, {'name': '아이폰 17 Pro', 'action': '구매'}, {'name': '5G', 'action': '사용'}, {'name': 'A14 Bionic 칩', 'action': '사용'}, {'name': '세라믹 실드', 'action': '사용'}, {'name': 'Dolby Vision 영상 카메라', 'action': '사용'}, {'name': '죠르디 한정판 기프트', 'action': '기타'}, {'name': '멀티 무선 충전기', 'action': '기타'}, {'name': '보조배터리+멀티백', 'action': '기타'}, {'name': '3in1 무선 충전 살균기', 'action': '기타'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/2HeWcdx', 'action': '추가 정보'}, {'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/3o7zOnA', 'action': '추가 정보'}, {'type': '전화번호', 'value': '1558', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['상품및부가서비스가입유도_단말', '사용법/혜택/이벤트안내_단말']}
2025-10-20 14:33:51,273 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 14:33:51,273 - __main__ - INFO - LLM 추출 엔티티: ['아이폰 12', '아이폰 12 Pro', '아이폰 17', '아이폰 17 Pro', '5G', 'A14 Bionic 칩', '세라믹 실드', 'Dolby Vision 영상 카메라', '죠르디 한정판 기프트', '멀티 무선 충전기', '보조배터리+멀티백', '3in1 무선 충전 살균기']
2025-10-20 14:33:51,273 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-10-20 14:33:51,273 - __main__ - INFO - === 후보 엔티티 추출 시작 ===
2025-10-20 14:33:51,274 - __main__ - INFO - 퍼지 매칭 임계값: 0.4
2025-10-20 14:33:52,776 - __main__ - ERROR - 결합 유사도 계산 실패: DataFrame.reset_index() got an unexpected keyword argument 'name'
2025-10-20 14:33:52,776 - __main__ - ERROR - LLM 기반 엔티티 추출 실패: 'item_nm_alias'
2025-10-20 14:33:52,777 - __main__ - INFO - extract_entities_by_llm 실행완료: 1.50초
2025-10-20 14:33:52,778 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 14:33:52,778 - __main__ - INFO - ============================================================
2025-10-20 14:33:52,778 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 14:33:52,778 - __main__ - INFO - ============================================================
2025-10-20 14:33:52,778 - __main__ - INFO - 제목: [SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
2025-10-20 14:33:52,778 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내']
2025-10-20 14:33:52,778 - __main__ - INFO - 상품 수: 12개
2025-10-20 14:33:52,778 - __main__ - INFO - 채널 수: 4개
2025-10-20 14:33:52,778 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 14:33:52,778 - __main__ - INFO - process_message 실행완료: 15.51초
2025-10-20 14:33:52,778 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 14:44:58,033 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 14:44:58,033 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 14:44:58,033 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 14:44:58,033 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 14:44:58,033 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 14:44:58,035 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 14:44:58,066 - __main__ - INFO - Using device: mps
2025-10-20 14:44:58,066 - __main__ - INFO - _initialize_device 실행완료: 0.03초
2025-10-20 14:44:58,067 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 14:44:58,067 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 14:44:58,067 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 14:44:58,067 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 14:44:58,067 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 14:44:58,067 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 14:44:58,067 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 14:44:58,323 - __main__ - INFO - Model loaded on mps
2025-10-20 14:44:58,323 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.26초
2025-10-20 14:44:58,323 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 14:44:58,899 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 14:44:58,899 - __main__ - INFO - _initialize_kiwi 실행완료: 0.58초
2025-10-20 14:44:58,899 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 14:44:58,899 - __main__ - INFO - ============================================================
2025-10-20 14:44:58,899 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 14:44:58,899 - __main__ - INFO - ============================================================
2025-10-20 14:44:58,899 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 14:44:58,899 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 14:44:58,899 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 14:44:58,899 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 14:44:58,899 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:44:59,054 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 14:44:59,054 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:44:59,054 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 14:44:59,062 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 14:44:59,063 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 14:44:59,064 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:44:59,064 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:44:59,065 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 14:44:59,065 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 14:44:59,066 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 14:44:59,070 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 14:44:59,070 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 14:44:59,070 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:44:59,070 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 14:44:59,070 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 14:44:59,071 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 14:44:59,071 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:44:59,071 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 14:44:59,071 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 14:44:59,071 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 14:44:59,072 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 14:44:59,072 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 14:44:59,072 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:44:59,073 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 14:44:59,073 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:44:59,304 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 14:44:59,315 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 14:44:59,316 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 넷플릭스 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증']
2025-10-20 14:44:59,316 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 14:44:59,316 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 14:44:59,316 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 14:44:59,317 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 14:44:59,317 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 14:44:59,318 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 14:44:59,318 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 14:44:59,319 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 14:44:59,320 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 14:44:59,320 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 넷플릭스 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증']
2025-10-20 14:44:59,341 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 14:44:59,341 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 14:44:59,341 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 14:44:59,343 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 14:44:59,343 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 14:44:59,596 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 14:44:59,597 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 14:44:59,597 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 14:44:59,597 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 14:44:59,597 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 14:44:59,597 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:44:59,681 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 14:44:59,681 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:44:59,683 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 14:44:59,684 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 14:44:59,684 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 14:44:59,684 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:44:59,684 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 14:44:59,685 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 14:44:59,685 - __main__ - INFO - ============================================================
2025-10-20 14:44:59,685 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 14:44:59,685 - __main__ - INFO - ============================================================
2025-10-20 14:44:59,685 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 14:44:59,685 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 14:44:59,685 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 14:44:59,685 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 14:44:59,685 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 14:44:59,686 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 14:44:59,688 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 14:44:59,690 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 14:44:59,690 - __main__ - INFO - _load_data 실행완료: 0.79초
2025-10-20 14:44:59,690 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 14:44:59,691 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 14:44:59,691 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
(광고)[SKT] 아...
2025-10-20 14:44:59,691 - __main__ - INFO - ============================================================
2025-10-20 14:44:59,691 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 14:44:59,691 - __main__ - INFO - ============================================================
2025-10-20 14:44:59,691 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
(광고)[SKT] 아이폰 12/12 Pro 사전예약 안내  #04 고객님, 안녕하세요. 최고의 스마트폰 칩과 카메라, 견고한 세라믹 실드에 5G 기술까지! 이 모든 것을 갖춘 아이폰 12/12 Pro를 만나 보세요.  ▶ 혜택받고 사전예약하기: http://t-mms.kr/t.do?m=#...
2025-10-20 14:44:59,691 - __main__ - INFO - 메시지 길이: 822 문자
2025-10-20 14:44:59,691 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 14:44:59,691 - __main__ - INFO - 데이터 소스: local
2025-10-20 14:44:59,691 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 14:44:59,691 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-20 14:44:59,691 - __main__ - INFO - LLM 모델: ax
2025-10-20 14:44:59,691 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 14:44:59,691 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 14:44:59,691 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 14:44:59,691 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 14:44:59,691 - __main__ - INFO - 처리할 메시지 길이: 815 문자
2025-10-20 14:44:59,692 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 14:45:00,358 - __main__ - INFO - 분할된 문장 수: 9개
2025-10-20 14:45:00,359 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 반가워요', '5G 아이폰 Pro 사전예약 안내 광고 SKT 아이폰 Pro 사전예약 안내 고객님 안녕하세요 ', '최고의 스마트폰 칩과 카메라 견고 세라믹 실드에 5G 기술까지 ']...
2025-10-20 14:45:00,366 - __main__ - INFO - 전체 토큰 수: 310개
2025-10-20 14:45:00,366 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '아이폰', '아이폰', '실드', '아이폰', '아이폰', '스펙', '아이폰', '스마트폰', '택1', '사죠영', '죠르디', '한정판', '기프트', '프리디', '충전기', '에이프릴', '스톤', '충전', '기프트', '.', '카카오톡', '코로나']
2025-10-20 14:45:00,367 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['한정판', '실드', '스펙', '기프트', '카카오톡', '죠르디', '아이폰', '에이프릴', '코로나', '스톤', '택1', '프리디', '충전기', '사죠영']
2025-10-20 14:45:00,367 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 14:45:01,329 - __main__ - INFO - 퍼지 매칭 결과 크기: (2116, 3)
2025-10-20 14:45:01,330 - __main__ - INFO - 퍼지 매칭 성공: 2116개 결과
2025-10-20 14:45:01,331 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.4285714285714286}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.4}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.4}]
2025-10-20 14:45:01,331 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 14:45:01,501 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2116, 3)
2025-10-20 14:45:01,502 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.18461538461538463}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.15000000000000002}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.15000000000000002}]
2025-10-20 14:45:01,502 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 14:45:01,505 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 11개
2025-10-20 14:45:01,507 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 14:45:01,508 - __main__ - INFO - 통합된 후보 아이템 수: 11개
2025-10-20 14:45:01,511 - __main__ - INFO - 최종 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:45:01,514 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (10, 2)
2025-10-20 14:45:01,515 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}, {'item_nm': 'IPHONE 16 PRO', 'item_id': ['A5XE', 'A643', 'A5XN', 'A64C', 'A647', 'A63Y', 'A5XJ', 'A5X9']}]
2025-10-20 14:45:01,515 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.82초
2025-10-20 14:45:01,515 - __main__ - INFO - 추출된 후보 엔티티: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:45:01,515 - __main__ - INFO - 매칭된 상품 정보: (10, 2)
2025-10-20 14:45:01,515 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 14:45:01,668 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 14:45:01,668 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 14:45:01,668 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 400 문자
2025-10-20 14:45:01,668 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 14:45:01,668 - __main__ - INFO - 후보 아이템 리스트 크기: 11개
2025-10-20 14:45:01,668 - __main__ - INFO - 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:45:01,668 - __main__ - INFO - extra_item_pdf 크기: (10, 2)
2025-10-20 14:45:01,668 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 14:45:01,669 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}]
2025-10-20 14:45:01,669 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 14:45:01,669 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 14:45:01,669 - __main__ - INFO - 구성된 프롬프트 길이: 6734 문자
2025-10-20 14:45:01,669 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 14:45:01,669 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 14:45:01,669 - __main__ - INFO - 📝 프롬프트 길이: 6,734 문자
2025-10-20 14:45:01,669 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 14:45:01,669 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 14:45:13,644 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 14:45:13,664 - __main__ - INFO - LLM 응답 길이: 1746 문자
2025-10-20 14:45:13,664 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내"
    ],
    "product": [
        {
            "name": "아이폰 12",
            "action": "구매"
        },
        {
            "name": "아이폰 12 Pro",
            "action": "구매"
        },
        {
            "name": "아이폰 17",
            "action": "구매"
        },
        {
            "name": "아이폰 17 Pro",
            "action": "구매"
        },
        {
            "name": "5G",
   ...
2025-10-20 14:45:13,665 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 14:45:13,666 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 14:45:13,667 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 14:45:13,667 - __main__ - INFO - 파싱된 JSON 내용: {'title': '[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내', 'purpose': ['상품 가입 유도', '혜택 안내'], 'product': [{'name': '아이폰 12', 'action': '구매'}, {'name': '아이폰 12 Pro', 'action': '구매'}, {'name': '아이폰 17', 'action': '구매'}, {'name': '아이폰 17 Pro', 'action': '구매'}, {'name': '5G', 'action': '사용'}, {'name': 'A14 Bionic 칩', 'action': '사용'}, {'name': '세라믹 실드', 'action': '사용'}, {'name': 'Dolby Vision 영상 카메라', 'action': '사용'}, {'name': '죠르디 한정판 기프트', 'action': '기타'}, {'name': '멀티 무선 충전기', 'action': '기타'}, {'name': '보조배터리+멀티백', 'action': '기타'}, {'name': '3in1 무선 충전 살균기', 'action': '기타'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/2HeWcdx', 'action': '추가 정보'}, {'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/3o7zOnA', 'action': '추가 정보'}, {'type': '전화번호', 'value': '1558', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['상품및부가서비스가입유도_단말', '사용법/혜택/이벤트안내_단말']}
2025-10-20 14:45:13,667 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 14:45:13,667 - __main__ - INFO - LLM 추출 엔티티: ['아이폰 12', '아이폰 12 Pro', '아이폰 17', '아이폰 17 Pro', '5G', 'A14 Bionic 칩', '세라믹 실드', 'Dolby Vision 영상 카메라', '죠르디 한정판 기프트', '멀티 무선 충전기', '보조배터리+멀티백', '3in1 무선 충전 살균기']
2025-10-20 14:45:13,668 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-10-20 14:45:13,668 - __main__ - INFO - === 후보 엔티티 추출 시작 ===
2025-10-20 14:45:13,668 - __main__ - INFO - 퍼지 매칭 임계값: 0.4
2025-10-20 14:45:15,313 - __main__ - INFO - 로직 기반 추출 원본 엔티티 수: 1306개
2025-10-20 14:45:15,313 - __main__ - INFO - 원본 엔티티 샘플 (최대 10개): ['(KTF)아이폰 16E', '(LGU)아이폰 16E', '0 청년 109(T 우주)', '0 청년 109(TVING)', '0 청년 109(tving)', '0 청년 109(스마트기기)', '0 청년 109(티빙)', '0 청년 37', '0 청년 37 DATA 충전 1GB', '0 청년 37 Data 충전 1GB']
2025-10-20 14:45:15,315 - __main__ - INFO - 필터링 후 엔티티 수: 1301개
2025-10-20 14:45:15,315 - __main__ - INFO - 제거된 엔티티 수: 5개
2025-10-20 14:45:15,315 - __main__ - INFO - 최종 후보 엔티티 수: 1301개
2025-10-20 14:45:15,315 - __main__ - WARNING - ⚠️ 후보 엔티티가 매우 많습니다: 1301개
2025-10-20 14:45:15,315 - __main__ - WARNING - 이는 프롬프트 길이를 크게 증가시킬 수 있습니다.
2025-10-20 14:45:15,315 - __main__ - WARNING - 성능을 위해 상위 100개만 사용합니다. (원본: 1301개)
2025-10-20 14:45:15,315 - __main__ - INFO - 최종 후보 엔티티 샘플 (최대 10개): ['(KTF)아이폰 16E', '(LGU)아이폰 16E', '0 청년 109(T 우주)', '0 청년 109(TVING)', '0 청년 109(tving)', '0 청년 109(스마트기기)', '0 청년 109(티빙)', '0 청년 37', '0 청년 37 DATA 충전 1GB', '0 청년 37 Data 충전 1GB']
2025-10-20 14:45:15,315 - __main__ - INFO - === 후보 엔티티 추출 완료 ===
2025-10-20 14:45:15,315 - __main__ - INFO - 🔍 프롬프트에 추가될 엔티티 섹션 길이: 1,715 문자
2025-10-20 14:45:15,315 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 4,947 문자
2025-10-20 14:45:15,315 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-10-20 14:45:15,315 - __main__ - INFO - 📝 프롬프트 길이: 4,947 문자
2025-10-20 14:45:15,315 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-10-20 14:45:15,316 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-10-20 14:45:15,316 - __main__ - INFO - 🔄 1개 LLM 모델로 엔티티 추출 시작
2025-10-20 14:45:15,316 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-20 14:45:15,316 - __main__ - INFO - 🔍 프롬프트 구성 중 - LLM 모델: client=<openai.resources.chat.completions.completions.Completions object at 0x1631d8830> async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x164727a70> root_client=<openai.OpenAI object at 0x16314e300> root_async_client=<openai.AsyncOpenAI object at 0x1631d92b0> model_name='skt/ax4' temperature=0.0 model_kwargs={} openai_api_key=SecretStr('**********') openai_api_base='https://api.platform.a15t.com/v1' max_tokens=4000
2025-10-20 14:45:15,316 - __main__ - INFO - 🔍 후보 엔티티 개수: 100개
2025-10-20 14:45:15,316 - __main__ - INFO - 🔍 후보 엔티티 문자열 길이: 1,552 문자
2025-10-20 14:45:15,316 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-20 14:45:15,316 - __main__ - INFO - 🔍 메시지 길이: 815 문자
2025-10-20 14:45:15,316 - __main__ - INFO - 🔍 예상 전체 프롬프트 길이: 4,815 문자
2025-10-20 14:45:17,172 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 14:45:17,175 - __main__ - INFO - ✅ LLM 추출 완료: ['아이폰 12', '[에이프릴스톤] 보조배터리+멀티백', '[크레앙] 3in1 무선 충전 살균기', '[사죠영] 죠르디 한정판 기프트', '아이폰 12 Pro', 'T다이렉트샵', '[프리디] 멀티 무선 충전기']
2025-10-20 14:45:17,598 - __main__ - INFO - extract_entities_by_llm 실행완료: 3.93초
2025-10-20 14:45:17,603 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 14:45:17,604 - __main__ - INFO - ============================================================
2025-10-20 14:45:17,604 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 14:45:17,604 - __main__ - INFO - ============================================================
2025-10-20 14:45:17,604 - __main__ - INFO - 제목: [SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
2025-10-20 14:45:17,604 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내']
2025-10-20 14:45:17,604 - __main__ - INFO - 상품 수: 2개
2025-10-20 14:45:17,604 - __main__ - INFO - 채널 수: 4개
2025-10-20 14:45:17,604 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 14:45:17,604 - __main__ - INFO - process_message 실행완료: 17.91초
2025-10-20 14:45:17,604 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 14:46:07,828 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 14:46:07,828 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 14:46:07,828 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 14:46:07,828 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 14:46:07,828 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 14:46:07,830 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 14:46:07,904 - __main__ - INFO - Using device: mps
2025-10-20 14:46:07,905 - __main__ - INFO - _initialize_device 실행완료: 0.07초
2025-10-20 14:46:07,905 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 14:46:07,905 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 14:46:07,905 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 14:46:07,905 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 14:46:07,905 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 14:46:07,906 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 14:46:07,906 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 14:46:08,203 - __main__ - INFO - Model loaded on mps
2025-10-20 14:46:08,203 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.30초
2025-10-20 14:46:08,203 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 14:46:08,797 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 14:46:08,797 - __main__ - INFO - _initialize_kiwi 실행완료: 0.59초
2025-10-20 14:46:08,797 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 14:46:08,797 - __main__ - INFO - ============================================================
2025-10-20 14:46:08,797 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 14:46:08,797 - __main__ - INFO - ============================================================
2025-10-20 14:46:08,797 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 14:46:08,797 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 14:46:08,797 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 14:46:08,797 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 14:46:08,797 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:46:08,954 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 14:46:08,954 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:46:08,954 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 14:46:08,960 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 14:46:08,961 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 14:46:08,962 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:46:08,963 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:46:08,963 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 14:46:08,963 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 14:46:08,968 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 14:46:08,971 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 14:46:08,971 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 14:46:08,971 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:46:08,971 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 14:46:08,971 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 14:46:08,972 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 14:46:08,972 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:46:08,972 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 14:46:08,972 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 14:46:08,972 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 14:46:08,976 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 14:46:08,976 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 14:46:08,976 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:46:08,976 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 14:46:08,977 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:46:09,200 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 14:46:09,210 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 14:46:09,211 - __main__ - INFO - 별칭 적용 후 샘플: ['우주pass Netflix 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증', '우주패스 넷플릭스 인증']
2025-10-20 14:46:09,211 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 14:46:09,211 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 14:46:09,211 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 14:46:09,212 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 14:46:09,212 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 14:46:09,212 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 14:46:09,212 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 14:46:09,213 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 14:46:09,215 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 14:46:09,215 - __main__ - INFO - 등록할 별칭 샘플: ['우주pass Netflix 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증', '우주패스 넷플릭스 인증']
2025-10-20 14:46:09,235 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 14:46:09,235 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 14:46:09,235 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 14:46:09,243 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 14:46:09,243 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 14:46:09,526 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 14:46:09,527 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 14:46:09,527 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 14:46:09,527 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 14:46:09,527 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 14:46:09,527 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:46:09,611 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 14:46:09,611 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:46:09,614 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 14:46:09,614 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 14:46:09,614 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 14:46:09,614 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:46:09,614 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 14:46:09,615 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 14:46:09,615 - __main__ - INFO - ============================================================
2025-10-20 14:46:09,615 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 14:46:09,615 - __main__ - INFO - ============================================================
2025-10-20 14:46:09,615 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 14:46:09,615 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 14:46:09,615 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 14:46:09,615 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 14:46:09,615 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 14:46:09,616 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 14:46:09,618 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 14:46:09,620 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 14:46:09,620 - __main__ - INFO - _load_data 실행완료: 0.82초
2025-10-20 14:46:09,620 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 14:46:09,620 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 14:46:09,620 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
(광고)[SKT] 아...
2025-10-20 14:46:09,620 - __main__ - INFO - ============================================================
2025-10-20 14:46:09,620 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 14:46:09,620 - __main__ - INFO - ============================================================
2025-10-20 14:46:09,621 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
(광고)[SKT] 아이폰 12/12 Pro 사전예약 안내  #04 고객님, 안녕하세요. 최고의 스마트폰 칩과 카메라, 견고한 세라믹 실드에 5G 기술까지! 이 모든 것을 갖춘 아이폰 12/12 Pro를 만나 보세요.  ▶ 혜택받고 사전예약하기: http://t-mms.kr/t.do?m=#...
2025-10-20 14:46:09,621 - __main__ - INFO - 메시지 길이: 822 문자
2025-10-20 14:46:09,621 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 14:46:09,621 - __main__ - INFO - 데이터 소스: local
2025-10-20 14:46:09,621 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 14:46:09,621 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-20 14:46:09,621 - __main__ - INFO - LLM 모델: ax
2025-10-20 14:46:09,621 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 14:46:09,621 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 14:46:09,621 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 14:46:09,621 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 14:46:09,621 - __main__ - INFO - 처리할 메시지 길이: 815 문자
2025-10-20 14:46:09,622 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 14:46:10,289 - __main__ - INFO - 분할된 문장 수: 9개
2025-10-20 14:46:10,290 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 반가워요', '5G 아이폰 Pro 사전예약 안내 광고 SKT 아이폰 Pro 사전예약 안내 고객님 안녕하세요 ', '최고의 스마트폰 칩과 카메라 견고 세라믹 실드에 5G 기술까지 ']...
2025-10-20 14:46:10,297 - __main__ - INFO - 전체 토큰 수: 310개
2025-10-20 14:46:10,297 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '아이폰', '아이폰', '실드', '아이폰', '아이폰', '스펙', '아이폰', '스마트폰', '택1', '사죠영', '죠르디', '한정판', '기프트', '프리디', '충전기', '에이프릴', '스톤', '충전', '기프트', '.', '카카오톡', '코로나']
2025-10-20 14:46:10,298 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['코로나', '아이폰', '카카오톡', '택1', '죠르디', '사죠영', '스펙', '충전기', '기프트', '프리디', '실드', '스톤', '한정판', '에이프릴']
2025-10-20 14:46:10,298 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 14:46:11,696 - __main__ - INFO - 퍼지 매칭 결과 크기: (2116, 3)
2025-10-20 14:46:11,696 - __main__ - INFO - 퍼지 매칭 성공: 2116개 결과
2025-10-20 14:46:11,697 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.4285714285714286}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.4}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.4}]
2025-10-20 14:46:11,697 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 14:46:11,867 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2116, 3)
2025-10-20 14:46:11,867 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.18461538461538463}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.15000000000000002}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.15000000000000002}]
2025-10-20 14:46:11,868 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 14:46:11,870 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 11개
2025-10-20 14:46:11,873 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 14:46:11,873 - __main__ - INFO - 통합된 후보 아이템 수: 11개
2025-10-20 14:46:11,876 - __main__ - INFO - 최종 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:46:11,880 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (10, 2)
2025-10-20 14:46:11,880 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}, {'item_nm': 'IPHONE 16 PRO', 'item_id': ['A5XE', 'A643', 'A5XN', 'A64C', 'A647', 'A63Y', 'A5XJ', 'A5X9']}]
2025-10-20 14:46:11,880 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 2.26초
2025-10-20 14:46:11,880 - __main__ - INFO - 추출된 후보 엔티티: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:46:11,880 - __main__ - INFO - 매칭된 상품 정보: (10, 2)
2025-10-20 14:46:11,880 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 14:46:12,035 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 14:46:12,035 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 14:46:12,035 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 400 문자
2025-10-20 14:46:12,035 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 14:46:12,035 - __main__ - INFO - 후보 아이템 리스트 크기: 11개
2025-10-20 14:46:12,035 - __main__ - INFO - 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:46:12,035 - __main__ - INFO - extra_item_pdf 크기: (10, 2)
2025-10-20 14:46:12,036 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 14:46:12,036 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}]
2025-10-20 14:46:12,036 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 14:46:12,036 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 14:46:12,036 - __main__ - INFO - 구성된 프롬프트 길이: 6734 문자
2025-10-20 14:46:12,036 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 14:46:12,036 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 14:46:12,036 - __main__ - INFO - 📝 프롬프트 길이: 6,734 문자
2025-10-20 14:46:12,036 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 14:46:12,036 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 14:46:24,728 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 14:46:24,750 - __main__ - INFO - LLM 응답 길이: 1746 문자
2025-10-20 14:46:24,750 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내"
    ],
    "product": [
        {
            "name": "아이폰 12",
            "action": "구매"
        },
        {
            "name": "아이폰 12 Pro",
            "action": "구매"
        },
        {
            "name": "아이폰 17",
            "action": "구매"
        },
        {
            "name": "아이폰 17 Pro",
            "action": "구매"
        },
        {
            "name": "5G",
   ...
2025-10-20 14:46:24,751 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 14:46:24,752 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 14:46:24,752 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 14:46:24,752 - __main__ - INFO - 파싱된 JSON 내용: {'title': '[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내', 'purpose': ['상품 가입 유도', '혜택 안내'], 'product': [{'name': '아이폰 12', 'action': '구매'}, {'name': '아이폰 12 Pro', 'action': '구매'}, {'name': '아이폰 17', 'action': '구매'}, {'name': '아이폰 17 Pro', 'action': '구매'}, {'name': '5G', 'action': '사용'}, {'name': 'A14 Bionic 칩', 'action': '사용'}, {'name': '세라믹 실드', 'action': '사용'}, {'name': 'Dolby Vision 영상 카메라', 'action': '사용'}, {'name': '죠르디 한정판 기프트', 'action': '기타'}, {'name': '멀티 무선 충전기', 'action': '기타'}, {'name': '보조배터리+멀티백', 'action': '기타'}, {'name': '3in1 무선 충전 살균기', 'action': '기타'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/2HeWcdx', 'action': '추가 정보'}, {'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/3o7zOnA', 'action': '추가 정보'}, {'type': '전화번호', 'value': '1558', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['상품및부가서비스가입유도_단말', '사용법/혜택/이벤트안내_단말']}
2025-10-20 14:46:24,752 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 14:46:24,752 - __main__ - INFO - LLM 추출 엔티티: ['아이폰 12', '아이폰 12 Pro', '아이폰 17', '아이폰 17 Pro', '5G', 'A14 Bionic 칩', '세라믹 실드', 'Dolby Vision 영상 카메라', '죠르디 한정판 기프트', '멀티 무선 충전기', '보조배터리+멀티백', '3in1 무선 충전 살균기']
2025-10-20 14:46:24,753 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-10-20 14:46:24,754 - __main__ - INFO - === 후보 엔티티 추출 시작 ===
2025-10-20 14:46:24,754 - __main__ - INFO - 퍼지 매칭 임계값: 0.4
2025-10-20 14:46:26,347 - __main__ - INFO - 로직 기반 추출 원본 엔티티 수: 1306개
2025-10-20 14:46:26,347 - __main__ - INFO - 원본 엔티티 샘플 (최대 10개): ['(KTF)아이폰 16E', '(LGU)아이폰 16E', '0 청년 109(T 우주)', '0 청년 109(TVING)', '0 청년 109(tving)', '0 청년 109(스마트기기)', '0 청년 109(티빙)', '0 청년 37', '0 청년 37 DATA 충전 1GB', '0 청년 37 Data 충전 1GB']
2025-10-20 14:46:26,348 - __main__ - INFO - 필터링 후 엔티티 수: 1301개
2025-10-20 14:46:26,348 - __main__ - INFO - 제거된 엔티티 수: 5개
2025-10-20 14:46:26,349 - __main__ - INFO - 최종 후보 엔티티 수: 1301개
2025-10-20 14:46:26,349 - __main__ - WARNING - ⚠️ 후보 엔티티가 매우 많습니다: 1301개
2025-10-20 14:46:26,349 - __main__ - WARNING - 이는 프롬프트 길이를 크게 증가시킬 수 있습니다.
2025-10-20 14:46:26,349 - __main__ - WARNING - 성능을 위해 상위 100개만 사용합니다. (원본: 1301개)
2025-10-20 14:46:26,349 - __main__ - INFO - 최종 후보 엔티티 샘플 (최대 10개): ['(KTF)아이폰 16E', '(LGU)아이폰 16E', '0 청년 109(T 우주)', '0 청년 109(TVING)', '0 청년 109(tving)', '0 청년 109(스마트기기)', '0 청년 109(티빙)', '0 청년 37', '0 청년 37 DATA 충전 1GB', '0 청년 37 Data 충전 1GB']
2025-10-20 14:46:26,349 - __main__ - INFO - === 후보 엔티티 추출 완료 ===
2025-10-20 14:46:26,349 - __main__ - INFO - 🔍 프롬프트에 추가될 엔티티 섹션 길이: 1,715 문자
2025-10-20 14:46:26,349 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 4,947 문자
2025-10-20 14:46:26,349 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-10-20 14:46:26,349 - __main__ - INFO - 📝 프롬프트 길이: 4,947 문자
2025-10-20 14:46:26,349 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-10-20 14:46:26,349 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-10-20 14:46:26,349 - __main__ - INFO - 🔄 1개 LLM 모델로 엔티티 추출 시작
2025-10-20 14:46:26,349 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-20 14:46:26,349 - __main__ - INFO - 🔍 프롬프트 구성 중 - LLM 모델: client=<openai.resources.chat.completions.completions.Completions object at 0x16269ba10> async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x162d570e0> root_client=<openai.OpenAI object at 0x162d7db80> root_async_client=<openai.AsyncOpenAI object at 0x162d540b0> model_name='skt/ax4' temperature=0.0 model_kwargs={} openai_api_key=SecretStr('**********') openai_api_base='https://api.platform.a15t.com/v1' max_tokens=4000
2025-10-20 14:46:26,349 - __main__ - INFO - 🔍 후보 엔티티 개수: 100개
2025-10-20 14:46:26,349 - __main__ - INFO - 🔍 후보 엔티티 문자열 길이: 1,552 문자
2025-10-20 14:46:26,350 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-20 14:46:26,350 - __main__ - INFO - 🔍 메시지 길이: 815 문자
2025-10-20 14:46:26,350 - __main__ - INFO - 🔍 예상 전체 프롬프트 길이: 4,815 문자
2025-10-20 14:46:27,764 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 14:46:27,767 - __main__ - INFO - ✅ LLM 추출 완료: ['[크레앙] 3in1 무선 충전 살균기', '[사죠영] 죠르디 한정판 기프트', '[에이프릴스톤] 보조배터리+멀티백', '[프리디] 멀티 무선 충전기', '아이폰 12 Pro', 'T다이렉트샵', '아이폰 12']
2025-10-20 14:46:28,177 - __main__ - INFO - extract_entities_by_llm 실행완료: 3.42초
2025-10-20 14:46:28,183 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 14:46:28,183 - __main__ - INFO - ============================================================
2025-10-20 14:46:28,183 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 14:46:28,183 - __main__ - INFO - ============================================================
2025-10-20 14:46:28,183 - __main__ - INFO - 제목: [SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
2025-10-20 14:46:28,183 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내']
2025-10-20 14:46:28,183 - __main__ - INFO - 상품 수: 2개
2025-10-20 14:46:28,183 - __main__ - INFO - 채널 수: 4개
2025-10-20 14:46:28,183 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 14:46:28,183 - __main__ - INFO - process_message 실행완료: 18.56초
2025-10-20 14:46:28,183 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 14:47:52,124 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 14:47:52,124 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 14:47:52,124 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 14:47:52,124 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 14:47:52,124 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 14:47:52,126 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 14:47:52,175 - __main__ - INFO - Using device: mps
2025-10-20 14:47:52,175 - __main__ - INFO - _initialize_device 실행완료: 0.05초
2025-10-20 14:47:52,175 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 14:47:52,176 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 14:47:52,176 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 14:47:52,176 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 14:47:52,176 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 14:47:52,176 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 14:47:52,176 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 14:47:52,439 - __main__ - INFO - Model loaded on mps
2025-10-20 14:47:52,439 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.26초
2025-10-20 14:47:52,440 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 14:47:53,018 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 14:47:53,019 - __main__ - INFO - _initialize_kiwi 실행완료: 0.58초
2025-10-20 14:47:53,019 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 14:47:53,019 - __main__ - INFO - ============================================================
2025-10-20 14:47:53,019 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 14:47:53,019 - __main__ - INFO - ============================================================
2025-10-20 14:47:53,019 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 14:47:53,019 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 14:47:53,019 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 14:47:53,019 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 14:47:53,019 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:47:53,181 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 14:47:53,181 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:47:53,181 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 14:47:53,189 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 14:47:53,190 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 14:47:53,191 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:47:53,191 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:47:53,192 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 14:47:53,192 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 14:47:53,193 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 14:47:53,197 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 14:47:53,197 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 14:47:53,197 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:47:53,197 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 14:47:53,197 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 14:47:53,197 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 14:47:53,197 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:47:53,197 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 14:47:53,197 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 14:47:53,197 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 14:47:53,199 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 14:47:53,199 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 14:47:53,199 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:47:53,199 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 14:47:53,200 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:47:53,420 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 14:47:53,431 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 14:47:53,431 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 Netflix 인증', '우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증']
2025-10-20 14:47:53,431 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 14:47:53,432 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 14:47:53,432 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 14:47:53,433 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 14:47:53,433 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 14:47:53,433 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 14:47:53,433 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 14:47:53,434 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 14:47:53,436 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 14:47:53,436 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 Netflix 인증', '우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증']
2025-10-20 14:47:53,456 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 14:47:53,456 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 14:47:53,456 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 14:47:53,458 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 14:47:53,458 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 14:47:53,732 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 14:47:53,732 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 14:47:53,732 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 14:47:53,732 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 14:47:53,732 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 14:47:53,732 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:47:53,819 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 14:47:53,819 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:47:53,821 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 14:47:53,822 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 14:47:53,822 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 14:47:53,822 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:47:53,822 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 14:47:53,823 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 14:47:53,823 - __main__ - INFO - ============================================================
2025-10-20 14:47:53,823 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 14:47:53,823 - __main__ - INFO - ============================================================
2025-10-20 14:47:53,823 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 14:47:53,823 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 14:47:53,823 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 14:47:53,823 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 14:47:53,823 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 14:47:53,824 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 14:47:53,826 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 14:47:53,827 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 14:47:53,828 - __main__ - INFO - _load_data 실행완료: 0.81초
2025-10-20 14:47:53,828 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 14:47:53,828 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 14:47:53,828 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
(광고)[SKT] 아...
2025-10-20 14:47:53,828 - __main__ - INFO - ============================================================
2025-10-20 14:47:53,828 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 14:47:53,828 - __main__ - INFO - ============================================================
2025-10-20 14:47:53,828 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
(광고)[SKT] 아이폰 12/12 Pro 사전예약 안내  #04 고객님, 안녕하세요. 최고의 스마트폰 칩과 카메라, 견고한 세라믹 실드에 5G 기술까지! 이 모든 것을 갖춘 아이폰 12/12 Pro를 만나 보세요.  ▶ 혜택받고 사전예약하기: http://t-mms.kr/t.do?m=#...
2025-10-20 14:47:53,828 - __main__ - INFO - 메시지 길이: 822 문자
2025-10-20 14:47:53,828 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 14:47:53,828 - __main__ - INFO - 데이터 소스: local
2025-10-20 14:47:53,828 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 14:47:53,828 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-20 14:47:53,828 - __main__ - INFO - LLM 모델: ax
2025-10-20 14:47:53,828 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 14:47:53,828 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 14:47:53,828 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 14:47:53,828 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 14:47:53,828 - __main__ - INFO - 처리할 메시지 길이: 815 문자
2025-10-20 14:47:53,829 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 14:47:54,501 - __main__ - INFO - 분할된 문장 수: 9개
2025-10-20 14:47:54,503 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 반가워요', '5G 아이폰 Pro 사전예약 안내 광고 SKT 아이폰 Pro 사전예약 안내 고객님 안녕하세요 ', '최고의 스마트폰 칩과 카메라 견고 세라믹 실드에 5G 기술까지 ']...
2025-10-20 14:47:54,510 - __main__ - INFO - 전체 토큰 수: 310개
2025-10-20 14:47:54,510 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '아이폰', '아이폰', '실드', '아이폰', '아이폰', '스펙', '아이폰', '스마트폰', '택1', '사죠영', '죠르디', '한정판', '기프트', '프리디', '충전기', '에이프릴', '스톤', '충전', '기프트', '.', '카카오톡', '코로나']
2025-10-20 14:47:54,511 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['카카오톡', '코로나', '기프트', '실드', '스톤', '에이프릴', '택1', '죠르디', '한정판', '스펙', '충전기', '아이폰', '사죠영', '프리디']
2025-10-20 14:47:54,511 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 14:47:55,461 - __main__ - INFO - 퍼지 매칭 결과 크기: (2116, 3)
2025-10-20 14:47:55,461 - __main__ - INFO - 퍼지 매칭 성공: 2116개 결과
2025-10-20 14:47:55,462 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.4285714285714286}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.4}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.4}]
2025-10-20 14:47:55,462 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 14:47:55,633 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2116, 3)
2025-10-20 14:47:55,634 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.18461538461538463}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.15000000000000002}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.15000000000000002}]
2025-10-20 14:47:55,634 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 14:47:55,637 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 11개
2025-10-20 14:47:55,639 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 14:47:55,640 - __main__ - INFO - 통합된 후보 아이템 수: 11개
2025-10-20 14:47:55,642 - __main__ - INFO - 최종 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:47:55,646 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (10, 2)
2025-10-20 14:47:55,646 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}, {'item_nm': 'IPHONE 16 PRO', 'item_id': ['A5XE', 'A643', 'A5XN', 'A64C', 'A647', 'A63Y', 'A5XJ', 'A5X9']}]
2025-10-20 14:47:55,646 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.82초
2025-10-20 14:47:55,646 - __main__ - INFO - 추출된 후보 엔티티: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:47:55,646 - __main__ - INFO - 매칭된 상품 정보: (10, 2)
2025-10-20 14:47:55,646 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 14:47:55,802 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 14:47:55,802 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 14:47:55,802 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 400 문자
2025-10-20 14:47:55,802 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 14:47:55,802 - __main__ - INFO - 후보 아이템 리스트 크기: 11개
2025-10-20 14:47:55,802 - __main__ - INFO - 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:47:55,802 - __main__ - INFO - extra_item_pdf 크기: (10, 2)
2025-10-20 14:47:55,802 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 14:47:55,802 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}]
2025-10-20 14:47:55,802 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 14:47:55,802 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 14:47:55,802 - __main__ - INFO - 구성된 프롬프트 길이: 6734 문자
2025-10-20 14:47:55,802 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 14:47:55,803 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 14:47:55,803 - __main__ - INFO - 📝 프롬프트 길이: 6,734 문자
2025-10-20 14:47:55,803 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 14:47:55,803 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 14:48:07,608 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 14:48:07,620 - __main__ - INFO - LLM 응답 길이: 1746 문자
2025-10-20 14:48:07,621 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내"
    ],
    "product": [
        {
            "name": "아이폰 12",
            "action": "구매"
        },
        {
            "name": "아이폰 12 Pro",
            "action": "구매"
        },
        {
            "name": "아이폰 17",
            "action": "구매"
        },
        {
            "name": "아이폰 17 Pro",
            "action": "구매"
        },
        {
            "name": "5G",
   ...
2025-10-20 14:48:07,621 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 14:48:07,621 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 14:48:07,622 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 14:48:07,622 - __main__ - INFO - 파싱된 JSON 내용: {'title': '[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내', 'purpose': ['상품 가입 유도', '혜택 안내'], 'product': [{'name': '아이폰 12', 'action': '구매'}, {'name': '아이폰 12 Pro', 'action': '구매'}, {'name': '아이폰 17', 'action': '구매'}, {'name': '아이폰 17 Pro', 'action': '구매'}, {'name': '5G', 'action': '사용'}, {'name': 'A14 Bionic 칩', 'action': '사용'}, {'name': '세라믹 실드', 'action': '사용'}, {'name': 'Dolby Vision 영상 카메라', 'action': '사용'}, {'name': '죠르디 한정판 기프트', 'action': '기타'}, {'name': '멀티 무선 충전기', 'action': '기타'}, {'name': '보조배터리+멀티백', 'action': '기타'}, {'name': '3in1 무선 충전 살균기', 'action': '기타'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/2HeWcdx', 'action': '추가 정보'}, {'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/3o7zOnA', 'action': '추가 정보'}, {'type': '전화번호', 'value': '1558', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['상품및부가서비스가입유도_단말', '사용법/혜택/이벤트안내_단말']}
2025-10-20 14:48:07,622 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 14:48:07,622 - __main__ - INFO - LLM 추출 엔티티: ['아이폰 12', '아이폰 12 Pro', '아이폰 17', '아이폰 17 Pro', '5G', 'A14 Bionic 칩', '세라믹 실드', 'Dolby Vision 영상 카메라', '죠르디 한정판 기프트', '멀티 무선 충전기', '보조배터리+멀티백', '3in1 무선 충전 살균기']
2025-10-20 14:48:07,623 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-10-20 14:48:07,623 - __main__ - INFO - === 후보 엔티티 추출 시작 ===
2025-10-20 14:48:07,623 - __main__ - INFO - 퍼지 매칭 임계값: 0.4
2025-10-20 14:48:09,219 - __main__ - INFO - 로직 기반 추출 원본 엔티티 수: 1306개
2025-10-20 14:48:09,220 - __main__ - INFO - 원본 엔티티 샘플 (최대 10개): ['(KTF)아이폰 16E', '(LGU)아이폰 16E', '0 청년 109(T 우주)', '0 청년 109(TVING)', '0 청년 109(tving)', '0 청년 109(스마트기기)', '0 청년 109(티빙)', '0 청년 37', '0 청년 37 DATA 충전 1GB', '0 청년 37 Data 충전 1GB']
2025-10-20 14:48:09,221 - __main__ - INFO - 필터링 후 엔티티 수: 1301개
2025-10-20 14:48:09,221 - __main__ - INFO - 제거된 엔티티 수: 5개
2025-10-20 14:48:09,221 - __main__ - INFO - 최종 후보 엔티티 수: 1301개
2025-10-20 14:48:09,221 - __main__ - WARNING - ⚠️ 후보 엔티티가 매우 많습니다: 1301개
2025-10-20 14:48:09,222 - __main__ - WARNING - 이는 프롬프트 길이를 크게 증가시킬 수 있습니다.
2025-10-20 14:48:09,222 - __main__ - WARNING - 성능을 위해 상위 100개만 사용합니다. (원본: 1301개)
2025-10-20 14:48:09,222 - __main__ - INFO - 최종 후보 엔티티 샘플 (최대 10개): ['(KTF)아이폰 16E', '(LGU)아이폰 16E', '0 청년 109(T 우주)', '0 청년 109(TVING)', '0 청년 109(tving)', '0 청년 109(스마트기기)', '0 청년 109(티빙)', '0 청년 37', '0 청년 37 DATA 충전 1GB', '0 청년 37 Data 충전 1GB']
2025-10-20 14:48:09,222 - __main__ - INFO - === 후보 엔티티 추출 완료 ===
2025-10-20 14:48:09,222 - __main__ - INFO - 🔍 프롬프트에 추가될 엔티티 섹션 길이: 1,715 문자
2025-10-20 14:48:09,222 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 4,947 문자
2025-10-20 14:48:09,222 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-10-20 14:48:09,222 - __main__ - INFO - 📝 프롬프트 길이: 4,947 문자
2025-10-20 14:48:09,222 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-10-20 14:48:09,222 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-10-20 14:48:09,222 - __main__ - INFO - 🔄 1개 LLM 모델로 엔티티 추출 시작
2025-10-20 14:48:09,222 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-20 14:48:09,222 - __main__ - INFO - 🔍 프롬프트 구성 중 - LLM 모델: client=<openai.resources.chat.completions.completions.Completions object at 0x15c6cd8b0> async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x166cc8470> root_client=<openai.OpenAI object at 0x15c6cde20> root_async_client=<openai.AsyncOpenAI object at 0x15c6cd490> model_name='skt/ax4' temperature=0.0 model_kwargs={} openai_api_key=SecretStr('**********') openai_api_base='https://api.platform.a15t.com/v1' max_tokens=4000
2025-10-20 14:48:09,222 - __main__ - INFO - 🔍 후보 엔티티 개수: 100개
2025-10-20 14:48:09,222 - __main__ - INFO - 🔍 후보 엔티티 문자열 길이: 1,552 문자
2025-10-20 14:48:09,222 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-20 14:48:09,223 - __main__ - INFO - 🔍 메시지 길이: 815 문자
2025-10-20 14:48:09,223 - __main__ - INFO - 🔍 예상 전체 프롬프트 길이: 4,815 문자
2025-10-20 14:48:10,640 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 14:48:10,641 - __main__ - INFO - ✅ LLM 추출 완료: ['[크레앙] 3in1 무선 충전 살균기', '아이폰 12 Pro', '[프리디] 멀티 무선 충전기', '아이폰 12', 'T다이렉트샵', '[사죠영] 죠르디 한정판 기프트', '[에이프릴스톤] 보조배터리+멀티백']
2025-10-20 14:48:11,031 - __main__ - INFO - extract_entities_by_llm 실행완료: 3.41초
2025-10-20 14:48:11,037 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 14:48:11,037 - __main__ - INFO - ============================================================
2025-10-20 14:48:11,037 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 14:48:11,037 - __main__ - INFO - ============================================================
2025-10-20 14:48:11,037 - __main__ - INFO - 제목: [SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
2025-10-20 14:48:11,037 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내']
2025-10-20 14:48:11,037 - __main__ - INFO - 상품 수: 2개
2025-10-20 14:48:11,037 - __main__ - INFO - 채널 수: 4개
2025-10-20 14:48:11,037 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 14:48:11,037 - __main__ - INFO - process_message 실행완료: 17.21초
2025-10-20 14:48:11,037 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 14:48:34,630 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 14:48:34,634 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 14:48:34,634 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 14:48:34,634 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 14:48:34,634 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 14:48:34,636 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 14:48:34,671 - __main__ - INFO - Using device: mps
2025-10-20 14:48:34,671 - __main__ - INFO - _initialize_device 실행완료: 0.03초
2025-10-20 14:48:34,671 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 14:48:34,671 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 14:48:34,671 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 14:48:34,671 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 14:48:34,671 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 14:48:34,672 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 14:48:34,672 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 14:48:34,972 - __main__ - INFO - Model loaded on mps
2025-10-20 14:48:34,972 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.30초
2025-10-20 14:48:34,972 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 14:48:35,553 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 14:48:35,554 - __main__ - INFO - _initialize_kiwi 실행완료: 0.58초
2025-10-20 14:48:35,554 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 14:48:35,554 - __main__ - INFO - ============================================================
2025-10-20 14:48:35,554 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 14:48:35,554 - __main__ - INFO - ============================================================
2025-10-20 14:48:35,554 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 14:48:35,554 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 14:48:35,554 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 14:48:35,554 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 14:48:35,554 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:48:35,703 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 14:48:35,703 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:48:35,703 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 14:48:35,711 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 14:48:35,712 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 14:48:35,713 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:48:35,713 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:48:35,714 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 14:48:35,714 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 14:48:35,715 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 14:48:35,720 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 14:48:35,720 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 14:48:35,720 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:48:35,720 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 14:48:35,720 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 14:48:35,721 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 14:48:35,721 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:48:35,721 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 14:48:35,721 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 14:48:35,721 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 14:48:35,723 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 14:48:35,723 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 14:48:35,723 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:48:35,723 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 14:48:35,724 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:48:35,947 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 14:48:35,959 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 14:48:35,959 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 Netflix 인증', '우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증']
2025-10-20 14:48:35,959 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 14:48:35,960 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 14:48:35,960 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 14:48:35,961 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 14:48:35,961 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 14:48:35,961 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 14:48:35,962 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 14:48:35,963 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 14:48:35,964 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 14:48:35,964 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 Netflix 인증', '우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증']
2025-10-20 14:48:35,986 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 14:48:35,986 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 14:48:35,986 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 14:48:35,987 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 14:48:35,987 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 14:48:36,253 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 14:48:36,254 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 14:48:36,254 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 14:48:36,254 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 14:48:36,254 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 14:48:36,254 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:48:36,348 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 14:48:36,348 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:48:36,351 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 14:48:36,351 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 14:48:36,351 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 14:48:36,351 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:48:36,351 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 14:48:36,352 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 14:48:36,352 - __main__ - INFO - ============================================================
2025-10-20 14:48:36,352 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 14:48:36,352 - __main__ - INFO - ============================================================
2025-10-20 14:48:36,352 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 14:48:36,352 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 14:48:36,352 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 14:48:36,352 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 14:48:36,352 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 14:48:36,353 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 14:48:36,355 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 14:48:36,357 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 14:48:36,357 - __main__ - INFO - _load_data 실행완료: 0.80초
2025-10-20 14:48:36,357 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 14:48:36,357 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 14:48:36,357 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
(광고)[SKT] 아...
2025-10-20 14:48:36,357 - __main__ - INFO - ============================================================
2025-10-20 14:48:36,357 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 14:48:36,358 - __main__ - INFO - ============================================================
2025-10-20 14:48:36,358 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
(광고)[SKT] 아이폰 12/12 Pro 사전예약 안내  #04 고객님, 안녕하세요. 최고의 스마트폰 칩과 카메라, 견고한 세라믹 실드에 5G 기술까지! 이 모든 것을 갖춘 아이폰 12/12 Pro를 만나 보세요.  ▶ 혜택받고 사전예약하기: http://t-mms.kr/t.do?m=#...
2025-10-20 14:48:36,358 - __main__ - INFO - 메시지 길이: 822 문자
2025-10-20 14:48:36,358 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 14:48:36,358 - __main__ - INFO - 데이터 소스: local
2025-10-20 14:48:36,358 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 14:48:36,358 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-20 14:48:36,358 - __main__ - INFO - LLM 모델: ax
2025-10-20 14:48:36,358 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 14:48:36,358 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 14:48:36,358 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 14:48:36,358 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 14:48:36,358 - __main__ - INFO - 처리할 메시지 길이: 815 문자
2025-10-20 14:48:36,359 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 14:48:37,032 - __main__ - INFO - 분할된 문장 수: 9개
2025-10-20 14:48:37,034 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 반가워요', '5G 아이폰 Pro 사전예약 안내 광고 SKT 아이폰 Pro 사전예약 안내 고객님 안녕하세요 ', '최고의 스마트폰 칩과 카메라 견고 세라믹 실드에 5G 기술까지 ']...
2025-10-20 14:48:37,041 - __main__ - INFO - 전체 토큰 수: 310개
2025-10-20 14:48:37,041 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '아이폰', '아이폰', '실드', '아이폰', '아이폰', '스펙', '아이폰', '스마트폰', '택1', '사죠영', '죠르디', '한정판', '기프트', '프리디', '충전기', '에이프릴', '스톤', '충전', '기프트', '.', '카카오톡', '코로나']
2025-10-20 14:48:37,041 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['죠르디', '택1', '충전기', '실드', '카카오톡', '에이프릴', '기프트', '스펙', '스톤', '사죠영', '아이폰', '한정판', '프리디', '코로나']
2025-10-20 14:48:37,041 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 14:48:38,008 - __main__ - INFO - 퍼지 매칭 결과 크기: (2116, 3)
2025-10-20 14:48:38,009 - __main__ - INFO - 퍼지 매칭 성공: 2116개 결과
2025-10-20 14:48:38,009 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.4285714285714286}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.4}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.4}]
2025-10-20 14:48:38,010 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 14:48:38,181 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2116, 3)
2025-10-20 14:48:38,182 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.18461538461538463}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.15000000000000002}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.15000000000000002}]
2025-10-20 14:48:38,182 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 14:48:38,185 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 11개
2025-10-20 14:48:38,187 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 14:48:38,188 - __main__ - INFO - 통합된 후보 아이템 수: 11개
2025-10-20 14:48:38,191 - __main__ - INFO - 최종 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:48:38,194 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (10, 2)
2025-10-20 14:48:38,194 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}, {'item_nm': 'IPHONE 16 PRO', 'item_id': ['A5XE', 'A643', 'A5XN', 'A64C', 'A647', 'A63Y', 'A5XJ', 'A5X9']}]
2025-10-20 14:48:38,195 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.84초
2025-10-20 14:48:38,195 - __main__ - INFO - 추출된 후보 엔티티: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:48:38,195 - __main__ - INFO - 매칭된 상품 정보: (10, 2)
2025-10-20 14:48:38,195 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 14:48:38,344 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 14:48:38,344 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 14:48:38,344 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 400 문자
2025-10-20 14:48:38,344 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 14:48:38,344 - __main__ - INFO - 후보 아이템 리스트 크기: 11개
2025-10-20 14:48:38,344 - __main__ - INFO - 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:48:38,344 - __main__ - INFO - extra_item_pdf 크기: (10, 2)
2025-10-20 14:48:38,344 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 14:48:38,345 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}]
2025-10-20 14:48:38,345 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 14:48:38,345 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 14:48:38,345 - __main__ - INFO - 구성된 프롬프트 길이: 6734 문자
2025-10-20 14:48:38,345 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 14:48:38,345 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 14:48:38,345 - __main__ - INFO - 📝 프롬프트 길이: 6,734 문자
2025-10-20 14:48:38,345 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 14:48:38,345 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 14:48:49,993 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 14:48:50,017 - __main__ - INFO - LLM 응답 길이: 1746 문자
2025-10-20 14:48:50,018 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내"
    ],
    "product": [
        {
            "name": "아이폰 12",
            "action": "구매"
        },
        {
            "name": "아이폰 12 Pro",
            "action": "구매"
        },
        {
            "name": "아이폰 17",
            "action": "구매"
        },
        {
            "name": "아이폰 17 Pro",
            "action": "구매"
        },
        {
            "name": "5G",
   ...
2025-10-20 14:48:50,018 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 14:48:50,019 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 14:48:50,019 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 14:48:50,019 - __main__ - INFO - 파싱된 JSON 내용: {'title': '[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내', 'purpose': ['상품 가입 유도', '혜택 안내'], 'product': [{'name': '아이폰 12', 'action': '구매'}, {'name': '아이폰 12 Pro', 'action': '구매'}, {'name': '아이폰 17', 'action': '구매'}, {'name': '아이폰 17 Pro', 'action': '구매'}, {'name': '5G', 'action': '사용'}, {'name': 'A14 Bionic 칩', 'action': '사용'}, {'name': '세라믹 실드', 'action': '사용'}, {'name': 'Dolby Vision 영상 카메라', 'action': '사용'}, {'name': '죠르디 한정판 기프트', 'action': '기타'}, {'name': '멀티 무선 충전기', 'action': '기타'}, {'name': '보조배터리+멀티백', 'action': '기타'}, {'name': '3in1 무선 충전 살균기', 'action': '기타'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/2HeWcdx', 'action': '추가 정보'}, {'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/3o7zOnA', 'action': '추가 정보'}, {'type': '전화번호', 'value': '1558', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['상품및부가서비스가입유도_단말', '사용법/혜택/이벤트안내_단말']}
2025-10-20 14:48:50,019 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 14:48:50,019 - __main__ - INFO - LLM 추출 엔티티: ['아이폰 12', '아이폰 12 Pro', '아이폰 17', '아이폰 17 Pro', '5G', 'A14 Bionic 칩', '세라믹 실드', 'Dolby Vision 영상 카메라', '죠르디 한정판 기프트', '멀티 무선 충전기', '보조배터리+멀티백', '3in1 무선 충전 살균기']
2025-10-20 14:48:50,020 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-10-20 14:48:50,020 - __main__ - INFO - === 후보 엔티티 추출 시작 ===
2025-10-20 14:48:50,020 - __main__ - INFO - 퍼지 매칭 임계값: 0.4
2025-10-20 14:48:51,606 - __main__ - INFO - 로직 기반 추출 원본 엔티티 수: 1306개
2025-10-20 14:48:51,607 - __main__ - INFO - 원본 엔티티 샘플 (최대 10개): ['(KTF)아이폰 16E', '(LGU)아이폰 16E', '0 청년 109(T 우주)', '0 청년 109(TVING)', '0 청년 109(tving)', '0 청년 109(스마트기기)', '0 청년 109(티빙)', '0 청년 37', '0 청년 37 DATA 충전 1GB', '0 청년 37 Data 충전 1GB']
2025-10-20 14:48:51,608 - __main__ - INFO - 필터링 후 엔티티 수: 1301개
2025-10-20 14:48:51,608 - __main__ - INFO - 제거된 엔티티 수: 5개
2025-10-20 14:48:51,608 - __main__ - INFO - 최종 후보 엔티티 수: 1301개
2025-10-20 14:48:51,608 - __main__ - WARNING - ⚠️ 후보 엔티티가 매우 많습니다: 1301개
2025-10-20 14:48:51,608 - __main__ - WARNING - 이는 프롬프트 길이를 크게 증가시킬 수 있습니다.
2025-10-20 14:48:51,608 - __main__ - WARNING - 성능을 위해 상위 100개만 사용합니다. (원본: 1301개)
2025-10-20 14:48:51,608 - __main__ - INFO - 최종 후보 엔티티 샘플 (최대 10개): ['(KTF)아이폰 16E', '(LGU)아이폰 16E', '0 청년 109(T 우주)', '0 청년 109(TVING)', '0 청년 109(tving)', '0 청년 109(스마트기기)', '0 청년 109(티빙)', '0 청년 37', '0 청년 37 DATA 충전 1GB', '0 청년 37 Data 충전 1GB']
2025-10-20 14:48:51,608 - __main__ - INFO - === 후보 엔티티 추출 완료 ===
2025-10-20 14:48:51,609 - __main__ - INFO - 🔍 프롬프트에 추가될 엔티티 섹션 길이: 1,715 문자
2025-10-20 14:48:51,609 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 4,947 문자
2025-10-20 14:48:51,609 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-10-20 14:48:51,609 - __main__ - INFO - 📝 프롬프트 길이: 4,947 문자
2025-10-20 14:48:51,609 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-10-20 14:48:51,609 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-10-20 14:48:51,609 - __main__ - INFO - 🔄 1개 LLM 모델로 엔티티 추출 시작
2025-10-20 14:48:51,609 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-20 14:48:51,609 - __main__ - INFO - 🔍 프롬프트 구성 중 - LLM 모델: client=<openai.resources.chat.completions.completions.Completions object at 0x1627f04d0> async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x1627f0620> root_client=<openai.OpenAI object at 0x16a232030> root_async_client=<openai.AsyncOpenAI object at 0x1627f2540> model_name='skt/ax4' temperature=0.0 model_kwargs={} openai_api_key=SecretStr('**********') openai_api_base='https://api.platform.a15t.com/v1' max_tokens=4000
2025-10-20 14:48:51,609 - __main__ - INFO - 🔍 후보 엔티티 개수: 100개
2025-10-20 14:48:51,609 - __main__ - INFO - 🔍 후보 엔티티 문자열 길이: 1,552 문자
2025-10-20 14:48:51,609 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-20 14:48:51,609 - __main__ - INFO - 🔍 메시지 길이: 815 문자
2025-10-20 14:48:51,609 - __main__ - INFO - 🔍 예상 전체 프롬프트 길이: 4,815 문자
2025-10-20 14:48:52,974 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 14:48:52,978 - __main__ - INFO - ✅ LLM 추출 완료: ['[프리디] 멀티 무선 충전기', '[사죠영] 죠르디 한정판 기프트', '아이폰 12', 'T다이렉트샵', '아이폰 12 Pro', '[크레앙] 3in1 무선 충전 살균기', '[에이프릴스톤] 보조배터리+멀티백']
2025-10-20 14:48:53,371 - __main__ - INFO - extract_entities_by_llm 실행완료: 3.35초
2025-10-20 14:48:53,377 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 14:48:53,377 - __main__ - INFO - ============================================================
2025-10-20 14:48:53,377 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 14:48:53,377 - __main__ - INFO - ============================================================
2025-10-20 14:48:53,377 - __main__ - INFO - 제목: [SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
2025-10-20 14:48:53,377 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내']
2025-10-20 14:48:53,377 - __main__ - INFO - 상품 수: 2개
2025-10-20 14:48:53,377 - __main__ - INFO - 채널 수: 4개
2025-10-20 14:48:53,377 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 14:48:53,378 - __main__ - INFO - process_message 실행완료: 17.02초
2025-10-20 14:48:53,378 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 14:49:36,241 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 14:49:36,241 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 14:49:36,241 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 14:49:36,241 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 14:49:36,241 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 14:49:36,243 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 14:49:36,281 - __main__ - INFO - Using device: mps
2025-10-20 14:49:36,281 - __main__ - INFO - _initialize_device 실행완료: 0.04초
2025-10-20 14:49:36,281 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 14:49:36,281 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 14:49:36,281 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 14:49:36,281 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 14:49:36,281 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 14:49:36,282 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 14:49:36,282 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 14:49:36,582 - __main__ - INFO - Model loaded on mps
2025-10-20 14:49:36,582 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.30초
2025-10-20 14:49:36,582 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 14:49:37,165 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 14:49:37,165 - __main__ - INFO - _initialize_kiwi 실행완료: 0.58초
2025-10-20 14:49:37,165 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 14:49:37,165 - __main__ - INFO - ============================================================
2025-10-20 14:49:37,165 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 14:49:37,165 - __main__ - INFO - ============================================================
2025-10-20 14:49:37,165 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 14:49:37,165 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 14:49:37,165 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 14:49:37,165 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 14:49:37,165 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:49:37,332 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 14:49:37,332 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:49:37,332 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 14:49:37,340 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 14:49:37,341 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 14:49:37,342 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:49:37,342 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:49:37,343 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 14:49:37,343 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 14:49:37,344 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 14:49:37,348 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 14:49:37,348 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 14:49:37,349 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:49:37,349 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 14:49:37,349 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 14:49:37,349 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 14:49:37,349 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:49:37,349 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 14:49:37,349 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 14:49:37,349 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 14:49:37,351 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 14:49:37,351 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 14:49:37,351 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:49:37,351 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 14:49:37,352 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:49:37,582 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 14:49:37,592 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 14:49:37,593 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 Netflix 인증', '우주pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 넷플릭스 인증', '우주Pass Netflix 인증']
2025-10-20 14:49:37,593 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 14:49:37,594 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 14:49:37,594 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 14:49:37,595 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 14:49:37,595 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 14:49:37,595 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 14:49:37,595 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 14:49:37,596 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 14:49:37,598 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 14:49:37,598 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 Netflix 인증', '우주pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 넷플릭스 인증', '우주Pass Netflix 인증']
2025-10-20 14:49:37,619 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 14:49:37,619 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 14:49:37,619 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 14:49:37,621 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 14:49:37,621 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 14:49:37,868 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 14:49:37,868 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 14:49:37,868 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 14:49:37,868 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 14:49:37,868 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 14:49:37,868 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:49:37,954 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 14:49:37,954 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:49:37,956 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 14:49:37,957 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 14:49:37,957 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 14:49:37,957 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:49:37,957 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 14:49:37,958 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 14:49:37,958 - __main__ - INFO - ============================================================
2025-10-20 14:49:37,958 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 14:49:37,958 - __main__ - INFO - ============================================================
2025-10-20 14:49:37,958 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 14:49:37,958 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 14:49:37,958 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 14:49:37,958 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 14:49:37,958 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 14:49:37,959 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 14:49:37,961 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 14:49:37,963 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 14:49:37,963 - __main__ - INFO - _load_data 실행완료: 0.80초
2025-10-20 14:49:37,963 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 14:49:37,964 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 14:49:37,964 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내
(광고)[SKT] ...
2025-10-20 14:49:37,964 - __main__ - INFO - ============================================================
2025-10-20 14:49:37,964 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 14:49:37,964 - __main__ - INFO - ============================================================
2025-10-20 14:49:37,964 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내
(광고)[SKT] 아이폰 12/12 Pro 사전예약 안내  #04 고객님, 안녕하세요. 최고의 스마트폰 칩과 카메라, 견고한 세라믹 실드에 5G 기술까지! 이 모든 것을 갖춘 아이폰 12/12 Pro를 만나 보세요.  ▶ 혜택받고 사전예약하기: http://t-mms.kr/t.do?m=...
2025-10-20 14:49:37,964 - __main__ - INFO - 메시지 길이: 823 문자
2025-10-20 14:49:37,964 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 14:49:37,964 - __main__ - INFO - 데이터 소스: local
2025-10-20 14:49:37,964 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 14:49:37,964 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-20 14:49:37,964 - __main__ - INFO - LLM 모델: ax
2025-10-20 14:49:37,964 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 14:49:37,964 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 14:49:37,964 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 14:49:37,964 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 14:49:37,964 - __main__ - INFO - 처리할 메시지 길이: 816 문자
2025-10-20 14:49:37,965 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 14:49:38,639 - __main__ - INFO - 분할된 문장 수: 9개
2025-10-20 14:49:38,641 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 반가워요', '5G 아이폰 Pro 사전예약 안내 광고 SKT 아이폰 Pro 사전예약 안내 고객님 안녕하세요 ', '최고의 스마트폰 칩과 카메라 견고 세라믹 실드에 5G 기술까지 ']...
2025-10-20 14:49:38,648 - __main__ - INFO - 전체 토큰 수: 310개
2025-10-20 14:49:38,648 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '아이폰', '아이폰', '실드', '아이폰', '아이폰', '스펙', '아이폰', '스마트폰', '택1', '사죠영', '죠르디', '한정판', '기프트', '프리디', '충전기', '에이프릴', '스톤', '충전', '기프트', '.', '카카오톡', '코로나']
2025-10-20 14:49:38,648 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['카카오톡', '택1', '죠르디', '아이폰', '스톤', '한정판', '사죠영', '스펙', '프리디', '실드', '기프트', '코로나', '에이프릴', '충전기']
2025-10-20 14:49:38,648 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 14:49:39,609 - __main__ - INFO - 퍼지 매칭 결과 크기: (2116, 3)
2025-10-20 14:49:39,610 - __main__ - INFO - 퍼지 매칭 성공: 2116개 결과
2025-10-20 14:49:39,611 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.4285714285714286}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.4}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.4}]
2025-10-20 14:49:39,611 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 14:49:39,782 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2116, 3)
2025-10-20 14:49:39,783 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.18461538461538463}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.15000000000000002}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.15000000000000002}]
2025-10-20 14:49:39,783 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 14:49:39,786 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 11개
2025-10-20 14:49:39,788 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 14:49:39,788 - __main__ - INFO - 통합된 후보 아이템 수: 11개
2025-10-20 14:49:39,792 - __main__ - INFO - 최종 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:49:39,795 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (10, 2)
2025-10-20 14:49:39,795 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}, {'item_nm': 'IPHONE 16 PRO', 'item_id': ['A5XE', 'A643', 'A5XN', 'A64C', 'A647', 'A63Y', 'A5XJ', 'A5X9']}]
2025-10-20 14:49:39,795 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.83초
2025-10-20 14:49:39,796 - __main__ - INFO - 추출된 후보 엔티티: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:49:39,796 - __main__ - INFO - 매칭된 상품 정보: (10, 2)
2025-10-20 14:49:39,796 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 14:49:39,950 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 14:49:39,950 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 14:49:39,950 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 400 문자
2025-10-20 14:49:39,950 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 14:49:39,950 - __main__ - INFO - 후보 아이템 리스트 크기: 11개
2025-10-20 14:49:39,951 - __main__ - INFO - 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:49:39,951 - __main__ - INFO - extra_item_pdf 크기: (10, 2)
2025-10-20 14:49:39,951 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 14:49:39,951 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}]
2025-10-20 14:49:39,951 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 14:49:39,951 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 14:49:39,951 - __main__ - INFO - 구성된 프롬프트 길이: 6735 문자
2025-10-20 14:49:39,951 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 14:49:39,951 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 14:49:39,951 - __main__ - INFO - 📝 프롬프트 길이: 6,735 문자
2025-10-20 14:49:39,951 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 14:49:39,951 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 14:49:52,939 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 14:49:52,963 - __main__ - INFO - LLM 응답 길이: 1853 문자
2025-10-20 14:49:52,963 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내"
    ],
    "product": [
        {
            "name": "아이폰 17",
            "action": "구매"
        },
        {
            "name": "아이폰 17 Pro",
            "action": "구매"
        },
        {
            "name": "아이폰 12",
            "action": "구매"
        },
        {
            "name": "아이폰 12 Pro",
            "action": "구매"
        },
        {
            "name": "5G",
  ...
2025-10-20 14:49:52,963 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 14:49:52,965 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 14:49:52,965 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 14:49:52,965 - __main__ - INFO - 파싱된 JSON 내용: {'title': '[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내', 'purpose': ['상품 가입 유도', '혜택 안내'], 'product': [{'name': '아이폰 17', 'action': '구매'}, {'name': '아이폰 17 Pro', 'action': '구매'}, {'name': '아이폰 12', 'action': '구매'}, {'name': '아이폰 12 Pro', 'action': '구매'}, {'name': '5G', 'action': '사용'}, {'name': 'A14 Bionic 칩', 'action': '사용'}, {'name': '세라믹 실드', 'action': '사용'}, {'name': '카메라 시스템', 'action': '사용'}, {'name': 'Dolby Vision 영상 카메라', 'action': '사용'}, {'name': '[사죠영] 죠르디 한정판 기프트', 'action': '기타'}, {'name': '[프리디] 멀티 무선 충전기', 'action': '기타'}, {'name': '[에이프릴스톤] 보조배터리+멀티백', 'action': '기타'}, {'name': '[크레앙] 3in1 무선 충전 살균기', 'action': '기타'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/2HeWcdx', 'action': '추가 정보'}, {'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/3o7zOnA', 'action': '추가 정보'}, {'type': '전화번호', 'value': '1558', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['상품및부가서비스가입유도_단말', '사용법/혜택/이벤트안내_단말']}
2025-10-20 14:49:52,965 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 14:49:52,965 - __main__ - INFO - LLM 추출 엔티티: ['아이폰 17', '아이폰 17 Pro', '아이폰 12', '아이폰 12 Pro', '5G', 'A14 Bionic 칩', '세라믹 실드', '카메라 시스템', 'Dolby Vision 영상 카메라', '[사죠영] 죠르디 한정판 기프트', '[프리디] 멀티 무선 충전기', '[에이프릴스톤] 보조배터리+멀티백', '[크레앙] 3in1 무선 충전 살균기']
2025-10-20 14:49:52,966 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-10-20 14:49:52,966 - __main__ - INFO - === 후보 엔티티 추출 시작 ===
2025-10-20 14:49:52,966 - __main__ - INFO - 퍼지 매칭 임계값: 0.4
2025-10-20 14:49:54,583 - __main__ - INFO - 로직 기반 추출 원본 엔티티 수: 1308개
2025-10-20 14:49:54,584 - __main__ - INFO - 원본 엔티티 샘플 (최대 10개): ['(KTF)아이폰 16E', '(LGU)아이폰 16E', '0 청년 109(T 우주)', '0 청년 109(TVING)', '0 청년 109(tving)', '0 청년 109(스마트기기)', '0 청년 109(티빙)', '0 청년 37', '0 청년 37 DATA 충전 1GB', '0 청년 37 Data 충전 1GB']
2025-10-20 14:49:54,585 - __main__ - INFO - 필터링 후 엔티티 수: 1303개
2025-10-20 14:49:54,585 - __main__ - INFO - 제거된 엔티티 수: 5개
2025-10-20 14:49:54,585 - __main__ - INFO - 최종 후보 엔티티 수: 1303개
2025-10-20 14:49:54,585 - __main__ - WARNING - ⚠️ 후보 엔티티가 매우 많습니다: 1303개
2025-10-20 14:49:54,585 - __main__ - WARNING - 이는 프롬프트 길이를 크게 증가시킬 수 있습니다.
2025-10-20 14:49:54,585 - __main__ - WARNING - 성능을 위해 상위 100개만 사용합니다. (원본: 1303개)
2025-10-20 14:49:54,585 - __main__ - INFO - 최종 후보 엔티티 샘플 (최대 10개): ['(KTF)아이폰 16E', '(LGU)아이폰 16E', '0 청년 109(T 우주)', '0 청년 109(TVING)', '0 청년 109(tving)', '0 청년 109(스마트기기)', '0 청년 109(티빙)', '0 청년 37', '0 청년 37 DATA 충전 1GB', '0 청년 37 Data 충전 1GB']
2025-10-20 14:49:54,586 - __main__ - INFO - === 후보 엔티티 추출 완료 ===
2025-10-20 14:49:54,586 - __main__ - INFO - 🔍 프롬프트에 추가될 엔티티 섹션 길이: 1,723 문자
2025-10-20 14:49:54,586 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 4,956 문자
2025-10-20 14:49:54,586 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-10-20 14:49:54,586 - __main__ - INFO - 📝 프롬프트 길이: 4,956 문자
2025-10-20 14:49:54,586 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-10-20 14:49:54,586 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-10-20 14:49:54,586 - __main__ - INFO - 🔄 1개 LLM 모델로 엔티티 추출 시작
2025-10-20 14:49:54,586 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-20 14:49:54,586 - __main__ - INFO - 🔍 프롬프트 구성 중 - LLM 모델: client=<openai.resources.chat.completions.completions.Completions object at 0x1628ec440> async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x16a9752b0> root_client=<openai.OpenAI object at 0x160329b20> root_async_client=<openai.AsyncOpenAI object at 0x16a975c70> model_name='skt/ax4' temperature=0.0 model_kwargs={} openai_api_key=SecretStr('**********') openai_api_base='https://api.platform.a15t.com/v1' max_tokens=4000
2025-10-20 14:49:54,586 - __main__ - INFO - 🔍 후보 엔티티 개수: 100개
2025-10-20 14:49:54,586 - __main__ - INFO - 🔍 후보 엔티티 문자열 길이: 1,560 문자
2025-10-20 14:49:54,586 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-20 14:49:54,586 - __main__ - INFO - 🔍 메시지 길이: 816 문자
2025-10-20 14:49:54,586 - __main__ - INFO - 🔍 예상 전체 프롬프트 길이: 4,824 문자
2025-10-20 14:49:55,597 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 14:49:55,600 - __main__ - INFO - ✅ LLM 추출 완료: ['SKT 고객센터', 'T다이렉트샵 카카오톡 상담', 'T다이렉트샵', 'T기프트', '아이폰 12', '아이폰 12 Pro']
2025-10-20 14:49:55,959 - __main__ - INFO - extract_entities_by_llm 실행완료: 2.99초
2025-10-20 14:49:55,960 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 14:49:55,960 - __main__ - INFO - ============================================================
2025-10-20 14:49:55,960 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 14:49:55,960 - __main__ - INFO - ============================================================
2025-10-20 14:49:55,960 - __main__ - INFO - 제목: [SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내
2025-10-20 14:49:55,961 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내']
2025-10-20 14:49:55,961 - __main__ - INFO - 상품 수: 13개
2025-10-20 14:49:55,961 - __main__ - INFO - 채널 수: 4개
2025-10-20 14:49:55,961 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 14:49:55,961 - __main__ - INFO - process_message 실행완료: 18.00초
2025-10-20 14:49:55,961 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 14:50:43,796 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 14:50:43,796 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 14:50:43,796 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 14:50:43,796 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 14:50:43,796 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 14:50:43,798 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 14:50:43,836 - __main__ - INFO - Using device: mps
2025-10-20 14:50:43,836 - __main__ - INFO - _initialize_device 실행완료: 0.04초
2025-10-20 14:50:43,836 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 14:50:43,836 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 14:50:43,836 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 14:50:43,837 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 14:50:43,837 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 14:50:43,837 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 14:50:43,837 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 14:50:44,101 - __main__ - INFO - Model loaded on mps
2025-10-20 14:50:44,101 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.26초
2025-10-20 14:50:44,101 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 14:50:44,699 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 14:50:44,699 - __main__ - INFO - _initialize_kiwi 실행완료: 0.60초
2025-10-20 14:50:44,699 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 14:50:44,699 - __main__ - INFO - ============================================================
2025-10-20 14:50:44,699 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 14:50:44,699 - __main__ - INFO - ============================================================
2025-10-20 14:50:44,699 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 14:50:44,699 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 14:50:44,699 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 14:50:44,699 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 14:50:44,699 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:50:44,857 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 14:50:44,857 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:50:44,857 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 14:50:44,864 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 14:50:44,865 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 14:50:44,866 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:50:44,866 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:50:44,867 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 14:50:44,867 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 14:50:44,869 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 14:50:44,873 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 14:50:44,873 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 14:50:44,873 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:50:44,873 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 14:50:44,873 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 14:50:44,874 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 14:50:44,874 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:50:44,874 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 14:50:44,874 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 14:50:44,874 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 14:50:44,875 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 14:50:44,876 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 14:50:44,876 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:50:44,876 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 14:50:44,877 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:50:45,103 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 14:50:45,113 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 14:50:45,114 - __main__ - INFO - 별칭 적용 후 샘플: ['우주pass Netflix 인증', '우주패스 Netflix 인증', '우주패스 넷플릭스 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증']
2025-10-20 14:50:45,114 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 14:50:45,115 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 14:50:45,115 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 14:50:45,116 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 14:50:45,116 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 14:50:45,116 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 14:50:45,116 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 14:50:45,118 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 14:50:45,119 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 14:50:45,119 - __main__ - INFO - 등록할 별칭 샘플: ['우주pass Netflix 인증', '우주패스 Netflix 인증', '우주패스 넷플릭스 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증']
2025-10-20 14:50:45,139 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 14:50:45,140 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 14:50:45,140 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 14:50:45,142 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 14:50:45,142 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 14:50:45,414 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 14:50:45,414 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 14:50:45,414 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 14:50:45,414 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 14:50:45,414 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 14:50:45,414 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:50:45,501 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 14:50:45,501 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:50:45,504 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 14:50:45,505 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 14:50:45,505 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 14:50:45,505 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:50:45,505 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 14:50:45,505 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 14:50:45,505 - __main__ - INFO - ============================================================
2025-10-20 14:50:45,505 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 14:50:45,505 - __main__ - INFO - ============================================================
2025-10-20 14:50:45,506 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 14:50:45,506 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 14:50:45,506 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 14:50:45,506 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 14:50:45,506 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 14:50:45,507 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 14:50:45,509 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 14:50:45,511 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 14:50:45,511 - __main__ - INFO - _load_data 실행완료: 0.81초
2025-10-20 14:50:45,511 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 14:50:45,511 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 14:50:45,511 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내
(광고)[SKT] ...
2025-10-20 14:50:45,511 - __main__ - INFO - ============================================================
2025-10-20 14:50:45,511 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 14:50:45,511 - __main__ - INFO - ============================================================
2025-10-20 14:50:45,511 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내
(광고)[SKT] 아이폰 12/12 Pro 사전예약 안내  #04 고객님, 안녕하세요. 최고의 스마트폰 칩과 카메라, 견고한 세라믹 실드에 5G 기술까지! 이 모든 것을 갖춘 아이폰 12/12 Pro를 만나 보세요.  ▶ 혜택받고 사전예약하기: http://t-mms.kr/t.do?m=...
2025-10-20 14:50:45,511 - __main__ - INFO - 메시지 길이: 823 문자
2025-10-20 14:50:45,511 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 14:50:45,511 - __main__ - INFO - 데이터 소스: local
2025-10-20 14:50:45,511 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 14:50:45,511 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-20 14:50:45,511 - __main__ - INFO - LLM 모델: ax
2025-10-20 14:50:45,511 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 14:50:45,511 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 14:50:45,511 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 14:50:45,511 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 14:50:45,512 - __main__ - INFO - 처리할 메시지 길이: 816 문자
2025-10-20 14:50:45,513 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 14:50:46,185 - __main__ - INFO - 분할된 문장 수: 9개
2025-10-20 14:50:46,186 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 반가워요', '5G 아이폰 Pro 사전예약 안내 광고 SKT 아이폰 Pro 사전예약 안내 고객님 안녕하세요 ', '최고의 스마트폰 칩과 카메라 견고 세라믹 실드에 5G 기술까지 ']...
2025-10-20 14:50:46,193 - __main__ - INFO - 전체 토큰 수: 310개
2025-10-20 14:50:46,193 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '아이폰', '아이폰', '실드', '아이폰', '아이폰', '스펙', '아이폰', '스마트폰', '택1', '사죠영', '죠르디', '한정판', '기프트', '프리디', '충전기', '에이프릴', '스톤', '충전', '기프트', '.', '카카오톡', '코로나']
2025-10-20 14:50:46,194 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['기프트', '프리디', '스펙', '택1', '카카오톡', '코로나', '실드', '에이프릴', '충전기', '죠르디', '한정판', '아이폰', '스톤', '사죠영']
2025-10-20 14:50:46,194 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 14:50:47,163 - __main__ - INFO - 퍼지 매칭 결과 크기: (2116, 3)
2025-10-20 14:50:47,163 - __main__ - INFO - 퍼지 매칭 성공: 2116개 결과
2025-10-20 14:50:47,164 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.4285714285714286}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.4}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.4}]
2025-10-20 14:50:47,164 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 14:50:47,337 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2116, 3)
2025-10-20 14:50:47,338 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.18461538461538463}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.15000000000000002}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.15000000000000002}]
2025-10-20 14:50:47,338 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 14:50:47,341 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 11개
2025-10-20 14:50:47,342 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 14:50:47,343 - __main__ - INFO - 통합된 후보 아이템 수: 11개
2025-10-20 14:50:47,345 - __main__ - INFO - 최종 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:50:47,348 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (10, 2)
2025-10-20 14:50:47,349 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}, {'item_nm': 'IPHONE 16 PRO', 'item_id': ['A5XE', 'A643', 'A5XN', 'A64C', 'A647', 'A63Y', 'A5XJ', 'A5X9']}]
2025-10-20 14:50:47,349 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.84초
2025-10-20 14:50:47,349 - __main__ - INFO - 추출된 후보 엔티티: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:50:47,349 - __main__ - INFO - 매칭된 상품 정보: (10, 2)
2025-10-20 14:50:47,349 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 14:50:47,503 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 14:50:47,503 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 14:50:47,503 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 400 문자
2025-10-20 14:50:47,503 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 14:50:47,503 - __main__ - INFO - 후보 아이템 리스트 크기: 11개
2025-10-20 14:50:47,503 - __main__ - INFO - 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:50:47,503 - __main__ - INFO - extra_item_pdf 크기: (10, 2)
2025-10-20 14:50:47,503 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 14:50:47,504 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}]
2025-10-20 14:50:47,504 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 14:50:47,504 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 14:50:47,504 - __main__ - INFO - 구성된 프롬프트 길이: 6735 문자
2025-10-20 14:50:47,504 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 14:50:47,504 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 14:50:47,504 - __main__ - INFO - 📝 프롬프트 길이: 6,735 문자
2025-10-20 14:50:47,504 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 14:50:47,504 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 14:50:59,923 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 14:50:59,943 - __main__ - INFO - LLM 응답 길이: 1853 문자
2025-10-20 14:50:59,944 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내"
    ],
    "product": [
        {
            "name": "아이폰 17",
            "action": "구매"
        },
        {
            "name": "아이폰 17 Pro",
            "action": "구매"
        },
        {
            "name": "아이폰 12",
            "action": "구매"
        },
        {
            "name": "아이폰 12 Pro",
            "action": "구매"
        },
        {
            "name": "5G",
  ...
2025-10-20 14:50:59,944 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 14:50:59,945 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 14:50:59,945 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 14:50:59,946 - __main__ - INFO - 파싱된 JSON 내용: {'title': '[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내', 'purpose': ['상품 가입 유도', '혜택 안내'], 'product': [{'name': '아이폰 17', 'action': '구매'}, {'name': '아이폰 17 Pro', 'action': '구매'}, {'name': '아이폰 12', 'action': '구매'}, {'name': '아이폰 12 Pro', 'action': '구매'}, {'name': '5G', 'action': '사용'}, {'name': 'A14 Bionic 칩', 'action': '사용'}, {'name': '세라믹 실드', 'action': '사용'}, {'name': '카메라 시스템', 'action': '사용'}, {'name': 'Dolby Vision 영상 카메라', 'action': '사용'}, {'name': '[사죠영] 죠르디 한정판 기프트', 'action': '기타'}, {'name': '[프리디] 멀티 무선 충전기', 'action': '기타'}, {'name': '[에이프릴스톤] 보조배터리+멀티백', 'action': '기타'}, {'name': '[크레앙] 3in1 무선 충전 살균기', 'action': '기타'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/2HeWcdx', 'action': '추가 정보'}, {'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/3o7zOnA', 'action': '추가 정보'}, {'type': '전화번호', 'value': '1558', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['상품및부가서비스가입유도_단말', '사용법/혜택/이벤트안내_단말']}
2025-10-20 14:50:59,946 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 14:50:59,946 - __main__ - INFO - LLM 추출 엔티티: ['아이폰 17', '아이폰 17 Pro', '아이폰 12', '아이폰 12 Pro', '5G', 'A14 Bionic 칩', '세라믹 실드', '카메라 시스템', 'Dolby Vision 영상 카메라', '[사죠영] 죠르디 한정판 기프트', '[프리디] 멀티 무선 충전기', '[에이프릴스톤] 보조배터리+멀티백', '[크레앙] 3in1 무선 충전 살균기']
2025-10-20 14:50:59,947 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-10-20 14:50:59,947 - __main__ - INFO - === 후보 엔티티 추출 시작 ===
2025-10-20 14:50:59,947 - __main__ - INFO - 퍼지 매칭 임계값: 0.4
2025-10-20 14:51:01,551 - __main__ - INFO - 로직 기반 추출 원본 엔티티 수: 1308개
2025-10-20 14:51:01,552 - __main__ - INFO - 원본 엔티티 샘플 (최대 10개): ['(KTF)아이폰 16E', '(LGU)아이폰 16E', '0 청년 109(T 우주)', '0 청년 109(TVING)', '0 청년 109(tving)', '0 청년 109(스마트기기)', '0 청년 109(티빙)', '0 청년 37', '0 청년 37 DATA 충전 1GB', '0 청년 37 Data 충전 1GB']
2025-10-20 14:51:01,553 - __main__ - INFO - 필터링 후 엔티티 수: 1303개
2025-10-20 14:51:01,553 - __main__ - INFO - 제거된 엔티티 수: 5개
2025-10-20 14:51:01,553 - __main__ - INFO - 최종 후보 엔티티 수: 1303개
2025-10-20 14:51:01,553 - __main__ - WARNING - ⚠️ 후보 엔티티가 매우 많습니다: 1303개
2025-10-20 14:51:01,553 - __main__ - WARNING - 이는 프롬프트 길이를 크게 증가시킬 수 있습니다.
2025-10-20 14:51:01,553 - __main__ - WARNING - 성능을 위해 상위 100개만 사용합니다. (원본: 1303개)
2025-10-20 14:51:01,553 - __main__ - INFO - 최종 후보 엔티티 샘플 (최대 10개): ['(KTF)아이폰 16E', '(LGU)아이폰 16E', '0 청년 109(T 우주)', '0 청년 109(TVING)', '0 청년 109(tving)', '0 청년 109(스마트기기)', '0 청년 109(티빙)', '0 청년 37', '0 청년 37 DATA 충전 1GB', '0 청년 37 Data 충전 1GB']
2025-10-20 14:51:01,554 - __main__ - INFO - === 후보 엔티티 추출 완료 ===
2025-10-20 14:51:01,554 - __main__ - INFO - 🔍 프롬프트에 추가될 엔티티 섹션 길이: 1,723 문자
2025-10-20 14:51:01,554 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 4,956 문자
2025-10-20 14:51:01,554 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-10-20 14:51:01,554 - __main__ - INFO - 📝 프롬프트 길이: 4,956 문자
2025-10-20 14:51:01,554 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-10-20 14:51:01,554 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-10-20 14:51:01,554 - __main__ - INFO - 🔄 1개 LLM 모델로 엔티티 추출 시작
2025-10-20 14:51:01,554 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-20 14:51:01,554 - __main__ - INFO - 🔍 프롬프트 구성 중 - LLM 모델: client=<openai.resources.chat.completions.completions.Completions object at 0x15f1cb260> async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x15ed503e0> root_client=<openai.OpenAI object at 0x15ed89190> root_async_client=<openai.AsyncOpenAI object at 0x15f1cac00> model_name='skt/ax4' temperature=0.0 model_kwargs={} openai_api_key=SecretStr('**********') openai_api_base='https://api.platform.a15t.com/v1' max_tokens=4000
2025-10-20 14:51:01,554 - __main__ - INFO - 🔍 후보 엔티티 개수: 100개
2025-10-20 14:51:01,554 - __main__ - INFO - 🔍 후보 엔티티 문자열 길이: 1,560 문자
2025-10-20 14:51:01,554 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-20 14:51:01,554 - __main__ - INFO - 🔍 메시지 길이: 816 문자
2025-10-20 14:51:01,554 - __main__ - INFO - 🔍 예상 전체 프롬프트 길이: 4,824 문자
2025-10-20 14:51:02,513 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 14:51:02,516 - __main__ - INFO - ✅ LLM 추출 완료: ['T다이렉트샵 카카오톡 상담', '아이폰 12', 'SKT 고객센터', 'T기프트', 'T다이렉트샵', '아이폰 12 Pro']
2025-10-20 14:51:02,900 - __main__ - INFO - extract_entities_by_llm 실행완료: 2.95초
2025-10-20 14:51:02,901 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 14:51:02,901 - __main__ - INFO - ============================================================
2025-10-20 14:51:02,901 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 14:51:02,901 - __main__ - INFO - ============================================================
2025-10-20 14:51:02,901 - __main__ - INFO - 제목: [SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내
2025-10-20 14:51:02,901 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내']
2025-10-20 14:51:02,901 - __main__ - INFO - 상품 수: 13개
2025-10-20 14:51:02,901 - __main__ - INFO - 채널 수: 4개
2025-10-20 14:51:02,901 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 14:51:02,901 - __main__ - INFO - process_message 실행완료: 17.39초
2025-10-20 14:51:02,902 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 14:52:48,742 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 14:52:48,742 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 14:52:48,742 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 14:52:48,742 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 14:52:48,742 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 14:52:48,744 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 14:52:48,785 - __main__ - INFO - Using device: mps
2025-10-20 14:52:48,785 - __main__ - INFO - _initialize_device 실행완료: 0.04초
2025-10-20 14:52:48,785 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 14:52:48,786 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 14:52:48,786 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 14:52:48,786 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 14:52:48,786 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 14:52:48,786 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 14:52:48,786 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 14:52:49,253 - __main__ - INFO - Model loaded on mps
2025-10-20 14:52:49,253 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.47초
2025-10-20 14:52:49,253 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 14:52:49,834 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 14:52:49,834 - __main__ - INFO - _initialize_kiwi 실행완료: 0.58초
2025-10-20 14:52:49,834 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 14:52:49,834 - __main__ - INFO - ============================================================
2025-10-20 14:52:49,834 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 14:52:49,834 - __main__ - INFO - ============================================================
2025-10-20 14:52:49,834 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 14:52:49,834 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 14:52:49,834 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 14:52:49,834 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 14:52:49,834 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:52:49,993 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 14:52:49,993 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:52:49,993 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 14:52:50,000 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 14:52:50,001 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 14:52:50,002 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:52:50,002 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:52:50,003 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 14:52:50,003 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 14:52:50,005 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 14:52:50,009 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 14:52:50,009 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 14:52:50,009 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:52:50,010 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 14:52:50,010 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 14:52:50,010 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 14:52:50,010 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:52:50,010 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 14:52:50,010 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 14:52:50,010 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 14:52:50,012 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 14:52:50,012 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 14:52:50,012 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:52:50,013 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 14:52:50,013 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:52:50,234 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 14:52:50,244 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 14:52:50,245 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 Netflix 인증', '우주패스 넷플릭스 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증']
2025-10-20 14:52:50,245 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 14:52:50,245 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 14:52:50,245 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 14:52:50,247 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 14:52:50,247 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 14:52:50,247 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 14:52:50,247 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 14:52:50,248 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 14:52:50,249 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 14:52:50,249 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 Netflix 인증', '우주패스 넷플릭스 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증']
2025-10-20 14:52:50,270 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 14:52:50,271 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 14:52:50,271 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 14:52:50,272 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 14:52:50,272 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 14:52:50,520 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 14:52:50,520 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 14:52:50,520 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 14:52:50,520 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 14:52:50,520 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 14:52:50,520 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:52:50,610 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 14:52:50,610 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:52:50,612 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 14:52:50,613 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 14:52:50,613 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 14:52:50,613 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:52:50,613 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 14:52:50,614 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 14:52:50,614 - __main__ - INFO - ============================================================
2025-10-20 14:52:50,614 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 14:52:50,614 - __main__ - INFO - ============================================================
2025-10-20 14:52:50,614 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 14:52:50,614 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 14:52:50,614 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 14:52:50,614 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 14:52:50,614 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 14:52:50,615 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 14:52:50,617 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 14:52:50,619 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 14:52:50,619 - __main__ - INFO - _load_data 실행완료: 0.78초
2025-10-20 14:52:50,619 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 14:52:50,619 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 14:52:50,619 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내
(광고)[SKT] ...
2025-10-20 14:52:50,619 - __main__ - INFO - ============================================================
2025-10-20 14:52:50,619 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 14:52:50,619 - __main__ - INFO - ============================================================
2025-10-20 14:52:50,619 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내
(광고)[SKT] 아이폰 12/12 Pro 사전예약 안내  #04 고객님, 안녕하세요. 최고의 스마트폰 칩과 카메라, 견고한 세라믹 실드에 5G 기술까지! 이 모든 것을 갖춘 아이폰 12/12 Pro를 만나 보세요.  ▶ 혜택받고 사전예약하기: http://t-mms.kr/t.do?m=...
2025-10-20 14:52:50,619 - __main__ - INFO - 메시지 길이: 823 문자
2025-10-20 14:52:50,619 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 14:52:50,619 - __main__ - INFO - 데이터 소스: local
2025-10-20 14:52:50,619 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 14:52:50,619 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-20 14:52:50,619 - __main__ - INFO - LLM 모델: ax
2025-10-20 14:52:50,619 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 14:52:50,619 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 14:52:50,619 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 14:52:50,619 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 14:52:50,619 - __main__ - INFO - 처리할 메시지 길이: 816 문자
2025-10-20 14:52:50,621 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 14:52:51,288 - __main__ - INFO - 분할된 문장 수: 9개
2025-10-20 14:52:51,289 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 반가워요', '5G 아이폰 Pro 사전예약 안내 광고 SKT 아이폰 Pro 사전예약 안내 고객님 안녕하세요 ', '최고의 스마트폰 칩과 카메라 견고 세라믹 실드에 5G 기술까지 ']...
2025-10-20 14:52:51,296 - __main__ - INFO - 전체 토큰 수: 310개
2025-10-20 14:52:51,297 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '아이폰', '아이폰', '실드', '아이폰', '아이폰', '스펙', '아이폰', '스마트폰', '택1', '사죠영', '죠르디', '한정판', '기프트', '프리디', '충전기', '에이프릴', '스톤', '충전', '기프트', '.', '카카오톡', '코로나']
2025-10-20 14:52:51,297 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['기프트', '스톤', '아이폰', '카카오톡', '코로나', '스펙', '사죠영', '충전기', '택1', '죠르디', '실드', '한정판', '에이프릴', '프리디']
2025-10-20 14:52:51,297 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 14:52:52,255 - __main__ - INFO - 퍼지 매칭 결과 크기: (2116, 3)
2025-10-20 14:52:52,255 - __main__ - INFO - 퍼지 매칭 성공: 2116개 결과
2025-10-20 14:52:52,256 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.4285714285714286}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.4}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.4}]
2025-10-20 14:52:52,256 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 14:52:52,425 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2116, 3)
2025-10-20 14:52:52,426 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.18461538461538463}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.15000000000000002}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.15000000000000002}]
2025-10-20 14:52:52,426 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 14:52:52,429 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 11개
2025-10-20 14:52:52,431 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 14:52:52,431 - __main__ - INFO - 통합된 후보 아이템 수: 11개
2025-10-20 14:52:52,434 - __main__ - INFO - 최종 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:52:52,437 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (10, 2)
2025-10-20 14:52:52,438 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}, {'item_nm': 'IPHONE 16 PRO', 'item_id': ['A5XE', 'A643', 'A5XN', 'A64C', 'A647', 'A63Y', 'A5XJ', 'A5X9']}]
2025-10-20 14:52:52,438 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.82초
2025-10-20 14:52:52,438 - __main__ - INFO - 추출된 후보 엔티티: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:52:52,438 - __main__ - INFO - 매칭된 상품 정보: (10, 2)
2025-10-20 14:52:52,438 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 14:52:52,594 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 14:52:52,594 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 14:52:52,594 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 400 문자
2025-10-20 14:52:52,594 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 14:52:52,594 - __main__ - INFO - 후보 아이템 리스트 크기: 11개
2025-10-20 14:52:52,594 - __main__ - INFO - 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:52:52,594 - __main__ - INFO - extra_item_pdf 크기: (10, 2)
2025-10-20 14:52:52,594 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 14:52:52,595 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}]
2025-10-20 14:52:52,595 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 14:52:52,595 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 14:52:52,595 - __main__ - INFO - 구성된 프롬프트 길이: 6735 문자
2025-10-20 14:52:52,595 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 14:52:52,595 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 14:52:52,595 - __main__ - INFO - 📝 프롬프트 길이: 6,735 문자
2025-10-20 14:52:52,595 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 14:52:52,595 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 14:53:05,132 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 14:53:05,156 - __main__ - INFO - LLM 응답 길이: 1853 문자
2025-10-20 14:53:05,156 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내"
    ],
    "product": [
        {
            "name": "아이폰 17",
            "action": "구매"
        },
        {
            "name": "아이폰 17 Pro",
            "action": "구매"
        },
        {
            "name": "아이폰 12",
            "action": "구매"
        },
        {
            "name": "아이폰 12 Pro",
            "action": "구매"
        },
        {
            "name": "5G",
  ...
2025-10-20 14:53:05,156 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 14:53:05,157 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 14:53:05,157 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 14:53:05,157 - __main__ - INFO - 파싱된 JSON 내용: {'title': '[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내', 'purpose': ['상품 가입 유도', '혜택 안내'], 'product': [{'name': '아이폰 17', 'action': '구매'}, {'name': '아이폰 17 Pro', 'action': '구매'}, {'name': '아이폰 12', 'action': '구매'}, {'name': '아이폰 12 Pro', 'action': '구매'}, {'name': '5G', 'action': '사용'}, {'name': 'A14 Bionic 칩', 'action': '사용'}, {'name': '세라믹 실드', 'action': '사용'}, {'name': '카메라 시스템', 'action': '사용'}, {'name': 'Dolby Vision 영상 카메라', 'action': '사용'}, {'name': '[사죠영] 죠르디 한정판 기프트', 'action': '기타'}, {'name': '[프리디] 멀티 무선 충전기', 'action': '기타'}, {'name': '[에이프릴스톤] 보조배터리+멀티백', 'action': '기타'}, {'name': '[크레앙] 3in1 무선 충전 살균기', 'action': '기타'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/2HeWcdx', 'action': '추가 정보'}, {'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/3o7zOnA', 'action': '추가 정보'}, {'type': '전화번호', 'value': '1558', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['상품및부가서비스가입유도_단말', '사용법/혜택/이벤트안내_단말']}
2025-10-20 14:53:05,158 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 14:53:05,158 - __main__ - INFO - LLM 추출 엔티티: ['아이폰 17', '아이폰 17 Pro', '아이폰 12', '아이폰 12 Pro', '5G', 'A14 Bionic 칩', '세라믹 실드', '카메라 시스템', 'Dolby Vision 영상 카메라', '[사죠영] 죠르디 한정판 기프트', '[프리디] 멀티 무선 충전기', '[에이프릴스톤] 보조배터리+멀티백', '[크레앙] 3in1 무선 충전 살균기']
2025-10-20 14:53:05,159 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-10-20 14:53:05,159 - __main__ - INFO - === 후보 엔티티 추출 시작 ===
2025-10-20 14:53:05,159 - __main__ - INFO - 퍼지 매칭 임계값: 0.4
2025-10-20 14:53:06,771 - __main__ - INFO - 로직 기반 추출 원본 엔티티 수: 1308개
2025-10-20 14:53:06,771 - __main__ - INFO - 원본 엔티티 샘플 (최대 10개): ['(KTF)아이폰 16E', '(LGU)아이폰 16E', '0 청년 109(T 우주)', '0 청년 109(TVING)', '0 청년 109(tving)', '0 청년 109(스마트기기)', '0 청년 109(티빙)', '0 청년 37', '0 청년 37 DATA 충전 1GB', '0 청년 37 Data 충전 1GB']
2025-10-20 14:53:06,773 - __main__ - INFO - 필터링 후 엔티티 수: 1303개
2025-10-20 14:53:06,773 - __main__ - INFO - 제거된 엔티티 수: 5개
2025-10-20 14:53:06,773 - __main__ - INFO - 최종 후보 엔티티 수: 1303개
2025-10-20 14:53:06,773 - __main__ - WARNING - ⚠️ 후보 엔티티가 매우 많습니다: 1303개
2025-10-20 14:53:06,773 - __main__ - WARNING - 이는 프롬프트 길이를 크게 증가시킬 수 있습니다.
2025-10-20 14:53:06,773 - __main__ - WARNING - 성능을 위해 상위 100개만 사용합니다. (원본: 1303개)
2025-10-20 14:53:06,773 - __main__ - INFO - 최종 후보 엔티티 샘플 (최대 10개): ['(KTF)아이폰 16E', '(LGU)아이폰 16E', '0 청년 109(T 우주)', '0 청년 109(TVING)', '0 청년 109(tving)', '0 청년 109(스마트기기)', '0 청년 109(티빙)', '0 청년 37', '0 청년 37 DATA 충전 1GB', '0 청년 37 Data 충전 1GB']
2025-10-20 14:53:06,773 - __main__ - INFO - === 후보 엔티티 추출 완료 ===
2025-10-20 14:53:06,773 - __main__ - INFO - 🔍 프롬프트에 추가될 엔티티 섹션 길이: 1,723 문자
2025-10-20 14:53:06,773 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 4,956 문자
2025-10-20 14:53:06,773 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-10-20 14:53:06,773 - __main__ - INFO - 📝 프롬프트 길이: 4,956 문자
2025-10-20 14:53:06,773 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-10-20 14:53:06,773 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-10-20 14:53:06,774 - __main__ - INFO - 🔄 1개 LLM 모델로 엔티티 추출 시작
2025-10-20 14:53:06,774 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-20 14:53:06,774 - __main__ - INFO - 🔍 프롬프트 구성 중 - LLM 모델: client=<openai.resources.chat.completions.completions.Completions object at 0x161c33230> async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x1604ff0b0> root_client=<openai.OpenAI object at 0x1604d6d50> root_async_client=<openai.AsyncOpenAI object at 0x161c32f60> model_name='skt/ax4' temperature=0.0 model_kwargs={} openai_api_key=SecretStr('**********') openai_api_base='https://api.platform.a15t.com/v1' max_tokens=4000
2025-10-20 14:53:06,774 - __main__ - INFO - 🔍 후보 엔티티 개수: 100개
2025-10-20 14:53:06,774 - __main__ - INFO - 🔍 후보 엔티티 문자열 길이: 1,560 문자
2025-10-20 14:53:06,774 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-20 14:53:06,774 - __main__ - INFO - 🔍 메시지 길이: 816 문자
2025-10-20 14:53:06,774 - __main__ - INFO - 🔍 예상 전체 프롬프트 길이: 4,824 문자
2025-10-20 14:53:07,459 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 14:53:07,462 - __main__ - INFO - ✅ LLM 추출 완료: ['T기프트', '아이폰 12 Pro', '아이폰 12', 'T다이렉트샵']
2025-10-20 14:53:07,790 - __main__ - INFO - extract_entities_by_llm 실행완료: 2.63초
2025-10-20 14:53:07,792 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 14:53:07,792 - __main__ - INFO - ============================================================
2025-10-20 14:53:07,792 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 14:53:07,792 - __main__ - INFO - ============================================================
2025-10-20 14:53:07,792 - __main__ - INFO - 제목: [SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내
2025-10-20 14:53:07,792 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내']
2025-10-20 14:53:07,792 - __main__ - INFO - 상품 수: 13개
2025-10-20 14:53:07,792 - __main__ - INFO - 채널 수: 4개
2025-10-20 14:53:07,792 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 14:53:07,792 - __main__ - INFO - process_message 실행완료: 17.17초
2025-10-20 14:53:07,792 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 14:57:21,425 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 14:57:21,425 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 14:57:21,425 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 14:57:21,425 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 14:57:21,425 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 14:57:21,427 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 14:57:21,457 - __main__ - INFO - Using device: mps
2025-10-20 14:57:21,457 - __main__ - INFO - _initialize_device 실행완료: 0.03초
2025-10-20 14:57:21,457 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 14:57:21,458 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 14:57:21,458 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 14:57:21,458 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 14:57:21,458 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 14:57:21,458 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 14:57:21,458 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 14:57:21,713 - __main__ - INFO - Model loaded on mps
2025-10-20 14:57:21,714 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.26초
2025-10-20 14:57:21,714 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 14:57:22,315 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 14:57:22,315 - __main__ - INFO - _initialize_kiwi 실행완료: 0.60초
2025-10-20 14:57:22,315 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 14:57:22,315 - __main__ - INFO - ============================================================
2025-10-20 14:57:22,315 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 14:57:22,315 - __main__ - INFO - ============================================================
2025-10-20 14:57:22,315 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 14:57:22,315 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 14:57:22,315 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 14:57:22,316 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 14:57:22,316 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:57:22,472 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 14:57:22,473 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:57:22,473 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 14:57:22,480 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 14:57:22,481 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 14:57:22,481 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:57:22,482 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:57:22,483 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 14:57:22,483 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 14:57:22,484 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 14:57:22,488 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 14:57:22,488 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 14:57:22,488 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:57:22,488 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 14:57:22,488 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 14:57:22,489 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 14:57:22,489 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:57:22,489 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 14:57:22,489 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 14:57:22,489 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 14:57:22,491 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 14:57:22,491 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 14:57:22,491 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:57:22,492 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 14:57:22,492 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 14:57:22,719 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 14:57:22,728 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 14:57:22,729 - __main__ - INFO - 별칭 적용 후 샘플: ['우주pass Netflix 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증', '우주패스 넷플릭스 인증']
2025-10-20 14:57:22,729 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 14:57:22,729 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 14:57:22,729 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 14:57:22,730 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 14:57:22,730 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 14:57:22,730 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 14:57:22,730 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 14:57:22,731 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 14:57:22,733 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 14:57:22,733 - __main__ - INFO - 등록할 별칭 샘플: ['우주pass Netflix 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증', '우주패스 넷플릭스 인증']
2025-10-20 14:57:22,754 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 14:57:22,754 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 14:57:22,754 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 14:57:22,756 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 14:57:22,756 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 14:57:23,005 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 14:57:23,005 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 14:57:23,005 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 14:57:23,005 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 14:57:23,005 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 14:57:23,005 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 14:57:23,088 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 14:57:23,088 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 14:57:23,091 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 14:57:23,091 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 14:57:23,091 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 14:57:23,091 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 14:57:23,091 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 14:57:23,092 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 14:57:23,092 - __main__ - INFO - ============================================================
2025-10-20 14:57:23,092 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 14:57:23,092 - __main__ - INFO - ============================================================
2025-10-20 14:57:23,092 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 14:57:23,092 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 14:57:23,092 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 14:57:23,092 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 14:57:23,092 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 14:57:23,093 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 14:57:23,095 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 14:57:23,097 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 14:57:23,097 - __main__ - INFO - _load_data 실행완료: 0.78초
2025-10-20 14:57:23,097 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 14:57:23,097 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 14:57:23,097 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내
(광고)[SKT] ...
2025-10-20 14:57:23,097 - __main__ - INFO - ============================================================
2025-10-20 14:57:23,097 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 14:57:23,097 - __main__ - INFO - ============================================================
2025-10-20 14:57:23,097 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내
(광고)[SKT] 아이폰 12/12 Pro 사전예약 안내  #04 고객님, 안녕하세요. 최고의 스마트폰 칩과 카메라, 견고한 세라믹 실드에 5G 기술까지! 이 모든 것을 갖춘 아이폰 12/12 Pro를 만나 보세요.  ▶ 혜택받고 사전예약하기: http://t-mms.kr/t.do?m=...
2025-10-20 14:57:23,097 - __main__ - INFO - 메시지 길이: 823 문자
2025-10-20 14:57:23,097 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 14:57:23,097 - __main__ - INFO - 데이터 소스: local
2025-10-20 14:57:23,098 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 14:57:23,098 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-20 14:57:23,098 - __main__ - INFO - LLM 모델: ax
2025-10-20 14:57:23,098 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 14:57:23,098 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 14:57:23,098 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 14:57:23,098 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 14:57:23,098 - __main__ - INFO - 처리할 메시지 길이: 816 문자
2025-10-20 14:57:23,099 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 14:57:23,768 - __main__ - INFO - 분할된 문장 수: 9개
2025-10-20 14:57:23,769 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 반가워요', '5G 아이폰 Pro 사전예약 안내 광고 SKT 아이폰 Pro 사전예약 안내 고객님 안녕하세요 ', '최고의 스마트폰 칩과 카메라 견고 세라믹 실드에 5G 기술까지 ']...
2025-10-20 14:57:23,777 - __main__ - INFO - 전체 토큰 수: 310개
2025-10-20 14:57:23,777 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '아이폰', '아이폰', '실드', '아이폰', '아이폰', '스펙', '아이폰', '스마트폰', '택1', '사죠영', '죠르디', '한정판', '기프트', '프리디', '충전기', '에이프릴', '스톤', '충전', '기프트', '.', '카카오톡', '코로나']
2025-10-20 14:57:23,777 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['택1', '죠르디', '기프트', '프리디', '아이폰', '사죠영', '에이프릴', '충전기', '실드', '스펙', '카카오톡', '스톤', '코로나', '한정판']
2025-10-20 14:57:23,777 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 14:57:24,745 - __main__ - INFO - 퍼지 매칭 결과 크기: (2116, 3)
2025-10-20 14:57:24,745 - __main__ - INFO - 퍼지 매칭 성공: 2116개 결과
2025-10-20 14:57:24,746 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.4285714285714286}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.4}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.4}]
2025-10-20 14:57:24,746 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 14:57:24,917 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2116, 3)
2025-10-20 14:57:24,917 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.18461538461538463}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.15000000000000002}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.15000000000000002}]
2025-10-20 14:57:24,917 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 14:57:24,921 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 11개
2025-10-20 14:57:24,923 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 14:57:24,923 - __main__ - INFO - 통합된 후보 아이템 수: 11개
2025-10-20 14:57:24,927 - __main__ - INFO - 최종 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:57:24,930 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (10, 2)
2025-10-20 14:57:24,931 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}, {'item_nm': 'IPHONE 16 PRO', 'item_id': ['A5XE', 'A643', 'A5XN', 'A64C', 'A647', 'A63Y', 'A5XJ', 'A5X9']}]
2025-10-20 14:57:24,931 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.83초
2025-10-20 14:57:24,931 - __main__ - INFO - 추출된 후보 엔티티: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:57:24,931 - __main__ - INFO - 매칭된 상품 정보: (10, 2)
2025-10-20 14:57:24,931 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 14:57:25,088 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 14:57:25,089 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 14:57:25,089 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 400 문자
2025-10-20 14:57:25,089 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 14:57:25,089 - __main__ - INFO - 후보 아이템 리스트 크기: 11개
2025-10-20 14:57:25,089 - __main__ - INFO - 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 14:57:25,089 - __main__ - INFO - extra_item_pdf 크기: (10, 2)
2025-10-20 14:57:25,089 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 14:57:25,089 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}]
2025-10-20 14:57:25,089 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 14:57:25,089 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 14:57:25,089 - __main__ - INFO - 구성된 프롬프트 길이: 6735 문자
2025-10-20 14:57:25,089 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 14:57:25,089 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 14:57:25,089 - __main__ - INFO - 📝 프롬프트 길이: 6,735 문자
2025-10-20 14:57:25,089 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 14:57:25,089 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 14:57:37,455 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 14:57:37,479 - __main__ - INFO - LLM 응답 길이: 1774 문자
2025-10-20 14:57:37,479 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내"
    ],
    "product": [
        {
            "name": "아이폰 17",
            "action": "구매"
        },
        {
            "name": "아이폰 17 Pro",
            "action": "구매"
        },
        {
            "name": "아이폰 12",
            "action": "구매"
        },
        {
            "name": "아이폰 12 Pro",
            "action": "구매"
        },
        {
            "name": "5G",
  ...
2025-10-20 14:57:37,479 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 14:57:37,480 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 14:57:37,480 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 14:57:37,480 - __main__ - INFO - 파싱된 JSON 내용: {'title': '[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내', 'purpose': ['상품 가입 유도', '혜택 안내'], 'product': [{'name': '아이폰 17', 'action': '구매'}, {'name': '아이폰 17 Pro', 'action': '구매'}, {'name': '아이폰 12', 'action': '구매'}, {'name': '아이폰 12 Pro', 'action': '구매'}, {'name': '5G', 'action': '사용'}, {'name': 'A14 Bionic 칩', 'action': '사용'}, {'name': '세라믹 실드', 'action': '사용'}, {'name': 'Dolby Vision 영상 카메라', 'action': '사용'}, {'name': '[사죠영] 죠르디 한정판 기프트', 'action': '구매'}, {'name': '[프리디] 멀티 무선 충전기', 'action': '구매'}, {'name': '[에이프릴스톤] 보조배터리+멀티백', 'action': '구매'}, {'name': '[크레앙] 3in1 무선 충전 살균기', 'action': '구매'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/2HeWcdx', 'action': '추가 정보'}, {'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/3o7zOnA', 'action': '추가 정보'}, {'type': '전화번호', 'value': '1558', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['상품및부가서비스가입유도_단말', '사용법/혜택/이벤트안내_단말']}
2025-10-20 14:57:37,480 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 14:57:37,481 - __main__ - INFO - LLM 추출 엔티티: ['아이폰 17', '아이폰 17 Pro', '아이폰 12', '아이폰 12 Pro', '5G', 'A14 Bionic 칩', '세라믹 실드', 'Dolby Vision 영상 카메라', '[사죠영] 죠르디 한정판 기프트', '[프리디] 멀티 무선 충전기', '[에이프릴스톤] 보조배터리+멀티백', '[크레앙] 3in1 무선 충전 살균기']
2025-10-20 14:57:37,482 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-10-20 14:57:37,482 - __main__ - INFO - === 후보 엔티티 추출 시작 ===
2025-10-20 14:57:37,482 - __main__ - INFO - 퍼지 매칭 임계값: 0.4
2025-10-20 14:57:39,074 - __main__ - INFO - 로직 기반 추출 원본 엔티티 수: 1308개
2025-10-20 14:57:39,074 - __main__ - INFO - 원본 엔티티 샘플 (최대 10개): ['(KTF)아이폰 16E', '(LGU)아이폰 16E', '0 청년 109(T 우주)', '0 청년 109(TVING)', '0 청년 109(tving)', '0 청년 109(스마트기기)', '0 청년 109(티빙)', '0 청년 37', '0 청년 37 DATA 충전 1GB', '0 청년 37 Data 충전 1GB']
2025-10-20 14:57:39,076 - __main__ - INFO - 필터링 후 엔티티 수: 1303개
2025-10-20 14:57:39,076 - __main__ - INFO - 제거된 엔티티 수: 5개
2025-10-20 14:57:39,076 - __main__ - INFO - 최종 후보 엔티티 수: 1303개
2025-10-20 14:57:39,076 - __main__ - WARNING - ⚠️ 후보 엔티티가 매우 많습니다: 1303개
2025-10-20 14:57:39,076 - __main__ - WARNING - 이는 프롬프트 길이를 크게 증가시킬 수 있습니다.
2025-10-20 14:57:39,076 - __main__ - WARNING - 성능을 위해 상위 100개만 사용합니다. (원본: 1303개)
2025-10-20 14:57:39,076 - __main__ - INFO - 최종 후보 엔티티 샘플 (최대 10개): ['(KTF)아이폰 16E', '(LGU)아이폰 16E', '0 청년 109(T 우주)', '0 청년 109(TVING)', '0 청년 109(tving)', '0 청년 109(스마트기기)', '0 청년 109(티빙)', '0 청년 37', '0 청년 37 DATA 충전 1GB', '0 청년 37 Data 충전 1GB']
2025-10-20 14:57:39,076 - __main__ - INFO - === 후보 엔티티 추출 완료 ===
2025-10-20 14:57:39,076 - __main__ - INFO - 🔍 프롬프트에 추가될 엔티티 섹션 길이: 1,723 문자
2025-10-20 14:57:39,076 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 4,956 문자
2025-10-20 14:57:39,076 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-10-20 14:57:39,076 - __main__ - INFO - 📝 프롬프트 길이: 4,956 문자
2025-10-20 14:57:39,076 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-10-20 14:57:39,076 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-10-20 14:57:39,077 - __main__ - INFO - 🔄 1개 LLM 모델로 엔티티 추출 시작
2025-10-20 14:57:39,077 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-20 14:57:39,077 - __main__ - INFO - 🔍 프롬프트 구성 중 - LLM 모델: client=<openai.resources.chat.completions.completions.Completions object at 0x16475cc80> async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x160625c10> root_client=<openai.OpenAI object at 0x1632e8f20> root_async_client=<openai.AsyncOpenAI object at 0x16475deb0> model_name='skt/ax4' temperature=0.0 model_kwargs={} openai_api_key=SecretStr('**********') openai_api_base='https://api.platform.a15t.com/v1' max_tokens=4000
2025-10-20 14:57:39,077 - __main__ - INFO - 🔍 후보 엔티티 개수: 100개
2025-10-20 14:57:39,077 - __main__ - INFO - 🔍 후보 엔티티 문자열 길이: 1,560 문자
2025-10-20 14:57:39,077 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-20 14:57:39,077 - __main__ - INFO - 🔍 메시지 길이: 816 문자
2025-10-20 14:57:39,077 - __main__ - INFO - 🔍 예상 전체 프롬프트 길이: 4,824 문자
2025-10-20 14:57:40,644 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 14:57:40,647 - __main__ - INFO - ✅ LLM 추출 완료: ['T기프트', 'T다이렉트샵', '아이폰 17 Pro', '아이폰 17', '[크레앙] 3in1 무선 충전 살균기', '[프리디] 멀티 무선 충전기', '[에이프릴스톤] 보조배터리+멀티백', '[사죠영] 죠르디 한정판 기프트', '아이폰 12', '아이폰 12 Pro']
2025-10-20 14:57:41,171 - __main__ - INFO - extract_entities_by_llm 실행완료: 3.69초
2025-10-20 14:57:41,178 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 14:57:41,179 - __main__ - INFO - ============================================================
2025-10-20 14:57:41,179 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 14:57:41,179 - __main__ - INFO - ============================================================
2025-10-20 14:57:41,179 - __main__ - INFO - 제목: [SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내
2025-10-20 14:57:41,179 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내']
2025-10-20 14:57:41,179 - __main__ - INFO - 상품 수: 4개
2025-10-20 14:57:41,179 - __main__ - INFO - 채널 수: 4개
2025-10-20 14:57:41,179 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 14:57:41,179 - __main__ - INFO - process_message 실행완료: 18.08초
2025-10-20 14:57:41,179 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 15:07:21,375 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 15:07:21,375 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 15:07:21,375 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 15:07:21,375 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 15:07:21,375 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 15:07:21,377 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 15:07:21,455 - __main__ - INFO - Using device: mps
2025-10-20 15:07:21,456 - __main__ - INFO - _initialize_device 실행완료: 0.08초
2025-10-20 15:07:21,456 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 15:07:21,456 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 15:07:21,456 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 15:07:21,456 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 15:07:21,456 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 15:07:21,457 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 15:07:21,457 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 15:07:21,786 - __main__ - INFO - Model loaded on mps
2025-10-20 15:07:21,786 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.33초
2025-10-20 15:07:21,786 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 15:07:22,902 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 15:07:22,902 - __main__ - INFO - _initialize_kiwi 실행완료: 1.12초
2025-10-20 15:07:22,902 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 15:07:22,902 - __main__ - INFO - ============================================================
2025-10-20 15:07:22,902 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 15:07:22,902 - __main__ - INFO - ============================================================
2025-10-20 15:07:22,902 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 15:07:22,902 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 15:07:22,902 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 15:07:22,902 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 15:07:22,902 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:07:23,066 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 15:07:23,066 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:07:23,066 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 15:07:23,074 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 15:07:23,074 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 15:07:23,075 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:07:23,076 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:07:23,076 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 15:07:23,076 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 15:07:23,151 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 15:07:23,157 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 15:07:23,157 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 15:07:23,157 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:07:23,157 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 15:07:23,157 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 15:07:23,158 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 15:07:23,158 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:07:23,158 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 15:07:23,158 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 15:07:23,158 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 15:07:23,183 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 15:07:23,183 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 15:07:23,183 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:07:23,184 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 15:07:23,184 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:07:23,418 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 15:07:23,429 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 15:07:23,430 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 Netflix 인증', '우주PASS Netflix 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증', '우주패스 넷플릭스 인증']
2025-10-20 15:07:23,430 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 15:07:23,430 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 15:07:23,430 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 15:07:23,431 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 15:07:23,431 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 15:07:23,431 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 15:07:23,431 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 15:07:23,433 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 15:07:23,434 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 15:07:23,434 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 Netflix 인증', '우주PASS Netflix 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증', '우주패스 넷플릭스 인증']
2025-10-20 15:07:23,456 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 15:07:23,457 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 15:07:23,457 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 15:07:23,465 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 15:07:23,466 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 15:07:23,761 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 15:07:23,762 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 15:07:23,762 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 15:07:23,762 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 15:07:23,762 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 15:07:23,762 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:07:23,843 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 15:07:23,843 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:07:23,845 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 15:07:23,846 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 15:07:23,846 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 15:07:23,846 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:07:23,846 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 15:07:23,847 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 15:07:23,847 - __main__ - INFO - ============================================================
2025-10-20 15:07:23,847 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 15:07:23,847 - __main__ - INFO - ============================================================
2025-10-20 15:07:23,847 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 15:07:23,847 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 15:07:23,847 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 15:07:23,847 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 15:07:23,847 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 15:07:23,848 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 15:07:23,850 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 15:07:23,852 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 15:07:23,852 - __main__ - INFO - _load_data 실행완료: 0.95초
2025-10-20 15:07:23,853 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 15:07:23,853 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 15:07:23,853 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내
(광고)[SKT] ...
2025-10-20 15:07:23,853 - __main__ - INFO - ============================================================
2025-10-20 15:07:23,853 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 15:07:23,853 - __main__ - INFO - ============================================================
2025-10-20 15:07:23,853 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내
(광고)[SKT] 아이폰 12/12 Pro 사전예약 안내  #04 고객님, 안녕하세요. 최고의 스마트폰 칩과 카메라, 견고한 세라믹 실드에 5G 기술까지! 이 모든 것을 갖춘 아이폰 12/12 Pro를 만나 보세요.  ▶ 혜택받고 사전예약하기: http://t-mms.kr/t.do?m=...
2025-10-20 15:07:23,853 - __main__ - INFO - 메시지 길이: 823 문자
2025-10-20 15:07:23,853 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 15:07:23,853 - __main__ - INFO - 데이터 소스: local
2025-10-20 15:07:23,853 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 15:07:23,853 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-20 15:07:23,853 - __main__ - INFO - LLM 모델: ax
2025-10-20 15:07:23,853 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 15:07:23,853 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 15:07:23,853 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 15:07:23,853 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 15:07:23,853 - __main__ - INFO - 처리할 메시지 길이: 816 문자
2025-10-20 15:07:23,854 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 15:07:24,525 - __main__ - INFO - 분할된 문장 수: 9개
2025-10-20 15:07:24,526 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 반가워요', '5G 아이폰 Pro 사전예약 안내 광고 SKT 아이폰 Pro 사전예약 안내 고객님 안녕하세요 ', '최고의 스마트폰 칩과 카메라 견고 세라믹 실드에 5G 기술까지 ']...
2025-10-20 15:07:24,533 - __main__ - INFO - 전체 토큰 수: 310개
2025-10-20 15:07:24,533 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '아이폰', '아이폰', '실드', '아이폰', '아이폰', '스펙', '아이폰', '스마트폰', '택1', '사죠영', '죠르디', '한정판', '기프트', '프리디', '충전기', '에이프릴', '스톤', '충전', '기프트', '.', '카카오톡', '코로나']
2025-10-20 15:07:24,533 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['아이폰', '기프트', '사죠영', '충전기', '택1', '실드', '스펙', '코로나', '스톤', '에이프릴', '프리디', '죠르디', '카카오톡', '한정판']
2025-10-20 15:07:24,533 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 15:07:25,522 - __main__ - INFO - 퍼지 매칭 결과 크기: (2116, 3)
2025-10-20 15:07:25,522 - __main__ - INFO - 퍼지 매칭 성공: 2116개 결과
2025-10-20 15:07:25,523 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.4285714285714286}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.4}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.4}]
2025-10-20 15:07:25,523 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 15:07:25,732 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2116, 3)
2025-10-20 15:07:25,733 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.18461538461538463}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.15000000000000002}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.15000000000000002}]
2025-10-20 15:07:25,733 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 15:07:25,736 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 11개
2025-10-20 15:07:25,738 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 15:07:25,739 - __main__ - INFO - 통합된 후보 아이템 수: 11개
2025-10-20 15:07:25,742 - __main__ - INFO - 최종 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 15:07:25,745 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (10, 2)
2025-10-20 15:07:25,745 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}, {'item_nm': 'IPHONE 16 PRO', 'item_id': ['A5XE', 'A643', 'A5XN', 'A64C', 'A647', 'A63Y', 'A5XJ', 'A5X9']}]
2025-10-20 15:07:25,746 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.89초
2025-10-20 15:07:25,746 - __main__ - INFO - 추출된 후보 엔티티: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 15:07:25,746 - __main__ - INFO - 매칭된 상품 정보: (10, 2)
2025-10-20 15:07:25,746 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 15:07:25,909 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 15:07:25,909 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 15:07:25,909 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 400 문자
2025-10-20 15:07:25,909 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 15:07:25,909 - __main__ - INFO - 후보 아이템 리스트 크기: 11개
2025-10-20 15:07:25,909 - __main__ - INFO - 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 15:07:25,909 - __main__ - INFO - extra_item_pdf 크기: (10, 2)
2025-10-20 15:07:25,909 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 15:07:25,909 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}]
2025-10-20 15:07:25,909 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 15:07:25,909 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 15:07:25,910 - __main__ - INFO - 구성된 프롬프트 길이: 6735 문자
2025-10-20 15:07:25,910 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 15:07:25,910 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 15:07:25,910 - __main__ - INFO - 📝 프롬프트 길이: 6,735 문자
2025-10-20 15:07:25,910 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 15:07:25,910 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 15:07:38,385 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 15:07:38,409 - __main__ - INFO - LLM 응답 길이: 1853 문자
2025-10-20 15:07:38,410 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내"
    ],
    "product": [
        {
            "name": "아이폰 17",
            "action": "구매"
        },
        {
            "name": "아이폰 17 Pro",
            "action": "구매"
        },
        {
            "name": "아이폰 12",
            "action": "구매"
        },
        {
            "name": "아이폰 12 Pro",
            "action": "구매"
        },
        {
            "name": "5G",
  ...
2025-10-20 15:07:38,410 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 15:07:38,411 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 15:07:38,411 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 15:07:38,411 - __main__ - INFO - 파싱된 JSON 내용: {'title': '[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내', 'purpose': ['상품 가입 유도', '혜택 안내'], 'product': [{'name': '아이폰 17', 'action': '구매'}, {'name': '아이폰 17 Pro', 'action': '구매'}, {'name': '아이폰 12', 'action': '구매'}, {'name': '아이폰 12 Pro', 'action': '구매'}, {'name': '5G', 'action': '사용'}, {'name': 'A14 Bionic 칩', 'action': '사용'}, {'name': '세라믹 실드', 'action': '사용'}, {'name': '카메라 시스템', 'action': '사용'}, {'name': 'Dolby Vision 영상 카메라', 'action': '사용'}, {'name': '[사죠영] 죠르디 한정판 기프트', 'action': '기타'}, {'name': '[프리디] 멀티 무선 충전기', 'action': '기타'}, {'name': '[에이프릴스톤] 보조배터리+멀티백', 'action': '기타'}, {'name': '[크레앙] 3in1 무선 충전 살균기', 'action': '기타'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/2HeWcdx', 'action': '추가 정보'}, {'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/3o7zOnA', 'action': '추가 정보'}, {'type': '전화번호', 'value': '1558', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['상품및부가서비스가입유도_단말', '사용법/혜택/이벤트안내_단말']}
2025-10-20 15:07:38,412 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 15:07:38,412 - __main__ - INFO - LLM 추출 엔티티: ['아이폰 17', '아이폰 17 Pro', '아이폰 12', '아이폰 12 Pro', '5G', 'A14 Bionic 칩', '세라믹 실드', '카메라 시스템', 'Dolby Vision 영상 카메라', '[사죠영] 죠르디 한정판 기프트', '[프리디] 멀티 무선 충전기', '[에이프릴스톤] 보조배터리+멀티백', '[크레앙] 3in1 무선 충전 살균기']
2025-10-20 15:07:38,413 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-10-20 15:07:38,413 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 3,233 문자
2025-10-20 15:07:38,413 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-10-20 15:07:38,413 - __main__ - INFO - 📝 프롬프트 길이: 3,233 문자
2025-10-20 15:07:38,413 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-10-20 15:07:38,413 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-10-20 15:07:38,413 - __main__ - INFO - 🔄 1개 LLM 모델로 엔티티 추출 시작
2025-10-20 15:07:38,414 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-20 15:07:38,414 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-20 15:07:38,414 - __main__ - INFO - 🔍 메시지 길이: 816 문자
2025-10-20 15:07:38,508 - __main__ - ERROR - LLM 모델에서 엔티티 추출 실패: name 'cand_entities_list' is not defined
2025-10-20 15:07:38,509 - __main__ - INFO - ✅ LLM 추출 완료: []
2025-10-20 15:07:38,509 - __main__ - WARNING - LLM 추출에서 유효한 엔티티를 찾지 못함
2025-10-20 15:07:38,510 - __main__ - INFO - extract_entities_by_llm 실행완료: 0.10초
2025-10-20 15:07:38,512 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 15:07:38,513 - __main__ - INFO - ============================================================
2025-10-20 15:07:38,513 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 15:07:38,513 - __main__ - INFO - ============================================================
2025-10-20 15:07:38,513 - __main__ - INFO - 제목: [SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내
2025-10-20 15:07:38,513 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내']
2025-10-20 15:07:38,513 - __main__ - INFO - 상품 수: 13개
2025-10-20 15:07:38,513 - __main__ - INFO - 채널 수: 4개
2025-10-20 15:07:38,513 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 15:07:38,514 - __main__ - INFO - process_message 실행완료: 14.66초
2025-10-20 15:07:38,514 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 15:08:38,270 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 15:08:38,271 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 15:08:38,271 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 15:08:38,271 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 15:08:38,271 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 15:08:38,272 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 15:08:38,312 - __main__ - INFO - Using device: mps
2025-10-20 15:08:38,312 - __main__ - INFO - _initialize_device 실행완료: 0.04초
2025-10-20 15:08:38,312 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 15:08:38,312 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 15:08:38,312 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 15:08:38,312 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 15:08:38,312 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 15:08:38,313 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 15:08:38,313 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 15:08:38,985 - __main__ - INFO - Model loaded on mps
2025-10-20 15:08:38,985 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.67초
2025-10-20 15:08:38,985 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 15:08:39,627 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 15:08:39,628 - __main__ - INFO - _initialize_kiwi 실행완료: 0.64초
2025-10-20 15:08:39,628 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 15:08:39,628 - __main__ - INFO - ============================================================
2025-10-20 15:08:39,628 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 15:08:39,628 - __main__ - INFO - ============================================================
2025-10-20 15:08:39,628 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 15:08:39,628 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 15:08:39,628 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 15:08:39,628 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 15:08:39,628 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:08:39,789 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 15:08:39,789 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:08:39,789 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 15:08:39,796 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 15:08:39,797 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 15:08:39,798 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:08:39,799 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:08:39,799 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 15:08:39,799 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 15:08:39,801 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 15:08:39,805 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 15:08:39,805 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 15:08:39,805 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:08:39,806 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 15:08:39,806 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 15:08:39,806 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 15:08:39,806 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:08:39,806 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 15:08:39,806 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 15:08:39,806 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 15:08:39,808 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 15:08:39,808 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 15:08:39,808 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:08:39,809 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 15:08:39,809 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:08:40,031 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 15:08:40,041 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 15:08:40,042 - __main__ - INFO - 별칭 적용 후 샘플: ['우주PASS Netflix 인증', '우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증']
2025-10-20 15:08:40,042 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 15:08:40,043 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 15:08:40,043 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 15:08:40,044 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 15:08:40,044 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 15:08:40,044 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 15:08:40,044 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 15:08:40,045 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 15:08:40,047 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 15:08:40,047 - __main__ - INFO - 등록할 별칭 샘플: ['우주PASS Netflix 인증', '우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증']
2025-10-20 15:08:40,067 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 15:08:40,068 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 15:08:40,068 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 15:08:40,073 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 15:08:40,073 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 15:08:40,421 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 15:08:40,422 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 15:08:40,422 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 15:08:40,422 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 15:08:40,422 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 15:08:40,422 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:08:40,514 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 15:08:40,514 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:08:40,516 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 15:08:40,517 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 15:08:40,517 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 15:08:40,517 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:08:40,517 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 15:08:40,518 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 15:08:40,518 - __main__ - INFO - ============================================================
2025-10-20 15:08:40,518 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 15:08:40,518 - __main__ - INFO - ============================================================
2025-10-20 15:08:40,518 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 15:08:40,518 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 15:08:40,518 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 15:08:40,518 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 15:08:40,518 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 15:08:40,519 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 15:08:40,521 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 15:08:40,524 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 15:08:40,524 - __main__ - INFO - _load_data 실행완료: 0.90초
2025-10-20 15:08:40,524 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 15:08:40,524 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 15:08:40,524 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내
(광고)[SKT] ...
2025-10-20 15:08:40,524 - __main__ - INFO - ============================================================
2025-10-20 15:08:40,524 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 15:08:40,524 - __main__ - INFO - ============================================================
2025-10-20 15:08:40,524 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내
(광고)[SKT] 아이폰 12/12 Pro 사전예약 안내  #04 고객님, 안녕하세요. 최고의 스마트폰 칩과 카메라, 견고한 세라믹 실드에 5G 기술까지! 이 모든 것을 갖춘 아이폰 12/12 Pro를 만나 보세요.  ▶ 혜택받고 사전예약하기: http://t-mms.kr/t.do?m=...
2025-10-20 15:08:40,524 - __main__ - INFO - 메시지 길이: 823 문자
2025-10-20 15:08:40,524 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 15:08:40,524 - __main__ - INFO - 데이터 소스: local
2025-10-20 15:08:40,524 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 15:08:40,524 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-20 15:08:40,524 - __main__ - INFO - LLM 모델: ax
2025-10-20 15:08:40,524 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 15:08:40,524 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 15:08:40,524 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 15:08:40,524 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 15:08:40,524 - __main__ - INFO - 처리할 메시지 길이: 816 문자
2025-10-20 15:08:40,525 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 15:08:41,271 - __main__ - INFO - 분할된 문장 수: 9개
2025-10-20 15:08:41,273 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 반가워요', '5G 아이폰 Pro 사전예약 안내 광고 SKT 아이폰 Pro 사전예약 안내 고객님 안녕하세요 ', '최고의 스마트폰 칩과 카메라 견고 세라믹 실드에 5G 기술까지 ']...
2025-10-20 15:08:41,280 - __main__ - INFO - 전체 토큰 수: 310개
2025-10-20 15:08:41,280 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '아이폰', '아이폰', '실드', '아이폰', '아이폰', '스펙', '아이폰', '스마트폰', '택1', '사죠영', '죠르디', '한정판', '기프트', '프리디', '충전기', '에이프릴', '스톤', '충전', '기프트', '.', '카카오톡', '코로나']
2025-10-20 15:08:41,280 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['프리디', '기프트', '한정판', '카카오톡', '스펙', '죠르디', '아이폰', '실드', '스톤', '충전기', '택1', '에이프릴', '사죠영', '코로나']
2025-10-20 15:08:41,280 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 15:08:42,288 - __main__ - INFO - 퍼지 매칭 결과 크기: (2116, 3)
2025-10-20 15:08:42,288 - __main__ - INFO - 퍼지 매칭 성공: 2116개 결과
2025-10-20 15:08:42,289 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.4285714285714286}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.4}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.4}]
2025-10-20 15:08:42,289 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 15:08:42,458 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2116, 3)
2025-10-20 15:08:42,458 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.18461538461538463}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.15000000000000002}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.15000000000000002}]
2025-10-20 15:08:42,458 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 15:08:42,461 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 11개
2025-10-20 15:08:42,463 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 15:08:42,464 - __main__ - INFO - 통합된 후보 아이템 수: 11개
2025-10-20 15:08:42,468 - __main__ - INFO - 최종 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 15:08:42,471 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (10, 2)
2025-10-20 15:08:42,472 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}, {'item_nm': 'IPHONE 16 PRO', 'item_id': ['A5XE', 'A643', 'A5XN', 'A64C', 'A647', 'A63Y', 'A5XJ', 'A5X9']}]
2025-10-20 15:08:42,472 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.95초
2025-10-20 15:08:42,472 - __main__ - INFO - 추출된 후보 엔티티: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 15:08:42,472 - __main__ - INFO - 매칭된 상품 정보: (10, 2)
2025-10-20 15:08:42,472 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 15:08:42,650 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 15:08:42,650 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 15:08:42,650 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 400 문자
2025-10-20 15:08:42,650 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 15:08:42,650 - __main__ - INFO - 후보 아이템 리스트 크기: 11개
2025-10-20 15:08:42,650 - __main__ - INFO - 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 15:08:42,650 - __main__ - INFO - extra_item_pdf 크기: (10, 2)
2025-10-20 15:08:42,650 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 15:08:42,651 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}]
2025-10-20 15:08:42,651 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 15:08:42,651 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 15:08:42,651 - __main__ - INFO - 구성된 프롬프트 길이: 6735 문자
2025-10-20 15:08:42,651 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 15:08:42,651 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 15:08:42,651 - __main__ - INFO - 📝 프롬프트 길이: 6,735 문자
2025-10-20 15:08:42,651 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 15:08:42,651 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 15:08:55,327 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 15:08:55,339 - __main__ - INFO - LLM 응답 길이: 1853 문자
2025-10-20 15:08:55,340 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내"
    ],
    "product": [
        {
            "name": "아이폰 17",
            "action": "구매"
        },
        {
            "name": "아이폰 17 Pro",
            "action": "구매"
        },
        {
            "name": "아이폰 12",
            "action": "구매"
        },
        {
            "name": "아이폰 12 Pro",
            "action": "구매"
        },
        {
            "name": "5G",
  ...
2025-10-20 15:08:55,340 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 15:08:55,340 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 15:08:55,340 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 15:08:55,341 - __main__ - INFO - 파싱된 JSON 내용: {'title': '[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내', 'purpose': ['상품 가입 유도', '혜택 안내'], 'product': [{'name': '아이폰 17', 'action': '구매'}, {'name': '아이폰 17 Pro', 'action': '구매'}, {'name': '아이폰 12', 'action': '구매'}, {'name': '아이폰 12 Pro', 'action': '구매'}, {'name': '5G', 'action': '사용'}, {'name': 'A14 Bionic 칩', 'action': '사용'}, {'name': '세라믹 실드', 'action': '사용'}, {'name': '카메라 시스템', 'action': '사용'}, {'name': 'Dolby Vision 영상 카메라', 'action': '사용'}, {'name': '[사죠영] 죠르디 한정판 기프트', 'action': '기타'}, {'name': '[프리디] 멀티 무선 충전기', 'action': '기타'}, {'name': '[에이프릴스톤] 보조배터리+멀티백', 'action': '기타'}, {'name': '[크레앙] 3in1 무선 충전 살균기', 'action': '기타'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/2HeWcdx', 'action': '추가 정보'}, {'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/3o7zOnA', 'action': '추가 정보'}, {'type': '전화번호', 'value': '1558', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['상품및부가서비스가입유도_단말', '사용법/혜택/이벤트안내_단말']}
2025-10-20 15:08:55,341 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 15:08:55,341 - __main__ - INFO - LLM 추출 엔티티: ['아이폰 17', '아이폰 17 Pro', '아이폰 12', '아이폰 12 Pro', '5G', 'A14 Bionic 칩', '세라믹 실드', '카메라 시스템', 'Dolby Vision 영상 카메라', '[사죠영] 죠르디 한정판 기프트', '[프리디] 멀티 무선 충전기', '[에이프릴스톤] 보조배터리+멀티백', '[크레앙] 3in1 무선 충전 살균기']
2025-10-20 15:08:55,342 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-10-20 15:08:55,342 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 3,233 문자
2025-10-20 15:08:55,342 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-10-20 15:08:55,342 - __main__ - INFO - 📝 프롬프트 길이: 3,233 문자
2025-10-20 15:08:55,342 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-10-20 15:08:55,342 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-10-20 15:08:55,342 - __main__ - INFO - 🔄 1개 LLM 모델로 엔티티 추출 시작
2025-10-20 15:08:55,342 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-20 15:08:55,342 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-20 15:08:55,342 - __main__ - INFO - 🔍 메시지 길이: 816 문자
2025-10-20 15:08:55,402 - __main__ - ERROR - LLM 모델에서 엔티티 추출 실패: name 'cand_entities_list' is not defined
2025-10-20 15:08:55,402 - __main__ - INFO - ✅ LLM 추출 완료: []
2025-10-20 15:08:55,402 - __main__ - WARNING - LLM 추출에서 유효한 엔티티를 찾지 못함
2025-10-20 15:08:55,403 - __main__ - INFO - extract_entities_by_llm 실행완료: 0.06초
2025-10-20 15:08:55,405 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 15:08:55,405 - __main__ - INFO - ============================================================
2025-10-20 15:08:55,405 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 15:08:55,405 - __main__ - INFO - ============================================================
2025-10-20 15:08:55,405 - __main__ - INFO - 제목: [SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내
2025-10-20 15:08:55,405 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내']
2025-10-20 15:08:55,405 - __main__ - INFO - 상품 수: 13개
2025-10-20 15:08:55,405 - __main__ - INFO - 채널 수: 4개
2025-10-20 15:08:55,405 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 15:08:55,406 - __main__ - INFO - process_message 실행완료: 14.88초
2025-10-20 15:08:55,406 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 15:09:47,836 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 15:09:47,836 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 15:09:47,836 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 15:09:47,836 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 15:09:47,836 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 15:09:47,837 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 15:09:47,867 - __main__ - INFO - Using device: mps
2025-10-20 15:09:47,867 - __main__ - INFO - _initialize_device 실행완료: 0.03초
2025-10-20 15:09:47,867 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 15:09:47,867 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 15:09:47,867 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 15:09:47,867 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 15:09:47,867 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 15:09:47,867 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 15:09:47,867 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 15:09:48,358 - __main__ - INFO - Model loaded on mps
2025-10-20 15:09:48,359 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.49초
2025-10-20 15:09:48,359 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 15:09:48,969 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 15:09:48,969 - __main__ - INFO - _initialize_kiwi 실행완료: 0.61초
2025-10-20 15:09:48,969 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 15:09:48,969 - __main__ - INFO - ============================================================
2025-10-20 15:09:48,969 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 15:09:48,969 - __main__ - INFO - ============================================================
2025-10-20 15:09:48,969 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 15:09:48,969 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 15:09:48,969 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 15:09:48,969 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 15:09:48,969 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:09:49,136 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 15:09:49,136 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:09:49,136 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 15:09:49,143 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 15:09:49,145 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 15:09:49,145 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:09:49,146 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:09:49,147 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 15:09:49,147 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 15:09:49,149 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 15:09:49,153 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 15:09:49,153 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 15:09:49,153 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:09:49,153 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 15:09:49,153 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 15:09:49,153 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 15:09:49,154 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:09:49,154 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 15:09:49,154 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 15:09:49,154 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 15:09:49,155 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 15:09:49,155 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 15:09:49,155 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:09:49,156 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 15:09:49,156 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:09:49,376 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 15:09:49,386 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 15:09:49,387 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 Netflix 인증', '우주pass Netflix 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증', '우주패스 넷플릭스 인증']
2025-10-20 15:09:49,387 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 15:09:49,387 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 15:09:49,387 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 15:09:49,389 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 15:09:49,389 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 15:09:49,389 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 15:09:49,389 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 15:09:49,390 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 15:09:49,391 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 15:09:49,391 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 Netflix 인증', '우주pass Netflix 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증', '우주패스 넷플릭스 인증']
2025-10-20 15:09:49,411 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 15:09:49,412 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 15:09:49,412 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 15:09:49,414 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 15:09:49,414 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 15:09:49,676 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 15:09:49,676 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 15:09:49,676 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 15:09:49,676 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 15:09:49,676 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 15:09:49,676 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:09:49,763 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 15:09:49,763 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:09:49,766 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 15:09:49,766 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 15:09:49,766 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 15:09:49,766 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:09:49,766 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 15:09:49,767 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 15:09:49,767 - __main__ - INFO - ============================================================
2025-10-20 15:09:49,767 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 15:09:49,767 - __main__ - INFO - ============================================================
2025-10-20 15:09:49,767 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 15:09:49,767 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 15:09:49,767 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 15:09:49,767 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 15:09:49,767 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 15:09:49,768 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 15:09:49,770 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 15:09:49,772 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 15:09:49,773 - __main__ - INFO - _load_data 실행완료: 0.80초
2025-10-20 15:09:49,773 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 15:09:49,773 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 15:09:49,773 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내
(광고)[SKT] ...
2025-10-20 15:09:49,773 - __main__ - INFO - ============================================================
2025-10-20 15:09:49,773 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 15:09:49,773 - __main__ - INFO - ============================================================
2025-10-20 15:09:49,773 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내
(광고)[SKT] 아이폰 12/12 Pro 사전예약 안내  #04 고객님, 안녕하세요. 최고의 스마트폰 칩과 카메라, 견고한 세라믹 실드에 5G 기술까지! 이 모든 것을 갖춘 아이폰 12/12 Pro를 만나 보세요.  ▶ 혜택받고 사전예약하기: http://t-mms.kr/t.do?m=...
2025-10-20 15:09:49,773 - __main__ - INFO - 메시지 길이: 823 문자
2025-10-20 15:09:49,773 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 15:09:49,773 - __main__ - INFO - 데이터 소스: local
2025-10-20 15:09:49,773 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 15:09:49,773 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-20 15:09:49,773 - __main__ - INFO - LLM 모델: ax
2025-10-20 15:09:49,773 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 15:09:49,773 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 15:09:49,773 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 15:09:49,773 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 15:09:49,773 - __main__ - INFO - 처리할 메시지 길이: 816 문자
2025-10-20 15:09:49,774 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 15:09:50,451 - __main__ - INFO - 분할된 문장 수: 9개
2025-10-20 15:09:50,452 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 반가워요', '5G 아이폰 Pro 사전예약 안내 광고 SKT 아이폰 Pro 사전예약 안내 고객님 안녕하세요 ', '최고의 스마트폰 칩과 카메라 견고 세라믹 실드에 5G 기술까지 ']...
2025-10-20 15:09:50,459 - __main__ - INFO - 전체 토큰 수: 310개
2025-10-20 15:09:50,459 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '아이폰', '아이폰', '실드', '아이폰', '아이폰', '스펙', '아이폰', '스마트폰', '택1', '사죠영', '죠르디', '한정판', '기프트', '프리디', '충전기', '에이프릴', '스톤', '충전', '기프트', '.', '카카오톡', '코로나']
2025-10-20 15:09:50,460 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['카카오톡', '기프트', '코로나', '사죠영', '아이폰', '스펙', '에이프릴', '실드', '죠르디', '택1', '스톤', '프리디', '충전기', '한정판']
2025-10-20 15:09:50,460 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 15:09:51,466 - __main__ - INFO - 퍼지 매칭 결과 크기: (2116, 3)
2025-10-20 15:09:51,466 - __main__ - INFO - 퍼지 매칭 성공: 2116개 결과
2025-10-20 15:09:51,467 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.4285714285714286}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.4}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.4}]
2025-10-20 15:09:51,467 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 15:09:51,627 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2116, 3)
2025-10-20 15:09:51,628 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.18461538461538463}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.15000000000000002}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.15000000000000002}]
2025-10-20 15:09:51,628 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 15:09:51,631 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 11개
2025-10-20 15:09:51,633 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 15:09:51,634 - __main__ - INFO - 통합된 후보 아이템 수: 11개
2025-10-20 15:09:51,637 - __main__ - INFO - 최종 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 15:09:51,640 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (10, 2)
2025-10-20 15:09:51,640 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}, {'item_nm': 'IPHONE 16 PRO', 'item_id': ['A5XE', 'A643', 'A5XN', 'A64C', 'A647', 'A63Y', 'A5XJ', 'A5X9']}]
2025-10-20 15:09:51,641 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.87초
2025-10-20 15:09:51,641 - __main__ - INFO - 추출된 후보 엔티티: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 15:09:51,641 - __main__ - INFO - 매칭된 상품 정보: (10, 2)
2025-10-20 15:09:51,641 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 15:09:51,805 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 15:09:51,805 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 15:09:51,805 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 400 문자
2025-10-20 15:09:51,805 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 15:09:51,805 - __main__ - INFO - 후보 아이템 리스트 크기: 11개
2025-10-20 15:09:51,805 - __main__ - INFO - 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 15:09:51,805 - __main__ - INFO - extra_item_pdf 크기: (10, 2)
2025-10-20 15:09:51,805 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 15:09:51,805 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}]
2025-10-20 15:09:51,806 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 15:09:51,806 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 15:09:51,806 - __main__ - INFO - 구성된 프롬프트 길이: 6735 문자
2025-10-20 15:09:51,806 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 15:09:51,806 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 15:09:51,806 - __main__ - INFO - 📝 프롬프트 길이: 6,735 문자
2025-10-20 15:09:51,806 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 15:09:51,806 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 15:10:04,742 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 15:10:04,752 - __main__ - INFO - LLM 응답 길이: 1853 문자
2025-10-20 15:10:04,753 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내"
    ],
    "product": [
        {
            "name": "아이폰 17",
            "action": "구매"
        },
        {
            "name": "아이폰 17 Pro",
            "action": "구매"
        },
        {
            "name": "아이폰 12",
            "action": "구매"
        },
        {
            "name": "아이폰 12 Pro",
            "action": "구매"
        },
        {
            "name": "5G",
  ...
2025-10-20 15:10:04,753 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 15:10:04,753 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 15:10:04,753 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 15:10:04,754 - __main__ - INFO - 파싱된 JSON 내용: {'title': '[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내', 'purpose': ['상품 가입 유도', '혜택 안내'], 'product': [{'name': '아이폰 17', 'action': '구매'}, {'name': '아이폰 17 Pro', 'action': '구매'}, {'name': '아이폰 12', 'action': '구매'}, {'name': '아이폰 12 Pro', 'action': '구매'}, {'name': '5G', 'action': '사용'}, {'name': 'A14 Bionic 칩', 'action': '사용'}, {'name': '세라믹 실드', 'action': '사용'}, {'name': '카메라 시스템', 'action': '사용'}, {'name': 'Dolby Vision 영상 카메라', 'action': '사용'}, {'name': '[사죠영] 죠르디 한정판 기프트', 'action': '기타'}, {'name': '[프리디] 멀티 무선 충전기', 'action': '기타'}, {'name': '[에이프릴스톤] 보조배터리+멀티백', 'action': '기타'}, {'name': '[크레앙] 3in1 무선 충전 살균기', 'action': '기타'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/2HeWcdx', 'action': '추가 정보'}, {'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/3o7zOnA', 'action': '추가 정보'}, {'type': '전화번호', 'value': '1558', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['상품및부가서비스가입유도_단말', '사용법/혜택/이벤트안내_단말']}
2025-10-20 15:10:04,754 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 15:10:04,754 - __main__ - INFO - LLM 추출 엔티티: ['아이폰 17', '아이폰 17 Pro', '아이폰 12', '아이폰 12 Pro', '5G', 'A14 Bionic 칩', '세라믹 실드', '카메라 시스템', 'Dolby Vision 영상 카메라', '[사죠영] 죠르디 한정판 기프트', '[프리디] 멀티 무선 충전기', '[에이프릴스톤] 보조배터리+멀티백', '[크레앙] 3in1 무선 충전 살균기']
2025-10-20 15:10:04,754 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-10-20 15:10:04,754 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 3,233 문자
2025-10-20 15:10:04,755 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-10-20 15:10:04,755 - __main__ - INFO - 📝 프롬프트 길이: 3,233 문자
2025-10-20 15:10:04,755 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-10-20 15:10:04,755 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-10-20 15:10:04,755 - __main__ - INFO - 🔄 1개 LLM 모델로 엔티티 추출 시작
2025-10-20 15:10:04,755 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-20 15:10:04,755 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-20 15:10:04,755 - __main__ - INFO - 🔍 메시지 길이: 816 문자
2025-10-20 15:10:06,382 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 15:10:06,386 - __main__ - INFO - ✅ LLM 추출 완료: ['아이폰 17 Pro', '[크레앙] 3in1 무선 충전 살균기', '아이폰 17', 'T기프트', 'T다이렉트샵', '아이폰 12 Pro', '[사죠영] 죠르디 한정판 기프트', '[프리디] 멀티 무선 충전기', '[에이프릴스톤] 보조배터리+멀티백', '아이폰 12']
2025-10-20 15:10:06,889 - __main__ - INFO - extract_entities_by_llm 실행완료: 2.13초
2025-10-20 15:10:06,897 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 15:10:06,897 - __main__ - INFO - ============================================================
2025-10-20 15:10:06,897 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 15:10:06,897 - __main__ - INFO - ============================================================
2025-10-20 15:10:06,897 - __main__ - INFO - 제목: [SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내
2025-10-20 15:10:06,897 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내']
2025-10-20 15:10:06,897 - __main__ - INFO - 상품 수: 2개
2025-10-20 15:10:06,897 - __main__ - INFO - 채널 수: 4개
2025-10-20 15:10:06,897 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 15:10:06,897 - __main__ - INFO - process_message 실행완료: 17.12초
2025-10-20 15:10:06,897 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 15:12:15,174 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 15:12:15,174 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 15:12:15,174 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 15:12:15,174 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 15:12:15,174 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 15:12:15,176 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 15:12:15,207 - __main__ - INFO - Using device: mps
2025-10-20 15:12:15,207 - __main__ - INFO - _initialize_device 실행완료: 0.03초
2025-10-20 15:12:15,207 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 15:12:15,208 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 15:12:15,208 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 15:12:15,208 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 15:12:15,208 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 15:12:15,208 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 15:12:15,208 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 15:12:15,502 - __main__ - INFO - Model loaded on mps
2025-10-20 15:12:15,503 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.29초
2025-10-20 15:12:15,503 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 15:12:16,181 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 15:12:16,181 - __main__ - INFO - _initialize_kiwi 실행완료: 0.68초
2025-10-20 15:12:16,181 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 15:12:16,181 - __main__ - INFO - ============================================================
2025-10-20 15:12:16,181 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 15:12:16,181 - __main__ - INFO - ============================================================
2025-10-20 15:12:16,181 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 15:12:16,181 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 15:12:16,181 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 15:12:16,181 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 15:12:16,181 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:12:16,337 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 15:12:16,337 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:12:16,337 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 15:12:16,344 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 15:12:16,345 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 15:12:16,346 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:12:16,346 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:12:16,347 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 15:12:16,347 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 15:12:16,349 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 15:12:16,353 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 15:12:16,354 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 15:12:16,354 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:12:16,354 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 15:12:16,354 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 15:12:16,354 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 15:12:16,354 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:12:16,354 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 15:12:16,354 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 15:12:16,354 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 15:12:16,356 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 15:12:16,356 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 15:12:16,356 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:12:16,357 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 15:12:16,357 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:12:16,594 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 15:12:16,604 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 15:12:16,605 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 Netflix 인증', '우주PASS Netflix 인증', '우주패스 넷플릭스 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증']
2025-10-20 15:12:16,605 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 15:12:16,605 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 15:12:16,605 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 15:12:16,607 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 15:12:16,607 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 15:12:16,607 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 15:12:16,607 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 15:12:16,608 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 15:12:16,609 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 15:12:16,609 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 Netflix 인증', '우주PASS Netflix 인증', '우주패스 넷플릭스 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증']
2025-10-20 15:12:16,630 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 15:12:16,631 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 15:12:16,631 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 15:12:16,633 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 15:12:16,633 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 15:12:16,929 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 15:12:16,929 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 15:12:16,929 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 15:12:16,929 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 15:12:16,929 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 15:12:16,930 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:12:17,017 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 15:12:17,017 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:12:17,019 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 15:12:17,020 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 15:12:17,020 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 15:12:17,020 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:12:17,020 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 15:12:17,021 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 15:12:17,021 - __main__ - INFO - ============================================================
2025-10-20 15:12:17,021 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 15:12:17,021 - __main__ - INFO - ============================================================
2025-10-20 15:12:17,021 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 15:12:17,021 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 15:12:17,021 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 15:12:17,021 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 15:12:17,021 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 15:12:17,022 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 15:12:17,024 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 15:12:17,026 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 15:12:17,026 - __main__ - INFO - _load_data 실행완료: 0.85초
2025-10-20 15:12:17,026 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 15:12:17,026 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 15:12:17,026 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내
(광고)[SKT] ...
2025-10-20 15:12:17,026 - __main__ - INFO - ============================================================
2025-10-20 15:12:17,026 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 15:12:17,026 - __main__ - INFO - ============================================================
2025-10-20 15:12:17,026 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내
(광고)[SKT] 아이폰 12/12 Pro 사전예약 안내  #04 고객님, 안녕하세요. 최고의 스마트폰 칩과 카메라, 견고한 세라믹 실드에 5G 기술까지! 이 모든 것을 갖춘 아이폰 12/12 Pro를 만나 보세요.  ▶ 혜택받고 사전예약하기: http://t-mms.kr/t.do?m=...
2025-10-20 15:12:17,026 - __main__ - INFO - 메시지 길이: 823 문자
2025-10-20 15:12:17,026 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 15:12:17,026 - __main__ - INFO - 데이터 소스: local
2025-10-20 15:12:17,026 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 15:12:17,026 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-20 15:12:17,026 - __main__ - INFO - LLM 모델: ax
2025-10-20 15:12:17,026 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 15:12:17,026 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 15:12:17,026 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 15:12:17,026 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 15:12:17,027 - __main__ - INFO - 처리할 메시지 길이: 816 문자
2025-10-20 15:12:17,028 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 15:12:17,732 - __main__ - INFO - 분할된 문장 수: 9개
2025-10-20 15:12:17,734 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 반가워요', '5G 아이폰 Pro 사전예약 안내 광고 SKT 아이폰 Pro 사전예약 안내 고객님 안녕하세요 ', '최고의 스마트폰 칩과 카메라 견고 세라믹 실드에 5G 기술까지 ']...
2025-10-20 15:12:17,741 - __main__ - INFO - 전체 토큰 수: 310개
2025-10-20 15:12:17,741 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '아이폰', '아이폰', '실드', '아이폰', '아이폰', '스펙', '아이폰', '스마트폰', '택1', '사죠영', '죠르디', '한정판', '기프트', '프리디', '충전기', '에이프릴', '스톤', '충전', '기프트', '.', '카카오톡', '코로나']
2025-10-20 15:12:17,742 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['사죠영', '실드', '프리디', '한정판', '충전기', '코로나', '택1', '아이폰', '죠르디', '기프트', '카카오톡', '에이프릴', '스펙', '스톤']
2025-10-20 15:12:17,742 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 15:12:18,734 - __main__ - INFO - 퍼지 매칭 결과 크기: (2116, 3)
2025-10-20 15:12:18,735 - __main__ - INFO - 퍼지 매칭 성공: 2116개 결과
2025-10-20 15:12:18,736 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.4285714285714286}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.4}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.4}]
2025-10-20 15:12:18,736 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 15:12:18,913 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2116, 3)
2025-10-20 15:12:18,913 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.18461538461538463}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.15000000000000002}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.15000000000000002}]
2025-10-20 15:12:18,914 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 15:12:18,917 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 11개
2025-10-20 15:12:18,919 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 15:12:18,920 - __main__ - INFO - 통합된 후보 아이템 수: 11개
2025-10-20 15:12:18,922 - __main__ - INFO - 최종 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 15:12:18,925 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (10, 2)
2025-10-20 15:12:18,925 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}, {'item_nm': 'IPHONE 16 PRO', 'item_id': ['A5XE', 'A643', 'A5XN', 'A64C', 'A647', 'A63Y', 'A5XJ', 'A5X9']}]
2025-10-20 15:12:18,925 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.90초
2025-10-20 15:12:18,925 - __main__ - INFO - 추출된 후보 엔티티: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 15:12:18,925 - __main__ - INFO - 매칭된 상품 정보: (10, 2)
2025-10-20 15:12:18,925 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 15:12:19,085 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 15:12:19,085 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 15:12:19,085 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 400 문자
2025-10-20 15:12:19,085 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 15:12:19,085 - __main__ - INFO - 후보 아이템 리스트 크기: 11개
2025-10-20 15:12:19,085 - __main__ - INFO - 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 15:12:19,085 - __main__ - INFO - extra_item_pdf 크기: (10, 2)
2025-10-20 15:12:19,085 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 15:12:19,086 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}]
2025-10-20 15:12:19,086 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 15:12:19,086 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 15:12:19,086 - __main__ - INFO - 구성된 프롬프트 길이: 6735 문자
2025-10-20 15:12:19,086 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 15:12:19,086 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 15:12:19,086 - __main__ - INFO - 📝 프롬프트 길이: 6,735 문자
2025-10-20 15:12:19,086 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 15:12:19,086 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 15:12:32,329 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 15:12:32,345 - __main__ - INFO - LLM 응답 길이: 1853 문자
2025-10-20 15:12:32,345 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내"
    ],
    "product": [
        {
            "name": "아이폰 17",
            "action": "구매"
        },
        {
            "name": "아이폰 17 Pro",
            "action": "구매"
        },
        {
            "name": "아이폰 12",
            "action": "구매"
        },
        {
            "name": "아이폰 12 Pro",
            "action": "구매"
        },
        {
            "name": "5G",
  ...
2025-10-20 15:12:32,345 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 15:12:32,347 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 15:12:32,347 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 15:12:32,347 - __main__ - INFO - 파싱된 JSON 내용: {'title': '[SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내', 'purpose': ['상품 가입 유도', '혜택 안내'], 'product': [{'name': '아이폰 17', 'action': '구매'}, {'name': '아이폰 17 Pro', 'action': '구매'}, {'name': '아이폰 12', 'action': '구매'}, {'name': '아이폰 12 Pro', 'action': '구매'}, {'name': '5G', 'action': '사용'}, {'name': 'A14 Bionic 칩', 'action': '사용'}, {'name': '세라믹 실드', 'action': '사용'}, {'name': '카메라 시스템', 'action': '사용'}, {'name': 'Dolby Vision 영상 카메라', 'action': '사용'}, {'name': '[사죠영] 죠르디 한정판 기프트', 'action': '기타'}, {'name': '[프리디] 멀티 무선 충전기', 'action': '기타'}, {'name': '[에이프릴스톤] 보조배터리+멀티백', 'action': '기타'}, {'name': '[크레앙] 3in1 무선 충전 살균기', 'action': '기타'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/2HeWcdx', 'action': '추가 정보'}, {'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/3o7zOnA', 'action': '추가 정보'}, {'type': '전화번호', 'value': '1558', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['상품및부가서비스가입유도_단말', '사용법/혜택/이벤트안내_단말']}
2025-10-20 15:12:32,347 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 15:12:32,347 - __main__ - INFO - LLM 추출 엔티티: ['아이폰 17', '아이폰 17 Pro', '아이폰 12', '아이폰 12 Pro', '5G', 'A14 Bionic 칩', '세라믹 실드', '카메라 시스템', 'Dolby Vision 영상 카메라', '[사죠영] 죠르디 한정판 기프트', '[프리디] 멀티 무선 충전기', '[에이프릴스톤] 보조배터리+멀티백', '[크레앙] 3in1 무선 충전 살균기']
2025-10-20 15:12:32,349 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-10-20 15:12:32,349 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 3,233 문자
2025-10-20 15:12:32,349 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-10-20 15:12:32,349 - __main__ - INFO - 📝 프롬프트 길이: 3,233 문자
2025-10-20 15:12:32,349 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-10-20 15:12:32,349 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-10-20 15:12:32,349 - __main__ - INFO - 🔄 1개 LLM 모델로 엔티티 추출 시작
2025-10-20 15:12:32,349 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-20 15:12:32,349 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-20 15:12:32,349 - __main__ - INFO - 🔍 메시지 길이: 816 문자
2025-10-20 15:12:33,971 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 15:12:33,974 - __main__ - INFO - ✅ LLM 추출 완료: ['[사죠영] 죠르디 한정판 기프트', '아이폰 12 Pro', '[크레앙] 3in1 무선 충전 살균기', '아이폰 12', '아이폰 17 Pro', '아이폰 17', 'T다이렉트샵', '[프리디] 멀티 무선 충전기', 'T기프트', '[에이프릴스톤] 보조배터리+멀티백']
2025-10-20 15:12:34,445 - __main__ - INFO - extract_entities_by_llm 실행완료: 2.10초
2025-10-20 15:12:34,451 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 15:12:34,451 - __main__ - INFO - ============================================================
2025-10-20 15:12:34,451 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 15:12:34,451 - __main__ - INFO - ============================================================
2025-10-20 15:12:34,451 - __main__ - INFO - 제목: [SK텔레콤] 반가워요 5G 아이폰 17/ 17 Pro 사전예약 안내
2025-10-20 15:12:34,451 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내']
2025-10-20 15:12:34,451 - __main__ - INFO - 상품 수: 2개
2025-10-20 15:12:34,451 - __main__ - INFO - 채널 수: 4개
2025-10-20 15:12:34,451 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 15:12:34,451 - __main__ - INFO - process_message 실행완료: 17.43초
2025-10-20 15:12:34,451 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 15:12:54,189 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 15:12:54,190 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 15:12:54,190 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 15:12:54,190 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 15:12:54,190 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 15:12:54,191 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 15:12:54,227 - __main__ - INFO - Using device: mps
2025-10-20 15:12:54,227 - __main__ - INFO - _initialize_device 실행완료: 0.04초
2025-10-20 15:12:54,227 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 15:12:54,228 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 15:12:54,228 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 15:12:54,228 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 15:12:54,228 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 15:12:54,228 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 15:12:54,228 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 15:12:54,490 - __main__ - INFO - Model loaded on mps
2025-10-20 15:12:54,490 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.26초
2025-10-20 15:12:54,490 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 15:12:55,060 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 15:12:55,060 - __main__ - INFO - _initialize_kiwi 실행완료: 0.57초
2025-10-20 15:12:55,060 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 15:12:55,060 - __main__ - INFO - ============================================================
2025-10-20 15:12:55,060 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 15:12:55,060 - __main__ - INFO - ============================================================
2025-10-20 15:12:55,060 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 15:12:55,060 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 15:12:55,060 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 15:12:55,060 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 15:12:55,060 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:12:55,209 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 15:12:55,209 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:12:55,209 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 15:12:55,216 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 15:12:55,217 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 15:12:55,218 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:12:55,219 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:12:55,219 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 15:12:55,219 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 15:12:55,221 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 15:12:55,224 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 15:12:55,225 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 15:12:55,225 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:12:55,225 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 15:12:55,225 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 15:12:55,225 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 15:12:55,225 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:12:55,225 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 15:12:55,225 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 15:12:55,225 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 15:12:55,227 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 15:12:55,227 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 15:12:55,227 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:12:55,227 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 15:12:55,228 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:12:55,451 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 15:12:55,461 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 15:12:55,462 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 넷플릭스 인증', '우주pass Netflix 인증', '우주패스 Netflix 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증']
2025-10-20 15:12:55,462 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 15:12:55,462 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 15:12:55,462 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 15:12:55,464 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 15:12:55,464 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 15:12:55,464 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 15:12:55,464 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 15:12:55,465 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 15:12:55,466 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 15:12:55,466 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 넷플릭스 인증', '우주pass Netflix 인증', '우주패스 Netflix 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증']
2025-10-20 15:12:55,486 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 15:12:55,487 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 15:12:55,487 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 15:12:55,488 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 15:12:55,488 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 15:12:55,748 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 15:12:55,748 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 15:12:55,748 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 15:12:55,748 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 15:12:55,748 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 15:12:55,748 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:12:55,836 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 15:12:55,836 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:12:55,838 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 15:12:55,839 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 15:12:55,839 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 15:12:55,839 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:12:55,839 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 15:12:55,839 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 15:12:55,840 - __main__ - INFO - ============================================================
2025-10-20 15:12:55,840 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 15:12:55,840 - __main__ - INFO - ============================================================
2025-10-20 15:12:55,840 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 15:12:55,840 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 15:12:55,840 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 15:12:55,840 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 15:12:55,840 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 15:12:55,841 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 15:12:55,843 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 15:12:55,845 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 15:12:55,845 - __main__ - INFO - _load_data 실행완료: 0.78초
2025-10-20 15:12:55,845 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 15:12:55,845 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 15:12:55,845 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
(광고)[SKT] 아...
2025-10-20 15:12:55,845 - __main__ - INFO - ============================================================
2025-10-20 15:12:55,845 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 15:12:55,845 - __main__ - INFO - ============================================================
2025-10-20 15:12:55,845 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
(광고)[SKT] 아이폰 12/12 Pro 사전예약 안내  #04 고객님, 안녕하세요. 최고의 스마트폰 칩과 카메라, 견고한 세라믹 실드에 5G 기술까지! 이 모든 것을 갖춘 아이폰 12/12 Pro를 만나 보세요.  ▶ 혜택받고 사전예약하기: http://t-mms.kr/t.do?m=#...
2025-10-20 15:12:55,845 - __main__ - INFO - 메시지 길이: 822 문자
2025-10-20 15:12:55,845 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 15:12:55,845 - __main__ - INFO - 데이터 소스: local
2025-10-20 15:12:55,845 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 15:12:55,845 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-20 15:12:55,845 - __main__ - INFO - LLM 모델: ax
2025-10-20 15:12:55,845 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 15:12:55,845 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 15:12:55,845 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 15:12:55,845 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 15:12:55,845 - __main__ - INFO - 처리할 메시지 길이: 815 문자
2025-10-20 15:12:55,846 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 15:12:56,510 - __main__ - INFO - 분할된 문장 수: 9개
2025-10-20 15:12:56,511 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 반가워요', '5G 아이폰 Pro 사전예약 안내 광고 SKT 아이폰 Pro 사전예약 안내 고객님 안녕하세요 ', '최고의 스마트폰 칩과 카메라 견고 세라믹 실드에 5G 기술까지 ']...
2025-10-20 15:12:56,519 - __main__ - INFO - 전체 토큰 수: 310개
2025-10-20 15:12:56,519 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '아이폰', '아이폰', '실드', '아이폰', '아이폰', '스펙', '아이폰', '스마트폰', '택1', '사죠영', '죠르디', '한정판', '기프트', '프리디', '충전기', '에이프릴', '스톤', '충전', '기프트', '.', '카카오톡', '코로나']
2025-10-20 15:12:56,519 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['죠르디', '에이프릴', '사죠영', '실드', '프리디', '기프트', '충전기', '아이폰', '카카오톡', '스펙', '택1', '스톤', '코로나', '한정판']
2025-10-20 15:12:56,519 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 15:12:57,478 - __main__ - INFO - 퍼지 매칭 결과 크기: (2116, 3)
2025-10-20 15:12:57,478 - __main__ - INFO - 퍼지 매칭 성공: 2116개 결과
2025-10-20 15:12:57,479 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.4285714285714286}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.4}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.4}]
2025-10-20 15:12:57,479 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 15:12:57,641 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2116, 3)
2025-10-20 15:12:57,642 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.18461538461538463}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.15000000000000002}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.15000000000000002}]
2025-10-20 15:12:57,642 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 15:12:57,645 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 11개
2025-10-20 15:12:57,647 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 15:12:57,647 - __main__ - INFO - 통합된 후보 아이템 수: 11개
2025-10-20 15:12:57,650 - __main__ - INFO - 최종 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 15:12:57,653 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (10, 2)
2025-10-20 15:12:57,654 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}, {'item_nm': 'IPHONE 16 PRO', 'item_id': ['A5XE', 'A643', 'A5XN', 'A64C', 'A647', 'A63Y', 'A5XJ', 'A5X9']}]
2025-10-20 15:12:57,654 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.81초
2025-10-20 15:12:57,654 - __main__ - INFO - 추출된 후보 엔티티: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 15:12:57,654 - __main__ - INFO - 매칭된 상품 정보: (10, 2)
2025-10-20 15:12:57,654 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 15:12:57,804 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 15:12:57,804 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 15:12:57,804 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 400 문자
2025-10-20 15:12:57,804 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 15:12:57,805 - __main__ - INFO - 후보 아이템 리스트 크기: 11개
2025-10-20 15:12:57,805 - __main__ - INFO - 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 15:12:57,805 - __main__ - INFO - extra_item_pdf 크기: (10, 2)
2025-10-20 15:12:57,805 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 15:12:57,805 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}]
2025-10-20 15:12:57,805 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 15:12:57,805 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 15:12:57,805 - __main__ - INFO - 구성된 프롬프트 길이: 6734 문자
2025-10-20 15:12:57,805 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 15:12:57,805 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 15:12:57,805 - __main__ - INFO - 📝 프롬프트 길이: 6,734 문자
2025-10-20 15:12:57,805 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 15:12:57,805 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 15:13:09,601 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 15:13:09,624 - __main__ - INFO - LLM 응답 길이: 1746 문자
2025-10-20 15:13:09,624 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내"
    ],
    "product": [
        {
            "name": "아이폰 12",
            "action": "구매"
        },
        {
            "name": "아이폰 12 Pro",
            "action": "구매"
        },
        {
            "name": "아이폰 17",
            "action": "구매"
        },
        {
            "name": "아이폰 17 Pro",
            "action": "구매"
        },
        {
            "name": "5G",
   ...
2025-10-20 15:13:09,624 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 15:13:09,625 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 15:13:09,626 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 15:13:09,626 - __main__ - INFO - 파싱된 JSON 내용: {'title': '[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내', 'purpose': ['상품 가입 유도', '혜택 안내'], 'product': [{'name': '아이폰 12', 'action': '구매'}, {'name': '아이폰 12 Pro', 'action': '구매'}, {'name': '아이폰 17', 'action': '구매'}, {'name': '아이폰 17 Pro', 'action': '구매'}, {'name': '5G', 'action': '사용'}, {'name': 'A14 Bionic 칩', 'action': '사용'}, {'name': '세라믹 실드', 'action': '사용'}, {'name': 'Dolby Vision 영상 카메라', 'action': '사용'}, {'name': '죠르디 한정판 기프트', 'action': '기타'}, {'name': '멀티 무선 충전기', 'action': '기타'}, {'name': '보조배터리+멀티백', 'action': '기타'}, {'name': '3in1 무선 충전 살균기', 'action': '기타'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/2HeWcdx', 'action': '추가 정보'}, {'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/3o7zOnA', 'action': '추가 정보'}, {'type': '전화번호', 'value': '1558', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['상품및부가서비스가입유도_단말', '사용법/혜택/이벤트안내_단말']}
2025-10-20 15:13:09,626 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 15:13:09,626 - __main__ - INFO - LLM 추출 엔티티: ['아이폰 12', '아이폰 12 Pro', '아이폰 17', '아이폰 17 Pro', '5G', 'A14 Bionic 칩', '세라믹 실드', 'Dolby Vision 영상 카메라', '죠르디 한정판 기프트', '멀티 무선 충전기', '보조배터리+멀티백', '3in1 무선 충전 살균기']
2025-10-20 15:13:09,627 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-10-20 15:13:09,627 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 3,232 문자
2025-10-20 15:13:09,627 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-10-20 15:13:09,627 - __main__ - INFO - 📝 프롬프트 길이: 3,232 문자
2025-10-20 15:13:09,627 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-10-20 15:13:09,627 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-10-20 15:13:09,627 - __main__ - INFO - 🔄 1개 LLM 모델로 엔티티 추출 시작
2025-10-20 15:13:09,628 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-20 15:13:09,628 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-20 15:13:09,628 - __main__ - INFO - 🔍 메시지 길이: 815 문자
2025-10-20 15:13:11,164 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 15:13:11,167 - __main__ - INFO - ✅ LLM 추출 완료: ['[에이프릴스톤] 보조배터리+멀티백', 'T기프트', '[크레앙] 3in1 무선 충전 살균기', '아이폰 17 Pro', '[프리디] 멀티 무선 충전기', 'T다이렉트샵', '[사죠영] 죠르디 한정판 기프트', '아이폰 12', '아이폰 17', '아이폰 12 Pro']
2025-10-20 15:13:11,634 - __main__ - INFO - extract_entities_by_llm 실행완료: 2.01초
2025-10-20 15:13:11,639 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 15:13:11,640 - __main__ - INFO - ============================================================
2025-10-20 15:13:11,640 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 15:13:11,640 - __main__ - INFO - ============================================================
2025-10-20 15:13:11,640 - __main__ - INFO - 제목: [SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
2025-10-20 15:13:11,640 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내']
2025-10-20 15:13:11,640 - __main__ - INFO - 상품 수: 2개
2025-10-20 15:13:11,640 - __main__ - INFO - 채널 수: 4개
2025-10-20 15:13:11,640 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 15:13:11,640 - __main__ - INFO - process_message 실행완료: 15.80초
2025-10-20 15:13:11,640 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 15:14:16,384 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 15:14:16,384 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 15:14:16,384 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 15:14:16,384 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 15:14:16,384 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 15:14:16,386 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 15:14:16,422 - __main__ - INFO - Using device: mps
2025-10-20 15:14:16,422 - __main__ - INFO - _initialize_device 실행완료: 0.04초
2025-10-20 15:14:16,422 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 15:14:16,422 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 15:14:16,422 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 15:14:16,422 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 15:14:16,422 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 15:14:16,423 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 15:14:16,423 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 15:14:17,217 - __main__ - INFO - Model loaded on mps
2025-10-20 15:14:17,217 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.79초
2025-10-20 15:14:17,217 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 15:14:17,846 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 15:14:17,846 - __main__ - INFO - _initialize_kiwi 실행완료: 0.63초
2025-10-20 15:14:17,846 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 15:14:17,846 - __main__ - INFO - ============================================================
2025-10-20 15:14:17,846 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 15:14:17,846 - __main__ - INFO - ============================================================
2025-10-20 15:14:17,846 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 15:14:17,846 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 15:14:17,846 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 15:14:17,846 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 15:14:17,847 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:14:18,003 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 15:14:18,003 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:14:18,003 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 15:14:18,010 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 15:14:18,011 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 15:14:18,012 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:14:18,012 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:14:18,013 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 15:14:18,013 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 15:14:18,015 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 15:14:18,018 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 15:14:18,019 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 15:14:18,019 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:14:18,019 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 15:14:18,019 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 15:14:18,019 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 15:14:18,019 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:14:18,019 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 15:14:18,019 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 15:14:18,019 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 15:14:18,021 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 15:14:18,021 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 15:14:18,021 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:14:18,022 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 15:14:18,022 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:14:18,244 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 15:14:18,255 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 15:14:18,256 - __main__ - INFO - 별칭 적용 후 샘플: ['우주PASS Netflix 인증', '우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주패스 Netflix 인증', '우주Pass Netflix 인증']
2025-10-20 15:14:18,256 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 15:14:18,256 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 15:14:18,256 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 15:14:18,257 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 15:14:18,257 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 15:14:18,257 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 15:14:18,257 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 15:14:18,258 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 15:14:18,260 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 15:14:18,260 - __main__ - INFO - 등록할 별칭 샘플: ['우주PASS Netflix 인증', '우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주패스 Netflix 인증', '우주Pass Netflix 인증']
2025-10-20 15:14:18,280 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 15:14:18,281 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 15:14:18,281 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 15:14:18,282 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 15:14:18,282 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 15:14:18,569 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 15:14:18,569 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 15:14:18,569 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 15:14:18,569 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 15:14:18,569 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 15:14:18,569 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:14:18,655 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 15:14:18,656 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:14:18,658 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 15:14:18,659 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 15:14:18,659 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 15:14:18,659 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:14:18,659 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 15:14:18,659 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 15:14:18,659 - __main__ - INFO - ============================================================
2025-10-20 15:14:18,659 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 15:14:18,659 - __main__ - INFO - ============================================================
2025-10-20 15:14:18,659 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 15:14:18,659 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 15:14:18,659 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 15:14:18,660 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 15:14:18,660 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 15:14:18,661 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 15:14:18,663 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 15:14:18,665 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 15:14:18,665 - __main__ - INFO - _load_data 실행완료: 0.82초
2025-10-20 15:14:18,665 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 15:14:18,665 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 15:14:18,665 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] 반가워요 5G 아이폰12/ 12 Pro 사전예약 안내
(광고)[SKT] 아...
2025-10-20 15:14:18,665 - __main__ - INFO - ============================================================
2025-10-20 15:14:18,665 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 15:14:18,665 - __main__ - INFO - ============================================================
2025-10-20 15:14:18,665 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] 반가워요 5G 아이폰12/ 12 Pro 사전예약 안내
(광고)[SKT] 아이폰 12/12 Pro 사전예약 안내  #04 고객님, 안녕하세요. 최고의 스마트폰 칩과 카메라, 견고한 세라믹 실드에 5G 기술까지! 이 모든 것을 갖춘 아이폰 12/12 Pro를 만나 보세요.  ▶ 혜택받고 사전예약하기: http://t-mms.kr/t.do?m=#...
2025-10-20 15:14:18,665 - __main__ - INFO - 메시지 길이: 822 문자
2025-10-20 15:14:18,665 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 15:14:18,665 - __main__ - INFO - 데이터 소스: local
2025-10-20 15:14:18,665 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 15:14:18,665 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-20 15:14:18,665 - __main__ - INFO - LLM 모델: ax
2025-10-20 15:14:18,665 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 15:14:18,665 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 15:14:18,665 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 15:14:18,665 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 15:14:18,665 - __main__ - INFO - 처리할 메시지 길이: 815 문자
2025-10-20 15:14:18,667 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 15:14:19,339 - __main__ - INFO - 분할된 문장 수: 9개
2025-10-20 15:14:19,340 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 반가워요', '5G 아이폰 Pro 사전예약 안내 광고 SKT 아이폰 Pro 사전예약 안내 고객님 안녕하세요 ', '최고의 스마트폰 칩과 카메라 견고 세라믹 실드에 5G 기술까지 ']...
2025-10-20 15:14:19,347 - __main__ - INFO - 전체 토큰 수: 310개
2025-10-20 15:14:19,347 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '아이폰', '아이폰', '실드', '아이폰', '아이폰', '스펙', '아이폰', '스마트폰', '택1', '사죠영', '죠르디', '한정판', '기프트', '프리디', '충전기', '에이프릴', '스톤', '충전', '기프트', '.', '카카오톡', '코로나']
2025-10-20 15:14:19,348 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['스톤', '코로나', '죠르디', '사죠영', '프리디', '충전기', '에이프릴', '실드', '기프트', '스펙', '아이폰', '택1', '한정판', '카카오톡']
2025-10-20 15:14:19,348 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 15:14:20,414 - __main__ - INFO - 퍼지 매칭 결과 크기: (2116, 3)
2025-10-20 15:14:20,415 - __main__ - INFO - 퍼지 매칭 성공: 2116개 결과
2025-10-20 15:14:20,416 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.4285714285714286}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.4}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.4}]
2025-10-20 15:14:20,416 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 15:14:20,585 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2116, 3)
2025-10-20 15:14:20,585 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.18461538461538463}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.15000000000000002}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.15000000000000002}]
2025-10-20 15:14:20,585 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 15:14:20,588 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 11개
2025-10-20 15:14:20,590 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 15:14:20,591 - __main__ - INFO - 통합된 후보 아이템 수: 11개
2025-10-20 15:14:20,594 - __main__ - INFO - 최종 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 15:14:20,597 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (10, 2)
2025-10-20 15:14:20,597 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}, {'item_nm': 'IPHONE 16 PRO', 'item_id': ['A5XE', 'A643', 'A5XN', 'A64C', 'A647', 'A63Y', 'A5XJ', 'A5X9']}]
2025-10-20 15:14:20,598 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.93초
2025-10-20 15:14:20,598 - __main__ - INFO - 추출된 후보 엔티티: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 15:14:20,598 - __main__ - INFO - 매칭된 상품 정보: (10, 2)
2025-10-20 15:14:20,598 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 15:14:20,767 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 15:14:20,768 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 15:14:20,768 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 400 문자
2025-10-20 15:14:20,768 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 15:14:20,768 - __main__ - INFO - 후보 아이템 리스트 크기: 11개
2025-10-20 15:14:20,768 - __main__ - INFO - 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 15:14:20,768 - __main__ - INFO - extra_item_pdf 크기: (10, 2)
2025-10-20 15:14:20,768 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 15:14:20,768 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}]
2025-10-20 15:14:20,768 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 15:14:20,768 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 15:14:20,768 - __main__ - INFO - 구성된 프롬프트 길이: 6734 문자
2025-10-20 15:14:20,768 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 15:14:20,768 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 15:14:20,768 - __main__ - INFO - 📝 프롬프트 길이: 6,734 문자
2025-10-20 15:14:20,768 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 15:14:20,768 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 15:14:32,779 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 15:14:32,802 - __main__ - INFO - LLM 응답 길이: 1586 문자
2025-10-20 15:14:32,803 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "[SK텔레콤] 반가워요 5G 아이폰12/ 12 Pro 사전예약 안내",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내"
    ],
    "product": [
        {
            "name": "아이폰 12",
            "action": "구매"
        },
        {
            "name": "아이폰 12 Pro",
            "action": "구매"
        },
        {
            "name": "5G",
            "action": "사용"
        },
        {
            "name": "A14 Bionic 칩",
            "action": "사용"
        },
        {
            "name": "세라믹 실드",
 ...
2025-10-20 15:14:32,803 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 15:14:32,804 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 15:14:32,804 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 15:14:32,804 - __main__ - INFO - 파싱된 JSON 내용: {'title': '[SK텔레콤] 반가워요 5G 아이폰12/ 12 Pro 사전예약 안내', 'purpose': ['상품 가입 유도', '혜택 안내'], 'product': [{'name': '아이폰 12', 'action': '구매'}, {'name': '아이폰 12 Pro', 'action': '구매'}, {'name': '5G', 'action': '사용'}, {'name': 'A14 Bionic 칩', 'action': '사용'}, {'name': '세라믹 실드', 'action': '사용'}, {'name': 'Dolby Vision 영상 카메라', 'action': '사용'}, {'name': '죠르디 한정판 기프트', 'action': '기타'}, {'name': '멀티 무선 충전기', 'action': '기타'}, {'name': '보조배터리+멀티백', 'action': '기타'}, {'name': '3in1 무선 충전 살균기', 'action': '기타'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/2HeWcdx', 'action': '추가 정보'}, {'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/3o7zOnA', 'action': '추가 정보'}, {'type': '전화번호', 'value': '1558', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['상품및부가서비스가입유도_단말', '사용법/혜택/이벤트안내_단말']}
2025-10-20 15:14:32,804 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 15:14:32,805 - __main__ - INFO - LLM 추출 엔티티: ['아이폰 12', '아이폰 12 Pro', '5G', 'A14 Bionic 칩', '세라믹 실드', 'Dolby Vision 영상 카메라', '죠르디 한정판 기프트', '멀티 무선 충전기', '보조배터리+멀티백', '3in1 무선 충전 살균기']
2025-10-20 15:14:32,806 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-10-20 15:14:32,806 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 3,232 문자
2025-10-20 15:14:32,806 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-10-20 15:14:32,806 - __main__ - INFO - 📝 프롬프트 길이: 3,232 문자
2025-10-20 15:14:32,806 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-10-20 15:14:32,806 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-10-20 15:14:32,806 - __main__ - INFO - 🔄 1개 LLM 모델로 엔티티 추출 시작
2025-10-20 15:14:32,807 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-20 15:14:32,807 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-20 15:14:32,807 - __main__ - INFO - 🔍 메시지 길이: 815 문자
2025-10-20 15:14:34,401 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 15:14:34,404 - __main__ - INFO - ✅ LLM 추출 완료: ['[에이프릴스톤] 보조배터리+멀티백', 'T다이렉트샵', '아이폰 12', '아이폰 12 Pro', '[사죠영] 죠르디 한정판 기프트', 'T기프트', '[크레앙] 3in1 무선 충전 살균기', '[프리디] 멀티 무선 충전기']
2025-10-20 15:14:34,800 - __main__ - INFO - extract_entities_by_llm 실행완료: 1.99초
2025-10-20 15:14:34,801 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 15:14:34,801 - __main__ - INFO - ============================================================
2025-10-20 15:14:34,801 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 15:14:34,801 - __main__ - INFO - ============================================================
2025-10-20 15:14:34,801 - __main__ - INFO - 제목: [SK텔레콤] 반가워요 5G 아이폰12/ 12 Pro 사전예약 안내
2025-10-20 15:14:34,801 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내']
2025-10-20 15:14:34,801 - __main__ - INFO - 상품 수: 10개
2025-10-20 15:14:34,801 - __main__ - INFO - 채널 수: 4개
2025-10-20 15:14:34,801 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 15:14:34,801 - __main__ - INFO - process_message 실행완료: 16.14초
2025-10-20 15:14:34,802 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 15:34:54,582 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 15:34:54,582 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 15:34:54,582 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 15:34:54,582 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 15:34:54,582 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 15:34:54,584 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 15:34:54,615 - __main__ - INFO - Using device: mps
2025-10-20 15:34:54,615 - __main__ - INFO - _initialize_device 실행완료: 0.03초
2025-10-20 15:34:54,615 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 15:34:54,615 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 15:34:54,615 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 15:34:54,615 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 15:34:54,616 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 15:34:54,616 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 15:34:54,616 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 15:34:55,087 - __main__ - INFO - Model loaded on mps
2025-10-20 15:34:55,088 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.47초
2025-10-20 15:34:55,088 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 15:34:55,692 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 15:34:55,692 - __main__ - INFO - _initialize_kiwi 실행완료: 0.60초
2025-10-20 15:34:55,692 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 15:34:55,693 - __main__ - INFO - ============================================================
2025-10-20 15:34:55,693 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 15:34:55,693 - __main__ - INFO - ============================================================
2025-10-20 15:34:55,693 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 15:34:55,693 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 15:34:55,693 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 15:34:55,693 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 15:34:55,693 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:34:55,850 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 15:34:55,850 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:34:55,850 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 15:34:55,858 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 15:34:55,859 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 15:34:55,860 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:34:55,860 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:34:55,861 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 15:34:55,861 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 15:34:55,863 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 15:34:55,867 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 15:34:55,867 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 15:34:55,867 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:34:55,867 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 15:34:55,867 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 15:34:55,868 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 15:34:55,868 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:34:55,868 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 15:34:55,868 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 15:34:55,868 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 15:34:55,869 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 15:34:55,870 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 15:34:55,870 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:34:55,870 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 15:34:55,870 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:34:56,096 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 15:34:56,106 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 15:34:56,107 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 Netflix 인증', '우주패스 넷플릭스 인증', '우주PASS Netflix 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증']
2025-10-20 15:34:56,107 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 15:34:56,108 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 15:34:56,108 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 15:34:56,109 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 15:34:56,109 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 15:34:56,109 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 15:34:56,109 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 15:34:56,110 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 15:34:56,112 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 15:34:56,112 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 Netflix 인증', '우주패스 넷플릭스 인증', '우주PASS Netflix 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증']
2025-10-20 15:34:56,132 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 15:34:56,132 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 15:34:56,132 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 15:34:56,134 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 15:34:56,134 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 15:34:56,437 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 15:34:56,437 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 15:34:56,437 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 15:34:56,437 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 15:34:56,437 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 15:34:56,437 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:34:56,534 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 15:34:56,535 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:34:56,538 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 15:34:56,539 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 15:34:56,539 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 15:34:56,539 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:34:56,539 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 15:34:56,540 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 15:34:56,540 - __main__ - INFO - ============================================================
2025-10-20 15:34:56,540 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 15:34:56,541 - __main__ - INFO - ============================================================
2025-10-20 15:34:56,541 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 15:34:56,541 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 15:34:56,541 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 15:34:56,541 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 15:34:56,541 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 15:34:56,542 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 15:34:56,543 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 15:34:56,545 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 15:34:56,545 - __main__ - INFO - _load_data 실행완료: 0.85초
2025-10-20 15:34:56,545 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 15:34:56,545 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 15:34:56,545 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A....
2025-10-20 15:34:56,545 - __main__ - INFO - ============================================================
2025-10-20 15:34:56,545 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 15:34:56,545 - __main__ - INFO - ============================================================
2025-10-20 15:34:56,545 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A. (에이닷)에서 알람을 설정하면 선물을 드려요!__#04 고객님, 안녕하세요.__모닝콜, 영양제 먹기, 애견 산책 등  매일 반복되는 일상을 최애 음악으로 알람 설정 해보세요~!__A.(에이닷)에서 알람을 등록하고 권한 설정하면 선물을 드립니다!__▶ 이벤트 자세히 보...
2025-10-20 15:34:56,545 - __main__ - INFO - 메시지 길이: 685 문자
2025-10-20 15:34:56,545 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 15:34:56,545 - __main__ - INFO - 데이터 소스: local
2025-10-20 15:34:56,545 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 15:34:56,545 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-20 15:34:56,546 - __main__ - INFO - LLM 모델: ax
2025-10-20 15:34:56,546 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 15:34:56,546 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 15:34:56,546 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 15:34:56,546 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 15:34:56,546 - __main__ - INFO - 처리할 메시지 길이: 683 문자
2025-10-20 15:34:56,547 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 15:34:57,279 - __main__ - INFO - 분할된 문장 수: 16개
2025-10-20 15:34:57,280 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'A. 에이닷 에서 알람 설정 선물 드려요 ', ' 고객님 안녕하세요 ']...
2025-10-20 15:34:57,296 - __main__ - INFO - 전체 토큰 수: 296개
2025-10-20 15:34:57,296 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '에이닷', '에이닷', '모닝콜', '에이닷', '에이닷', '기프티콘', '앤', '앨리스']
2025-10-20 15:34:57,296 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['에이닷', '앨리스', '기프티콘', '모닝콜']
2025-10-20 15:34:57,296 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 15:34:58,384 - __main__ - INFO - 퍼지 매칭 결과 크기: (2548, 3)
2025-10-20 15:34:58,384 - __main__ - INFO - 퍼지 매칭 성공: 2548개 결과
2025-10-20 15:34:58,385 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.4285714285714286}]
2025-10-20 15:34:58,385 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 15:34:58,461 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2548, 3)
2025-10-20 15:34:58,462 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.21818181818181817}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.34285714285714286}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.2857142857142857}]
2025-10-20 15:34:58,462 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 15:34:58,466 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 2개
2025-10-20 15:34:58,468 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 15:34:58,469 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-10-20 15:34:58,472 - __main__ - INFO - 최종 후보 아이템 리스트: ['라이트 서비스', 'T 서비스']
2025-10-20 15:34:58,474 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (2, 2)
2025-10-20 15:34:58,474 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-20 15:34:58,474 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.93초
2025-10-20 15:34:58,474 - __main__ - INFO - 추출된 후보 엔티티: ['라이트 서비스', 'T 서비스']
2025-10-20 15:34:58,474 - __main__ - INFO - 매칭된 상품 정보: (2, 2)
2025-10-20 15:34:58,474 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 15:34:58,660 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 15:34:58,660 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 15:34:58,660 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 360 문자
2025-10-20 15:34:58,660 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 15:34:58,660 - __main__ - INFO - 후보 아이템 리스트 크기: 2개
2025-10-20 15:34:58,660 - __main__ - INFO - 후보 아이템 리스트: ['라이트 서비스', 'T 서비스']
2025-10-20 15:34:58,660 - __main__ - INFO - extra_item_pdf 크기: (2, 2)
2025-10-20 15:34:58,660 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 15:34:58,661 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-20 15:34:58,661 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 15:34:58,661 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 15:34:58,661 - __main__ - INFO - 구성된 프롬프트 길이: 6463 문자
2025-10-20 15:34:58,661 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 15:34:58,661 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 15:34:58,661 - __main__ - INFO - 📝 프롬프트 길이: 6,463 문자
2025-10-20 15:34:58,661 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 15:34:58,661 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 15:35:05,252 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 15:35:05,275 - __main__ - INFO - LLM 응답 길이: 802 문자
2025-10-20 15:35:05,276 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "A. (에이닷)에서 알람을 설정하면 선물을 드려요!",
    "purpose": [
        "이벤트 응모 유도",
        "경품 제공 안내"
    ],
    "product": [
        {
            "name": "A. (에이닷)",
            "action": "사용"
        },
        {
            "name": "A.알람",
            "action": "사용"
        }
    ],
    "channel": [
        {
            "type": "URL",
            "value": "http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr",
            "action": "추가 정보"
        },
  ...
2025-10-20 15:35:05,276 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 15:35:05,276 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 15:35:05,276 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 15:35:05,277 - __main__ - INFO - 파싱된 JSON 내용: {'title': 'A. (에이닷)에서 알람을 설정하면 선물을 드려요!', 'purpose': ['이벤트 응모 유도', '경품 제공 안내'], 'product': [{'name': 'A. (에이닷)', 'action': '사용'}, {'name': 'A.알람', 'action': '사용'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr', 'action': '추가 정보'}, {'type': '전화번호', 'value': '02-542-4920', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['사용법/혜택/이벤트안내_AI', '사용법/혜택/이벤트안내_SKT']}
2025-10-20 15:35:05,277 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 15:35:05,277 - __main__ - INFO - LLM 추출 엔티티: ['A. (에이닷)', 'A.알람']
2025-10-20 15:35:05,278 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-10-20 15:35:05,279 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-10-20 15:35:05,279 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 3,100 문자
2025-10-20 15:35:05,279 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-10-20 15:35:05,279 - __main__ - INFO - 📝 프롬프트 길이: 3,100 문자
2025-10-20 15:35:05,279 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-10-20 15:35:05,279 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-10-20 15:35:05,279 - __main__ - INFO - 🔄 2개 LLM 모델로 엔티티 추출 시작
2025-10-20 15:35:05,298 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-20 15:35:05,298 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-20 15:35:05,298 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-20 15:35:05,298 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-20 15:35:05,298 - __main__ - INFO - 🔍 메시지 길이: 683 문자
2025-10-20 15:35:05,298 - __main__ - INFO - 🔍 메시지 길이: 683 문자
2025-10-20 15:35:05,953 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 15:35:07,407 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 15:35:07,412 - __main__ - INFO - ✅ LLM 추출 완료: ['에이닷', 'A.', 'A. (에이닷)', 'A.알람', 'CU 빙그레 바나나우유 기프티콘', 'A. 알람 챌린지']
2025-10-20 15:35:08,029 - __main__ - INFO - extract_entities_by_llm 실행완료: 2.75초
2025-10-20 15:35:08,034 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 15:35:08,034 - __main__ - INFO - ============================================================
2025-10-20 15:35:08,034 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 15:35:08,034 - __main__ - INFO - ============================================================
2025-10-20 15:35:08,034 - __main__ - INFO - 제목: A. (에이닷)에서 알람을 설정하면 선물을 드려요!
2025-10-20 15:35:08,034 - __main__ - INFO - 목적: ['이벤트 응모 유도', '경품 제공 안내']
2025-10-20 15:35:08,034 - __main__ - INFO - 상품 수: 1개
2025-10-20 15:35:08,034 - __main__ - INFO - 채널 수: 3개
2025-10-20 15:35:08,034 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 15:35:08,034 - __main__ - INFO - process_message 실행완료: 11.49초
2025-10-20 15:35:08,034 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 15:37:30,104 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 15:37:30,104 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 15:37:30,104 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 15:37:30,104 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 15:37:30,104 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 15:37:30,105 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 15:37:30,136 - __main__ - INFO - Using device: mps
2025-10-20 15:37:30,136 - __main__ - INFO - _initialize_device 실행완료: 0.03초
2025-10-20 15:37:30,136 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 15:37:30,137 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 15:37:30,137 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 15:37:30,137 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 15:37:30,137 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 15:37:30,137 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 15:37:30,137 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 15:37:30,422 - __main__ - INFO - Model loaded on mps
2025-10-20 15:37:30,422 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.28초
2025-10-20 15:37:30,422 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 15:37:31,000 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 15:37:31,000 - __main__ - INFO - _initialize_kiwi 실행완료: 0.58초
2025-10-20 15:37:31,000 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 15:37:31,000 - __main__ - INFO - ============================================================
2025-10-20 15:37:31,000 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 15:37:31,000 - __main__ - INFO - ============================================================
2025-10-20 15:37:31,000 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 15:37:31,000 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 15:37:31,000 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 15:37:31,000 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 15:37:31,000 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:37:31,150 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 15:37:31,150 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:37:31,150 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 15:37:31,158 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 15:37:31,159 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 15:37:31,160 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:37:31,160 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:37:31,160 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 15:37:31,161 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 15:37:31,162 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 15:37:31,166 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 15:37:31,166 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 15:37:31,166 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:37:31,166 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 15:37:31,166 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 15:37:31,167 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 15:37:31,167 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:37:31,167 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 15:37:31,167 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 15:37:31,167 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 15:37:31,176 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 15:37:31,177 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 15:37:31,177 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:37:31,177 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 15:37:31,177 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:37:31,408 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 15:37:31,419 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 15:37:31,419 - __main__ - INFO - 별칭 적용 후 샘플: ['우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주pass Netflix 인증']
2025-10-20 15:37:31,420 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 15:37:31,420 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 15:37:31,420 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 15:37:31,421 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 15:37:31,421 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 15:37:31,421 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 15:37:31,421 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 15:37:31,422 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 15:37:31,424 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 15:37:31,424 - __main__ - INFO - 등록할 별칭 샘플: ['우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주pass Netflix 인증']
2025-10-20 15:37:31,445 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 15:37:31,445 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 15:37:31,445 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 15:37:31,446 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 15:37:31,447 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 15:37:31,696 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 15:37:31,696 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 15:37:31,696 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 15:37:31,696 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 15:37:31,696 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 15:37:31,696 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:37:31,782 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 15:37:31,782 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:37:31,785 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 15:37:31,785 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 15:37:31,785 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 15:37:31,785 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:37:31,786 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 15:37:31,786 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 15:37:31,786 - __main__ - INFO - ============================================================
2025-10-20 15:37:31,786 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 15:37:31,786 - __main__ - INFO - ============================================================
2025-10-20 15:37:31,786 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 15:37:31,786 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 15:37:31,786 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 15:37:31,786 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 15:37:31,786 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 15:37:31,787 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 15:37:31,790 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 15:37:31,792 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 15:37:31,792 - __main__ - INFO - _load_data 실행완료: 0.79초
2025-10-20 15:37:31,792 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 15:37:31,792 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 15:37:31,792 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A....
2025-10-20 15:37:31,792 - __main__ - INFO - ============================================================
2025-10-20 15:37:31,792 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 15:37:31,792 - __main__ - INFO - ============================================================
2025-10-20 15:37:31,792 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A. (에이닷)에서 알람을 설정하면 선물을 드려요!__#04 고객님, 안녕하세요.__모닝콜, 영양제 먹기, 애견 산책 등  매일 반복되는 일상을 최애 음악으로 알람 설정 해보세요~!__A.(에이닷)에서 알람을 등록하고 권한 설정하면 선물을 드립니다!__▶ 이벤트 자세히 보...
2025-10-20 15:37:31,792 - __main__ - INFO - 메시지 길이: 685 문자
2025-10-20 15:37:31,792 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 15:37:31,792 - __main__ - INFO - 데이터 소스: local
2025-10-20 15:37:31,792 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 15:37:31,792 - __main__ - INFO - 엔티티 추출 모드: logic
2025-10-20 15:37:31,792 - __main__ - INFO - LLM 모델: ax
2025-10-20 15:37:31,792 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 15:37:31,792 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 15:37:31,792 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 15:37:31,792 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 15:37:31,792 - __main__ - INFO - 처리할 메시지 길이: 683 문자
2025-10-20 15:37:31,793 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 15:37:32,446 - __main__ - INFO - 분할된 문장 수: 16개
2025-10-20 15:37:32,447 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'A. 에이닷 에서 알람 설정 선물 드려요 ', ' 고객님 안녕하세요 ']...
2025-10-20 15:37:32,461 - __main__ - INFO - 전체 토큰 수: 296개
2025-10-20 15:37:32,461 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '에이닷', '에이닷', '모닝콜', '에이닷', '에이닷', '기프티콘', '앤', '앨리스']
2025-10-20 15:37:32,462 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['모닝콜', '에이닷', '앨리스', '기프티콘']
2025-10-20 15:37:32,462 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 15:37:33,487 - __main__ - INFO - 퍼지 매칭 결과 크기: (2548, 3)
2025-10-20 15:37:33,487 - __main__ - INFO - 퍼지 매칭 성공: 2548개 결과
2025-10-20 15:37:33,488 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.4285714285714286}]
2025-10-20 15:37:33,488 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 15:37:33,568 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2548, 3)
2025-10-20 15:37:33,569 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.21818181818181817}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.34285714285714286}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.2857142857142857}]
2025-10-20 15:37:33,569 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 15:37:33,572 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 2개
2025-10-20 15:37:33,574 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 15:37:33,575 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-10-20 15:37:33,578 - __main__ - INFO - 최종 후보 아이템 리스트: ['라이트 서비스', 'T 서비스']
2025-10-20 15:37:33,581 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (2, 2)
2025-10-20 15:37:33,581 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-20 15:37:33,581 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.79초
2025-10-20 15:37:33,581 - __main__ - INFO - 추출된 후보 엔티티: ['라이트 서비스', 'T 서비스']
2025-10-20 15:37:33,581 - __main__ - INFO - 매칭된 상품 정보: (2, 2)
2025-10-20 15:37:33,581 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 15:37:33,737 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 15:37:33,737 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 15:37:33,737 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 360 문자
2025-10-20 15:37:33,737 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 15:37:33,737 - __main__ - INFO - 후보 아이템 리스트 크기: 2개
2025-10-20 15:37:33,737 - __main__ - INFO - 후보 아이템 리스트: ['라이트 서비스', 'T 서비스']
2025-10-20 15:37:33,737 - __main__ - INFO - extra_item_pdf 크기: (2, 2)
2025-10-20 15:37:33,737 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 15:37:33,737 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-20 15:37:33,737 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 15:37:33,737 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 15:37:33,737 - __main__ - INFO - 구성된 프롬프트 길이: 6463 문자
2025-10-20 15:37:33,737 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 15:37:33,738 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 15:37:33,738 - __main__ - INFO - 📝 프롬프트 길이: 6,463 문자
2025-10-20 15:37:33,738 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 15:37:33,738 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 15:37:41,174 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 15:37:41,197 - __main__ - INFO - LLM 응답 길이: 802 문자
2025-10-20 15:37:41,197 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "A. (에이닷)에서 알람을 설정하면 선물을 드려요!",
    "purpose": [
        "이벤트 응모 유도",
        "경품 제공 안내"
    ],
    "product": [
        {
            "name": "A. (에이닷)",
            "action": "사용"
        },
        {
            "name": "A.알람",
            "action": "사용"
        }
    ],
    "channel": [
        {
            "type": "URL",
            "value": "http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr",
            "action": "추가 정보"
        },
  ...
2025-10-20 15:37:41,197 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 15:37:41,198 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 15:37:41,198 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 15:37:41,198 - __main__ - INFO - 파싱된 JSON 내용: {'title': 'A. (에이닷)에서 알람을 설정하면 선물을 드려요!', 'purpose': ['이벤트 응모 유도', '경품 제공 안내'], 'product': [{'name': 'A. (에이닷)', 'action': '사용'}, {'name': 'A.알람', 'action': '사용'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr', 'action': '추가 정보'}, {'type': '전화번호', 'value': '02-542-4920', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['사용법/혜택/이벤트안내_AI', '사용법/혜택/이벤트안내_SKT']}
2025-10-20 15:37:41,198 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 15:37:41,198 - __main__ - INFO - LLM 추출 엔티티: ['A. (에이닷)', 'A.알람']
2025-10-20 15:37:41,431 - __main__ - ERROR - 결합 유사도 계산 실패: DataFrame.reset_index() got an unexpected keyword argument 'name'
2025-10-20 15:37:41,432 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 15:37:41,432 - __main__ - INFO - ============================================================
2025-10-20 15:37:41,432 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 15:37:41,432 - __main__ - INFO - ============================================================
2025-10-20 15:37:41,432 - __main__ - INFO - 제목: A. (에이닷)에서 알람을 설정하면 선물을 드려요!
2025-10-20 15:37:41,433 - __main__ - INFO - 목적: ['이벤트 응모 유도', '경품 제공 안내']
2025-10-20 15:37:41,433 - __main__ - INFO - 상품 수: 2개
2025-10-20 15:37:41,433 - __main__ - INFO - 채널 수: 3개
2025-10-20 15:37:41,433 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 15:37:41,433 - __main__ - INFO - process_message 실행완료: 9.64초
2025-10-20 15:37:41,433 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 15:38:52,139 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 15:38:52,139 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 15:38:52,139 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 15:38:52,140 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 15:38:52,140 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 15:38:52,141 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 15:38:52,179 - __main__ - INFO - Using device: mps
2025-10-20 15:38:52,180 - __main__ - INFO - _initialize_device 실행완료: 0.04초
2025-10-20 15:38:52,180 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 15:38:52,180 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 15:38:52,180 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 15:38:52,180 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 15:38:52,180 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 15:38:52,180 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 15:38:52,180 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 15:38:52,440 - __main__ - INFO - Model loaded on mps
2025-10-20 15:38:52,440 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.26초
2025-10-20 15:38:52,441 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 15:38:53,019 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 15:38:53,019 - __main__ - INFO - _initialize_kiwi 실행완료: 0.58초
2025-10-20 15:38:53,019 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 15:38:53,019 - __main__ - INFO - ============================================================
2025-10-20 15:38:53,019 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 15:38:53,019 - __main__ - INFO - ============================================================
2025-10-20 15:38:53,019 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 15:38:53,019 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 15:38:53,019 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 15:38:53,019 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 15:38:53,020 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:38:53,173 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 15:38:53,173 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:38:53,173 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 15:38:53,181 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 15:38:53,181 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 15:38:53,182 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:38:53,183 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:38:53,184 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 15:38:53,184 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 15:38:53,185 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 15:38:53,189 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 15:38:53,189 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 15:38:53,189 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:38:53,189 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 15:38:53,189 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 15:38:53,189 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 15:38:53,189 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:38:53,189 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 15:38:53,189 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 15:38:53,189 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 15:38:53,191 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 15:38:53,192 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 15:38:53,192 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:38:53,192 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 15:38:53,192 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:38:53,418 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 15:38:53,428 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 15:38:53,429 - __main__ - INFO - 별칭 적용 후 샘플: ['우주Pass Netflix 인증', '우주패스 넷플릭스 인증', '우주pass Netflix 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증']
2025-10-20 15:38:53,429 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 15:38:53,429 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 15:38:53,429 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 15:38:53,431 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 15:38:53,431 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 15:38:53,431 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 15:38:53,431 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 15:38:53,432 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 15:38:53,433 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 15:38:53,433 - __main__ - INFO - 등록할 별칭 샘플: ['우주Pass Netflix 인증', '우주패스 넷플릭스 인증', '우주pass Netflix 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증']
2025-10-20 15:38:53,454 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 15:38:53,455 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 15:38:53,455 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 15:38:53,456 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 15:38:53,456 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 15:38:53,718 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 15:38:53,718 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 15:38:53,718 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 15:38:53,718 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 15:38:53,718 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 15:38:53,718 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:38:53,800 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 15:38:53,800 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:38:53,803 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 15:38:53,803 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 15:38:53,803 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 15:38:53,803 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:38:53,803 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 15:38:53,804 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 15:38:53,804 - __main__ - INFO - ============================================================
2025-10-20 15:38:53,804 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 15:38:53,804 - __main__ - INFO - ============================================================
2025-10-20 15:38:53,804 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 15:38:53,804 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 15:38:53,804 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 15:38:53,804 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 15:38:53,804 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 15:38:53,805 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 15:38:53,807 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 15:38:53,809 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 15:38:53,809 - __main__ - INFO - _load_data 실행완료: 0.79초
2025-10-20 15:38:53,809 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 15:38:53,809 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 15:38:53,809 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A....
2025-10-20 15:38:53,809 - __main__ - INFO - ============================================================
2025-10-20 15:38:53,809 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 15:38:53,809 - __main__ - INFO - ============================================================
2025-10-20 15:38:53,809 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A. (에이닷)에서 알람을 설정하면 선물을 드려요!__#04 고객님, 안녕하세요.__모닝콜, 영양제 먹기, 애견 산책 등  매일 반복되는 일상을 최애 음악으로 알람 설정 해보세요~!__A.(에이닷)에서 알람을 등록하고 권한 설정하면 선물을 드립니다!__▶ 이벤트 자세히 보...
2025-10-20 15:38:53,809 - __main__ - INFO - 메시지 길이: 685 문자
2025-10-20 15:38:53,809 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 15:38:53,809 - __main__ - INFO - 데이터 소스: local
2025-10-20 15:38:53,809 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 15:38:53,809 - __main__ - INFO - 엔티티 추출 모드: logic
2025-10-20 15:38:53,809 - __main__ - INFO - LLM 모델: ax
2025-10-20 15:38:53,809 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 15:38:53,809 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 15:38:53,809 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 15:38:53,810 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 15:38:53,810 - __main__ - INFO - 처리할 메시지 길이: 683 문자
2025-10-20 15:38:53,811 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 15:38:54,475 - __main__ - INFO - 분할된 문장 수: 16개
2025-10-20 15:38:54,476 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'A. 에이닷 에서 알람 설정 선물 드려요 ', ' 고객님 안녕하세요 ']...
2025-10-20 15:38:54,491 - __main__ - INFO - 전체 토큰 수: 296개
2025-10-20 15:38:54,491 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '에이닷', '에이닷', '모닝콜', '에이닷', '에이닷', '기프티콘', '앤', '앨리스']
2025-10-20 15:38:54,491 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['모닝콜', '기프티콘', '에이닷', '앨리스']
2025-10-20 15:38:54,491 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 15:38:55,513 - __main__ - INFO - 퍼지 매칭 결과 크기: (2548, 3)
2025-10-20 15:38:55,513 - __main__ - INFO - 퍼지 매칭 성공: 2548개 결과
2025-10-20 15:38:55,514 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.4285714285714286}]
2025-10-20 15:38:55,514 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 15:38:55,596 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2548, 3)
2025-10-20 15:38:55,597 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.21818181818181817}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.34285714285714286}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.2857142857142857}]
2025-10-20 15:38:55,597 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 15:38:55,600 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 2개
2025-10-20 15:38:55,602 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 15:38:55,603 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-10-20 15:38:55,606 - __main__ - INFO - 최종 후보 아이템 리스트: ['라이트 서비스', 'T 서비스']
2025-10-20 15:38:55,609 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (2, 2)
2025-10-20 15:38:55,609 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-20 15:38:55,610 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.80초
2025-10-20 15:38:55,610 - __main__ - INFO - 추출된 후보 엔티티: ['라이트 서비스', 'T 서비스']
2025-10-20 15:38:55,610 - __main__ - INFO - 매칭된 상품 정보: (2, 2)
2025-10-20 15:38:55,610 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 15:38:55,759 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 15:38:55,759 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 15:38:55,760 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 360 문자
2025-10-20 15:38:55,760 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 15:38:55,760 - __main__ - INFO - 후보 아이템 리스트 크기: 2개
2025-10-20 15:38:55,760 - __main__ - INFO - 후보 아이템 리스트: ['라이트 서비스', 'T 서비스']
2025-10-20 15:38:55,760 - __main__ - INFO - extra_item_pdf 크기: (2, 2)
2025-10-20 15:38:55,760 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 15:38:55,760 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-20 15:38:55,760 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 15:38:55,760 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 15:38:55,760 - __main__ - INFO - 구성된 프롬프트 길이: 6463 문자
2025-10-20 15:38:55,760 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 15:38:55,760 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 15:38:55,760 - __main__ - INFO - 📝 프롬프트 길이: 6,463 문자
2025-10-20 15:38:55,760 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 15:38:55,760 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 15:39:02,525 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 15:39:02,545 - __main__ - INFO - LLM 응답 길이: 802 문자
2025-10-20 15:39:02,545 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "A. (에이닷)에서 알람을 설정하면 선물을 드려요!",
    "purpose": [
        "이벤트 응모 유도",
        "경품 제공 안내"
    ],
    "product": [
        {
            "name": "A. (에이닷)",
            "action": "사용"
        },
        {
            "name": "A.알람",
            "action": "사용"
        }
    ],
    "channel": [
        {
            "type": "URL",
            "value": "http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr",
            "action": "추가 정보"
        },
  ...
2025-10-20 15:39:02,545 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 15:39:02,546 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 15:39:02,546 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 15:39:02,546 - __main__ - INFO - 파싱된 JSON 내용: {'title': 'A. (에이닷)에서 알람을 설정하면 선물을 드려요!', 'purpose': ['이벤트 응모 유도', '경품 제공 안내'], 'product': [{'name': 'A. (에이닷)', 'action': '사용'}, {'name': 'A.알람', 'action': '사용'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr', 'action': '추가 정보'}, {'type': '전화번호', 'value': '02-542-4920', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['사용법/혜택/이벤트안내_AI', '사용법/혜택/이벤트안내_SKT']}
2025-10-20 15:39:02,546 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 15:39:02,546 - __main__ - INFO - LLM 추출 엔티티: ['A. (에이닷)', 'A.알람']
2025-10-20 15:39:02,810 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 15:39:02,810 - __main__ - INFO - ============================================================
2025-10-20 15:39:02,810 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 15:39:02,810 - __main__ - INFO - ============================================================
2025-10-20 15:39:02,810 - __main__ - INFO - 제목: A. (에이닷)에서 알람을 설정하면 선물을 드려요!
2025-10-20 15:39:02,810 - __main__ - INFO - 목적: ['이벤트 응모 유도', '경품 제공 안내']
2025-10-20 15:39:02,810 - __main__ - INFO - 상품 수: 2개
2025-10-20 15:39:02,810 - __main__ - INFO - 채널 수: 3개
2025-10-20 15:39:02,810 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 15:39:02,810 - __main__ - INFO - process_message 실행완료: 9.00초
2025-10-20 15:39:02,810 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 15:39:38,407 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 15:39:38,407 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 15:39:38,407 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 15:39:38,407 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 15:39:38,407 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 15:39:38,409 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 15:39:38,446 - __main__ - INFO - Using device: mps
2025-10-20 15:39:38,446 - __main__ - INFO - _initialize_device 실행완료: 0.04초
2025-10-20 15:39:38,446 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 15:39:38,446 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 15:39:38,446 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 15:39:38,446 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 15:39:38,446 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 15:39:38,447 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 15:39:38,447 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 15:39:38,710 - __main__ - INFO - Model loaded on mps
2025-10-20 15:39:38,711 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.26초
2025-10-20 15:39:38,711 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 15:39:39,278 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 15:39:39,278 - __main__ - INFO - _initialize_kiwi 실행완료: 0.57초
2025-10-20 15:39:39,279 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 15:39:39,279 - __main__ - INFO - ============================================================
2025-10-20 15:39:39,279 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 15:39:39,279 - __main__ - INFO - ============================================================
2025-10-20 15:39:39,279 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 15:39:39,279 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 15:39:39,279 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 15:39:39,279 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 15:39:39,279 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:39:39,431 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 15:39:39,431 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:39:39,431 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 15:39:39,438 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 15:39:39,440 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 15:39:39,440 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:39:39,441 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:39:39,441 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 15:39:39,442 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 15:39:39,443 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 15:39:39,447 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 15:39:39,447 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 15:39:39,447 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:39:39,447 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 15:39:39,447 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 15:39:39,447 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 15:39:39,447 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:39:39,447 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 15:39:39,447 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 15:39:39,447 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 15:39:39,449 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 15:39:39,449 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 15:39:39,449 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:39:39,449 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 15:39:39,450 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:39:39,674 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 15:39:39,685 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 15:39:39,686 - __main__ - INFO - 별칭 적용 후 샘플: ['우주PASS Netflix 인증', '우주Pass Netflix 인증', '우주pass Netflix 인증', '우주패스 Netflix 인증', '우주패스 넷플릭스 인증']
2025-10-20 15:39:39,686 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 15:39:39,687 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 15:39:39,687 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 15:39:39,688 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 15:39:39,688 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 15:39:39,688 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 15:39:39,688 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 15:39:39,689 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 15:39:39,691 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 15:39:39,691 - __main__ - INFO - 등록할 별칭 샘플: ['우주PASS Netflix 인증', '우주Pass Netflix 인증', '우주pass Netflix 인증', '우주패스 Netflix 인증', '우주패스 넷플릭스 인증']
2025-10-20 15:39:39,712 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 15:39:39,712 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 15:39:39,712 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 15:39:39,714 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 15:39:39,714 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 15:39:39,960 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 15:39:39,961 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 15:39:39,961 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 15:39:39,961 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 15:39:39,961 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 15:39:39,961 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:39:40,043 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 15:39:40,044 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:39:40,046 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 15:39:40,047 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 15:39:40,047 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 15:39:40,047 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:39:40,047 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 15:39:40,047 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 15:39:40,047 - __main__ - INFO - ============================================================
2025-10-20 15:39:40,047 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 15:39:40,047 - __main__ - INFO - ============================================================
2025-10-20 15:39:40,047 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 15:39:40,048 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 15:39:40,048 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 15:39:40,048 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 15:39:40,048 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 15:39:40,049 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 15:39:40,051 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 15:39:40,052 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 15:39:40,053 - __main__ - INFO - _load_data 실행완료: 0.77초
2025-10-20 15:39:40,053 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 15:39:40,053 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 15:39:40,053 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A....
2025-10-20 15:39:40,053 - __main__ - INFO - ============================================================
2025-10-20 15:39:40,053 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 15:39:40,053 - __main__ - INFO - ============================================================
2025-10-20 15:39:40,053 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A. (에이닷)에서 알람을 설정하면 선물을 드려요!__#04 고객님, 안녕하세요.__모닝콜, 영양제 먹기, 애견 산책 등  매일 반복되는 일상을 최애 음악으로 알람 설정 해보세요~!__A.(에이닷)에서 알람을 등록하고 권한 설정하면 선물을 드립니다!__▶ 이벤트 자세히 보...
2025-10-20 15:39:40,053 - __main__ - INFO - 메시지 길이: 685 문자
2025-10-20 15:39:40,053 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 15:39:40,053 - __main__ - INFO - 데이터 소스: local
2025-10-20 15:39:40,053 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 15:39:40,053 - __main__ - INFO - 엔티티 추출 모드: logic
2025-10-20 15:39:40,053 - __main__ - INFO - LLM 모델: ax
2025-10-20 15:39:40,053 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 15:39:40,053 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 15:39:40,053 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 15:39:40,053 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 15:39:40,053 - __main__ - INFO - 처리할 메시지 길이: 683 문자
2025-10-20 15:39:40,054 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 15:39:40,717 - __main__ - INFO - 분할된 문장 수: 16개
2025-10-20 15:39:40,718 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'A. 에이닷 에서 알람 설정 선물 드려요 ', ' 고객님 안녕하세요 ']...
2025-10-20 15:39:40,732 - __main__ - INFO - 전체 토큰 수: 296개
2025-10-20 15:39:40,732 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '에이닷', '에이닷', '모닝콜', '에이닷', '에이닷', '기프티콘', '앤', '앨리스']
2025-10-20 15:39:40,732 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['에이닷', '기프티콘', '모닝콜', '앨리스']
2025-10-20 15:39:40,732 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 15:39:41,749 - __main__ - INFO - 퍼지 매칭 결과 크기: (2548, 3)
2025-10-20 15:39:41,749 - __main__ - INFO - 퍼지 매칭 성공: 2548개 결과
2025-10-20 15:39:41,750 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.4285714285714286}]
2025-10-20 15:39:41,750 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 15:39:41,835 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2548, 3)
2025-10-20 15:39:41,836 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.21818181818181817}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.34285714285714286}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.2857142857142857}]
2025-10-20 15:39:41,836 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 15:39:41,839 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 2개
2025-10-20 15:39:41,840 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 15:39:41,841 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-10-20 15:39:41,844 - __main__ - INFO - 최종 후보 아이템 리스트: ['라이트 서비스', 'T 서비스']
2025-10-20 15:39:41,847 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (2, 2)
2025-10-20 15:39:41,847 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-20 15:39:41,848 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.79초
2025-10-20 15:39:41,848 - __main__ - INFO - 추출된 후보 엔티티: ['라이트 서비스', 'T 서비스']
2025-10-20 15:39:41,848 - __main__ - INFO - 매칭된 상품 정보: (2, 2)
2025-10-20 15:39:41,848 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 15:39:42,005 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 15:39:42,005 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 15:39:42,005 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 360 문자
2025-10-20 15:39:42,006 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 15:39:42,006 - __main__ - INFO - 후보 아이템 리스트 크기: 2개
2025-10-20 15:39:42,006 - __main__ - INFO - 후보 아이템 리스트: ['라이트 서비스', 'T 서비스']
2025-10-20 15:39:42,006 - __main__ - INFO - extra_item_pdf 크기: (2, 2)
2025-10-20 15:39:42,006 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 15:39:42,006 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-20 15:39:42,006 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 15:39:42,006 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 15:39:42,006 - __main__ - INFO - 구성된 프롬프트 길이: 6463 문자
2025-10-20 15:39:42,006 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 15:39:42,006 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 15:39:42,006 - __main__ - INFO - 📝 프롬프트 길이: 6,463 문자
2025-10-20 15:39:42,006 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 15:39:42,006 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 15:39:48,895 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 15:39:48,917 - __main__ - INFO - LLM 응답 길이: 802 문자
2025-10-20 15:39:48,918 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "A. (에이닷)에서 알람을 설정하면 선물을 드려요!",
    "purpose": [
        "이벤트 응모 유도",
        "경품 제공 안내"
    ],
    "product": [
        {
            "name": "A. (에이닷)",
            "action": "사용"
        },
        {
            "name": "A.알람",
            "action": "사용"
        }
    ],
    "channel": [
        {
            "type": "URL",
            "value": "http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr",
            "action": "추가 정보"
        },
  ...
2025-10-20 15:39:48,918 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 15:39:48,918 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 15:39:48,918 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 15:39:48,918 - __main__ - INFO - 파싱된 JSON 내용: {'title': 'A. (에이닷)에서 알람을 설정하면 선물을 드려요!', 'purpose': ['이벤트 응모 유도', '경품 제공 안내'], 'product': [{'name': 'A. (에이닷)', 'action': '사용'}, {'name': 'A.알람', 'action': '사용'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr', 'action': '추가 정보'}, {'type': '전화번호', 'value': '02-542-4920', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['사용법/혜택/이벤트안내_AI', '사용법/혜택/이벤트안내_SKT']}
2025-10-20 15:39:48,918 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 15:39:48,919 - __main__ - INFO - LLM 추출 엔티티: ['A. (에이닷)', 'A.알람']
2025-10-20 15:39:49,152 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 15:39:49,152 - __main__ - INFO - ============================================================
2025-10-20 15:39:49,152 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 15:39:49,152 - __main__ - INFO - ============================================================
2025-10-20 15:39:49,152 - __main__ - INFO - 제목: A. (에이닷)에서 알람을 설정하면 선물을 드려요!
2025-10-20 15:39:49,152 - __main__ - INFO - 목적: ['이벤트 응모 유도', '경품 제공 안내']
2025-10-20 15:39:49,152 - __main__ - INFO - 상품 수: 2개
2025-10-20 15:39:49,152 - __main__ - INFO - 채널 수: 3개
2025-10-20 15:39:49,153 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 15:39:49,153 - __main__ - INFO - process_message 실행완료: 9.10초
2025-10-20 15:39:49,153 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 15:40:20,882 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 15:40:20,882 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 15:40:20,882 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 15:40:20,882 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 15:40:20,882 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 15:40:20,884 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 15:40:20,917 - __main__ - INFO - Using device: mps
2025-10-20 15:40:20,917 - __main__ - INFO - _initialize_device 실행완료: 0.03초
2025-10-20 15:40:20,917 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 15:40:20,917 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 15:40:20,917 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 15:40:20,917 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 15:40:20,917 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 15:40:20,918 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 15:40:20,918 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 15:40:21,175 - __main__ - INFO - Model loaded on mps
2025-10-20 15:40:21,176 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.26초
2025-10-20 15:40:21,176 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 15:40:21,746 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 15:40:21,746 - __main__ - INFO - _initialize_kiwi 실행완료: 0.57초
2025-10-20 15:40:21,746 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 15:40:21,746 - __main__ - INFO - ============================================================
2025-10-20 15:40:21,746 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 15:40:21,746 - __main__ - INFO - ============================================================
2025-10-20 15:40:21,747 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 15:40:21,747 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 15:40:21,747 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 15:40:21,747 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 15:40:21,747 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:40:21,901 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 15:40:21,901 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:40:21,901 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 15:40:21,908 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 15:40:21,909 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 15:40:21,910 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:40:21,911 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:40:21,911 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 15:40:21,911 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 15:40:21,913 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 15:40:21,916 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 15:40:21,916 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 15:40:21,916 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:40:21,917 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 15:40:21,917 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 15:40:21,917 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 15:40:21,917 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:40:21,917 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 15:40:21,917 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 15:40:21,917 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 15:40:21,919 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 15:40:21,919 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 15:40:21,920 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:40:21,920 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 15:40:21,920 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:40:22,146 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 15:40:22,157 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 15:40:22,158 - __main__ - INFO - 별칭 적용 후 샘플: ['우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주Pass Netflix 인증', '우주pass Netflix 인증', '우주패스 넷플릭스 인증']
2025-10-20 15:40:22,158 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 15:40:22,158 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 15:40:22,158 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 15:40:22,159 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 15:40:22,159 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 15:40:22,159 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 15:40:22,159 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 15:40:22,161 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 15:40:22,162 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 15:40:22,162 - __main__ - INFO - 등록할 별칭 샘플: ['우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주Pass Netflix 인증', '우주pass Netflix 인증', '우주패스 넷플릭스 인증']
2025-10-20 15:40:22,183 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 15:40:22,183 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 15:40:22,183 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 15:40:22,184 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 15:40:22,184 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 15:40:22,438 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 15:40:22,439 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 15:40:22,439 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 15:40:22,439 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 15:40:22,439 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 15:40:22,439 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:40:22,522 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 15:40:22,523 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:40:22,525 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 15:40:22,526 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 15:40:22,526 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 15:40:22,526 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:40:22,526 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 15:40:22,527 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 15:40:22,527 - __main__ - INFO - ============================================================
2025-10-20 15:40:22,527 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 15:40:22,527 - __main__ - INFO - ============================================================
2025-10-20 15:40:22,527 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 15:40:22,527 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 15:40:22,527 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 15:40:22,527 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 15:40:22,527 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 15:40:22,528 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 15:40:22,530 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 15:40:22,532 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 15:40:22,532 - __main__ - INFO - _load_data 실행완료: 0.79초
2025-10-20 15:40:22,532 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 15:40:22,532 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 15:40:22,532 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A....
2025-10-20 15:40:22,532 - __main__ - INFO - ============================================================
2025-10-20 15:40:22,532 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 15:40:22,532 - __main__ - INFO - ============================================================
2025-10-20 15:40:22,532 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A. (에이닷)에서 알람을 설정하면 선물을 드려요!__#04 고객님, 안녕하세요.__모닝콜, 영양제 먹기, 애견 산책 등  매일 반복되는 일상을 최애 음악으로 알람 설정 해보세요~!__A.(에이닷)에서 알람을 등록하고 권한 설정하면 선물을 드립니다!__▶ 이벤트 자세히 보...
2025-10-20 15:40:22,532 - __main__ - INFO - 메시지 길이: 685 문자
2025-10-20 15:40:22,532 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 15:40:22,532 - __main__ - INFO - 데이터 소스: local
2025-10-20 15:40:22,533 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 15:40:22,533 - __main__ - INFO - 엔티티 추출 모드: logic
2025-10-20 15:40:22,533 - __main__ - INFO - LLM 모델: ax
2025-10-20 15:40:22,533 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 15:40:22,533 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 15:40:22,533 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 15:40:22,533 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 15:40:22,533 - __main__ - INFO - 처리할 메시지 길이: 683 문자
2025-10-20 15:40:22,534 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 15:40:23,192 - __main__ - INFO - 분할된 문장 수: 16개
2025-10-20 15:40:23,193 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'A. 에이닷 에서 알람 설정 선물 드려요 ', ' 고객님 안녕하세요 ']...
2025-10-20 15:40:23,209 - __main__ - INFO - 전체 토큰 수: 296개
2025-10-20 15:40:23,209 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '에이닷', '에이닷', '모닝콜', '에이닷', '에이닷', '기프티콘', '앤', '앨리스']
2025-10-20 15:40:23,209 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['모닝콜', '기프티콘', '앨리스', '에이닷']
2025-10-20 15:40:23,209 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 15:40:24,226 - __main__ - INFO - 퍼지 매칭 결과 크기: (2548, 3)
2025-10-20 15:40:24,227 - __main__ - INFO - 퍼지 매칭 성공: 2548개 결과
2025-10-20 15:40:24,228 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.4285714285714286}]
2025-10-20 15:40:24,228 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 15:40:24,301 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2548, 3)
2025-10-20 15:40:24,302 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.21818181818181817}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.34285714285714286}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.2857142857142857}]
2025-10-20 15:40:24,302 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 15:40:24,305 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 2개
2025-10-20 15:40:24,307 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 15:40:24,308 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-10-20 15:40:24,311 - __main__ - INFO - 최종 후보 아이템 리스트: ['라이트 서비스', 'T 서비스']
2025-10-20 15:40:24,313 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (2, 2)
2025-10-20 15:40:24,314 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-20 15:40:24,314 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.78초
2025-10-20 15:40:24,314 - __main__ - INFO - 추출된 후보 엔티티: ['라이트 서비스', 'T 서비스']
2025-10-20 15:40:24,314 - __main__ - INFO - 매칭된 상품 정보: (2, 2)
2025-10-20 15:40:24,314 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 15:40:24,463 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 15:40:24,463 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 15:40:24,463 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 360 문자
2025-10-20 15:40:24,463 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 15:40:24,463 - __main__ - INFO - 후보 아이템 리스트 크기: 2개
2025-10-20 15:40:24,463 - __main__ - INFO - 후보 아이템 리스트: ['라이트 서비스', 'T 서비스']
2025-10-20 15:40:24,463 - __main__ - INFO - extra_item_pdf 크기: (2, 2)
2025-10-20 15:40:24,463 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 15:40:24,464 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-20 15:40:24,464 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 15:40:24,464 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 15:40:24,464 - __main__ - INFO - 구성된 프롬프트 길이: 6463 문자
2025-10-20 15:40:24,464 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 15:40:24,464 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 15:40:24,464 - __main__ - INFO - 📝 프롬프트 길이: 6,463 문자
2025-10-20 15:40:24,464 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 15:40:24,464 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 15:40:31,476 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 15:40:31,499 - __main__ - INFO - LLM 응답 길이: 802 문자
2025-10-20 15:40:31,499 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "A. (에이닷)에서 알람을 설정하면 선물을 드려요!",
    "purpose": [
        "이벤트 응모 유도",
        "경품 제공 안내"
    ],
    "product": [
        {
            "name": "A. (에이닷)",
            "action": "사용"
        },
        {
            "name": "A.알람",
            "action": "사용"
        }
    ],
    "channel": [
        {
            "type": "URL",
            "value": "http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr",
            "action": "추가 정보"
        },
  ...
2025-10-20 15:40:31,499 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 15:40:31,500 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 15:40:31,500 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 15:40:31,500 - __main__ - INFO - 파싱된 JSON 내용: {'title': 'A. (에이닷)에서 알람을 설정하면 선물을 드려요!', 'purpose': ['이벤트 응모 유도', '경품 제공 안내'], 'product': [{'name': 'A. (에이닷)', 'action': '사용'}, {'name': 'A.알람', 'action': '사용'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr', 'action': '추가 정보'}, {'type': '전화번호', 'value': '02-542-4920', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['사용법/혜택/이벤트안내_AI', '사용법/혜택/이벤트안내_SKT']}
2025-10-20 15:40:31,500 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 15:40:31,500 - __main__ - INFO - LLM 추출 엔티티: ['A. (에이닷)', 'A.알람']
2025-10-20 15:40:31,729 - __main__ - ERROR - 결합 유사도 계산 실패: DataFrame.reset_index() got an unexpected keyword argument 'name'
2025-10-20 15:40:31,730 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 15:40:31,731 - __main__ - INFO - ============================================================
2025-10-20 15:40:31,731 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 15:40:31,731 - __main__ - INFO - ============================================================
2025-10-20 15:40:31,731 - __main__ - INFO - 제목: A. (에이닷)에서 알람을 설정하면 선물을 드려요!
2025-10-20 15:40:31,731 - __main__ - INFO - 목적: ['이벤트 응모 유도', '경품 제공 안내']
2025-10-20 15:40:31,731 - __main__ - INFO - 상품 수: 2개
2025-10-20 15:40:31,731 - __main__ - INFO - 채널 수: 3개
2025-10-20 15:40:31,731 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 15:40:31,731 - __main__ - INFO - process_message 실행완료: 9.20초
2025-10-20 15:40:31,731 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 15:41:01,292 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 15:41:01,292 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 15:41:01,292 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 15:41:01,292 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 15:41:01,292 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 15:41:01,294 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 15:41:01,328 - __main__ - INFO - Using device: mps
2025-10-20 15:41:01,328 - __main__ - INFO - _initialize_device 실행완료: 0.03초
2025-10-20 15:41:01,328 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 15:41:01,329 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 15:41:01,329 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 15:41:01,329 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 15:41:01,329 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 15:41:01,329 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 15:41:01,329 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 15:41:01,580 - __main__ - INFO - Model loaded on mps
2025-10-20 15:41:01,580 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.25초
2025-10-20 15:41:01,580 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 15:41:02,170 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 15:41:02,171 - __main__ - INFO - _initialize_kiwi 실행완료: 0.59초
2025-10-20 15:41:02,171 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 15:41:02,171 - __main__ - INFO - ============================================================
2025-10-20 15:41:02,171 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 15:41:02,171 - __main__ - INFO - ============================================================
2025-10-20 15:41:02,171 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 15:41:02,171 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 15:41:02,171 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 15:41:02,171 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 15:41:02,171 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:41:02,326 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 15:41:02,326 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:41:02,326 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 15:41:02,334 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 15:41:02,335 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 15:41:02,336 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:41:02,336 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:41:02,337 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 15:41:02,337 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 15:41:02,338 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 15:41:02,342 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 15:41:02,342 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 15:41:02,342 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:41:02,342 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 15:41:02,342 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 15:41:02,343 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 15:41:02,343 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:41:02,343 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 15:41:02,343 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 15:41:02,343 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 15:41:02,344 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 15:41:02,345 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 15:41:02,345 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:41:02,345 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 15:41:02,346 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:41:02,569 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 15:41:02,579 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 15:41:02,579 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증', '우주pass Netflix 인증', '우주PASS Netflix 인증']
2025-10-20 15:41:02,579 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 15:41:02,580 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 15:41:02,580 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 15:41:02,581 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 15:41:02,581 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 15:41:02,581 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 15:41:02,581 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 15:41:02,582 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 15:41:02,583 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 15:41:02,583 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증', '우주pass Netflix 인증', '우주PASS Netflix 인증']
2025-10-20 15:41:02,604 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 15:41:02,604 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 15:41:02,604 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 15:41:02,605 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 15:41:02,605 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 15:41:02,853 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 15:41:02,853 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 15:41:02,853 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 15:41:02,853 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 15:41:02,853 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 15:41:02,853 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:41:02,942 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 15:41:02,942 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:41:02,944 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 15:41:02,945 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 15:41:02,945 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 15:41:02,945 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:41:02,945 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 15:41:02,945 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 15:41:02,945 - __main__ - INFO - ============================================================
2025-10-20 15:41:02,945 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 15:41:02,945 - __main__ - INFO - ============================================================
2025-10-20 15:41:02,945 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 15:41:02,945 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 15:41:02,945 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 15:41:02,946 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 15:41:02,946 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 15:41:02,947 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 15:41:02,948 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 15:41:02,950 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 15:41:02,950 - __main__ - INFO - _load_data 실행완료: 0.78초
2025-10-20 15:41:02,950 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 15:41:02,950 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 15:41:02,951 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A....
2025-10-20 15:41:02,951 - __main__ - INFO - ============================================================
2025-10-20 15:41:02,951 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 15:41:02,951 - __main__ - INFO - ============================================================
2025-10-20 15:41:02,951 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A. (에이닷)에서 알람을 설정하면 선물을 드려요!__#04 고객님, 안녕하세요.__모닝콜, 영양제 먹기, 애견 산책 등  매일 반복되는 일상을 최애 음악으로 알람 설정 해보세요~!__A.(에이닷)에서 알람을 등록하고 권한 설정하면 선물을 드립니다!__▶ 이벤트 자세히 보...
2025-10-20 15:41:02,951 - __main__ - INFO - 메시지 길이: 685 문자
2025-10-20 15:41:02,951 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 15:41:02,951 - __main__ - INFO - 데이터 소스: local
2025-10-20 15:41:02,951 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 15:41:02,951 - __main__ - INFO - 엔티티 추출 모드: logic
2025-10-20 15:41:02,951 - __main__ - INFO - LLM 모델: ax
2025-10-20 15:41:02,951 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 15:41:02,951 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 15:41:02,951 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 15:41:02,951 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 15:41:02,951 - __main__ - INFO - 처리할 메시지 길이: 683 문자
2025-10-20 15:41:02,952 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 15:41:03,608 - __main__ - INFO - 분할된 문장 수: 16개
2025-10-20 15:41:03,609 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'A. 에이닷 에서 알람 설정 선물 드려요 ', ' 고객님 안녕하세요 ']...
2025-10-20 15:41:03,624 - __main__ - INFO - 전체 토큰 수: 296개
2025-10-20 15:41:03,624 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '에이닷', '에이닷', '모닝콜', '에이닷', '에이닷', '기프티콘', '앤', '앨리스']
2025-10-20 15:41:03,624 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['기프티콘', '에이닷', '모닝콜', '앨리스']
2025-10-20 15:41:03,624 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 15:41:04,644 - __main__ - INFO - 퍼지 매칭 결과 크기: (2548, 3)
2025-10-20 15:41:04,644 - __main__ - INFO - 퍼지 매칭 성공: 2548개 결과
2025-10-20 15:41:04,645 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.4285714285714286}]
2025-10-20 15:41:04,645 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 15:41:04,718 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2548, 3)
2025-10-20 15:41:04,719 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.21818181818181817}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.34285714285714286}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.2857142857142857}]
2025-10-20 15:41:04,719 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 15:41:04,722 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 2개
2025-10-20 15:41:04,724 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 15:41:04,724 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-10-20 15:41:04,728 - __main__ - INFO - 최종 후보 아이템 리스트: ['라이트 서비스', 'T 서비스']
2025-10-20 15:41:04,730 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (2, 2)
2025-10-20 15:41:04,730 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-20 15:41:04,731 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.78초
2025-10-20 15:41:04,731 - __main__ - INFO - 추출된 후보 엔티티: ['라이트 서비스', 'T 서비스']
2025-10-20 15:41:04,731 - __main__ - INFO - 매칭된 상품 정보: (2, 2)
2025-10-20 15:41:04,731 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 15:41:04,883 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 15:41:04,883 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 15:41:04,883 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 360 문자
2025-10-20 15:41:04,883 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 15:41:04,883 - __main__ - INFO - 후보 아이템 리스트 크기: 2개
2025-10-20 15:41:04,883 - __main__ - INFO - 후보 아이템 리스트: ['라이트 서비스', 'T 서비스']
2025-10-20 15:41:04,883 - __main__ - INFO - extra_item_pdf 크기: (2, 2)
2025-10-20 15:41:04,883 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 15:41:04,883 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-20 15:41:04,883 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 15:41:04,883 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 15:41:04,883 - __main__ - INFO - 구성된 프롬프트 길이: 6463 문자
2025-10-20 15:41:04,883 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 15:41:04,883 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 15:41:04,883 - __main__ - INFO - 📝 프롬프트 길이: 6,463 문자
2025-10-20 15:41:04,883 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 15:41:04,883 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 15:41:12,405 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 15:41:12,428 - __main__ - INFO - LLM 응답 길이: 802 문자
2025-10-20 15:41:12,428 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "A. (에이닷)에서 알람을 설정하면 선물을 드려요!",
    "purpose": [
        "이벤트 응모 유도",
        "경품 제공 안내"
    ],
    "product": [
        {
            "name": "A. (에이닷)",
            "action": "사용"
        },
        {
            "name": "A.알람",
            "action": "사용"
        }
    ],
    "channel": [
        {
            "type": "URL",
            "value": "http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr",
            "action": "추가 정보"
        },
  ...
2025-10-20 15:41:12,428 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 15:41:12,429 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 15:41:12,429 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 15:41:12,429 - __main__ - INFO - 파싱된 JSON 내용: {'title': 'A. (에이닷)에서 알람을 설정하면 선물을 드려요!', 'purpose': ['이벤트 응모 유도', '경품 제공 안내'], 'product': [{'name': 'A. (에이닷)', 'action': '사용'}, {'name': 'A.알람', 'action': '사용'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr', 'action': '추가 정보'}, {'type': '전화번호', 'value': '02-542-4920', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['사용법/혜택/이벤트안내_AI', '사용법/혜택/이벤트안내_SKT']}
2025-10-20 15:41:12,429 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 15:41:12,429 - __main__ - INFO - LLM 추출 엔티티: ['A. (에이닷)', 'A.알람']
2025-10-20 15:41:12,657 - __main__ - ERROR - 결합 유사도 계산 실패: DataFrame.reset_index() got an unexpected keyword argument 'name'
2025-10-20 15:41:12,658 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 15:41:12,659 - __main__ - INFO - ============================================================
2025-10-20 15:41:12,659 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 15:41:12,659 - __main__ - INFO - ============================================================
2025-10-20 15:41:12,659 - __main__ - INFO - 제목: A. (에이닷)에서 알람을 설정하면 선물을 드려요!
2025-10-20 15:41:12,659 - __main__ - INFO - 목적: ['이벤트 응모 유도', '경품 제공 안내']
2025-10-20 15:41:12,659 - __main__ - INFO - 상품 수: 2개
2025-10-20 15:41:12,659 - __main__ - INFO - 채널 수: 3개
2025-10-20 15:41:12,659 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 15:41:12,659 - __main__ - INFO - process_message 실행완료: 9.71초
2025-10-20 15:41:12,659 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 15:41:34,311 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 15:41:34,311 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 15:41:34,311 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 15:41:34,311 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 15:41:34,311 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 15:41:34,312 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 15:41:34,342 - __main__ - INFO - Using device: mps
2025-10-20 15:41:34,342 - __main__ - INFO - _initialize_device 실행완료: 0.03초
2025-10-20 15:41:34,342 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 15:41:34,342 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 15:41:34,342 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 15:41:34,342 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 15:41:34,342 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 15:41:34,343 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 15:41:34,343 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 15:41:34,600 - __main__ - INFO - Model loaded on mps
2025-10-20 15:41:34,600 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.26초
2025-10-20 15:41:34,600 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 15:41:35,179 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 15:41:35,179 - __main__ - INFO - _initialize_kiwi 실행완료: 0.58초
2025-10-20 15:41:35,179 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 15:41:35,179 - __main__ - INFO - ============================================================
2025-10-20 15:41:35,179 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 15:41:35,179 - __main__ - INFO - ============================================================
2025-10-20 15:41:35,179 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 15:41:35,180 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 15:41:35,180 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 15:41:35,180 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 15:41:35,180 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:41:35,348 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 15:41:35,348 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:41:35,348 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 15:41:35,355 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 15:41:35,356 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 15:41:35,357 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:41:35,357 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:41:35,358 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 15:41:35,358 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 15:41:35,360 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 15:41:35,364 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 15:41:35,364 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 15:41:35,364 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:41:35,364 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 15:41:35,364 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 15:41:35,365 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 15:41:35,365 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:41:35,365 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 15:41:35,365 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 15:41:35,365 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 15:41:35,366 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 15:41:35,366 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 15:41:35,366 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:41:35,367 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 15:41:35,367 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:41:35,592 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 15:41:35,602 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 15:41:35,603 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 넷플릭스 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증']
2025-10-20 15:41:35,603 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 15:41:35,603 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 15:41:35,603 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 15:41:35,604 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 15:41:35,604 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 15:41:35,604 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 15:41:35,604 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 15:41:35,605 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 15:41:35,607 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 15:41:35,607 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 넷플릭스 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증']
2025-10-20 15:41:35,627 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 15:41:35,627 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 15:41:35,627 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 15:41:35,629 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 15:41:35,629 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 15:41:35,873 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 15:41:35,873 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 15:41:35,873 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 15:41:35,873 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 15:41:35,873 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 15:41:35,873 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:41:35,957 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 15:41:35,957 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:41:35,960 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 15:41:35,960 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 15:41:35,960 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 15:41:35,960 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:41:35,960 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 15:41:35,961 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 15:41:35,961 - __main__ - INFO - ============================================================
2025-10-20 15:41:35,961 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 15:41:35,961 - __main__ - INFO - ============================================================
2025-10-20 15:41:35,961 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 15:41:35,961 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 15:41:35,961 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 15:41:35,961 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 15:41:35,961 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 15:41:35,962 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 15:41:35,964 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 15:41:35,966 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 15:41:35,966 - __main__ - INFO - _load_data 실행완료: 0.79초
2025-10-20 15:41:35,966 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 15:41:35,966 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 15:41:35,966 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A....
2025-10-20 15:41:35,966 - __main__ - INFO - ============================================================
2025-10-20 15:41:35,966 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 15:41:35,966 - __main__ - INFO - ============================================================
2025-10-20 15:41:35,966 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A. (에이닷)에서 알람을 설정하면 선물을 드려요!__#04 고객님, 안녕하세요.__모닝콜, 영양제 먹기, 애견 산책 등  매일 반복되는 일상을 최애 음악으로 알람 설정 해보세요~!__A.(에이닷)에서 알람을 등록하고 권한 설정하면 선물을 드립니다!__▶ 이벤트 자세히 보...
2025-10-20 15:41:35,966 - __main__ - INFO - 메시지 길이: 685 문자
2025-10-20 15:41:35,966 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 15:41:35,966 - __main__ - INFO - 데이터 소스: local
2025-10-20 15:41:35,967 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 15:41:35,967 - __main__ - INFO - 엔티티 추출 모드: logic
2025-10-20 15:41:35,967 - __main__ - INFO - LLM 모델: ax
2025-10-20 15:41:35,967 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 15:41:35,967 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 15:41:35,967 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 15:41:35,967 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 15:41:35,967 - __main__ - INFO - 처리할 메시지 길이: 683 문자
2025-10-20 15:41:35,968 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 15:41:36,635 - __main__ - INFO - 분할된 문장 수: 16개
2025-10-20 15:41:36,637 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'A. 에이닷 에서 알람 설정 선물 드려요 ', ' 고객님 안녕하세요 ']...
2025-10-20 15:41:36,651 - __main__ - INFO - 전체 토큰 수: 296개
2025-10-20 15:41:36,651 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '에이닷', '에이닷', '모닝콜', '에이닷', '에이닷', '기프티콘', '앤', '앨리스']
2025-10-20 15:41:36,651 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['모닝콜', '기프티콘', '에이닷', '앨리스']
2025-10-20 15:41:36,651 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 15:41:37,689 - __main__ - INFO - 퍼지 매칭 결과 크기: (2548, 3)
2025-10-20 15:41:37,689 - __main__ - INFO - 퍼지 매칭 성공: 2548개 결과
2025-10-20 15:41:37,690 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.4285714285714286}]
2025-10-20 15:41:37,690 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 15:41:37,763 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2548, 3)
2025-10-20 15:41:37,763 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.21818181818181817}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.34285714285714286}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.2857142857142857}]
2025-10-20 15:41:37,764 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 15:41:37,767 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 2개
2025-10-20 15:41:37,769 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 15:41:37,769 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-10-20 15:41:37,772 - __main__ - INFO - 최종 후보 아이템 리스트: ['라이트 서비스', 'T 서비스']
2025-10-20 15:41:37,774 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (2, 2)
2025-10-20 15:41:37,774 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-20 15:41:37,775 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.81초
2025-10-20 15:41:37,775 - __main__ - INFO - 추출된 후보 엔티티: ['라이트 서비스', 'T 서비스']
2025-10-20 15:41:37,775 - __main__ - INFO - 매칭된 상품 정보: (2, 2)
2025-10-20 15:41:37,775 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 15:41:37,931 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 15:41:37,931 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 15:41:37,931 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 360 문자
2025-10-20 15:41:37,931 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 15:41:37,931 - __main__ - INFO - 후보 아이템 리스트 크기: 2개
2025-10-20 15:41:37,931 - __main__ - INFO - 후보 아이템 리스트: ['라이트 서비스', 'T 서비스']
2025-10-20 15:41:37,931 - __main__ - INFO - extra_item_pdf 크기: (2, 2)
2025-10-20 15:41:37,931 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 15:41:37,932 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-20 15:41:37,932 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 15:41:37,932 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 15:41:37,932 - __main__ - INFO - 구성된 프롬프트 길이: 6463 문자
2025-10-20 15:41:37,932 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 15:41:37,932 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 15:41:37,932 - __main__ - INFO - 📝 프롬프트 길이: 6,463 문자
2025-10-20 15:41:37,932 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 15:41:37,932 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 15:41:44,441 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 15:41:44,457 - __main__ - INFO - LLM 응답 길이: 802 문자
2025-10-20 15:41:44,457 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "A. (에이닷)에서 알람을 설정하면 선물을 드려요!",
    "purpose": [
        "이벤트 응모 유도",
        "경품 제공 안내"
    ],
    "product": [
        {
            "name": "A. (에이닷)",
            "action": "사용"
        },
        {
            "name": "A.알람",
            "action": "사용"
        }
    ],
    "channel": [
        {
            "type": "URL",
            "value": "http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr",
            "action": "추가 정보"
        },
  ...
2025-10-20 15:41:44,458 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 15:41:44,458 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 15:41:44,458 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 15:41:44,458 - __main__ - INFO - 파싱된 JSON 내용: {'title': 'A. (에이닷)에서 알람을 설정하면 선물을 드려요!', 'purpose': ['이벤트 응모 유도', '경품 제공 안내'], 'product': [{'name': 'A. (에이닷)', 'action': '사용'}, {'name': 'A.알람', 'action': '사용'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr', 'action': '추가 정보'}, {'type': '전화번호', 'value': '02-542-4920', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['사용법/혜택/이벤트안내_AI', '사용법/혜택/이벤트안내_SKT']}
2025-10-20 15:41:44,459 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 15:41:44,459 - __main__ - INFO - LLM 추출 엔티티: ['A. (에이닷)', 'A.알람']
2025-10-20 15:41:44,763 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 15:41:44,763 - __main__ - INFO - ============================================================
2025-10-20 15:41:44,763 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 15:41:44,763 - __main__ - INFO - ============================================================
2025-10-20 15:41:44,763 - __main__ - INFO - 제목: A. (에이닷)에서 알람을 설정하면 선물을 드려요!
2025-10-20 15:41:44,763 - __main__ - INFO - 목적: ['이벤트 응모 유도', '경품 제공 안내']
2025-10-20 15:41:44,763 - __main__ - INFO - 상품 수: 2개
2025-10-20 15:41:44,763 - __main__ - INFO - 채널 수: 3개
2025-10-20 15:41:44,763 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 15:41:44,763 - __main__ - INFO - process_message 실행완료: 8.80초
2025-10-20 15:41:44,763 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 15:42:14,646 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 15:42:14,647 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 15:42:14,647 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 15:42:14,647 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 15:42:14,647 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 15:42:14,648 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 15:42:14,687 - __main__ - INFO - Using device: mps
2025-10-20 15:42:14,687 - __main__ - INFO - _initialize_device 실행완료: 0.04초
2025-10-20 15:42:14,687 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 15:42:14,687 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 15:42:14,687 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 15:42:14,688 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 15:42:14,688 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 15:42:14,688 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 15:42:14,688 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 15:42:14,943 - __main__ - INFO - Model loaded on mps
2025-10-20 15:42:14,944 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.26초
2025-10-20 15:42:14,944 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 15:42:15,516 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 15:42:15,516 - __main__ - INFO - _initialize_kiwi 실행완료: 0.57초
2025-10-20 15:42:15,516 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 15:42:15,516 - __main__ - INFO - ============================================================
2025-10-20 15:42:15,516 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 15:42:15,517 - __main__ - INFO - ============================================================
2025-10-20 15:42:15,517 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 15:42:15,517 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 15:42:15,517 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 15:42:15,517 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 15:42:15,517 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:42:15,667 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 15:42:15,667 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:42:15,667 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 15:42:15,674 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 15:42:15,675 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 15:42:15,676 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:42:15,677 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:42:15,677 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 15:42:15,678 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 15:42:15,679 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 15:42:15,683 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 15:42:15,683 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 15:42:15,683 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:42:15,683 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 15:42:15,683 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 15:42:15,683 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 15:42:15,683 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:42:15,683 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 15:42:15,683 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 15:42:15,684 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 15:42:15,685 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 15:42:15,685 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 15:42:15,685 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:42:15,686 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 15:42:15,686 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:42:15,907 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 15:42:15,918 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 15:42:15,918 - __main__ - INFO - 별칭 적용 후 샘플: ['우주pass Netflix 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 넷플릭스 인증', '우주패스 Netflix 인증']
2025-10-20 15:42:15,919 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 15:42:15,919 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 15:42:15,919 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 15:42:15,920 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 15:42:15,920 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 15:42:15,920 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 15:42:15,920 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 15:42:15,921 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 15:42:15,923 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 15:42:15,923 - __main__ - INFO - 등록할 별칭 샘플: ['우주pass Netflix 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 넷플릭스 인증', '우주패스 Netflix 인증']
2025-10-20 15:42:15,945 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 15:42:15,945 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 15:42:15,945 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 15:42:15,946 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 15:42:15,946 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 15:42:16,189 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 15:42:16,189 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 15:42:16,189 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 15:42:16,190 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 15:42:16,190 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 15:42:16,190 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:42:16,277 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 15:42:16,277 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:42:16,280 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 15:42:16,281 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 15:42:16,281 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 15:42:16,281 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:42:16,281 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 15:42:16,282 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 15:42:16,282 - __main__ - INFO - ============================================================
2025-10-20 15:42:16,282 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 15:42:16,282 - __main__ - INFO - ============================================================
2025-10-20 15:42:16,282 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 15:42:16,282 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 15:42:16,282 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 15:42:16,282 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 15:42:16,282 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 15:42:16,283 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 15:42:16,285 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 15:42:16,287 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 15:42:16,287 - __main__ - INFO - _load_data 실행완료: 0.77초
2025-10-20 15:42:16,287 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 15:42:16,287 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 15:42:16,287 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A....
2025-10-20 15:42:16,287 - __main__ - INFO - ============================================================
2025-10-20 15:42:16,287 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 15:42:16,287 - __main__ - INFO - ============================================================
2025-10-20 15:42:16,287 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A. (에이닷)에서 알람을 설정하면 선물을 드려요!__#04 고객님, 안녕하세요.__모닝콜, 영양제 먹기, 애견 산책 등  매일 반복되는 일상을 최애 음악으로 알람 설정 해보세요~!__A.(에이닷)에서 알람을 등록하고 권한 설정하면 선물을 드립니다!__▶ 이벤트 자세히 보...
2025-10-20 15:42:16,287 - __main__ - INFO - 메시지 길이: 685 문자
2025-10-20 15:42:16,288 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 15:42:16,288 - __main__ - INFO - 데이터 소스: local
2025-10-20 15:42:16,288 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 15:42:16,288 - __main__ - INFO - 엔티티 추출 모드: logic
2025-10-20 15:42:16,288 - __main__ - INFO - LLM 모델: ax
2025-10-20 15:42:16,288 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 15:42:16,288 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 15:42:16,288 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 15:42:16,288 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 15:42:16,288 - __main__ - INFO - 처리할 메시지 길이: 683 문자
2025-10-20 15:42:16,289 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 15:42:17,015 - __main__ - INFO - 분할된 문장 수: 16개
2025-10-20 15:42:17,016 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'A. 에이닷 에서 알람 설정 선물 드려요 ', ' 고객님 안녕하세요 ']...
2025-10-20 15:42:17,031 - __main__ - INFO - 전체 토큰 수: 296개
2025-10-20 15:42:17,031 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '에이닷', '에이닷', '모닝콜', '에이닷', '에이닷', '기프티콘', '앤', '앨리스']
2025-10-20 15:42:17,031 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['모닝콜', '에이닷', '앨리스', '기프티콘']
2025-10-20 15:42:17,031 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 15:42:18,067 - __main__ - INFO - 퍼지 매칭 결과 크기: (2548, 3)
2025-10-20 15:42:18,067 - __main__ - INFO - 퍼지 매칭 성공: 2548개 결과
2025-10-20 15:42:18,068 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.4285714285714286}]
2025-10-20 15:42:18,068 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 15:42:18,152 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2548, 3)
2025-10-20 15:42:18,153 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.21818181818181817}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.34285714285714286}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.2857142857142857}]
2025-10-20 15:42:18,153 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 15:42:18,156 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 2개
2025-10-20 15:42:18,158 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 15:42:18,159 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-10-20 15:42:18,162 - __main__ - INFO - 최종 후보 아이템 리스트: ['라이트 서비스', 'T 서비스']
2025-10-20 15:42:18,164 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (2, 2)
2025-10-20 15:42:18,164 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-20 15:42:18,165 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.88초
2025-10-20 15:42:18,165 - __main__ - INFO - 추출된 후보 엔티티: ['라이트 서비스', 'T 서비스']
2025-10-20 15:42:18,165 - __main__ - INFO - 매칭된 상품 정보: (2, 2)
2025-10-20 15:42:18,165 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 15:42:18,316 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 15:42:18,316 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 15:42:18,316 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 360 문자
2025-10-20 15:42:18,316 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 15:42:18,316 - __main__ - INFO - 후보 아이템 리스트 크기: 2개
2025-10-20 15:42:18,316 - __main__ - INFO - 후보 아이템 리스트: ['라이트 서비스', 'T 서비스']
2025-10-20 15:42:18,316 - __main__ - INFO - extra_item_pdf 크기: (2, 2)
2025-10-20 15:42:18,316 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 15:42:18,316 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-20 15:42:18,316 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 15:42:18,316 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 15:42:18,317 - __main__ - INFO - 구성된 프롬프트 길이: 6463 문자
2025-10-20 15:42:18,317 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 15:42:18,317 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 15:42:18,317 - __main__ - INFO - 📝 프롬프트 길이: 6,463 문자
2025-10-20 15:42:18,317 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 15:42:18,317 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 15:42:25,113 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 15:42:25,134 - __main__ - INFO - LLM 응답 길이: 802 문자
2025-10-20 15:42:25,135 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "A. (에이닷)에서 알람을 설정하면 선물을 드려요!",
    "purpose": [
        "이벤트 응모 유도",
        "경품 제공 안내"
    ],
    "product": [
        {
            "name": "A. (에이닷)",
            "action": "사용"
        },
        {
            "name": "A.알람",
            "action": "사용"
        }
    ],
    "channel": [
        {
            "type": "URL",
            "value": "http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr",
            "action": "추가 정보"
        },
  ...
2025-10-20 15:42:25,135 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 15:42:25,135 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 15:42:25,135 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 15:42:25,136 - __main__ - INFO - 파싱된 JSON 내용: {'title': 'A. (에이닷)에서 알람을 설정하면 선물을 드려요!', 'purpose': ['이벤트 응모 유도', '경품 제공 안내'], 'product': [{'name': 'A. (에이닷)', 'action': '사용'}, {'name': 'A.알람', 'action': '사용'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr', 'action': '추가 정보'}, {'type': '전화번호', 'value': '02-542-4920', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['사용법/혜택/이벤트안내_AI', '사용법/혜택/이벤트안내_SKT']}
2025-10-20 15:42:25,136 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 15:42:25,136 - __main__ - INFO - LLM 추출 엔티티: ['A. (에이닷)', 'A.알람']
2025-10-20 15:42:25,371 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 15:42:25,371 - __main__ - INFO - ============================================================
2025-10-20 15:42:25,371 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 15:42:25,371 - __main__ - INFO - ============================================================
2025-10-20 15:42:25,371 - __main__ - INFO - 제목: A. (에이닷)에서 알람을 설정하면 선물을 드려요!
2025-10-20 15:42:25,371 - __main__ - INFO - 목적: ['이벤트 응모 유도', '경품 제공 안내']
2025-10-20 15:42:25,371 - __main__ - INFO - 상품 수: 2개
2025-10-20 15:42:25,371 - __main__ - INFO - 채널 수: 3개
2025-10-20 15:42:25,371 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 15:42:25,371 - __main__ - INFO - process_message 실행완료: 9.08초
2025-10-20 15:42:25,371 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 15:43:10,654 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 15:43:10,655 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 15:43:10,655 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 15:43:10,655 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 15:43:10,655 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 15:43:10,656 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 15:43:10,690 - __main__ - INFO - Using device: mps
2025-10-20 15:43:10,690 - __main__ - INFO - _initialize_device 실행완료: 0.03초
2025-10-20 15:43:10,690 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 15:43:10,690 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 15:43:10,690 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 15:43:10,690 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 15:43:10,690 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 15:43:10,690 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 15:43:10,691 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 15:43:10,945 - __main__ - INFO - Model loaded on mps
2025-10-20 15:43:10,945 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.26초
2025-10-20 15:43:10,945 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 15:43:11,518 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 15:43:11,518 - __main__ - INFO - _initialize_kiwi 실행완료: 0.57초
2025-10-20 15:43:11,518 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 15:43:11,518 - __main__ - INFO - ============================================================
2025-10-20 15:43:11,518 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 15:43:11,519 - __main__ - INFO - ============================================================
2025-10-20 15:43:11,519 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 15:43:11,519 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 15:43:11,519 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 15:43:11,519 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 15:43:11,519 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:43:11,670 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 15:43:11,670 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:43:11,670 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 15:43:11,677 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 15:43:11,678 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 15:43:11,679 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:43:11,680 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:43:11,680 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 15:43:11,680 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 15:43:11,681 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 15:43:11,685 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 15:43:11,685 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 15:43:11,685 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:43:11,685 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 15:43:11,685 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 15:43:11,686 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 15:43:11,686 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:43:11,686 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 15:43:11,686 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 15:43:11,686 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 15:43:11,687 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 15:43:11,687 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 15:43:11,687 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:43:11,688 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 15:43:11,688 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:43:11,911 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 15:43:11,922 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 15:43:11,923 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 넷플릭스 인증', '우주패스 Netflix 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증']
2025-10-20 15:43:11,923 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 15:43:11,923 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 15:43:11,923 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 15:43:11,924 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 15:43:11,924 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 15:43:11,924 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 15:43:11,924 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 15:43:11,925 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 15:43:11,927 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 15:43:11,927 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 넷플릭스 인증', '우주패스 Netflix 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증']
2025-10-20 15:43:11,947 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 15:43:11,948 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 15:43:11,948 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 15:43:11,949 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 15:43:11,949 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 15:43:12,199 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 15:43:12,200 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 15:43:12,200 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 15:43:12,200 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 15:43:12,200 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 15:43:12,200 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:43:12,290 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 15:43:12,290 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:43:12,293 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 15:43:12,293 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 15:43:12,293 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 15:43:12,293 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:43:12,293 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 15:43:12,294 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 15:43:12,294 - __main__ - INFO - ============================================================
2025-10-20 15:43:12,294 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 15:43:12,294 - __main__ - INFO - ============================================================
2025-10-20 15:43:12,294 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 15:43:12,294 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 15:43:12,294 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 15:43:12,294 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 15:43:12,294 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 15:43:12,295 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 15:43:12,297 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 15:43:12,299 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 15:43:12,299 - __main__ - INFO - _load_data 실행완료: 0.78초
2025-10-20 15:43:12,299 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 15:43:12,299 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 15:43:12,300 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A....
2025-10-20 15:43:12,300 - __main__ - INFO - ============================================================
2025-10-20 15:43:12,300 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 15:43:12,300 - __main__ - INFO - ============================================================
2025-10-20 15:43:12,300 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A. (에이닷)에서 알람을 설정하면 선물을 드려요!__#04 고객님, 안녕하세요.__모닝콜, 영양제 먹기, 애견 산책 등  매일 반복되는 일상을 최애 음악으로 알람 설정 해보세요~!__A.(에이닷)에서 알람을 등록하고 권한 설정하면 선물을 드립니다!__▶ 이벤트 자세히 보...
2025-10-20 15:43:12,300 - __main__ - INFO - 메시지 길이: 685 문자
2025-10-20 15:43:12,300 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 15:43:12,300 - __main__ - INFO - 데이터 소스: local
2025-10-20 15:43:12,300 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 15:43:12,300 - __main__ - INFO - 엔티티 추출 모드: logic
2025-10-20 15:43:12,300 - __main__ - INFO - LLM 모델: ax
2025-10-20 15:43:12,300 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 15:43:12,300 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 15:43:12,300 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 15:43:12,300 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 15:43:12,300 - __main__ - INFO - 처리할 메시지 길이: 683 문자
2025-10-20 15:43:12,301 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 15:43:13,014 - __main__ - INFO - 분할된 문장 수: 16개
2025-10-20 15:43:13,015 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'A. 에이닷 에서 알람 설정 선물 드려요 ', ' 고객님 안녕하세요 ']...
2025-10-20 15:43:13,030 - __main__ - INFO - 전체 토큰 수: 296개
2025-10-20 15:43:13,031 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '에이닷', '에이닷', '모닝콜', '에이닷', '에이닷', '기프티콘', '앤', '앨리스']
2025-10-20 15:43:13,031 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['모닝콜', '앨리스', '에이닷', '기프티콘']
2025-10-20 15:43:13,031 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 15:43:14,867 - __main__ - INFO - 퍼지 매칭 결과 크기: (2548, 3)
2025-10-20 15:43:14,867 - __main__ - INFO - 퍼지 매칭 성공: 2548개 결과
2025-10-20 15:43:14,868 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.4285714285714286}]
2025-10-20 15:43:14,868 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 15:43:14,982 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2548, 3)
2025-10-20 15:43:14,983 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.21818181818181817}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.34285714285714286}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.2857142857142857}]
2025-10-20 15:43:14,983 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 15:43:14,986 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 2개
2025-10-20 15:43:14,988 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 15:43:14,988 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-10-20 15:43:14,991 - __main__ - INFO - 최종 후보 아이템 리스트: ['라이트 서비스', 'T 서비스']
2025-10-20 15:43:14,995 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (2, 2)
2025-10-20 15:43:14,995 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-20 15:43:14,995 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 2.70초
2025-10-20 15:43:14,995 - __main__ - INFO - 추출된 후보 엔티티: ['라이트 서비스', 'T 서비스']
2025-10-20 15:43:14,995 - __main__ - INFO - 매칭된 상품 정보: (2, 2)
2025-10-20 15:43:14,995 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 15:43:15,560 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 15:43:15,560 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 15:43:15,560 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 360 문자
2025-10-20 15:43:15,560 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 15:43:15,560 - __main__ - INFO - 후보 아이템 리스트 크기: 2개
2025-10-20 15:43:15,560 - __main__ - INFO - 후보 아이템 리스트: ['라이트 서비스', 'T 서비스']
2025-10-20 15:43:15,560 - __main__ - INFO - extra_item_pdf 크기: (2, 2)
2025-10-20 15:43:15,560 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 15:43:15,561 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-20 15:43:15,561 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 15:43:15,561 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 15:43:15,561 - __main__ - INFO - 구성된 프롬프트 길이: 6463 문자
2025-10-20 15:43:15,561 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 15:43:15,561 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 15:43:15,561 - __main__ - INFO - 📝 프롬프트 길이: 6,463 문자
2025-10-20 15:43:15,561 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 15:43:15,561 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 15:43:22,275 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 15:43:22,298 - __main__ - INFO - LLM 응답 길이: 802 문자
2025-10-20 15:43:22,298 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "A. (에이닷)에서 알람을 설정하면 선물을 드려요!",
    "purpose": [
        "이벤트 응모 유도",
        "경품 제공 안내"
    ],
    "product": [
        {
            "name": "A. (에이닷)",
            "action": "사용"
        },
        {
            "name": "A.알람",
            "action": "사용"
        }
    ],
    "channel": [
        {
            "type": "URL",
            "value": "http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr",
            "action": "추가 정보"
        },
  ...
2025-10-20 15:43:22,299 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 15:43:22,299 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 15:43:22,299 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 15:43:22,299 - __main__ - INFO - 파싱된 JSON 내용: {'title': 'A. (에이닷)에서 알람을 설정하면 선물을 드려요!', 'purpose': ['이벤트 응모 유도', '경품 제공 안내'], 'product': [{'name': 'A. (에이닷)', 'action': '사용'}, {'name': 'A.알람', 'action': '사용'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr', 'action': '추가 정보'}, {'type': '전화번호', 'value': '02-542-4920', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['사용법/혜택/이벤트안내_AI', '사용법/혜택/이벤트안내_SKT']}
2025-10-20 15:43:22,299 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 15:43:22,300 - __main__ - INFO - LLM 추출 엔티티: ['A. (에이닷)', 'A.알람']
2025-10-20 15:43:22,535 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 15:43:22,535 - __main__ - INFO - ============================================================
2025-10-20 15:43:22,535 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 15:43:22,535 - __main__ - INFO - ============================================================
2025-10-20 15:43:22,535 - __main__ - INFO - 제목: A. (에이닷)에서 알람을 설정하면 선물을 드려요!
2025-10-20 15:43:22,535 - __main__ - INFO - 목적: ['이벤트 응모 유도', '경품 제공 안내']
2025-10-20 15:43:22,535 - __main__ - INFO - 상품 수: 2개
2025-10-20 15:43:22,535 - __main__ - INFO - 채널 수: 3개
2025-10-20 15:43:22,535 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 15:43:22,536 - __main__ - INFO - process_message 실행완료: 10.24초
2025-10-20 15:43:22,536 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 15:44:07,951 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 15:44:07,951 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 15:44:07,951 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 15:44:07,951 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 15:44:07,951 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 15:44:07,952 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 15:44:07,985 - __main__ - INFO - Using device: mps
2025-10-20 15:44:07,985 - __main__ - INFO - _initialize_device 실행완료: 0.03초
2025-10-20 15:44:07,985 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 15:44:07,986 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 15:44:07,986 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 15:44:07,986 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 15:44:07,986 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 15:44:07,986 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 15:44:07,986 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 15:44:08,255 - __main__ - INFO - Model loaded on mps
2025-10-20 15:44:08,256 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.27초
2025-10-20 15:44:08,256 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 15:44:08,836 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 15:44:08,836 - __main__ - INFO - _initialize_kiwi 실행완료: 0.58초
2025-10-20 15:44:08,837 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 15:44:08,837 - __main__ - INFO - ============================================================
2025-10-20 15:44:08,837 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 15:44:08,837 - __main__ - INFO - ============================================================
2025-10-20 15:44:08,837 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 15:44:08,837 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 15:44:08,837 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 15:44:08,837 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 15:44:08,837 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:44:08,986 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 15:44:08,986 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:44:08,987 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 15:44:08,994 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 15:44:08,995 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 15:44:08,995 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:44:08,996 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:44:08,996 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 15:44:08,997 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 15:44:08,998 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 15:44:09,001 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 15:44:09,002 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 15:44:09,002 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:44:09,002 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 15:44:09,002 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 15:44:09,002 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 15:44:09,002 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:44:09,002 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 15:44:09,002 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 15:44:09,002 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 15:44:09,003 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 15:44:09,004 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 15:44:09,004 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:44:09,004 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 15:44:09,004 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:44:09,236 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 15:44:09,247 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 15:44:09,248 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 Netflix 인증', '우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증']
2025-10-20 15:44:09,248 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 15:44:09,248 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 15:44:09,248 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 15:44:09,249 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 15:44:09,249 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 15:44:09,249 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 15:44:09,249 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 15:44:09,250 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 15:44:09,252 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 15:44:09,252 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 Netflix 인증', '우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증']
2025-10-20 15:44:09,273 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 15:44:09,274 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 15:44:09,274 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 15:44:09,275 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 15:44:09,275 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 15:44:09,512 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 15:44:09,513 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 15:44:09,513 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 15:44:09,513 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 15:44:09,513 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 15:44:09,513 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:44:09,597 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 15:44:09,597 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:44:09,600 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 15:44:09,600 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 15:44:09,600 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 15:44:09,600 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:44:09,600 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 15:44:09,601 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 15:44:09,601 - __main__ - INFO - ============================================================
2025-10-20 15:44:09,601 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 15:44:09,601 - __main__ - INFO - ============================================================
2025-10-20 15:44:09,601 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 15:44:09,601 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 15:44:09,601 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 15:44:09,601 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 15:44:09,601 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 15:44:09,602 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 15:44:09,604 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 15:44:09,606 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 15:44:09,606 - __main__ - INFO - _load_data 실행완료: 0.77초
2025-10-20 15:44:09,606 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 15:44:09,606 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 15:44:09,606 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A....
2025-10-20 15:44:09,606 - __main__ - INFO - ============================================================
2025-10-20 15:44:09,606 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 15:44:09,606 - __main__ - INFO - ============================================================
2025-10-20 15:44:09,606 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A. (에이닷)에서 알람을 설정하면 선물을 드려요!__#04 고객님, 안녕하세요.__모닝콜, 영양제 먹기, 애견 산책 등  매일 반복되는 일상을 최애 음악으로 알람 설정 해보세요~!__A.(에이닷)에서 알람을 등록하고 권한 설정하면 선물을 드립니다!__▶ 이벤트 자세히 보...
2025-10-20 15:44:09,606 - __main__ - INFO - 메시지 길이: 685 문자
2025-10-20 15:44:09,606 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 15:44:09,607 - __main__ - INFO - 데이터 소스: local
2025-10-20 15:44:09,607 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 15:44:09,607 - __main__ - INFO - 엔티티 추출 모드: logic
2025-10-20 15:44:09,607 - __main__ - INFO - LLM 모델: ax
2025-10-20 15:44:09,607 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 15:44:09,607 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 15:44:09,607 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 15:44:09,607 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 15:44:09,607 - __main__ - INFO - 처리할 메시지 길이: 683 문자
2025-10-20 15:44:09,608 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 15:44:10,269 - __main__ - INFO - 분할된 문장 수: 16개
2025-10-20 15:44:10,270 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'A. 에이닷 에서 알람 설정 선물 드려요 ', ' 고객님 안녕하세요 ']...
2025-10-20 15:44:10,286 - __main__ - INFO - 전체 토큰 수: 296개
2025-10-20 15:44:10,286 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '에이닷', '에이닷', '모닝콜', '에이닷', '에이닷', '기프티콘', '앤', '앨리스']
2025-10-20 15:44:10,286 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['기프티콘', '에이닷', '앨리스', '모닝콜']
2025-10-20 15:44:10,286 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 15:44:11,302 - __main__ - INFO - 퍼지 매칭 결과 크기: (2548, 3)
2025-10-20 15:44:11,302 - __main__ - INFO - 퍼지 매칭 성공: 2548개 결과
2025-10-20 15:44:11,303 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.4285714285714286}]
2025-10-20 15:44:11,303 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 15:44:11,384 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2548, 3)
2025-10-20 15:44:11,385 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.21818181818181817}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.34285714285714286}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.2857142857142857}]
2025-10-20 15:44:11,385 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 15:44:11,388 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 2개
2025-10-20 15:44:11,390 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 15:44:11,391 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-10-20 15:44:11,394 - __main__ - INFO - 최종 후보 아이템 리스트: ['라이트 서비스', 'T 서비스']
2025-10-20 15:44:11,397 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (2, 2)
2025-10-20 15:44:11,397 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-20 15:44:11,398 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.79초
2025-10-20 15:44:11,398 - __main__ - INFO - 추출된 후보 엔티티: ['라이트 서비스', 'T 서비스']
2025-10-20 15:44:11,398 - __main__ - INFO - 매칭된 상품 정보: (2, 2)
2025-10-20 15:44:11,398 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 15:44:11,553 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 15:44:11,553 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 15:44:11,553 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 360 문자
2025-10-20 15:44:11,553 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 15:44:11,553 - __main__ - INFO - 후보 아이템 리스트 크기: 2개
2025-10-20 15:44:11,553 - __main__ - INFO - 후보 아이템 리스트: ['라이트 서비스', 'T 서비스']
2025-10-20 15:44:11,553 - __main__ - INFO - extra_item_pdf 크기: (2, 2)
2025-10-20 15:44:11,553 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 15:44:11,554 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-20 15:44:11,554 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 15:44:11,554 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 15:44:11,554 - __main__ - INFO - 구성된 프롬프트 길이: 6463 문자
2025-10-20 15:44:11,554 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 15:44:11,554 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 15:44:11,554 - __main__ - INFO - 📝 프롬프트 길이: 6,463 문자
2025-10-20 15:44:11,554 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 15:44:11,554 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 15:44:18,534 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 15:44:18,558 - __main__ - INFO - LLM 응답 길이: 802 문자
2025-10-20 15:44:18,558 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "A. (에이닷)에서 알람을 설정하면 선물을 드려요!",
    "purpose": [
        "이벤트 응모 유도",
        "경품 제공 안내"
    ],
    "product": [
        {
            "name": "A. (에이닷)",
            "action": "사용"
        },
        {
            "name": "A.알람",
            "action": "사용"
        }
    ],
    "channel": [
        {
            "type": "URL",
            "value": "http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr",
            "action": "추가 정보"
        },
  ...
2025-10-20 15:44:18,558 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 15:44:18,559 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 15:44:18,559 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 15:44:18,559 - __main__ - INFO - 파싱된 JSON 내용: {'title': 'A. (에이닷)에서 알람을 설정하면 선물을 드려요!', 'purpose': ['이벤트 응모 유도', '경품 제공 안내'], 'product': [{'name': 'A. (에이닷)', 'action': '사용'}, {'name': 'A.알람', 'action': '사용'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr', 'action': '추가 정보'}, {'type': '전화번호', 'value': '02-542-4920', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['사용법/혜택/이벤트안내_AI', '사용법/혜택/이벤트안내_SKT']}
2025-10-20 15:44:18,559 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 15:44:18,559 - __main__ - INFO - LLM 추출 엔티티: ['A. (에이닷)', 'A.알람']
2025-10-20 15:44:18,790 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 15:44:18,791 - __main__ - INFO - ============================================================
2025-10-20 15:44:18,791 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 15:44:18,791 - __main__ - INFO - ============================================================
2025-10-20 15:44:18,791 - __main__ - INFO - 제목: A. (에이닷)에서 알람을 설정하면 선물을 드려요!
2025-10-20 15:44:18,791 - __main__ - INFO - 목적: ['이벤트 응모 유도', '경품 제공 안내']
2025-10-20 15:44:18,791 - __main__ - INFO - 상품 수: 2개
2025-10-20 15:44:18,791 - __main__ - INFO - 채널 수: 3개
2025-10-20 15:44:18,791 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 15:44:18,791 - __main__ - INFO - process_message 실행완료: 9.18초
2025-10-20 15:44:18,791 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 15:45:24,880 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 15:45:24,881 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 15:45:24,881 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 15:45:24,881 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 15:45:24,881 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 15:45:24,882 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 15:45:24,919 - __main__ - INFO - Using device: mps
2025-10-20 15:45:24,919 - __main__ - INFO - _initialize_device 실행완료: 0.04초
2025-10-20 15:45:24,919 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 15:45:24,919 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 15:45:24,919 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 15:45:24,919 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 15:45:24,919 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 15:45:24,920 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 15:45:24,920 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 15:45:25,176 - __main__ - INFO - Model loaded on mps
2025-10-20 15:45:25,176 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.26초
2025-10-20 15:45:25,176 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 15:45:25,751 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 15:45:25,752 - __main__ - INFO - _initialize_kiwi 실행완료: 0.58초
2025-10-20 15:45:25,752 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 15:45:25,752 - __main__ - INFO - ============================================================
2025-10-20 15:45:25,752 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 15:45:25,752 - __main__ - INFO - ============================================================
2025-10-20 15:45:25,752 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 15:45:25,752 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 15:45:25,752 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 15:45:25,752 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 15:45:25,752 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:45:25,916 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 15:45:25,916 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:45:25,916 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 15:45:25,923 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 15:45:25,924 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 15:45:25,925 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:45:25,926 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:45:25,926 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 15:45:25,926 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 15:45:25,928 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 15:45:25,932 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 15:45:25,932 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 15:45:25,932 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:45:25,932 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 15:45:25,932 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 15:45:25,933 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 15:45:25,933 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:45:25,933 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 15:45:25,933 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 15:45:25,933 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 15:45:25,934 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 15:45:25,934 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 15:45:25,934 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:45:25,935 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 15:45:25,935 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 15:45:26,158 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 15:45:26,168 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 15:45:26,169 - __main__ - INFO - 별칭 적용 후 샘플: ['우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주pass Netflix 인증']
2025-10-20 15:45:26,169 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 15:45:26,170 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 15:45:26,170 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 15:45:26,171 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 15:45:26,171 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 15:45:26,171 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 15:45:26,171 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 15:45:26,173 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 15:45:26,174 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 15:45:26,174 - __main__ - INFO - 등록할 별칭 샘플: ['우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주pass Netflix 인증']
2025-10-20 15:45:26,196 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 15:45:26,196 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 15:45:26,197 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 15:45:26,198 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 15:45:26,198 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 15:45:26,460 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 15:45:26,460 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 15:45:26,460 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 15:45:26,460 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 15:45:26,460 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 15:45:26,460 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 15:45:26,544 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 15:45:26,544 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 15:45:26,547 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 15:45:26,547 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 15:45:26,547 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 15:45:26,547 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 15:45:26,547 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 15:45:26,548 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 15:45:26,548 - __main__ - INFO - ============================================================
2025-10-20 15:45:26,548 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 15:45:26,548 - __main__ - INFO - ============================================================
2025-10-20 15:45:26,548 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 15:45:26,548 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 15:45:26,548 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 15:45:26,548 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 15:45:26,548 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 15:45:26,549 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 15:45:26,551 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 15:45:26,553 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 15:45:26,553 - __main__ - INFO - _load_data 실행완료: 0.80초
2025-10-20 15:45:26,554 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 15:45:26,554 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 15:45:26,554 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A....
2025-10-20 15:45:26,554 - __main__ - INFO - ============================================================
2025-10-20 15:45:26,554 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 15:45:26,554 - __main__ - INFO - ============================================================
2025-10-20 15:45:26,554 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A. (에이닷)에서 알람을 설정하면 선물을 드려요!__#04 고객님, 안녕하세요.__모닝콜, 영양제 먹기, 애견 산책 등  매일 반복되는 일상을 최애 음악으로 알람 설정 해보세요~!__A.(에이닷)에서 알람을 등록하고 권한 설정하면 선물을 드립니다!__▶ 이벤트 자세히 보...
2025-10-20 15:45:26,554 - __main__ - INFO - 메시지 길이: 685 문자
2025-10-20 15:45:26,554 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 15:45:26,554 - __main__ - INFO - 데이터 소스: local
2025-10-20 15:45:26,554 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 15:45:26,554 - __main__ - INFO - 엔티티 추출 모드: logic
2025-10-20 15:45:26,554 - __main__ - INFO - LLM 모델: ax
2025-10-20 15:45:26,554 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 15:45:26,554 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 15:45:26,554 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 15:45:26,554 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 15:45:26,554 - __main__ - INFO - 처리할 메시지 길이: 683 문자
2025-10-20 15:45:26,555 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 15:45:27,225 - __main__ - INFO - 분할된 문장 수: 16개
2025-10-20 15:45:27,227 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'A. 에이닷 에서 알람 설정 선물 드려요 ', ' 고객님 안녕하세요 ']...
2025-10-20 15:45:27,242 - __main__ - INFO - 전체 토큰 수: 296개
2025-10-20 15:45:27,242 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '에이닷', '에이닷', '모닝콜', '에이닷', '에이닷', '기프티콘', '앤', '앨리스']
2025-10-20 15:45:27,242 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['기프티콘', '에이닷', '앨리스', '모닝콜']
2025-10-20 15:45:27,242 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 15:45:28,287 - __main__ - INFO - 퍼지 매칭 결과 크기: (2548, 3)
2025-10-20 15:45:28,287 - __main__ - INFO - 퍼지 매칭 성공: 2548개 결과
2025-10-20 15:45:28,288 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.4285714285714286}]
2025-10-20 15:45:28,288 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 15:45:28,372 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2548, 3)
2025-10-20 15:45:28,372 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.21818181818181817}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.34285714285714286}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.2857142857142857}]
2025-10-20 15:45:28,372 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 15:45:28,376 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 2개
2025-10-20 15:45:28,378 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 15:45:28,378 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-10-20 15:45:28,382 - __main__ - INFO - 최종 후보 아이템 리스트: ['라이트 서비스', 'T 서비스']
2025-10-20 15:45:28,384 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (2, 2)
2025-10-20 15:45:28,384 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-20 15:45:28,385 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.83초
2025-10-20 15:45:28,385 - __main__ - INFO - 추출된 후보 엔티티: ['라이트 서비스', 'T 서비스']
2025-10-20 15:45:28,385 - __main__ - INFO - 매칭된 상품 정보: (2, 2)
2025-10-20 15:45:28,385 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 15:45:28,536 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 15:45:28,536 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 15:45:28,536 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 360 문자
2025-10-20 15:45:28,536 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 15:45:28,536 - __main__ - INFO - 후보 아이템 리스트 크기: 2개
2025-10-20 15:45:28,536 - __main__ - INFO - 후보 아이템 리스트: ['라이트 서비스', 'T 서비스']
2025-10-20 15:45:28,536 - __main__ - INFO - extra_item_pdf 크기: (2, 2)
2025-10-20 15:45:28,536 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 15:45:28,536 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-20 15:45:28,536 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 15:45:28,536 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 15:45:28,536 - __main__ - INFO - 구성된 프롬프트 길이: 6463 문자
2025-10-20 15:45:28,537 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 15:45:28,537 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 15:45:28,537 - __main__ - INFO - 📝 프롬프트 길이: 6,463 문자
2025-10-20 15:45:28,537 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 15:45:28,537 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 15:45:35,491 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 15:45:35,515 - __main__ - INFO - LLM 응답 길이: 802 문자
2025-10-20 15:45:35,515 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "A. (에이닷)에서 알람을 설정하면 선물을 드려요!",
    "purpose": [
        "이벤트 응모 유도",
        "경품 제공 안내"
    ],
    "product": [
        {
            "name": "A. (에이닷)",
            "action": "사용"
        },
        {
            "name": "A.알람",
            "action": "사용"
        }
    ],
    "channel": [
        {
            "type": "URL",
            "value": "http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr",
            "action": "추가 정보"
        },
  ...
2025-10-20 15:45:35,515 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 15:45:35,516 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 15:45:35,516 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 15:45:35,516 - __main__ - INFO - 파싱된 JSON 내용: {'title': 'A. (에이닷)에서 알람을 설정하면 선물을 드려요!', 'purpose': ['이벤트 응모 유도', '경품 제공 안내'], 'product': [{'name': 'A. (에이닷)', 'action': '사용'}, {'name': 'A.알람', 'action': '사용'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr', 'action': '추가 정보'}, {'type': '전화번호', 'value': '02-542-4920', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['사용법/혜택/이벤트안내_AI', '사용법/혜택/이벤트안내_SKT']}
2025-10-20 15:45:35,516 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 15:45:35,516 - __main__ - INFO - LLM 추출 엔티티: ['A. (에이닷)', 'A.알람']
2025-10-20 15:45:35,757 - __main__ - ERROR - 결합 유사도 계산 실패: DataFrame.reset_index() got an unexpected keyword argument 'name'
2025-10-20 15:45:35,759 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 15:45:35,759 - __main__ - INFO - ============================================================
2025-10-20 15:45:35,759 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 15:45:35,759 - __main__ - INFO - ============================================================
2025-10-20 15:45:35,759 - __main__ - INFO - 제목: A. (에이닷)에서 알람을 설정하면 선물을 드려요!
2025-10-20 15:45:35,759 - __main__ - INFO - 목적: ['이벤트 응모 유도', '경품 제공 안내']
2025-10-20 15:45:35,759 - __main__ - INFO - 상품 수: 2개
2025-10-20 15:45:35,759 - __main__ - INFO - 채널 수: 3개
2025-10-20 15:45:35,759 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 15:45:35,759 - __main__ - INFO - process_message 실행완료: 9.21초
2025-10-20 15:45:35,759 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 16:08:22,209 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 16:08:22,210 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 16:08:22,210 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 16:08:22,210 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 16:08:22,210 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 16:08:22,211 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 16:08:22,255 - __main__ - INFO - Using device: mps
2025-10-20 16:08:22,255 - __main__ - INFO - _initialize_device 실행완료: 0.04초
2025-10-20 16:08:22,255 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 16:08:22,256 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 16:08:22,256 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 16:08:22,256 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 16:08:22,256 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 16:08:22,256 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 16:08:22,256 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 16:08:22,704 - __main__ - INFO - Model loaded on mps
2025-10-20 16:08:22,704 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.45초
2025-10-20 16:08:22,704 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 16:08:23,299 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 16:08:23,300 - __main__ - INFO - _initialize_kiwi 실행완료: 0.60초
2025-10-20 16:08:23,300 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 16:08:23,300 - __main__ - INFO - ============================================================
2025-10-20 16:08:23,300 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 16:08:23,300 - __main__ - INFO - ============================================================
2025-10-20 16:08:23,300 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 16:08:23,300 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 16:08:23,300 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 16:08:23,300 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 16:08:23,300 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 16:08:23,454 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 16:08:23,454 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 16:08:23,454 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 16:08:23,461 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 16:08:23,462 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 16:08:23,463 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 16:08:23,464 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 16:08:23,464 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 16:08:23,464 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 16:08:23,466 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 16:08:23,470 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 16:08:23,470 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 16:08:23,470 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 16:08:23,471 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 16:08:23,471 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 16:08:23,471 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 16:08:23,471 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 16:08:23,471 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 16:08:23,471 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 16:08:23,471 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 16:08:23,473 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 16:08:23,474 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 16:08:23,474 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 16:08:23,474 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 16:08:23,474 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 16:08:23,697 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 16:08:23,707 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 16:08:23,707 - __main__ - INFO - 별칭 적용 후 샘플: ['우주PASS Netflix 인증', '우주Pass Netflix 인증', '우주패스 넷플릭스 인증', '우주패스 Netflix 인증', '우주pass Netflix 인증']
2025-10-20 16:08:23,707 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 16:08:23,708 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 16:08:23,708 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 16:08:23,709 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 16:08:23,709 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 16:08:23,709 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 16:08:23,709 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 16:08:23,710 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 16:08:23,711 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 16:08:23,711 - __main__ - INFO - 등록할 별칭 샘플: ['우주PASS Netflix 인증', '우주Pass Netflix 인증', '우주패스 넷플릭스 인증', '우주패스 Netflix 인증', '우주pass Netflix 인증']
2025-10-20 16:08:23,731 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 16:08:23,731 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 16:08:23,731 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 16:08:23,733 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 16:08:23,733 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 16:08:24,009 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 16:08:24,009 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 16:08:24,009 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 16:08:24,009 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 16:08:24,009 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 16:08:24,009 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 16:08:24,094 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 16:08:24,094 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 16:08:24,097 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 16:08:24,097 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 16:08:24,097 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 16:08:24,097 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 16:08:24,097 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 16:08:24,098 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 16:08:24,098 - __main__ - INFO - ============================================================
2025-10-20 16:08:24,098 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 16:08:24,098 - __main__ - INFO - ============================================================
2025-10-20 16:08:24,098 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 16:08:24,098 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 16:08:24,098 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 16:08:24,098 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 16:08:24,098 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 16:08:24,099 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 16:08:24,101 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 16:08:24,103 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 16:08:24,104 - __main__ - INFO - _load_data 실행완료: 0.80초
2025-10-20 16:08:24,104 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 16:08:24,104 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 16:08:24,104 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A....
2025-10-20 16:08:24,104 - __main__ - INFO - ============================================================
2025-10-20 16:08:24,104 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 16:08:24,104 - __main__ - INFO - ============================================================
2025-10-20 16:08:24,104 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A. (에이닷)에서 알람을 설정하면 선물을 드려요!__#04 고객님, 안녕하세요.__모닝콜, 영양제 먹기, 애견 산책 등  매일 반복되는 일상을 최애 음악으로 알람 설정 해보세요~!__A.(에이닷)에서 알람을 등록하고 권한 설정하면 선물을 드립니다!__▶ 이벤트 자세히 보...
2025-10-20 16:08:24,104 - __main__ - INFO - 메시지 길이: 685 문자
2025-10-20 16:08:24,104 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 16:08:24,104 - __main__ - INFO - 데이터 소스: local
2025-10-20 16:08:24,104 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 16:08:24,104 - __main__ - INFO - 엔티티 추출 모드: logic
2025-10-20 16:08:24,104 - __main__ - INFO - LLM 모델: ax
2025-10-20 16:08:24,104 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 16:08:24,104 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 16:08:24,104 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 16:08:24,104 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 16:08:24,104 - __main__ - INFO - 처리할 메시지 길이: 683 문자
2025-10-20 16:08:24,105 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 16:08:24,793 - __main__ - INFO - 분할된 문장 수: 16개
2025-10-20 16:08:24,794 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'A. 에이닷 에서 알람 설정 선물 드려요 ', ' 고객님 안녕하세요 ']...
2025-10-20 16:08:24,809 - __main__ - INFO - 전체 토큰 수: 296개
2025-10-20 16:08:24,809 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '에이닷', '에이닷', '모닝콜', '에이닷', '에이닷', '기프티콘', '앤', '앨리스']
2025-10-20 16:08:24,809 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['기프티콘', '모닝콜', '앨리스', '에이닷']
2025-10-20 16:08:24,809 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 16:08:25,892 - __main__ - INFO - 퍼지 매칭 결과 크기: (2548, 3)
2025-10-20 16:08:25,892 - __main__ - INFO - 퍼지 매칭 성공: 2548개 결과
2025-10-20 16:08:25,893 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.4285714285714286}]
2025-10-20 16:08:25,893 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 16:08:25,968 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2548, 3)
2025-10-20 16:08:25,969 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.21818181818181817}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.34285714285714286}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.2857142857142857}]
2025-10-20 16:08:25,969 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 16:08:25,972 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 2개
2025-10-20 16:08:25,974 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 16:08:25,975 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-10-20 16:08:25,978 - __main__ - INFO - 최종 후보 아이템 리스트: ['라이트 서비스', 'T 서비스']
2025-10-20 16:08:25,981 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (2, 2)
2025-10-20 16:08:25,981 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-20 16:08:25,981 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.88초
2025-10-20 16:08:25,981 - __main__ - INFO - 추출된 후보 엔티티: ['라이트 서비스', 'T 서비스']
2025-10-20 16:08:25,981 - __main__ - INFO - 매칭된 상품 정보: (2, 2)
2025-10-20 16:08:25,982 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 16:08:26,149 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 16:08:26,149 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 16:08:26,150 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 360 문자
2025-10-20 16:08:26,150 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 16:08:26,150 - __main__ - INFO - 후보 아이템 리스트 크기: 2개
2025-10-20 16:08:26,150 - __main__ - INFO - 후보 아이템 리스트: ['라이트 서비스', 'T 서비스']
2025-10-20 16:08:26,150 - __main__ - INFO - extra_item_pdf 크기: (2, 2)
2025-10-20 16:08:26,150 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 16:08:26,150 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-20 16:08:26,150 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 16:08:26,150 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 16:08:26,150 - __main__ - INFO - 구성된 프롬프트 길이: 6463 문자
2025-10-20 16:08:26,150 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 16:08:26,150 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 16:08:26,150 - __main__ - INFO - 📝 프롬프트 길이: 6,463 문자
2025-10-20 16:08:26,150 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 16:08:26,150 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 16:08:32,369 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 16:08:32,386 - __main__ - INFO - LLM 응답 길이: 802 문자
2025-10-20 16:08:32,386 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "A. (에이닷)에서 알람을 설정하면 선물을 드려요!",
    "purpose": [
        "이벤트 응모 유도",
        "경품 제공 안내"
    ],
    "product": [
        {
            "name": "A. (에이닷)",
            "action": "사용"
        },
        {
            "name": "A.알람",
            "action": "사용"
        }
    ],
    "channel": [
        {
            "type": "URL",
            "value": "http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr",
            "action": "추가 정보"
        },
  ...
2025-10-20 16:08:32,386 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 16:08:32,387 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 16:08:32,387 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 16:08:32,387 - __main__ - INFO - 파싱된 JSON 내용: {'title': 'A. (에이닷)에서 알람을 설정하면 선물을 드려요!', 'purpose': ['이벤트 응모 유도', '경품 제공 안내'], 'product': [{'name': 'A. (에이닷)', 'action': '사용'}, {'name': 'A.알람', 'action': '사용'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr', 'action': '추가 정보'}, {'type': '전화번호', 'value': '02-542-4920', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['사용법/혜택/이벤트안내_AI', '사용법/혜택/이벤트안내_SKT']}
2025-10-20 16:08:32,387 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 16:08:32,387 - __main__ - INFO - LLM 추출 엔티티: ['A. (에이닷)', 'A.알람']
2025-10-20 16:08:32,756 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 16:08:32,756 - __main__ - INFO - ============================================================
2025-10-20 16:08:32,756 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 16:08:32,756 - __main__ - INFO - ============================================================
2025-10-20 16:08:32,756 - __main__ - INFO - 제목: A. (에이닷)에서 알람을 설정하면 선물을 드려요!
2025-10-20 16:08:32,756 - __main__ - INFO - 목적: ['이벤트 응모 유도', '경품 제공 안내']
2025-10-20 16:08:32,756 - __main__ - INFO - 상품 수: 2개
2025-10-20 16:08:32,756 - __main__ - INFO - 채널 수: 3개
2025-10-20 16:08:32,756 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 16:08:32,757 - __main__ - INFO - process_message 실행완료: 8.65초
2025-10-20 16:08:32,757 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 16:08:50,467 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 16:08:50,468 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 16:08:50,468 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 16:08:50,468 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 16:08:50,468 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 16:08:50,469 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 16:08:50,501 - __main__ - INFO - Using device: mps
2025-10-20 16:08:50,501 - __main__ - INFO - _initialize_device 실행완료: 0.03초
2025-10-20 16:08:50,501 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 16:08:50,501 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 16:08:50,501 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 16:08:50,501 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 16:08:50,501 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 16:08:50,502 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 16:08:50,502 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 16:08:50,781 - __main__ - INFO - Model loaded on mps
2025-10-20 16:08:50,781 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.28초
2025-10-20 16:08:50,781 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 16:08:51,354 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 16:08:51,354 - __main__ - INFO - _initialize_kiwi 실행완료: 0.57초
2025-10-20 16:08:51,354 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 16:08:51,354 - __main__ - INFO - ============================================================
2025-10-20 16:08:51,354 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 16:08:51,354 - __main__ - INFO - ============================================================
2025-10-20 16:08:51,355 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 16:08:51,355 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 16:08:51,355 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 16:08:51,355 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 16:08:51,355 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 16:08:51,517 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 16:08:51,517 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 16:08:51,517 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 16:08:51,525 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 16:08:51,526 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 16:08:51,527 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 16:08:51,527 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 16:08:51,528 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 16:08:51,528 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 16:08:51,529 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 16:08:51,533 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 16:08:51,533 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 16:08:51,533 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 16:08:51,533 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 16:08:51,533 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 16:08:51,534 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 16:08:51,534 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 16:08:51,534 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 16:08:51,534 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 16:08:51,534 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 16:08:51,535 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 16:08:51,535 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 16:08:51,535 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 16:08:51,536 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 16:08:51,536 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 16:08:51,769 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 16:08:51,782 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 16:08:51,783 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 넷플릭스 인증', '우주패스 Netflix 인증', '우주Pass Netflix 인증', '우주pass Netflix 인증', '우주PASS Netflix 인증']
2025-10-20 16:08:51,783 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 16:08:51,783 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 16:08:51,783 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 16:08:51,784 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 16:08:51,784 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 16:08:51,785 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 16:08:51,785 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 16:08:51,786 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 16:08:51,787 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 16:08:51,788 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 넷플릭스 인증', '우주패스 Netflix 인증', '우주Pass Netflix 인증', '우주pass Netflix 인증', '우주PASS Netflix 인증']
2025-10-20 16:08:51,810 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 16:08:51,811 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 16:08:51,811 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 16:08:51,812 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 16:08:51,812 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 16:08:52,083 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 16:08:52,083 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 16:08:52,083 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 16:08:52,083 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 16:08:52,083 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 16:08:52,083 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 16:08:52,174 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 16:08:52,174 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 16:08:52,177 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 16:08:52,177 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 16:08:52,177 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 16:08:52,177 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 16:08:52,178 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 16:08:52,178 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 16:08:52,178 - __main__ - INFO - ============================================================
2025-10-20 16:08:52,178 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 16:08:52,178 - __main__ - INFO - ============================================================
2025-10-20 16:08:52,178 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 16:08:52,178 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 16:08:52,178 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 16:08:52,178 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 16:08:52,178 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 16:08:52,180 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 16:08:52,182 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 16:08:52,184 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 16:08:52,184 - __main__ - INFO - _load_data 실행완료: 0.83초
2025-10-20 16:08:52,184 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 16:08:52,184 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 16:08:52,184 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A....
2025-10-20 16:08:52,184 - __main__ - INFO - ============================================================
2025-10-20 16:08:52,184 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 16:08:52,184 - __main__ - INFO - ============================================================
2025-10-20 16:08:52,184 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A. (에이닷)에서 알람을 설정하면 선물을 드려요!__#04 고객님, 안녕하세요.__모닝콜, 영양제 먹기, 애견 산책 등  매일 반복되는 일상을 최애 음악으로 알람 설정 해보세요~!__A.(에이닷)에서 알람을 등록하고 권한 설정하면 선물을 드립니다!__▶ 이벤트 자세히 보...
2025-10-20 16:08:52,184 - __main__ - INFO - 메시지 길이: 685 문자
2025-10-20 16:08:52,184 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 16:08:52,184 - __main__ - INFO - 데이터 소스: local
2025-10-20 16:08:52,184 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 16:08:52,184 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-20 16:08:52,184 - __main__ - INFO - LLM 모델: ax
2025-10-20 16:08:52,184 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 16:08:52,184 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 16:08:52,184 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 16:08:52,185 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 16:08:52,185 - __main__ - INFO - 처리할 메시지 길이: 683 문자
2025-10-20 16:08:52,186 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 16:08:52,853 - __main__ - INFO - 분할된 문장 수: 16개
2025-10-20 16:08:52,854 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'A. 에이닷 에서 알람 설정 선물 드려요 ', ' 고객님 안녕하세요 ']...
2025-10-20 16:08:52,870 - __main__ - INFO - 전체 토큰 수: 296개
2025-10-20 16:08:52,870 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '에이닷', '에이닷', '모닝콜', '에이닷', '에이닷', '기프티콘', '앤', '앨리스']
2025-10-20 16:08:52,870 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['모닝콜', '에이닷', '앨리스', '기프티콘']
2025-10-20 16:08:52,870 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 16:08:53,905 - __main__ - INFO - 퍼지 매칭 결과 크기: (2548, 3)
2025-10-20 16:08:53,905 - __main__ - INFO - 퍼지 매칭 성공: 2548개 결과
2025-10-20 16:08:53,906 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.4285714285714286}]
2025-10-20 16:08:53,906 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 16:08:53,978 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2548, 3)
2025-10-20 16:08:53,979 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.21818181818181817}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.34285714285714286}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.2857142857142857}]
2025-10-20 16:08:53,979 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 16:08:53,982 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 2개
2025-10-20 16:08:53,984 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 16:08:53,985 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-10-20 16:08:53,989 - __main__ - INFO - 최종 후보 아이템 리스트: ['라이트 서비스', 'T 서비스']
2025-10-20 16:08:53,991 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (2, 2)
2025-10-20 16:08:53,992 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-20 16:08:53,992 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.81초
2025-10-20 16:08:53,992 - __main__ - INFO - 추출된 후보 엔티티: ['라이트 서비스', 'T 서비스']
2025-10-20 16:08:53,992 - __main__ - INFO - 매칭된 상품 정보: (2, 2)
2025-10-20 16:08:53,992 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 16:08:54,153 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 16:08:54,153 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 16:08:54,153 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 360 문자
2025-10-20 16:08:54,153 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 16:08:54,153 - __main__ - INFO - 후보 아이템 리스트 크기: 2개
2025-10-20 16:08:54,153 - __main__ - INFO - 후보 아이템 리스트: ['라이트 서비스', 'T 서비스']
2025-10-20 16:08:54,153 - __main__ - INFO - extra_item_pdf 크기: (2, 2)
2025-10-20 16:08:54,153 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 16:08:54,153 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-20 16:08:54,153 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 16:08:54,154 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 16:08:54,154 - __main__ - INFO - 구성된 프롬프트 길이: 6463 문자
2025-10-20 16:08:54,154 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 16:08:54,154 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 16:08:54,154 - __main__ - INFO - 📝 프롬프트 길이: 6,463 문자
2025-10-20 16:08:54,154 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 16:08:54,154 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 16:09:00,379 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 16:09:00,399 - __main__ - INFO - LLM 응답 길이: 802 문자
2025-10-20 16:09:00,399 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "A. (에이닷)에서 알람을 설정하면 선물을 드려요!",
    "purpose": [
        "이벤트 응모 유도",
        "경품 제공 안내"
    ],
    "product": [
        {
            "name": "A. (에이닷)",
            "action": "사용"
        },
        {
            "name": "A.알람",
            "action": "사용"
        }
    ],
    "channel": [
        {
            "type": "URL",
            "value": "http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr",
            "action": "추가 정보"
        },
  ...
2025-10-20 16:09:00,400 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 16:09:00,400 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 16:09:00,400 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 16:09:00,400 - __main__ - INFO - 파싱된 JSON 내용: {'title': 'A. (에이닷)에서 알람을 설정하면 선물을 드려요!', 'purpose': ['이벤트 응모 유도', '경품 제공 안내'], 'product': [{'name': 'A. (에이닷)', 'action': '사용'}, {'name': 'A.알람', 'action': '사용'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr', 'action': '추가 정보'}, {'type': '전화번호', 'value': '02-542-4920', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['사용법/혜택/이벤트안내_AI', '사용법/혜택/이벤트안내_SKT']}
2025-10-20 16:09:00,400 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 16:09:00,401 - __main__ - INFO - LLM 추출 엔티티: ['A. (에이닷)', 'A.알람']
2025-10-20 16:09:00,402 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-10-20 16:09:00,402 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-10-20 16:09:00,403 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 3,100 문자
2025-10-20 16:09:00,403 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-10-20 16:09:00,403 - __main__ - INFO - 📝 프롬프트 길이: 3,100 문자
2025-10-20 16:09:00,403 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-10-20 16:09:00,403 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-10-20 16:09:00,403 - __main__ - INFO - 🔄 2개 LLM 모델로 엔티티 추출 시작
2025-10-20 16:09:00,427 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-20 16:09:00,427 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-20 16:09:00,427 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-20 16:09:00,427 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-20 16:09:00,427 - __main__ - INFO - 🔍 메시지 길이: 683 문자
2025-10-20 16:09:00,427 - __main__ - INFO - 🔍 메시지 길이: 683 문자
2025-10-20 16:09:01,163 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 16:09:02,702 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 16:09:02,717 - __main__ - INFO - ✅ LLM 추출 완료: ['A. 알람 챌린지', 'A. (에이닷)', 'CU 빙그레 바나나우유 기프티콘', 'A.알람', 'A.']
2025-10-20 16:09:03,276 - __main__ - INFO - extract_entities_by_llm 실행완료: 2.87초
2025-10-20 16:09:03,278 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 16:09:03,278 - __main__ - INFO - ============================================================
2025-10-20 16:09:03,278 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 16:09:03,278 - __main__ - INFO - ============================================================
2025-10-20 16:09:03,278 - __main__ - INFO - 제목: A. (에이닷)에서 알람을 설정하면 선물을 드려요!
2025-10-20 16:09:03,278 - __main__ - INFO - 목적: ['이벤트 응모 유도', '경품 제공 안내']
2025-10-20 16:09:03,278 - __main__ - INFO - 상품 수: 2개
2025-10-20 16:09:03,278 - __main__ - INFO - 채널 수: 3개
2025-10-20 16:09:03,278 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 16:09:03,279 - __main__ - INFO - process_message 실행완료: 11.09초
2025-10-20 16:09:03,279 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 16:09:59,664 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 16:09:59,665 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 16:09:59,665 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 16:09:59,665 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 16:09:59,665 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 16:09:59,666 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 16:09:59,716 - __main__ - INFO - Using device: mps
2025-10-20 16:09:59,716 - __main__ - INFO - _initialize_device 실행완료: 0.05초
2025-10-20 16:09:59,716 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 16:09:59,716 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 16:09:59,716 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 16:09:59,716 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 16:09:59,716 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 16:09:59,717 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 16:09:59,717 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 16:09:59,984 - __main__ - INFO - Model loaded on mps
2025-10-20 16:09:59,984 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.27초
2025-10-20 16:09:59,984 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 16:10:00,563 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 16:10:00,563 - __main__ - INFO - _initialize_kiwi 실행완료: 0.58초
2025-10-20 16:10:00,563 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 16:10:00,564 - __main__ - INFO - ============================================================
2025-10-20 16:10:00,564 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 16:10:00,564 - __main__ - INFO - ============================================================
2025-10-20 16:10:00,564 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 16:10:00,564 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 16:10:00,564 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 16:10:00,564 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 16:10:00,564 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 16:10:00,717 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 16:10:00,717 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 16:10:00,717 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 16:10:00,725 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 16:10:00,726 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 16:10:00,726 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 16:10:00,727 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 16:10:00,727 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 16:10:00,727 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 16:10:00,729 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 16:10:00,733 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 16:10:00,733 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 16:10:00,733 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 16:10:00,733 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 16:10:00,733 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 16:10:00,734 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 16:10:00,734 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 16:10:00,734 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 16:10:00,734 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 16:10:00,734 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 16:10:00,736 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 16:10:00,736 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 16:10:00,736 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 16:10:00,736 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 16:10:00,737 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 16:10:00,959 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 16:10:00,969 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 16:10:00,970 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 넷플릭스 인증', '우주패스 Netflix 인증', '우주pass Netflix 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증']
2025-10-20 16:10:00,970 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 16:10:00,970 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 16:10:00,970 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 16:10:00,971 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 16:10:00,971 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 16:10:00,972 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 16:10:00,972 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 16:10:00,973 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 16:10:00,974 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 16:10:00,974 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 넷플릭스 인증', '우주패스 Netflix 인증', '우주pass Netflix 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증']
2025-10-20 16:10:00,994 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 16:10:00,994 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 16:10:00,994 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 16:10:00,995 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 16:10:00,995 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 16:10:01,242 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 16:10:01,243 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 16:10:01,243 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 16:10:01,243 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 16:10:01,243 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 16:10:01,243 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 16:10:01,329 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 16:10:01,329 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 16:10:01,332 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 16:10:01,332 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 16:10:01,332 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 16:10:01,332 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 16:10:01,332 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 16:10:01,333 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 16:10:01,333 - __main__ - INFO - ============================================================
2025-10-20 16:10:01,333 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 16:10:01,333 - __main__ - INFO - ============================================================
2025-10-20 16:10:01,333 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 16:10:01,333 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 16:10:01,333 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 16:10:01,333 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 16:10:01,333 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 16:10:01,334 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 16:10:01,336 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 16:10:01,338 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 16:10:01,339 - __main__ - INFO - _load_data 실행완료: 0.77초
2025-10-20 16:10:01,339 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 16:10:01,339 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-20 16:10:01,339 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A....
2025-10-20 16:10:01,339 - __main__ - INFO - ============================================================
2025-10-20 16:10:01,339 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 16:10:01,339 - __main__ - INFO - ============================================================
2025-10-20 16:10:01,339 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A. (에이닷)에서 알람을 설정하면 선물을 드려요!__#04 고객님, 안녕하세요.__모닝콜, 영양제 먹기, 애견 산책 등  매일 반복되는 일상을 최애 음악으로 알람 설정 해보세요~!__A.(에이닷)에서 알람을 등록하고 권한 설정하면 선물을 드립니다!__▶ 이벤트 자세히 보...
2025-10-20 16:10:01,339 - __main__ - INFO - 메시지 길이: 685 문자
2025-10-20 16:10:01,339 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 16:10:01,339 - __main__ - INFO - 데이터 소스: local
2025-10-20 16:10:01,339 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 16:10:01,339 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-20 16:10:01,339 - __main__ - INFO - LLM 모델: ax
2025-10-20 16:10:01,339 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 16:10:01,339 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 16:10:01,339 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 16:10:01,339 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 16:10:01,339 - __main__ - INFO - 처리할 메시지 길이: 683 문자
2025-10-20 16:10:01,340 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 16:10:02,017 - __main__ - INFO - 분할된 문장 수: 16개
2025-10-20 16:10:02,018 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'A. 에이닷 에서 알람 설정 선물 드려요 ', ' 고객님 안녕하세요 ']...
2025-10-20 16:10:02,033 - __main__ - INFO - 전체 토큰 수: 296개
2025-10-20 16:10:02,034 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '에이닷', '에이닷', '모닝콜', '에이닷', '에이닷', '기프티콘', '앤', '앨리스']
2025-10-20 16:10:02,034 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['앨리스', '모닝콜', '에이닷', '기프티콘']
2025-10-20 16:10:02,034 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 16:10:03,045 - __main__ - INFO - 퍼지 매칭 결과 크기: (2548, 3)
2025-10-20 16:10:03,045 - __main__ - INFO - 퍼지 매칭 성공: 2548개 결과
2025-10-20 16:10:03,046 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.4285714285714286}]
2025-10-20 16:10:03,046 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 16:10:03,121 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2548, 3)
2025-10-20 16:10:03,122 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.21818181818181817}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.34285714285714286}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.2857142857142857}]
2025-10-20 16:10:03,122 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 16:10:03,125 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 2개
2025-10-20 16:10:03,127 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 16:10:03,128 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-10-20 16:10:03,131 - __main__ - INFO - 최종 후보 아이템 리스트: ['라이트 서비스', 'T 서비스']
2025-10-20 16:10:03,133 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (2, 2)
2025-10-20 16:10:03,134 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-20 16:10:03,134 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.79초
2025-10-20 16:10:03,134 - __main__ - INFO - 추출된 후보 엔티티: ['라이트 서비스', 'T 서비스']
2025-10-20 16:10:03,134 - __main__ - INFO - 매칭된 상품 정보: (2, 2)
2025-10-20 16:10:03,134 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 16:10:03,285 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 16:10:03,285 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 16:10:03,285 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 360 문자
2025-10-20 16:10:03,286 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 16:10:03,286 - __main__ - INFO - 후보 아이템 리스트 크기: 2개
2025-10-20 16:10:03,286 - __main__ - INFO - 후보 아이템 리스트: ['라이트 서비스', 'T 서비스']
2025-10-20 16:10:03,286 - __main__ - INFO - extra_item_pdf 크기: (2, 2)
2025-10-20 16:10:03,286 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 16:10:03,286 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-20 16:10:03,286 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 16:10:03,286 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 16:10:03,286 - __main__ - INFO - 구성된 프롬프트 길이: 6463 문자
2025-10-20 16:10:03,286 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 16:10:03,286 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 16:10:03,286 - __main__ - INFO - 📝 프롬프트 길이: 6,463 문자
2025-10-20 16:10:03,286 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 16:10:03,286 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 16:10:09,566 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 16:10:09,590 - __main__ - INFO - LLM 응답 길이: 802 문자
2025-10-20 16:10:09,591 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "A. (에이닷)에서 알람을 설정하면 선물을 드려요!",
    "purpose": [
        "이벤트 응모 유도",
        "경품 제공 안내"
    ],
    "product": [
        {
            "name": "A. (에이닷)",
            "action": "사용"
        },
        {
            "name": "A.알람",
            "action": "사용"
        }
    ],
    "channel": [
        {
            "type": "URL",
            "value": "http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr",
            "action": "추가 정보"
        },
  ...
2025-10-20 16:10:09,591 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 16:10:09,591 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 16:10:09,592 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 16:10:09,592 - __main__ - INFO - 파싱된 JSON 내용: {'title': 'A. (에이닷)에서 알람을 설정하면 선물을 드려요!', 'purpose': ['이벤트 응모 유도', '경품 제공 안내'], 'product': [{'name': 'A. (에이닷)', 'action': '사용'}, {'name': 'A.알람', 'action': '사용'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr', 'action': '추가 정보'}, {'type': '전화번호', 'value': '02-542-4920', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['사용법/혜택/이벤트안내_AI', '사용법/혜택/이벤트안내_SKT']}
2025-10-20 16:10:09,592 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 16:10:09,592 - __main__ - INFO - LLM 추출 엔티티: ['A. (에이닷)', 'A.알람']
2025-10-20 16:10:09,593 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-10-20 16:10:09,593 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 3,100 문자
2025-10-20 16:10:09,593 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-10-20 16:10:09,593 - __main__ - INFO - 📝 프롬프트 길이: 3,100 문자
2025-10-20 16:10:09,593 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-10-20 16:10:09,593 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-10-20 16:10:09,593 - __main__ - INFO - 🔄 1개 LLM 모델로 엔티티 추출 시작
2025-10-20 16:10:09,594 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-20 16:10:09,594 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-20 16:10:09,594 - __main__ - INFO - 🔍 메시지 길이: 683 문자
2025-10-20 16:10:11,784 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 16:10:11,786 - __main__ - INFO - ✅ LLM 추출 완료: ['A.', '에이닷', 'A. 알람 챌린지', 'A.알람']
2025-10-20 16:10:12,324 - __main__ - INFO - extract_entities_by_llm 실행완료: 2.73초
2025-10-20 16:10:12,329 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 16:10:12,329 - __main__ - INFO - ============================================================
2025-10-20 16:10:12,329 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 16:10:12,329 - __main__ - INFO - ============================================================
2025-10-20 16:10:12,329 - __main__ - INFO - 제목: A. (에이닷)에서 알람을 설정하면 선물을 드려요!
2025-10-20 16:10:12,330 - __main__ - INFO - 목적: ['이벤트 응모 유도', '경품 제공 안내']
2025-10-20 16:10:12,330 - __main__ - INFO - 상품 수: 1개
2025-10-20 16:10:12,330 - __main__ - INFO - 채널 수: 3개
2025-10-20 16:10:12,330 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 16:10:12,330 - __main__ - INFO - process_message 실행완료: 10.99초
2025-10-20 16:10:12,330 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 16:13:26,583 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-20 16:13:26,584 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-20 16:13:26,584 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-20 16:13:26,584 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-20 16:13:26,584 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-20 16:13:26,585 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-20 16:13:26,615 - __main__ - INFO - Using device: mps
2025-10-20 16:13:26,616 - __main__ - INFO - _initialize_device 실행완료: 0.03초
2025-10-20 16:13:26,616 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-20 16:13:26,616 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-20 16:13:26,616 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-10-20 16:13:26,616 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-20 16:13:26,616 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-20 16:13:26,616 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-20 16:13:26,616 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-20 16:13:26,902 - __main__ - INFO - Model loaded on mps
2025-10-20 16:13:26,902 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.29초
2025-10-20 16:13:26,902 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-20 16:13:27,522 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-20 16:13:27,522 - __main__ - INFO - _initialize_kiwi 실행완료: 0.62초
2025-10-20 16:13:27,522 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-20 16:13:27,522 - __main__ - INFO - ============================================================
2025-10-20 16:13:27,522 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-20 16:13:27,522 - __main__ - INFO - ============================================================
2025-10-20 16:13:27,522 - __main__ - INFO - 데이터 소스 모드: local
2025-10-20 16:13:27,522 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-20 16:13:27,522 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-20 16:13:27,522 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-20 16:13:27,522 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 16:13:27,679 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-20 16:13:27,679 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 16:13:27,679 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-20 16:13:27,686 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-20 16:13:27,687 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-20 16:13:27,688 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 16:13:27,689 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 16:13:27,689 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-20 16:13:27,689 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-20 16:13:27,691 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-20 16:13:27,695 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-20 16:13:27,695 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-20 16:13:27,695 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 16:13:27,695 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-20 16:13:27,695 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-20 16:13:27,696 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-20 16:13:27,696 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 16:13:27,696 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-20 16:13:27,696 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-20 16:13:27,696 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-20 16:13:27,697 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-10-20 16:13:27,697 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-20 16:13:27,698 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 16:13:27,698 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-20 16:13:27,698 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-20 16:13:27,924 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-20 16:13:27,935 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-10-20 16:13:27,936 - __main__ - INFO - 별칭 적용 후 샘플: ['우주Pass Netflix 인증', '우주pass Netflix 인증', '우주패스 Netflix 인증', '우주패스 넷플릭스 인증', '우주PASS Netflix 인증']
2025-10-20 16:13:27,936 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-10-20 16:13:27,936 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-10-20 16:13:27,936 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-20 16:13:27,937 - __main__ - INFO - 정지어 로드 완료: 166개
2025-10-20 16:13:27,937 - __main__ - INFO - 로드된 정지어 수: 166개
2025-10-20 16:13:27,937 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-20 16:13:27,937 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-20 16:13:27,938 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-10-20 16:13:27,939 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-10-20 16:13:27,939 - __main__ - INFO - 등록할 별칭 샘플: ['우주Pass Netflix 인증', '우주pass Netflix 인증', '우주패스 Netflix 인증', '우주패스 넷플릭스 인증', '우주PASS Netflix 인증']
2025-10-20 16:13:27,960 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-10-20 16:13:27,960 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-20 16:13:27,960 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-20 16:13:27,962 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-20 16:13:27,962 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-20 16:13:28,219 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-20 16:13:28,219 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-20 16:13:28,219 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-20 16:13:28,219 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-20 16:13:28,219 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-20 16:13:28,219 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-20 16:13:28,303 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-20 16:13:28,303 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-20 16:13:28,305 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-20 16:13:28,306 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-20 16:13:28,306 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-20 16:13:28,306 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-20 16:13:28,306 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-20 16:13:28,307 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-20 16:13:28,307 - __main__ - INFO - ============================================================
2025-10-20 16:13:28,307 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-20 16:13:28,307 - __main__ - INFO - ============================================================
2025-10-20 16:13:28,307 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-10-20 16:13:28,307 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-20 16:13:28,307 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-20 16:13:28,307 - __main__ - INFO - ✅ 정지어: 166개
2025-10-20 16:13:28,307 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-20 16:13:28,308 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-20 16:13:28,310 - __main__ - INFO - 고유 별칭 수: 16948개
2025-10-20 16:13:28,312 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-20 16:13:28,312 - __main__ - INFO - _load_data 실행완료: 0.79초
2025-10-20 16:13:28,312 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-20 16:13:28,312 - __main__ - INFO - 배치 파일에서 메시지 로드: reg_test.txt
2025-10-20 16:13:28,313 - __main__ - INFO - 로드된 메시지 수: 2개
2025-10-20 16:13:28,313 - __main__ - INFO - 배치 처리 시작: 2개 메시지, 2개 워커
2025-10-20 16:13:28,313 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: [SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!\n(광고)[SKT] A....
2025-10-20 16:13:28,313 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: [SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내\n(광고)[SKT] 아...
2025-10-20 16:13:28,313 - __main__ - INFO - ============================================================
2025-10-20 16:13:28,313 - __main__ - INFO - ============================================================
2025-10-20 16:13:28,313 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 16:13:28,313 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-20 16:13:28,313 - __main__ - INFO - ============================================================
2025-10-20 16:13:28,313 - __main__ - INFO - ============================================================
2025-10-20 16:13:28,313 - __main__ - INFO - 메시지 내용: [SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!\n(광고)[SKT] A. (에이닷)에서 알람을 설정하면 선물을 드려요!__#04 고객님, 안녕하세요.__모닝콜, 영양제 먹기, 애견 산책 등  매일 반복되는 일상을 최애 음악으로 알람 설정 해보세요~!__A.(에이닷)에서 알람을 등록하고 권한 설정하면 선물을 드립니다!__▶ 이벤트 자세히 보...
2025-10-20 16:13:28,314 - __main__ - INFO - 메시지 내용: [SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내\n(광고)[SKT] 아이폰 17/17 Pro 사전예약 안내  #04 고객님, 안녕하세요. 최고의 스마트폰 칩과 카메라, 견고한 세라믹 실드에 5G 기술까지! 이 모든 것을 갖춘 아이폰 17/17 Pro를 만나 보세요.  ▶ 혜택받고 사전예약하기: http://t-mms.kr/t.do?m=#...
2025-10-20 16:13:28,314 - __main__ - INFO - 메시지 길이: 685 문자
2025-10-20 16:13:28,314 - __main__ - INFO - 메시지 길이: 816 문자
2025-10-20 16:13:28,314 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 16:13:28,314 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-20 16:13:28,314 - __main__ - INFO - 데이터 소스: local
2025-10-20 16:13:28,314 - __main__ - INFO - 데이터 소스: local
2025-10-20 16:13:28,314 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 16:13:28,314 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-20 16:13:28,314 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-20 16:13:28,314 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-20 16:13:28,314 - __main__ - INFO - LLM 모델: ax
2025-10-20 16:13:28,314 - __main__ - INFO - LLM 모델: ax
2025-10-20 16:13:28,314 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 16:13:28,314 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-10-20 16:13:28,314 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 16:13:28,314 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-20 16:13:28,314 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 16:13:28,314 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-20 16:13:28,314 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 16:13:28,315 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-20 16:13:28,315 - __main__ - INFO - 처리할 메시지 길이: 685 문자
2025-10-20 16:13:28,315 - __main__ - INFO - 처리할 메시지 길이: 816 문자
2025-10-20 16:13:28,316 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 16:13:28,318 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-10-20 16:13:28,988 - __main__ - INFO - 분할된 문장 수: 15개
2025-10-20 16:13:28,999 - __main__ - INFO - 분할된 문장 수: 9개
2025-10-20 16:13:29,000 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 n 광고 SKT A. 에이닷 에서 알람 설정 선물 드려요 ', ' 고객님 안녕하세요 ', '모닝콜 영양제 애견 산책 등 매일 반복되는 일상 최애 음악으로 알람 설정 보세요 ']...
2025-10-20 16:13:29,001 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 반가워요', '5G 아이폰 Pro 사전예약 안내 n 광고 SKT 아이폰 Pro 사전예약 안내 고객님 안녕하세요 ', '최고의 스마트폰 칩과 카메라 견고 세라믹 실드에 5G 기술까지 ']...
2025-10-20 16:13:29,015 - __main__ - INFO - 전체 토큰 수: 299개
2025-10-20 16:13:29,024 - __main__ - INFO - 전체 토큰 수: 312개
2025-10-20 16:13:29,024 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '에이닷', '에이닷', '모닝콜', '에이닷', '에이닷', '기프티콘', '앤', '앨리스']
2025-10-20 16:13:29,025 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '아이폰', '아이폰', '실드', '아이폰', '아이폰', '스펙', '아이폰', '스마트폰', '택1', '사죠영', '죠르디', '한정판', '기프트', '프리디', '충전기', '에이프릴', '스톤', '충전', '기프트', '.', '카카오톡', '코로나']
2025-10-20 16:13:29,025 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['앨리스', '모닝콜', '에이닷', '기프티콘']
2025-10-20 16:13:29,025 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['택1', '아이폰', '충전기', '코로나', '사죠영', '죠르디', '한정판', '기프트', '프리디', '스톤', '에이프릴', '실드', '스펙', '카카오톡']
2025-10-20 16:13:29,025 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 16:13:29,025 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-20 16:13:30,485 - __main__ - INFO - 퍼지 매칭 결과 크기: (2117, 3)
2025-10-20 16:13:30,486 - __main__ - INFO - 퍼지 매칭 성공: 2117개 결과
2025-10-20 16:13:30,487 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.4285714285714286}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.4}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.4}]
2025-10-20 16:13:30,488 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 16:13:30,529 - __main__ - INFO - 퍼지 매칭 결과 크기: (2392, 3)
2025-10-20 16:13:30,532 - __main__ - INFO - 퍼지 매칭 성공: 2392개 결과
2025-10-20 16:13:30,534 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 n 광고 SKT A. 에이닷 에서 알람 설정 선물 드려요 ', 'item_nm_alias': 'data세이프', 'sim': 0.4285714285714286}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 n 광고 SKT A. 에이닷 에서 알람 설정 선물 드려요 ', 'item_nm_alias': 'Data세이프', 'sim': 0.4285714285714286}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 n 광고 SKT A. 에이닷 에서 알람 설정 선물 드려요 ', 'item_nm_alias': 'P Biz Data', 'sim': 0.4}]
2025-10-20 16:13:30,536 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-20 16:13:30,659 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2117, 3)
2025-10-20 16:13:30,659 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 반가워요', 'item_nm_alias': '국제전화사업자(온세텔레콤)', 'sim': 0.18461538461538463}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 5기가', 'sim': 0.15000000000000002}, {'sent': ' SK텔레콤 반가워요', 'item_nm_alias': 'T로밍 LongPass 2기가', 'sim': 0.15000000000000002}]
2025-10-20 16:13:30,659 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 16:13:30,662 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 11개
2025-10-20 16:13:30,664 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 16:13:30,665 - __main__ - INFO - 통합된 후보 아이템 수: 11개
2025-10-20 16:13:30,669 - __main__ - INFO - 최종 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 16:13:30,672 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (10, 2)
2025-10-20 16:13:30,672 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}, {'item_nm': 'IPHONE 16 PRO', 'item_id': ['A5XE', 'A643', 'A5XN', 'A64C', 'A647', 'A63Y', 'A5XJ', 'A5X9']}]
2025-10-20 16:13:30,673 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 2.36초
2025-10-20 16:13:30,673 - __main__ - INFO - 추출된 후보 엔티티: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 16:13:30,673 - __main__ - INFO - 매칭된 상품 정보: (10, 2)
2025-10-20 16:13:30,673 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 16:13:30,686 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2392, 3)
2025-10-20 16:13:30,687 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 n 광고 SKT A. 에이닷 에서 알람 설정 선물 드려요 ', 'item_nm_alias': 'data세이프', 'sim': 0.34285714285714286}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 n 광고 SKT A. 에이닷 에서 알람 설정 선물 드려요 ', 'item_nm_alias': 'Data세이프', 'sim': 0.34285714285714286}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 n 광고 SKT A. 에이닷 에서 알람 설정 선물 드려요 ', 'item_nm_alias': 'P Biz Data', 'sim': 0.32000000000000006}]
2025-10-20 16:13:30,687 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-20 16:13:30,689 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 5개
2025-10-20 16:13:30,691 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-20 16:13:30,691 - __main__ - INFO - 통합된 후보 아이템 수: 5개
2025-10-20 16:13:30,693 - __main__ - INFO - 최종 후보 아이템 리스트: ['라이트 서비스', 'T 서비스', '에이닷 NOTE', '에이닷 Note', '에이닷 note']
2025-10-20 16:13:30,696 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (3, 2)
2025-10-20 16:13:30,696 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}, {'item_nm': '에이닷 노트', 'item_id': ['PR00000655', 'PR00000655', 'PR00000655']}]
2025-10-20 16:13:30,697 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 2.38초
2025-10-20 16:13:30,697 - __main__ - INFO - 추출된 후보 엔티티: ['라이트 서비스', 'T 서비스', '에이닷 NOTE', '에이닷 Note', '에이닷 note']
2025-10-20 16:13:30,697 - __main__ - INFO - 매칭된 상품 정보: (3, 2)
2025-10-20 16:13:30,697 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-20 16:13:30,889 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 16:13:30,890 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-20 16:13:30,890 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 16:13:30,890 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-20 16:13:30,890 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 400 문자
2025-10-20 16:13:30,890 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 360 문자
2025-10-20 16:13:30,890 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 16:13:30,890 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-20 16:13:30,890 - __main__ - INFO - 후보 아이템 리스트 크기: 11개
2025-10-20 16:13:30,890 - __main__ - INFO - 후보 아이템 리스트 크기: 5개
2025-10-20 16:13:30,890 - __main__ - INFO - 후보 아이템 리스트: ['충전', '스마트 사인', '아이폰 16 PRO', '아이폰 17 PRO', '아이폰 16', '아이폰 17', '5G 음성', 'Red메이트', 'red메이트', '아이폰 AIR', 'PPS스마트폰 라이트']
2025-10-20 16:13:30,890 - __main__ - INFO - 후보 아이템 리스트: ['라이트 서비스', 'T 서비스', '에이닷 NOTE', '에이닷 Note', '에이닷 note']
2025-10-20 16:13:30,890 - __main__ - INFO - extra_item_pdf 크기: (10, 2)
2025-10-20 16:13:30,891 - __main__ - INFO - extra_item_pdf 크기: (3, 2)
2025-10-20 16:13:30,891 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 16:13:30,891 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-20 16:13:30,891 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '5G 음성', 'item_id': ['NA00007314']}, {'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A63N', 'A63T', 'A5WH', 'A63H', 'A5WN']}]
2025-10-20 16:13:30,891 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-20 16:13:30,891 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 16:13:30,891 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-20 16:13:30,891 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 16:13:30,891 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-20 16:13:30,892 - __main__ - INFO - 구성된 프롬프트 길이: 6735 문자
2025-10-20 16:13:30,892 - __main__ - INFO - 구성된 프롬프트 길이: 6501 문자
2025-10-20 16:13:30,892 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 16:13:30,892 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-20 16:13:30,892 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 16:13:30,892 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-20 16:13:30,892 - __main__ - INFO - 📝 프롬프트 길이: 6,735 문자
2025-10-20 16:13:30,892 - __main__ - INFO - 📝 프롬프트 길이: 6,501 문자
2025-10-20 16:13:30,892 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 16:13:30,892 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-20 16:13:30,892 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 16:13:30,892 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-20 16:13:37,509 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 16:13:37,533 - __main__ - INFO - LLM 응답 길이: 802 문자
2025-10-20 16:13:37,534 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "A. (에이닷)에서 알람을 설정하면 선물을 드려요!",
    "purpose": [
        "이벤트 응모 유도",
        "경품 제공 안내"
    ],
    "product": [
        {
            "name": "A. (에이닷)",
            "action": "사용"
        },
        {
            "name": "A.알람",
            "action": "사용"
        }
    ],
    "channel": [
        {
            "type": "URL",
            "value": "http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr",
            "action": "추가 정보"
        },
  ...
2025-10-20 16:13:37,534 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 16:13:37,535 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 16:13:37,535 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 16:13:37,535 - __main__ - INFO - 파싱된 JSON 내용: {'title': 'A. (에이닷)에서 알람을 설정하면 선물을 드려요!', 'purpose': ['이벤트 응모 유도', '경품 제공 안내'], 'product': [{'name': 'A. (에이닷)', 'action': '사용'}, {'name': 'A.알람', 'action': '사용'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr', 'action': '추가 정보'}, {'type': '전화번호', 'value': '02-542-4920', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['사용법/혜택/이벤트안내_AI', '사용법/혜택/이벤트안내_SKT']}
2025-10-20 16:13:37,535 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 16:13:37,535 - __main__ - INFO - LLM 추출 엔티티: ['A. (에이닷)', 'A.알람']
2025-10-20 16:13:37,536 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-10-20 16:13:37,536 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 3,102 문자
2025-10-20 16:13:37,536 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-10-20 16:13:37,536 - __main__ - INFO - 📝 프롬프트 길이: 3,102 문자
2025-10-20 16:13:37,536 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-10-20 16:13:37,536 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-10-20 16:13:37,536 - __main__ - INFO - 🔄 1개 LLM 모델로 엔티티 추출 시작
2025-10-20 16:13:37,537 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-20 16:13:37,537 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-20 16:13:37,537 - __main__ - INFO - 🔍 메시지 길이: 685 문자
2025-10-20 16:13:39,807 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 16:13:39,812 - __main__ - INFO - ✅ LLM 추출 완료: ['A.알람', 'A.', 'A. 알람 챌린지', 'CU 빙그레 바나나우유 기프티콘']
2025-10-20 16:13:40,374 - __main__ - ERROR - 결합 유사도 계산 실패: DataFrame.reset_index() got an unexpected keyword argument 'name'
2025-10-20 16:13:40,375 - __main__ - INFO - extract_entities_by_llm 실행완료: 2.84초
2025-10-20 16:13:40,376 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 16:13:40,376 - __main__ - INFO - ============================================================
2025-10-20 16:13:40,376 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 16:13:40,376 - __main__ - INFO - ============================================================
2025-10-20 16:13:40,376 - __main__ - INFO - 제목: A. (에이닷)에서 알람을 설정하면 선물을 드려요!
2025-10-20 16:13:40,376 - __main__ - INFO - 목적: ['이벤트 응모 유도', '경품 제공 안내']
2025-10-20 16:13:40,376 - __main__ - INFO - 상품 수: 2개
2025-10-20 16:13:40,376 - __main__ - INFO - 채널 수: 3개
2025-10-20 16:13:40,376 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 16:13:40,376 - __main__ - INFO - process_message 실행완료: 12.06초
2025-10-20 16:13:40,376 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 16:13:40,377 - __main__ - INFO - 배치 처리 진행률: 1/2 (50.0%)
2025-10-20 16:13:42,431 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 16:13:42,436 - __main__ - INFO - LLM 응답 길이: 1613 문자
2025-10-20 16:13:42,437 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내"
    ],
    "product": [
        {
            "name": "아이폰 17",
            "action": "구매"
        },
        {
            "name": "아이폰 17 Pro",
            "action": "구매"
        },
        {
            "name": "5G",
            "action": "사용"
        },
        {
            "name": "A14 Bionic 칩",
            "action": "사용"
        },
        {
            "name": "세라믹 실드",
 ...
2025-10-20 16:13:42,437 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-20 16:13:42,440 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-20 16:13:42,440 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-20 16:13:42,441 - __main__ - INFO - 파싱된 JSON 내용: {'title': '[SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내', 'purpose': ['상품 가입 유도', '혜택 안내'], 'product': [{'name': '아이폰 17', 'action': '구매'}, {'name': '아이폰 17 Pro', 'action': '구매'}, {'name': '5G', 'action': '사용'}, {'name': 'A14 Bionic 칩', 'action': '사용'}, {'name': '세라믹 실드', 'action': '사용'}, {'name': 'Dolby Vision 영상 카메라', 'action': '사용'}, {'name': '[사죠영] 죠르디 한정판 기프트', 'action': '기타'}, {'name': '[프리디] 멀티 무선 충전기', 'action': '기타'}, {'name': '[에이프릴스톤] 보조배터리+멀티백', 'action': '기타'}, {'name': '[크레앙] 3in1 무선 충전 살균기', 'action': '기타'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/2HeWcdx', 'action': '추가 정보'}, {'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&u=https://bit.ly/3o7zOnA', 'action': '추가 정보'}, {'type': '전화번호', 'value': '1558', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['상품및부가서비스가입유도_단말', '사용법/혜택/이벤트안내_단말']}
2025-10-20 16:13:42,441 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-20 16:13:42,441 - __main__ - INFO - LLM 추출 엔티티: ['아이폰 17', '아이폰 17 Pro', '5G', 'A14 Bionic 칩', '세라믹 실드', 'Dolby Vision 영상 카메라', '[사죠영] 죠르디 한정판 기프트', '[프리디] 멀티 무선 충전기', '[에이프릴스톤] 보조배터리+멀티백', '[크레앙] 3in1 무선 충전 살균기']
2025-10-20 16:13:42,443 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-10-20 16:13:42,443 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 3,233 문자
2025-10-20 16:13:42,444 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-10-20 16:13:42,444 - __main__ - INFO - 📝 프롬프트 길이: 3,233 문자
2025-10-20 16:13:42,444 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-10-20 16:13:42,444 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-10-20 16:13:42,444 - __main__ - INFO - 🔄 1개 LLM 모델로 엔티티 추출 시작
2025-10-20 16:13:42,445 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-20 16:13:42,445 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-20 16:13:42,445 - __main__ - INFO - 🔍 메시지 길이: 816 문자
2025-10-20 16:13:45,781 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-20 16:13:45,783 - __main__ - INFO - ✅ LLM 추출 완료: ['T다이렉트샵', '3in1 무선 충전 살균기', '아이폰17', '보조배터리+멀티백', '아이폰 17 Pro', 'T기프트', '죠르디 한정판 기프트', '멀티 무선 충전기']
2025-10-20 16:13:46,165 - __main__ - INFO - extract_entities_by_llm 실행완료: 3.72초
2025-10-20 16:13:46,171 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-20 16:13:46,171 - __main__ - INFO - ============================================================
2025-10-20 16:13:46,171 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-20 16:13:46,171 - __main__ - INFO - ============================================================
2025-10-20 16:13:46,171 - __main__ - INFO - 제목: [SK텔레콤] 반가워요 5G 아이폰17/ 17 Pro 사전예약 안내
2025-10-20 16:13:46,171 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내']
2025-10-20 16:13:46,171 - __main__ - INFO - 상품 수: 2개
2025-10-20 16:13:46,171 - __main__ - INFO - 채널 수: 4개
2025-10-20 16:13:46,172 - __main__ - INFO - 프로그램 수: 2개
2025-10-20 16:13:46,172 - __main__ - INFO - process_message 실행완료: 17.86초
2025-10-20 16:13:46,172 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-20 16:13:46,172 - __main__ - INFO - 배치 처리 진행률: 2/2 (100.0%)
2025-10-20 16:13:46,172 - __main__ - INFO - 배치 처리 완료: 2개 메시지, 17.86초
2025-10-20 16:13:46,172 - __main__ - INFO - 평균 처리 시간: 8.93초/메시지
2025-10-22 11:16:22,061 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-22 11:16:22,061 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-22 11:16:22,061 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-22 11:16:22,061 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-22 11:16:22,061 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-22 11:16:22,063 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-22 11:16:22,144 - __main__ - INFO - Using device: mps
2025-10-22 11:16:22,145 - utils - INFO - _initialize_device 실행완료: 0.08초
2025-10-22 11:16:22,145 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-22 11:16:22,145 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-22 11:16:22,145 - utils - INFO - _initialize_llm 실행완료: 0.00초
2025-10-22 11:16:22,145 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-22 11:16:22,145 - utils - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-22 11:16:22,145 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-22 11:16:22,145 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-22 11:16:22,730 - utils - INFO - Model loaded on mps
2025-10-22 11:16:22,730 - utils - INFO - _initialize_embedding_model 실행완료: 0.58초
2025-10-22 11:16:22,730 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-22 11:16:23,346 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-22 11:16:23,346 - utils - INFO - _initialize_kiwi 실행완료: 0.62초
2025-10-22 11:16:23,346 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-22 11:16:23,346 - __main__ - INFO - ============================================================
2025-10-22 11:16:23,346 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-22 11:16:23,346 - __main__ - INFO - ============================================================
2025-10-22 11:16:23,346 - __main__ - INFO - 데이터 소스 모드: local
2025-10-22 11:16:23,346 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-22 11:16:23,346 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-22 11:16:23,346 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-22 11:16:23,346 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-22 11:16:23,518 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-22 11:16:23,518 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-22 11:16:23,518 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-22 11:16:23,524 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-22 11:16:23,525 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-22 11:16:23,526 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-22 11:16:23,527 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-22 11:16:23,527 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-22 11:16:23,527 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-22 11:16:23,534 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-22 11:16:23,538 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-22 11:16:23,538 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-22 11:16:23,538 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-22 11:16:23,538 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-22 11:16:23,538 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-22 11:16:23,538 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-22 11:16:23,538 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-22 11:16:23,538 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-22 11:16:23,539 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-22 11:16:23,539 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-22 11:16:23,544 - __main__ - INFO - 로드된 별칭 규칙 수: 168개
2025-10-22 11:16:23,544 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-22 11:16:23,544 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-22 11:16:23,544 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-22 11:16:23,545 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-22 11:16:23,762 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-22 11:16:23,771 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22608
2025-10-22 11:16:23,772 - __main__ - INFO - 별칭 적용 후 샘플: ['우주PASS Netflix 인증', '우주Pass Netflix 인증', '우주pass Netflix 인증', '우주패스 Netflix 인증', '우주패스 넷플릭스 인증']
2025-10-22 11:16:23,772 - __main__ - INFO - 별칭 규칙 적용 완료: 168개 규칙
2025-10-22 11:16:23,773 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22608, 9)
2025-10-22 11:16:23,773 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-22 11:16:23,774 - __main__ - INFO - 정지어 로드 완료: 171개
2025-10-22 11:16:23,774 - __main__ - INFO - 로드된 정지어 수: 171개
2025-10-22 11:16:23,774 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-22 11:16:23,774 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-22 11:16:23,775 - __main__ - INFO - 등록할 고유 별칭 수: 17022개
2025-10-22 11:16:23,776 - __main__ - INFO - 유효한 별칭 수: 17021개
2025-10-22 11:16:23,776 - __main__ - INFO - 등록할 별칭 샘플: ['우주PASS Netflix 인증', '우주Pass Netflix 인증', '우주pass Netflix 인증', '우주패스 Netflix 인증', '우주패스 넷플릭스 인증']
2025-10-22 11:16:23,795 - __main__ - INFO - Kiwi에 상품명 등록 완료: 17021개 성공, 0개 실패
2025-10-22 11:16:23,796 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-22 11:16:23,796 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-22 11:16:23,807 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-22 11:16:23,807 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-22 11:16:24,088 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-22 11:16:24,088 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-22 11:16:24,089 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-22 11:16:24,089 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-22 11:16:24,089 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-22 11:16:24,089 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-22 11:16:24,169 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-22 11:16:24,169 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-22 11:16:24,171 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-22 11:16:24,172 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-22 11:16:24,172 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-22 11:16:24,172 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-22 11:16:24,172 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-22 11:16:24,173 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-22 11:16:24,173 - __main__ - INFO - ============================================================
2025-10-22 11:16:24,173 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-22 11:16:24,173 - __main__ - INFO - ============================================================
2025-10-22 11:16:24,173 - __main__ - INFO - ✅ 상품 데이터: (22608, 9)
2025-10-22 11:16:24,173 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-22 11:16:24,173 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-22 11:16:24,173 - __main__ - INFO - ✅ 정지어: 171개
2025-10-22 11:16:24,173 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-22 11:16:24,174 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-22 11:16:24,176 - __main__ - INFO - 고유 별칭 수: 17021개
2025-10-22 11:16:24,177 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-22 11:16:24,177 - utils - INFO - _load_data 실행완료: 0.83초
2025-10-22 11:16:24,177 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-22 11:16:24,178 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-22 11:16:24,178 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A....
2025-10-22 11:16:24,178 - __main__ - INFO - ============================================================
2025-10-22 11:16:24,178 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-22 11:16:24,178 - __main__ - INFO - ============================================================
2025-10-22 11:16:24,178 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A. (에이닷)에서 알람을 설정하면 선물을 드려요!__#04 고객님, 안녕하세요.__모닝콜, 영양제 먹기, 애견 산책 등  매일 반복되는 일상을 최애 음악으로 알람 설정 해보세요~!__A.(에이닷)에서 알람을 등록하고 권한 설정하면 선물을 드립니다!__▶ 이벤트 자세히 보...
2025-10-22 11:16:24,178 - __main__ - INFO - 메시지 길이: 685 문자
2025-10-22 11:16:24,178 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-22 11:16:24,178 - __main__ - INFO - 데이터 소스: local
2025-10-22 11:16:24,178 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-22 11:16:24,178 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-22 11:16:24,178 - __main__ - INFO - LLM 모델: ax
2025-10-22 11:16:24,178 - __main__ - INFO - 상품 데이터 크기: (22608, 9)
2025-10-22 11:16:24,178 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-22 11:16:24,178 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-22 11:16:24,178 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-22 11:16:24,178 - __main__ - INFO - 처리할 메시지 길이: 683 문자
2025-10-22 11:16:24,179 - __main__ - INFO - 매칭할 상품 별칭 수: 17022개
2025-10-22 11:16:24,811 - __main__ - INFO - 분할된 문장 수: 16개
2025-10-22 11:16:24,812 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'A. 에이닷 에서 알람 설정 선물 드려요 ', ' 고객님 안녕하세요 ']...
2025-10-22 11:16:24,826 - __main__ - INFO - 전체 토큰 수: 296개
2025-10-22 11:16:24,826 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '에이닷', '에이닷', '모닝콜', '에이닷', '에이닷', '기프티콘', '앤', '앨리스']
2025-10-22 11:16:24,826 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['앨리스', '기프티콘', '에이닷', '모닝콜']
2025-10-22 11:16:24,826 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-22 11:16:31,706 - __main__ - INFO - 퍼지 매칭 결과 크기: (2707, 3)
2025-10-22 11:16:31,706 - __main__ - INFO - 퍼지 매칭 성공: 2707개 결과
2025-10-22 11:16:31,707 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.4285714285714286}]
2025-10-22 11:16:31,707 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-22 11:16:31,778 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2707, 3)
2025-10-22 11:16:31,779 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.21818181818181817}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.34285714285714286}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.2857142857142857}]
2025-10-22 11:16:31,779 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-22 11:16:31,782 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 3개
2025-10-22 11:16:31,784 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-22 11:16:31,785 - __main__ - INFO - 통합된 후보 아이템 수: 3개
2025-10-22 11:16:31,789 - __main__ - INFO - 최종 후보 아이템 리스트: ['라이트 서비스', 'T 서비스', 'A. 전화']
2025-10-22 11:16:31,792 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (3, 2)
2025-10-22 11:16:31,792 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}, {'item_nm': '에이닷 전화', 'item_id': ['NA00004249']}]
2025-10-22 11:16:31,792 - utils - INFO - extract_entities_from_kiwi 실행완료: 7.61초
2025-10-22 11:16:31,792 - __main__ - INFO - 추출된 후보 엔티티: ['라이트 서비스', 'T 서비스', 'A. 전화']
2025-10-22 11:16:31,793 - __main__ - INFO - 매칭된 상품 정보: (3, 2)
2025-10-22 11:16:31,793 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-22 11:16:31,948 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-22 11:16:31,948 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-22 11:16:31,948 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 360 문자
2025-10-22 11:16:31,948 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-22 11:16:31,948 - __main__ - INFO - 후보 아이템 리스트 크기: 3개
2025-10-22 11:16:31,948 - __main__ - INFO - 후보 아이템 리스트: ['라이트 서비스', 'T 서비스', 'A. 전화']
2025-10-22 11:16:31,948 - __main__ - INFO - extra_item_pdf 크기: (3, 2)
2025-10-22 11:16:31,948 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-22 11:16:31,948 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-22 11:16:31,948 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-22 11:16:31,948 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-22 11:16:31,949 - __main__ - INFO - 구성된 프롬프트 길이: 6472 문자
2025-10-22 11:16:31,949 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-22 11:16:31,949 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-22 11:16:31,949 - __main__ - INFO - 📝 프롬프트 길이: 6,472 문자
2025-10-22 11:16:31,949 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-22 11:16:31,949 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-22 11:16:38,640 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-22 11:16:38,659 - __main__ - INFO - LLM 응답 길이: 802 문자
2025-10-22 11:16:38,660 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "A. (에이닷)에서 알람을 설정하면 선물을 드려요!",
    "purpose": [
        "이벤트 응모 유도",
        "경품 제공 안내"
    ],
    "product": [
        {
            "name": "A. (에이닷)",
            "action": "사용"
        },
        {
            "name": "A.알람",
            "action": "사용"
        }
    ],
    "channel": [
        {
            "type": "URL",
            "value": "http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr",
            "action": "추가 정보"
        },
  ...
2025-10-22 11:16:38,660 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-22 11:16:38,660 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-22 11:16:38,660 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-22 11:16:38,660 - __main__ - INFO - 파싱된 JSON 내용: {'title': 'A. (에이닷)에서 알람을 설정하면 선물을 드려요!', 'purpose': ['이벤트 응모 유도', '경품 제공 안내'], 'product': [{'name': 'A. (에이닷)', 'action': '사용'}, {'name': 'A.알람', 'action': '사용'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr', 'action': '추가 정보'}, {'type': '전화번호', 'value': '02-542-4920', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['사용법/혜택/이벤트안내_AI', '사용법/혜택/이벤트안내_SKT']}
2025-10-22 11:16:38,660 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-22 11:16:38,661 - __main__ - INFO - LLM 추출 엔티티: ['A. (에이닷)', 'A.알람']
2025-10-22 11:16:38,661 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-10-22 11:16:38,661 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 3,100 문자
2025-10-22 11:16:38,661 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-10-22 11:16:38,661 - __main__ - INFO - 📝 프롬프트 길이: 3,100 문자
2025-10-22 11:16:38,661 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-10-22 11:16:38,661 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-10-22 11:16:38,662 - __main__ - INFO - 🔄 1개 LLM 모델로 엔티티 추출 시작
2025-10-22 11:16:38,662 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-22 11:16:38,662 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-22 11:16:38,662 - __main__ - INFO - 🔍 메시지 길이: 683 문자
2025-10-22 11:16:41,439 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-22 11:16:41,443 - __main__ - INFO - ✅ LLM 추출 완료: ['A.알람', 'A. 알람 챌린지', 'A.', 'CU 빙그레 바나나우유 기프티콘']
2025-10-22 11:16:41,694 - __main__ - ERROR - 결합 유사도 계산 실패: DataFrame.reset_index() got an unexpected keyword argument 'name'
2025-10-22 11:16:41,695 - utils - INFO - extract_entities_by_llm 실행완료: 3.03초
2025-10-22 11:16:41,696 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-22 11:16:41,696 - __main__ - INFO - ============================================================
2025-10-22 11:16:41,696 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-22 11:16:41,696 - __main__ - INFO - ============================================================
2025-10-22 11:16:41,696 - __main__ - INFO - 제목: A. (에이닷)에서 알람을 설정하면 선물을 드려요!
2025-10-22 11:16:41,696 - __main__ - INFO - 목적: ['이벤트 응모 유도', '경품 제공 안내']
2025-10-22 11:16:41,696 - __main__ - INFO - 상품 수: 2개
2025-10-22 11:16:41,696 - __main__ - INFO - 채널 수: 3개
2025-10-22 11:16:41,696 - __main__ - INFO - 프로그램 수: 2개
2025-10-22 11:16:41,696 - utils - INFO - process_message 실행완료: 17.52초
2025-10-22 11:16:41,696 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-22 11:19:47,217 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-22 11:19:47,217 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-22 11:19:47,217 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-22 11:19:47,217 - __main__ - INFO - 🎯 DAG 추출 모드 활성화됨
2025-10-22 11:19:47,217 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-22 11:19:47,219 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-22 11:19:47,252 - __main__ - INFO - Using device: mps
2025-10-22 11:19:47,252 - utils - INFO - _initialize_device 실행완료: 0.03초
2025-10-22 11:19:47,252 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-22 11:19:47,252 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-22 11:19:47,252 - utils - INFO - _initialize_llm 실행완료: 0.00초
2025-10-22 11:19:47,252 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-22 11:19:47,252 - utils - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-22 11:19:47,253 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-22 11:19:47,253 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-22 11:19:47,515 - utils - INFO - Model loaded on mps
2025-10-22 11:19:47,516 - utils - INFO - _initialize_embedding_model 실행완료: 0.26초
2025-10-22 11:19:47,516 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-22 11:19:48,109 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-22 11:19:48,109 - utils - INFO - _initialize_kiwi 실행완료: 0.59초
2025-10-22 11:19:48,109 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-22 11:19:48,109 - __main__ - INFO - ============================================================
2025-10-22 11:19:48,109 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-22 11:19:48,109 - __main__ - INFO - ============================================================
2025-10-22 11:19:48,109 - __main__ - INFO - 데이터 소스 모드: local
2025-10-22 11:19:48,109 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-22 11:19:48,109 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-22 11:19:48,109 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-22 11:19:48,109 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-22 11:19:48,258 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-22 11:19:48,258 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-22 11:19:48,258 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-22 11:19:48,266 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-22 11:19:48,267 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-22 11:19:48,267 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-22 11:19:48,268 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-22 11:19:48,268 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-22 11:19:48,268 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-22 11:19:48,270 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-22 11:19:48,274 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-22 11:19:48,274 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-22 11:19:48,274 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-22 11:19:48,274 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-22 11:19:48,274 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-22 11:19:48,274 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-22 11:19:48,274 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-22 11:19:48,275 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-22 11:19:48,275 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-22 11:19:48,275 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-22 11:19:48,276 - __main__ - INFO - 로드된 별칭 규칙 수: 168개
2025-10-22 11:19:48,276 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-22 11:19:48,276 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-22 11:19:48,277 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-22 11:19:48,277 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-22 11:19:48,495 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-22 11:19:48,506 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22608
2025-10-22 11:19:48,506 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 넷플릭스 인증', '우주pass Netflix 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증']
2025-10-22 11:19:48,506 - __main__ - INFO - 별칭 규칙 적용 완료: 168개 규칙
2025-10-22 11:19:48,507 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22608, 9)
2025-10-22 11:19:48,507 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-22 11:19:48,508 - __main__ - INFO - 정지어 로드 완료: 171개
2025-10-22 11:19:48,508 - __main__ - INFO - 로드된 정지어 수: 171개
2025-10-22 11:19:48,508 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-22 11:19:48,508 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-22 11:19:48,509 - __main__ - INFO - 등록할 고유 별칭 수: 17022개
2025-10-22 11:19:48,510 - __main__ - INFO - 유효한 별칭 수: 17021개
2025-10-22 11:19:48,510 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 넷플릭스 인증', '우주pass Netflix 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증']
2025-10-22 11:19:48,532 - __main__ - INFO - Kiwi에 상품명 등록 완료: 17021개 성공, 0개 실패
2025-10-22 11:19:48,532 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-22 11:19:48,532 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-22 11:19:48,534 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-22 11:19:48,534 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-22 11:19:48,787 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-22 11:19:48,787 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-22 11:19:48,787 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-22 11:19:48,787 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-22 11:19:48,787 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-22 11:19:48,787 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-22 11:19:48,867 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-22 11:19:48,867 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-22 11:19:48,870 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-22 11:19:48,870 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-22 11:19:48,870 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-22 11:19:48,870 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-22 11:19:48,870 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-22 11:19:48,871 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-22 11:19:48,871 - __main__ - INFO - ============================================================
2025-10-22 11:19:48,871 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-22 11:19:48,871 - __main__ - INFO - ============================================================
2025-10-22 11:19:48,871 - __main__ - INFO - ✅ 상품 데이터: (22608, 9)
2025-10-22 11:19:48,871 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-22 11:19:48,871 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-22 11:19:48,871 - __main__ - INFO - ✅ 정지어: 171개
2025-10-22 11:19:48,871 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-22 11:19:48,872 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-22 11:19:48,874 - __main__ - INFO - 고유 별칭 수: 17021개
2025-10-22 11:19:48,876 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-22 11:19:48,876 - utils - INFO - _load_data 실행완료: 0.77초
2025-10-22 11:19:48,876 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-22 11:19:48,876 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-22 11:19:48,876 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A....
2025-10-22 11:19:48,876 - __main__ - INFO - ============================================================
2025-10-22 11:19:48,876 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-22 11:19:48,877 - __main__ - INFO - ============================================================
2025-10-22 11:19:48,877 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A. (에이닷)에서 알람을 설정하면 선물을 드려요!__#04 고객님, 안녕하세요.__모닝콜, 영양제 먹기, 애견 산책 등  매일 반복되는 일상을 최애 음악으로 알람 설정 해보세요~!__A.(에이닷)에서 알람을 등록하고 권한 설정하면 선물을 드립니다!__▶ 이벤트 자세히 보...
2025-10-22 11:19:48,877 - __main__ - INFO - 메시지 길이: 685 문자
2025-10-22 11:19:48,877 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-22 11:19:48,877 - __main__ - INFO - 데이터 소스: local
2025-10-22 11:19:48,877 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-22 11:19:48,877 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-22 11:19:48,877 - __main__ - INFO - LLM 모델: ax
2025-10-22 11:19:48,877 - __main__ - INFO - 상품 데이터 크기: (22608, 9)
2025-10-22 11:19:48,877 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-22 11:19:48,877 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-22 11:19:48,877 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-22 11:19:48,877 - __main__ - INFO - 처리할 메시지 길이: 683 문자
2025-10-22 11:19:48,878 - __main__ - INFO - 매칭할 상품 별칭 수: 17022개
2025-10-22 11:19:49,520 - __main__ - INFO - 분할된 문장 수: 16개
2025-10-22 11:19:49,521 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'A. 에이닷 에서 알람 설정 선물 드려요 ', ' 고객님 안녕하세요 ']...
2025-10-22 11:19:49,535 - __main__ - INFO - 전체 토큰 수: 296개
2025-10-22 11:19:49,536 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '에이닷', '에이닷', '모닝콜', '에이닷', '에이닷', '기프티콘', '앤', '앨리스']
2025-10-22 11:19:49,536 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['모닝콜', '앨리스', '기프티콘', '에이닷']
2025-10-22 11:19:49,536 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-22 11:19:55,896 - __main__ - INFO - 퍼지 매칭 결과 크기: (2707, 3)
2025-10-22 11:19:55,896 - __main__ - INFO - 퍼지 매칭 성공: 2707개 결과
2025-10-22 11:19:55,898 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.4285714285714286}]
2025-10-22 11:19:55,898 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-22 11:19:55,968 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2707, 3)
2025-10-22 11:19:55,969 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.21818181818181817}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.34285714285714286}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.2857142857142857}]
2025-10-22 11:19:55,969 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-22 11:19:55,973 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 3개
2025-10-22 11:19:55,975 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-22 11:19:55,976 - __main__ - INFO - 통합된 후보 아이템 수: 3개
2025-10-22 11:19:55,979 - __main__ - INFO - 최종 후보 아이템 리스트: ['라이트 서비스', 'T 서비스', 'A. 전화']
2025-10-22 11:19:55,982 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (3, 2)
2025-10-22 11:19:55,982 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}, {'item_nm': '에이닷 전화', 'item_id': ['NA00004249']}]
2025-10-22 11:19:55,982 - utils - INFO - extract_entities_from_kiwi 실행완료: 7.11초
2025-10-22 11:19:55,982 - __main__ - INFO - 추출된 후보 엔티티: ['라이트 서비스', 'T 서비스', 'A. 전화']
2025-10-22 11:19:55,982 - __main__ - INFO - 매칭된 상품 정보: (3, 2)
2025-10-22 11:19:55,982 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-22 11:19:56,143 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-22 11:19:56,143 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-22 11:19:56,143 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 360 문자
2025-10-22 11:19:56,143 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-22 11:19:56,143 - __main__ - INFO - 후보 아이템 리스트 크기: 3개
2025-10-22 11:19:56,143 - __main__ - INFO - 후보 아이템 리스트: ['라이트 서비스', 'T 서비스', 'A. 전화']
2025-10-22 11:19:56,143 - __main__ - INFO - extra_item_pdf 크기: (3, 2)
2025-10-22 11:19:56,143 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-22 11:19:56,144 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-22 11:19:56,144 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-22 11:19:56,144 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-22 11:19:56,144 - __main__ - INFO - 구성된 프롬프트 길이: 6472 문자
2025-10-22 11:19:56,144 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-22 11:19:56,144 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-22 11:19:56,144 - __main__ - INFO - 📝 프롬프트 길이: 6,472 문자
2025-10-22 11:19:56,144 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-22 11:19:56,144 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-22 11:20:02,280 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-22 11:20:02,299 - __main__ - INFO - LLM 응답 길이: 802 문자
2025-10-22 11:20:02,299 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "A. (에이닷)에서 알람을 설정하면 선물을 드려요!",
    "purpose": [
        "이벤트 응모 유도",
        "경품 제공 안내"
    ],
    "product": [
        {
            "name": "A. (에이닷)",
            "action": "사용"
        },
        {
            "name": "A.알람",
            "action": "사용"
        }
    ],
    "channel": [
        {
            "type": "URL",
            "value": "http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr",
            "action": "추가 정보"
        },
  ...
2025-10-22 11:20:02,300 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-22 11:20:02,300 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-22 11:20:02,300 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-22 11:20:02,300 - __main__ - INFO - 파싱된 JSON 내용: {'title': 'A. (에이닷)에서 알람을 설정하면 선물을 드려요!', 'purpose': ['이벤트 응모 유도', '경품 제공 안내'], 'product': [{'name': 'A. (에이닷)', 'action': '사용'}, {'name': 'A.알람', 'action': '사용'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr', 'action': '추가 정보'}, {'type': '전화번호', 'value': '02-542-4920', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['사용법/혜택/이벤트안내_AI', '사용법/혜택/이벤트안내_SKT']}
2025-10-22 11:20:02,300 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-22 11:20:02,300 - __main__ - INFO - LLM 추출 엔티티: ['A. (에이닷)', 'A.알람']
2025-10-22 11:20:02,301 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-10-22 11:20:02,301 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 3,100 문자
2025-10-22 11:20:02,301 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-10-22 11:20:02,301 - __main__ - INFO - 📝 프롬프트 길이: 3,100 문자
2025-10-22 11:20:02,301 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-10-22 11:20:02,301 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-10-22 11:20:02,301 - __main__ - INFO - 🔄 1개 LLM 모델로 엔티티 추출 시작
2025-10-22 11:20:02,302 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-22 11:20:02,302 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-22 11:20:02,302 - __main__ - INFO - 🔍 메시지 길이: 683 문자
2025-10-22 11:20:04,863 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-22 11:20:04,867 - __main__ - INFO - ✅ LLM 추출 완료: ['A.알람', 'A. 알람 챌린지', 'CU 빙그레 바나나우유 기프티콘', 'A.']
2025-10-22 11:20:05,111 - __main__ - ERROR - 결합 유사도 계산 실패: DataFrame.reset_index() got an unexpected keyword argument 'name'
2025-10-22 11:20:05,112 - utils - INFO - extract_entities_by_llm 실행완료: 2.81초
2025-10-22 11:20:05,113 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-22 11:20:05,113 - __main__ - INFO - ============================================================
2025-10-22 11:20:05,113 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-22 11:20:05,113 - __main__ - INFO - ============================================================
2025-10-22 11:20:05,113 - __main__ - INFO - 제목: A. (에이닷)에서 알람을 설정하면 선물을 드려요!
2025-10-22 11:20:05,113 - __main__ - INFO - 목적: ['이벤트 응모 유도', '경품 제공 안내']
2025-10-22 11:20:05,113 - __main__ - INFO - 상품 수: 2개
2025-10-22 11:20:05,113 - __main__ - INFO - 채널 수: 3개
2025-10-22 11:20:05,113 - __main__ - INFO - 프로그램 수: 2개
2025-10-22 11:20:05,113 - utils - INFO - process_message 실행완료: 16.24초
2025-10-22 11:20:05,113 - __main__ - INFO - 순차적 처리로 메인 추출 및 DAG 추출 수행
2025-10-22 11:20:05,113 - __main__ - INFO - ============================== DAG 추출 시작 ==============================
2025-10-22 11:20:05,113 - entity_dag_extractor - INFO - 🚀 DAG 추출 프로세스 시작
2025-10-22 11:20:05,113 - entity_dag_extractor - INFO - 📝 입력 메시지 길이: 685자
2025-10-22 11:20:05,114 - entity_dag_extractor - INFO - 🤖 사용 LLM 모델: client=<openai.resources.chat.completions.completions.Completions object at 0x163b7a750> async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x1641bb9e0> root_client=<openai.OpenAI object at 0x163b7b530> root_async_client=<openai.AsyncOpenAI object at 0x163b7b2c0> model_name='skt/ax4' temperature=0.0 model_kwargs={} openai_api_key=SecretStr('**********') openai_api_base='https://api.platform.a15t.com/v1' max_tokens=4000
2025-10-22 11:20:05,114 - entity_dag_extractor - INFO - 🤖 LLM에 DAG 추출 요청 중...
2025-10-22 11:20:05,114 - entity_dag_extractor - INFO - 📏 프롬프트 길이: 3670자
2025-10-22 11:20:27,392 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-22 11:20:27,397 - entity_dag_extractor - INFO - 📝 LLM 응답 길이: 2334자
2025-10-22 11:20:27,397 - entity_dag_extractor - INFO - 📄 LLM 응답 미리보기: ## 1. 메시지 분석

```
[메시지 요약 및 핵심 의도]
SK텔레콤은 자사 AI 비서 서비스인 '에이닷(A.dot)'의 알람 기능을 활성화하도록 유도하기 위해 이벤트를 진행하고 있습니다. 사용자는 에이닷 앱에서 알람을 설정하고 관련 권한을 부여하면 자동으로 이벤트에 응모되며, 추첨을 통해 5만 명에게 CU 빙그레 바나나우유 기프티콘을 제공합니다.

[...
2025-10-22 11:20:27,397 - entity_dag_extractor - INFO - 🔍 DAG 섹션 추출 중...
2025-10-22 11:20:27,398 - entity_dag_extractor - INFO - 📄 추출된 DAG 섹션 길이: 199자
2025-10-22 11:20:27,399 - entity_dag_extractor - INFO - 🔗 DAG 파싱 중...
2025-10-22 11:20:27,400 - entity_dag_extractor - INFO - 📊 파싱된 DAG - 노드 수: 7, 엣지 수: 7
2025-10-22 11:20:27,403 - entity_dag_extractor - INFO - 🎯 DAG 노드 목록: ['에이닷:다운로드', '에이닷:접속', '개인정보:등록', '알람:설정', '권한:설정', '알람서비스:이용', '기프티콘:수령']
2025-10-22 11:20:27,408 - entity_dag_extractor - INFO - 🔗 DAG 엣지 목록: [('에이닷:다운로드', '에이닷:접속'), ('에이닷:접속', '개인정보:등록'), ('개인정보:등록', '알람:설정'), ('알람:설정', '권한:설정'), ('알람:설정', '기프티콘:수령'), ('권한:설정', '알람서비스:이용'), ('권한:설정', '기프티콘:수령')]
2025-10-22 11:20:27,408 - entity_dag_extractor - INFO - ✅ DAG 추출 프로세스 완료
2025-10-22 11:20:29,645 - utils - INFO - DAG 다이어그램이 저장되었습니다: dag_images/dag_1d49859c.png
2025-10-22 11:20:29,645 - __main__ - INFO - ✅ DAG 추출 완료: dag_1d49859c
2025-10-22 11:20:29,645 - __main__ - INFO - 🕒 DAG 처리 시간: 24.532초
2025-10-22 11:20:29,645 - __main__ - INFO - 📏 DAG 섹션 길이: 199자
2025-10-22 11:20:29,645 - __main__ - INFO - 📄 DAG 내용 미리보기: (에이닷:다운로드) -[다운로드하면]-> (에이닷:접속)
(에이닷:접속) -[접속하면]-> (개인정보:등록)
(개인정보:등록) -[등록하면]-> (알람:설정)
(알람:설정) -[설정하면]-> (권한:설정)
(권한:설정) -[설정하면]-> (알람서비스:이용)
(알람:설정) -[설정하면]-> (기프티콘:수령)
(권한:설정) -[설정하면]-> (기프티콘:수령)...
2025-10-22 11:20:29,645 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-22 11:52:28,588 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-22 11:52:28,588 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-22 11:52:28,588 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-22 11:52:28,588 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-22 11:52:28,588 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-22 11:52:28,590 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-22 11:52:28,646 - __main__ - INFO - Using device: mps
2025-10-22 11:52:28,646 - utils - INFO - _initialize_device 실행완료: 0.06초
2025-10-22 11:52:28,646 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-22 11:52:28,646 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-22 11:52:28,646 - utils - INFO - _initialize_llm 실행완료: 0.00초
2025-10-22 11:52:28,646 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-22 11:52:28,647 - utils - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-22 11:52:28,647 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-22 11:52:28,647 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-22 11:52:29,152 - utils - INFO - Model loaded on mps
2025-10-22 11:52:29,152 - utils - INFO - _initialize_embedding_model 실행완료: 0.51초
2025-10-22 11:52:29,152 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-22 11:52:29,808 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-22 11:52:29,808 - utils - INFO - _initialize_kiwi 실행완료: 0.66초
2025-10-22 11:52:29,808 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-22 11:52:29,808 - __main__ - INFO - ============================================================
2025-10-22 11:52:29,808 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-22 11:52:29,808 - __main__ - INFO - ============================================================
2025-10-22 11:52:29,808 - __main__ - INFO - 데이터 소스 모드: local
2025-10-22 11:52:29,808 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-22 11:52:29,808 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-22 11:52:29,808 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-22 11:52:29,808 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-22 11:52:29,984 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-22 11:52:29,984 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-22 11:52:29,984 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-22 11:52:29,990 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-22 11:52:29,991 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-22 11:52:29,992 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-22 11:52:29,993 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-22 11:52:29,993 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-22 11:52:29,993 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-22 11:52:30,000 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-22 11:52:30,005 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-22 11:52:30,005 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-22 11:52:30,005 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-22 11:52:30,005 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-22 11:52:30,005 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-22 11:52:30,006 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-22 11:52:30,006 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-22 11:52:30,006 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-22 11:52:30,006 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-22 11:52:30,006 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-22 11:52:30,012 - __main__ - INFO - 로드된 별칭 규칙 수: 168개
2025-10-22 11:52:30,013 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-22 11:52:30,013 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-22 11:52:30,013 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-22 11:52:30,013 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-22 11:52:30,231 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-22 11:52:30,241 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22608
2025-10-22 11:52:30,242 - __main__ - INFO - 별칭 적용 후 샘플: ['우주PASS Netflix 인증', '우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증']
2025-10-22 11:52:30,242 - __main__ - INFO - 별칭 규칙 적용 완료: 168개 규칙
2025-10-22 11:52:30,242 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22608, 9)
2025-10-22 11:52:30,242 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-22 11:52:30,243 - __main__ - INFO - 정지어 로드 완료: 171개
2025-10-22 11:52:30,243 - __main__ - INFO - 로드된 정지어 수: 171개
2025-10-22 11:52:30,243 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-22 11:52:30,243 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-22 11:52:30,244 - __main__ - INFO - 등록할 고유 별칭 수: 17022개
2025-10-22 11:52:30,245 - __main__ - INFO - 유효한 별칭 수: 17021개
2025-10-22 11:52:30,245 - __main__ - INFO - 등록할 별칭 샘플: ['우주PASS Netflix 인증', '우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증']
2025-10-22 11:52:30,266 - __main__ - INFO - Kiwi에 상품명 등록 완료: 17021개 성공, 0개 실패
2025-10-22 11:52:30,266 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-22 11:52:30,266 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-22 11:52:30,278 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-22 11:52:30,278 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-22 11:52:30,596 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-22 11:52:30,596 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-22 11:52:30,596 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-22 11:52:30,596 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-22 11:52:30,596 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-22 11:52:30,596 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-22 11:52:30,693 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-22 11:52:30,693 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-22 11:52:30,695 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-22 11:52:30,696 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-22 11:52:30,696 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-22 11:52:30,696 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-22 11:52:30,696 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-22 11:52:30,696 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-22 11:52:30,696 - __main__ - INFO - ============================================================
2025-10-22 11:52:30,696 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-22 11:52:30,697 - __main__ - INFO - ============================================================
2025-10-22 11:52:30,697 - __main__ - INFO - ✅ 상품 데이터: (22608, 9)
2025-10-22 11:52:30,697 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-22 11:52:30,697 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-22 11:52:30,697 - __main__ - INFO - ✅ 정지어: 171개
2025-10-22 11:52:30,697 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-22 11:52:30,698 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-22 11:52:30,700 - __main__ - INFO - 고유 별칭 수: 17021개
2025-10-22 11:52:30,701 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-22 11:52:30,702 - utils - INFO - _load_data 실행완료: 0.89초
2025-10-22 11:52:30,702 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-22 11:52:30,702 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-22 11:52:30,702 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A....
2025-10-22 11:52:30,702 - __main__ - INFO - ============================================================
2025-10-22 11:52:30,702 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-22 11:52:30,702 - __main__ - INFO - ============================================================
2025-10-22 11:52:30,702 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A. (에이닷)에서 알람을 설정하면 선물을 드려요!__#04 고객님, 안녕하세요.__모닝콜, 영양제 먹기, 애견 산책 등  매일 반복되는 일상을 최애 음악으로 알람 설정 해보세요~!__A.(에이닷)에서 알람을 등록하고 권한 설정하면 선물을 드립니다!__▶ 이벤트 자세히 보...
2025-10-22 11:52:30,702 - __main__ - INFO - 메시지 길이: 685 문자
2025-10-22 11:52:30,702 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-22 11:52:30,702 - __main__ - INFO - 데이터 소스: local
2025-10-22 11:52:30,702 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-22 11:52:30,702 - __main__ - INFO - 엔티티 추출 모드: logic
2025-10-22 11:52:30,702 - __main__ - INFO - LLM 모델: ax
2025-10-22 11:52:30,702 - __main__ - INFO - 상품 데이터 크기: (22608, 9)
2025-10-22 11:52:30,702 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-22 11:52:30,702 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-22 11:52:30,702 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-22 11:52:30,702 - __main__ - INFO - 처리할 메시지 길이: 683 문자
2025-10-22 11:52:30,703 - __main__ - INFO - 매칭할 상품 별칭 수: 17022개
2025-10-22 11:52:31,360 - __main__ - INFO - 분할된 문장 수: 16개
2025-10-22 11:52:31,361 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'A. 에이닷 에서 알람 설정 선물 드려요 ', ' 고객님 안녕하세요 ']...
2025-10-22 11:52:31,375 - __main__ - INFO - 전체 토큰 수: 296개
2025-10-22 11:52:31,376 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '에이닷', '에이닷', '모닝콜', '에이닷', '에이닷', '기프티콘', '앤', '앨리스']
2025-10-22 11:52:31,376 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['앨리스', '에이닷', '기프티콘', '모닝콜']
2025-10-22 11:52:31,376 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-22 11:52:38,254 - __main__ - INFO - 퍼지 매칭 결과 크기: (2707, 3)
2025-10-22 11:52:38,255 - __main__ - INFO - 퍼지 매칭 성공: 2707개 결과
2025-10-22 11:52:38,256 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.4285714285714286}]
2025-10-22 11:52:38,256 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-22 11:52:38,325 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2707, 3)
2025-10-22 11:52:38,325 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.21818181818181817}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.34285714285714286}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.2857142857142857}]
2025-10-22 11:52:38,325 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-22 11:52:38,329 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 3개
2025-10-22 11:52:38,331 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-22 11:52:38,332 - __main__ - INFO - 통합된 후보 아이템 수: 3개
2025-10-22 11:52:38,336 - __main__ - INFO - 최종 후보 아이템 리스트: ['라이트 서비스', 'T 서비스', 'A. 전화']
2025-10-22 11:52:38,338 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (3, 2)
2025-10-22 11:52:38,338 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}, {'item_nm': '에이닷 전화', 'item_id': ['NA00004249']}]
2025-10-22 11:52:38,338 - utils - INFO - extract_entities_from_kiwi 실행완료: 7.64초
2025-10-22 11:52:38,338 - __main__ - INFO - 추출된 후보 엔티티: ['라이트 서비스', 'T 서비스', 'A. 전화']
2025-10-22 11:52:38,338 - __main__ - INFO - 매칭된 상품 정보: (3, 2)
2025-10-22 11:52:38,339 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-22 11:52:38,513 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-22 11:52:38,513 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-22 11:52:38,513 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 360 문자
2025-10-22 11:52:38,513 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-22 11:52:38,513 - __main__ - INFO - 후보 아이템 리스트 크기: 3개
2025-10-22 11:52:38,513 - __main__ - INFO - 후보 아이템 리스트: ['라이트 서비스', 'T 서비스', 'A. 전화']
2025-10-22 11:52:38,513 - __main__ - INFO - extra_item_pdf 크기: (3, 2)
2025-10-22 11:52:38,513 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-22 11:52:38,514 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-22 11:52:38,514 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-22 11:52:38,514 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-22 11:52:38,514 - __main__ - INFO - 구성된 프롬프트 길이: 6472 문자
2025-10-22 11:52:38,514 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-22 11:52:38,514 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-22 11:52:38,514 - __main__ - INFO - 📝 프롬프트 길이: 6,472 문자
2025-10-22 11:52:38,514 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-22 11:52:38,514 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-22 11:52:45,524 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-22 11:52:45,543 - __main__ - INFO - LLM 응답 길이: 802 문자
2025-10-22 11:52:45,543 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "A. (에이닷)에서 알람을 설정하면 선물을 드려요!",
    "purpose": [
        "이벤트 응모 유도",
        "경품 제공 안내"
    ],
    "product": [
        {
            "name": "A. (에이닷)",
            "action": "사용"
        },
        {
            "name": "A.알람",
            "action": "사용"
        }
    ],
    "channel": [
        {
            "type": "URL",
            "value": "http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr",
            "action": "추가 정보"
        },
  ...
2025-10-22 11:52:45,543 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-22 11:52:45,543 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-22 11:52:45,544 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-22 11:52:45,544 - __main__ - INFO - 파싱된 JSON 내용: {'title': 'A. (에이닷)에서 알람을 설정하면 선물을 드려요!', 'purpose': ['이벤트 응모 유도', '경품 제공 안내'], 'product': [{'name': 'A. (에이닷)', 'action': '사용'}, {'name': 'A.알람', 'action': '사용'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr', 'action': '추가 정보'}, {'type': '전화번호', 'value': '02-542-4920', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['사용법/혜택/이벤트안내_AI', '사용법/혜택/이벤트안내_SKT']}
2025-10-22 11:52:45,544 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-22 11:52:45,544 - __main__ - INFO - LLM 추출 엔티티: ['A. (에이닷)', 'A.알람']
2025-10-22 11:52:45,705 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-22 11:52:45,705 - __main__ - INFO - ============================================================
2025-10-22 11:52:45,705 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-22 11:52:45,705 - __main__ - INFO - ============================================================
2025-10-22 11:52:45,705 - __main__ - INFO - 제목: A. (에이닷)에서 알람을 설정하면 선물을 드려요!
2025-10-22 11:52:45,705 - __main__ - INFO - 목적: ['이벤트 응모 유도', '경품 제공 안내']
2025-10-22 11:52:45,705 - __main__ - INFO - 상품 수: 2개
2025-10-22 11:52:45,705 - __main__ - INFO - 채널 수: 3개
2025-10-22 11:52:45,705 - __main__ - INFO - 프로그램 수: 2개
2025-10-22 11:52:45,706 - utils - INFO - process_message 실행완료: 15.00초
2025-10-22 11:52:45,706 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-22 12:36:37,048 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-22 12:36:37,049 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-22 12:36:37,049 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-22 12:36:37,049 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-22 12:36:37,049 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-22 12:36:37,051 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-22 12:36:37,092 - __main__ - INFO - Using device: mps
2025-10-22 12:36:37,093 - utils - INFO - _initialize_device 실행완료: 0.04초
2025-10-22 12:36:37,093 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-22 12:36:37,093 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-22 12:36:37,093 - utils - INFO - _initialize_llm 실행완료: 0.00초
2025-10-22 12:36:37,093 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-22 12:36:37,093 - utils - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-22 12:36:37,093 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-22 12:36:37,093 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-22 12:36:37,619 - utils - INFO - Model loaded on mps
2025-10-22 12:36:37,620 - utils - INFO - _initialize_embedding_model 실행완료: 0.53초
2025-10-22 12:36:37,620 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-22 12:36:38,217 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-22 12:36:38,217 - utils - INFO - _initialize_kiwi 실행완료: 0.60초
2025-10-22 12:36:38,217 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-22 12:36:38,217 - __main__ - INFO - ============================================================
2025-10-22 12:36:38,217 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-22 12:36:38,217 - __main__ - INFO - ============================================================
2025-10-22 12:36:38,217 - __main__ - INFO - 데이터 소스 모드: local
2025-10-22 12:36:38,217 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-22 12:36:38,217 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-22 12:36:38,217 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-22 12:36:38,217 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-22 12:36:38,368 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-22 12:36:38,368 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-22 12:36:38,368 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-22 12:36:38,375 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-22 12:36:38,376 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-22 12:36:38,377 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-22 12:36:38,378 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-22 12:36:38,378 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-22 12:36:38,378 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-22 12:36:38,380 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-22 12:36:38,384 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-22 12:36:38,384 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-22 12:36:38,384 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-22 12:36:38,384 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-22 12:36:38,384 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-22 12:36:38,384 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-22 12:36:38,384 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-22 12:36:38,384 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-22 12:36:38,384 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-22 12:36:38,384 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-22 12:36:38,386 - __main__ - INFO - 로드된 별칭 규칙 수: 168개
2025-10-22 12:36:38,386 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-22 12:36:38,386 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-22 12:36:38,387 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-22 12:36:38,387 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-22 12:36:38,619 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-22 12:36:38,630 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22608
2025-10-22 12:36:38,630 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 넷플릭스 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증', '우주pass Netflix 인증']
2025-10-22 12:36:38,630 - __main__ - INFO - 별칭 규칙 적용 완료: 168개 규칙
2025-10-22 12:36:38,631 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22608, 9)
2025-10-22 12:36:38,631 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-22 12:36:38,632 - __main__ - INFO - 정지어 로드 완료: 171개
2025-10-22 12:36:38,632 - __main__ - INFO - 로드된 정지어 수: 171개
2025-10-22 12:36:38,632 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-22 12:36:38,632 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-22 12:36:38,633 - __main__ - INFO - 등록할 고유 별칭 수: 17022개
2025-10-22 12:36:38,635 - __main__ - INFO - 유효한 별칭 수: 17021개
2025-10-22 12:36:38,635 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 넷플릭스 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증', '우주pass Netflix 인증']
2025-10-22 12:36:38,655 - __main__ - INFO - Kiwi에 상품명 등록 완료: 17021개 성공, 0개 실패
2025-10-22 12:36:38,655 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-22 12:36:38,655 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-22 12:36:38,657 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-22 12:36:38,657 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-22 12:36:40,456 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-22 12:36:40,457 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-22 12:36:40,457 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-22 12:36:40,457 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-22 12:36:40,457 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-22 12:36:40,457 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-22 12:36:40,538 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-22 12:36:40,538 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-22 12:36:40,541 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-22 12:36:40,541 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-22 12:36:40,541 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-22 12:36:40,541 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-22 12:36:40,541 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-22 12:36:40,542 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-22 12:36:40,542 - __main__ - INFO - ============================================================
2025-10-22 12:36:40,542 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-22 12:36:40,542 - __main__ - INFO - ============================================================
2025-10-22 12:36:40,542 - __main__ - INFO - ✅ 상품 데이터: (22608, 9)
2025-10-22 12:36:40,542 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-22 12:36:40,542 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-22 12:36:40,542 - __main__ - INFO - ✅ 정지어: 171개
2025-10-22 12:36:40,542 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-22 12:36:40,543 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-22 12:36:40,545 - __main__ - INFO - 고유 별칭 수: 17021개
2025-10-22 12:36:40,547 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-22 12:36:40,547 - utils - INFO - _load_data 실행완료: 2.33초
2025-10-22 12:36:40,547 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-22 12:36:40,547 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-22 12:36:40,547 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A....
2025-10-22 12:36:40,547 - __main__ - INFO - ============================================================
2025-10-22 12:36:40,547 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-22 12:36:40,548 - __main__ - INFO - ============================================================
2025-10-22 12:36:40,548 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A. (에이닷)에서 알람을 설정하면 선물을 드려요!__#04 고객님, 안녕하세요.__모닝콜, 영양제 먹기, 애견 산책 등  매일 반복되는 일상을 최애 음악으로 알람 설정 해보세요~!__A.(에이닷)에서 알람을 등록하고 권한 설정하면 선물을 드립니다!__▶ 이벤트 자세히 보...
2025-10-22 12:36:40,548 - __main__ - INFO - 메시지 길이: 685 문자
2025-10-22 12:36:40,548 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-22 12:36:40,548 - __main__ - INFO - 데이터 소스: local
2025-10-22 12:36:40,548 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-22 12:36:40,548 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-22 12:36:40,548 - __main__ - INFO - LLM 모델: ax
2025-10-22 12:36:40,548 - __main__ - INFO - 상품 데이터 크기: (22608, 9)
2025-10-22 12:36:40,548 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-22 12:36:40,548 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-22 12:36:40,548 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-22 12:36:40,548 - __main__ - INFO - 처리할 메시지 길이: 683 문자
2025-10-22 12:36:40,549 - __main__ - INFO - 매칭할 상품 별칭 수: 17022개
2025-10-22 12:36:41,212 - __main__ - INFO - 분할된 문장 수: 16개
2025-10-22 12:36:41,213 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'A. 에이닷 에서 알람 설정 선물 드려요 ', ' 고객님 안녕하세요 ']...
2025-10-22 12:36:41,226 - __main__ - INFO - 전체 토큰 수: 296개
2025-10-22 12:36:41,227 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '에이닷', '에이닷', '모닝콜', '에이닷', '에이닷', '기프티콘', '앤', '앨리스']
2025-10-22 12:36:41,227 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['기프티콘', '에이닷', '모닝콜', '앨리스']
2025-10-22 12:36:41,227 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-22 12:36:49,686 - __main__ - INFO - 퍼지 매칭 결과 크기: (2707, 3)
2025-10-22 12:36:49,686 - __main__ - INFO - 퍼지 매칭 성공: 2707개 결과
2025-10-22 12:36:49,688 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.4285714285714286}]
2025-10-22 12:36:49,688 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-22 12:36:49,760 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2707, 3)
2025-10-22 12:36:49,761 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.21818181818181817}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.34285714285714286}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.24285714285714283}]
2025-10-22 12:36:49,761 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-22 12:36:49,766 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 3개
2025-10-22 12:36:49,769 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-22 12:36:49,770 - __main__ - INFO - 통합된 후보 아이템 수: 3개
2025-10-22 12:36:49,774 - __main__ - INFO - 최종 후보 아이템 리스트: ['라이트 서비스', 'T 서비스', 'A. 전화']
2025-10-22 12:36:49,776 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (3, 2)
2025-10-22 12:36:49,776 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}, {'item_nm': '에이닷 전화', 'item_id': ['NA00004249']}]
2025-10-22 12:36:49,777 - utils - INFO - extract_entities_from_kiwi 실행완료: 9.23초
2025-10-22 12:36:49,777 - __main__ - INFO - 추출된 후보 엔티티: ['라이트 서비스', 'T 서비스', 'A. 전화']
2025-10-22 12:36:49,777 - __main__ - INFO - 매칭된 상품 정보: (3, 2)
2025-10-22 12:36:49,777 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-22 12:36:50,877 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-22 12:36:50,877 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-22 12:36:50,877 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 360 문자
2025-10-22 12:36:50,877 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-22 12:36:50,877 - __main__ - INFO - 후보 아이템 리스트 크기: 3개
2025-10-22 12:36:50,877 - __main__ - INFO - 후보 아이템 리스트: ['라이트 서비스', 'T 서비스', 'A. 전화']
2025-10-22 12:36:50,877 - __main__ - INFO - extra_item_pdf 크기: (3, 2)
2025-10-22 12:36:50,877 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-22 12:36:50,878 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-22 12:36:50,878 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-22 12:36:50,878 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-22 12:36:50,878 - __main__ - INFO - 구성된 프롬프트 길이: 6472 문자
2025-10-22 12:36:50,878 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-22 12:36:50,878 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-22 12:36:50,878 - __main__ - INFO - 📝 프롬프트 길이: 6,472 문자
2025-10-22 12:36:50,878 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-22 12:36:50,878 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-22 12:36:57,395 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-22 12:36:57,416 - __main__ - INFO - LLM 응답 길이: 802 문자
2025-10-22 12:36:57,416 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "A. (에이닷)에서 알람을 설정하면 선물을 드려요!",
    "purpose": [
        "이벤트 응모 유도",
        "경품 제공 안내"
    ],
    "product": [
        {
            "name": "A. (에이닷)",
            "action": "사용"
        },
        {
            "name": "A.알람",
            "action": "사용"
        }
    ],
    "channel": [
        {
            "type": "URL",
            "value": "http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr",
            "action": "추가 정보"
        },
  ...
2025-10-22 12:36:57,417 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-22 12:36:57,417 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-22 12:36:57,417 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-22 12:36:57,417 - __main__ - INFO - 파싱된 JSON 내용: {'title': 'A. (에이닷)에서 알람을 설정하면 선물을 드려요!', 'purpose': ['이벤트 응모 유도', '경품 제공 안내'], 'product': [{'name': 'A. (에이닷)', 'action': '사용'}, {'name': 'A.알람', 'action': '사용'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr', 'action': '추가 정보'}, {'type': '전화번호', 'value': '02-542-4920', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['사용법/혜택/이벤트안내_AI', '사용법/혜택/이벤트안내_SKT']}
2025-10-22 12:36:57,417 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-22 12:36:57,417 - __main__ - INFO - LLM 추출 엔티티: ['A. (에이닷)', 'A.알람']
2025-10-22 12:36:57,418 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-10-22 12:36:57,418 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 3,100 문자
2025-10-22 12:36:57,419 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-10-22 12:36:57,419 - __main__ - INFO - 📝 프롬프트 길이: 3,100 문자
2025-10-22 12:36:57,419 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-10-22 12:36:57,419 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-10-22 12:36:57,419 - __main__ - INFO - 🔄 1개 LLM 모델로 엔티티 추출 시작
2025-10-22 12:36:57,419 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-22 12:36:57,419 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-22 12:36:57,419 - __main__ - INFO - 🔍 메시지 길이: 683 문자
2025-10-22 12:37:00,868 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-22 12:37:00,869 - __main__ - INFO - ✅ LLM 추출 완료: ['A.', 'A. 알람 챌린지', 'A.알람', 'CU 빙그레 바나나우유 기프티콘']
2025-10-22 12:37:01,132 - __main__ - ERROR - 결합 유사도 계산 실패: DataFrame.reset_index() got an unexpected keyword argument 'name'
2025-10-22 12:37:01,132 - utils - INFO - extract_entities_by_llm 실행완료: 3.71초
2025-10-22 12:37:01,133 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-22 12:37:01,133 - __main__ - INFO - ============================================================
2025-10-22 12:37:01,133 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-22 12:37:01,133 - __main__ - INFO - ============================================================
2025-10-22 12:37:01,133 - __main__ - INFO - 제목: A. (에이닷)에서 알람을 설정하면 선물을 드려요!
2025-10-22 12:37:01,134 - __main__ - INFO - 목적: ['이벤트 응모 유도', '경품 제공 안내']
2025-10-22 12:37:01,134 - __main__ - INFO - 상품 수: 2개
2025-10-22 12:37:01,134 - __main__ - INFO - 채널 수: 3개
2025-10-22 12:37:01,134 - __main__ - INFO - 프로그램 수: 2개
2025-10-22 12:37:01,134 - utils - INFO - process_message 실행완료: 20.59초
2025-10-22 12:37:01,134 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-22 12:38:23,090 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-22 12:38:23,090 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-22 12:38:23,090 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-22 12:38:23,090 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-22 12:38:23,090 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-22 12:38:23,092 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-22 12:38:23,125 - __main__ - INFO - Using device: mps
2025-10-22 12:38:23,125 - utils - INFO - _initialize_device 실행완료: 0.03초
2025-10-22 12:38:23,125 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-22 12:38:23,125 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-22 12:38:23,125 - utils - INFO - _initialize_llm 실행완료: 0.00초
2025-10-22 12:38:23,125 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-22 12:38:23,125 - utils - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-22 12:38:23,126 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-22 12:38:23,126 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-22 12:38:23,575 - utils - INFO - Model loaded on mps
2025-10-22 12:38:23,575 - utils - INFO - _initialize_embedding_model 실행완료: 0.45초
2025-10-22 12:38:23,575 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-22 12:38:24,190 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-22 12:38:24,190 - utils - INFO - _initialize_kiwi 실행완료: 0.61초
2025-10-22 12:38:24,191 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-22 12:38:24,191 - __main__ - INFO - ============================================================
2025-10-22 12:38:24,191 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-22 12:38:24,191 - __main__ - INFO - ============================================================
2025-10-22 12:38:24,191 - __main__ - INFO - 데이터 소스 모드: local
2025-10-22 12:38:24,191 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-22 12:38:24,191 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-22 12:38:24,191 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-22 12:38:24,191 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-22 12:38:24,337 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-22 12:38:24,337 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-22 12:38:24,337 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-22 12:38:24,344 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-22 12:38:24,345 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-22 12:38:24,345 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-22 12:38:24,346 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-22 12:38:24,346 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-22 12:38:24,347 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-22 12:38:24,348 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-22 12:38:24,352 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-22 12:38:24,352 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-22 12:38:24,352 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-22 12:38:24,353 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-22 12:38:24,353 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-22 12:38:24,353 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-22 12:38:24,353 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-22 12:38:24,353 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-22 12:38:24,353 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-22 12:38:24,353 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-22 12:38:24,355 - __main__ - INFO - 로드된 별칭 규칙 수: 168개
2025-10-22 12:38:24,355 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-22 12:38:24,355 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-22 12:38:24,355 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-22 12:38:24,356 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-22 12:38:24,578 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-22 12:38:24,588 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22608
2025-10-22 12:38:24,588 - __main__ - INFO - 별칭 적용 후 샘플: ['우주PASS Netflix 인증', '우주패스 넷플릭스 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증']
2025-10-22 12:38:24,588 - __main__ - INFO - 별칭 규칙 적용 완료: 168개 규칙
2025-10-22 12:38:24,589 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22608, 9)
2025-10-22 12:38:24,589 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-22 12:38:24,590 - __main__ - INFO - 정지어 로드 완료: 171개
2025-10-22 12:38:24,590 - __main__ - INFO - 로드된 정지어 수: 171개
2025-10-22 12:38:24,590 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-22 12:38:24,590 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-22 12:38:24,591 - __main__ - INFO - 등록할 고유 별칭 수: 17022개
2025-10-22 12:38:24,593 - __main__ - INFO - 유효한 별칭 수: 17021개
2025-10-22 12:38:24,593 - __main__ - INFO - 등록할 별칭 샘플: ['우주PASS Netflix 인증', '우주패스 넷플릭스 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증']
2025-10-22 12:38:24,614 - __main__ - INFO - Kiwi에 상품명 등록 완료: 17021개 성공, 0개 실패
2025-10-22 12:38:24,614 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-22 12:38:24,614 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-22 12:38:24,616 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-22 12:38:24,616 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-22 12:38:24,871 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-22 12:38:24,871 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-22 12:38:24,871 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-22 12:38:24,871 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-22 12:38:24,871 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-22 12:38:24,871 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-22 12:38:24,957 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-22 12:38:24,957 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-22 12:38:24,959 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-22 12:38:24,960 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-22 12:38:24,960 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-22 12:38:24,960 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-22 12:38:24,960 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-22 12:38:24,960 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-22 12:38:24,960 - __main__ - INFO - ============================================================
2025-10-22 12:38:24,961 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-22 12:38:24,961 - __main__ - INFO - ============================================================
2025-10-22 12:38:24,961 - __main__ - INFO - ✅ 상품 데이터: (22608, 9)
2025-10-22 12:38:24,961 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-22 12:38:24,961 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-22 12:38:24,961 - __main__ - INFO - ✅ 정지어: 171개
2025-10-22 12:38:24,961 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-22 12:38:24,962 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-22 12:38:24,964 - __main__ - INFO - 고유 별칭 수: 17021개
2025-10-22 12:38:24,966 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-22 12:38:24,966 - utils - INFO - _load_data 실행완료: 0.78초
2025-10-22 12:38:24,966 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-22 12:38:24,966 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-22 12:38:24,966 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A....
2025-10-22 12:38:24,966 - __main__ - INFO - ============================================================
2025-10-22 12:38:24,966 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-22 12:38:24,966 - __main__ - INFO - ============================================================
2025-10-22 12:38:24,966 - __main__ - INFO - 메시지 내용: 
[SK텔레콤] A. (에이닷)에서 알람을 설정하면 선물을 드려요!
(광고)[SKT] A. (에이닷)에서 알람을 설정하면 선물을 드려요!__#04 고객님, 안녕하세요.__모닝콜, 영양제 먹기, 애견 산책 등  매일 반복되는 일상을 최애 음악으로 알람 설정 해보세요~!__A.(에이닷)에서 알람을 등록하고 권한 설정하면 선물을 드립니다!__▶ 이벤트 자세히 보...
2025-10-22 12:38:24,966 - __main__ - INFO - 메시지 길이: 685 문자
2025-10-22 12:38:24,966 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-22 12:38:24,966 - __main__ - INFO - 데이터 소스: local
2025-10-22 12:38:24,966 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-22 12:38:24,967 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-22 12:38:24,967 - __main__ - INFO - LLM 모델: ax
2025-10-22 12:38:24,967 - __main__ - INFO - 상품 데이터 크기: (22608, 9)
2025-10-22 12:38:24,967 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-22 12:38:24,967 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-22 12:38:24,967 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-22 12:38:24,967 - __main__ - INFO - 처리할 메시지 길이: 683 문자
2025-10-22 12:38:24,968 - __main__ - INFO - 매칭할 상품 별칭 수: 17022개
2025-10-22 12:38:25,615 - __main__ - INFO - 분할된 문장 수: 16개
2025-10-22 12:38:25,616 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'A. 에이닷 에서 알람 설정 선물 드려요 ', ' 고객님 안녕하세요 ']...
2025-10-22 12:38:25,631 - __main__ - INFO - 전체 토큰 수: 296개
2025-10-22 12:38:25,631 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '에이닷', '에이닷', '모닝콜', '에이닷', '에이닷', '기프티콘', '앤', '앨리스']
2025-10-22 12:38:25,631 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['앨리스', '모닝콜', '기프티콘', '에이닷']
2025-10-22 12:38:25,631 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-22 12:38:32,358 - __main__ - INFO - 퍼지 매칭 결과 크기: (2707, 3)
2025-10-22 12:38:32,359 - __main__ - INFO - 퍼지 매칭 성공: 2707개 결과
2025-10-22 12:38:32,360 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.4}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.4285714285714286}]
2025-10-22 12:38:32,360 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-22 12:38:32,433 - __main__ - INFO - 시퀀스 유사도 결과 크기: (2707, 3)
2025-10-22 12:38:32,434 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'ZEM플랜 smart', 'sim': 0.21818181818181817}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': 'smart홈원', 'sim': 0.34285714285714286}, {'sent': ' SK텔레콤 A. 에이닷 에서 알람 설정 선물 드려요 광고 SKT ', 'item_nm_alias': '라이트 서비스', 'sim': 0.24285714285714283}]
2025-10-22 12:38:32,434 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-22 12:38:32,438 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 3개
2025-10-22 12:38:32,440 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 0개
2025-10-22 12:38:32,441 - __main__ - INFO - 통합된 후보 아이템 수: 3개
2025-10-22 12:38:32,445 - __main__ - INFO - 최종 후보 아이템 리스트: ['라이트 서비스', 'T 서비스', 'A. 전화']
2025-10-22 12:38:32,448 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (3, 2)
2025-10-22 12:38:32,448 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}, {'item_nm': '에이닷 전화', 'item_id': ['NA00004249']}]
2025-10-22 12:38:32,448 - utils - INFO - extract_entities_from_kiwi 실행완료: 7.48초
2025-10-22 12:38:32,448 - __main__ - INFO - 추출된 후보 엔티티: ['라이트 서비스', 'T 서비스', 'A. 전화']
2025-10-22 12:38:32,448 - __main__ - INFO - 매칭된 상품 정보: (3, 2)
2025-10-22 12:38:32,449 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-22 12:38:32,773 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-22 12:38:32,773 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-22 12:38:32,773 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 360 문자
2025-10-22 12:38:32,773 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-22 12:38:32,773 - __main__ - INFO - 후보 아이템 리스트 크기: 3개
2025-10-22 12:38:32,773 - __main__ - INFO - 후보 아이템 리스트: ['라이트 서비스', 'T 서비스', 'A. 전화']
2025-10-22 12:38:32,773 - __main__ - INFO - extra_item_pdf 크기: (3, 2)
2025-10-22 12:38:32,773 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-22 12:38:32,773 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'Lite 서비스', 'item_id': ['NM00000061']}, {'item_nm': 'T 서비스', 'item_id': ['NA00003911']}]
2025-10-22 12:38:32,773 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-22 12:38:32,773 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-22 12:38:32,773 - __main__ - INFO - 구성된 프롬프트 길이: 6472 문자
2025-10-22 12:38:32,773 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-22 12:38:32,773 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-22 12:38:32,773 - __main__ - INFO - 📝 프롬프트 길이: 6,472 문자
2025-10-22 12:38:32,774 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-22 12:38:32,774 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-22 12:38:38,931 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-22 12:38:38,951 - __main__ - INFO - LLM 응답 길이: 802 문자
2025-10-22 12:38:38,951 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "A. (에이닷)에서 알람을 설정하면 선물을 드려요!",
    "purpose": [
        "이벤트 응모 유도",
        "경품 제공 안내"
    ],
    "product": [
        {
            "name": "A. (에이닷)",
            "action": "사용"
        },
        {
            "name": "A.알람",
            "action": "사용"
        }
    ],
    "channel": [
        {
            "type": "URL",
            "value": "http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr",
            "action": "추가 정보"
        },
  ...
2025-10-22 12:38:38,951 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-22 12:38:38,952 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-22 12:38:38,952 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-22 12:38:38,952 - __main__ - INFO - 파싱된 JSON 내용: {'title': 'A. (에이닷)에서 알람을 설정하면 선물을 드려요!', 'purpose': ['이벤트 응모 유도', '경품 제공 안내'], 'product': [{'name': 'A. (에이닷)', 'action': '사용'}, {'name': 'A.알람', 'action': '사용'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&s=19398&a=&u=https://my-adot.onelink.me/MAbS/u44wyymr', 'action': '추가 정보'}, {'type': '전화번호', 'value': '02-542-4920', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['사용법/혜택/이벤트안내_AI', '사용법/혜택/이벤트안내_SKT']}
2025-10-22 12:38:38,952 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-22 12:38:38,952 - __main__ - INFO - LLM 추출 엔티티: ['A. (에이닷)', 'A.알람']
2025-10-22 12:38:38,953 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-10-22 12:38:38,953 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 3,100 문자
2025-10-22 12:38:38,953 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-10-22 12:38:38,953 - __main__ - INFO - 📝 프롬프트 길이: 3,100 문자
2025-10-22 12:38:38,953 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-10-22 12:38:38,953 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-10-22 12:38:38,953 - __main__ - INFO - 🔄 1개 LLM 모델로 엔티티 추출 시작
2025-10-22 12:38:38,953 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-22 12:38:38,953 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-22 12:38:38,954 - __main__ - INFO - 🔍 메시지 길이: 683 문자
2025-10-22 12:38:40,483 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-22 12:38:40,487 - __main__ - INFO - ✅ LLM 추출 완료: ['A.', 'A. 알람 챌린지', 'A.알람', '에이닷']
2025-10-22 12:38:40,776 - utils - INFO - extract_entities_by_llm 실행완료: 1.82초
2025-10-22 12:38:40,781 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-22 12:38:40,781 - __main__ - INFO - ============================================================
2025-10-22 12:38:40,781 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-22 12:38:40,781 - __main__ - INFO - ============================================================
2025-10-22 12:38:40,781 - __main__ - INFO - 제목: A. (에이닷)에서 알람을 설정하면 선물을 드려요!
2025-10-22 12:38:40,781 - __main__ - INFO - 목적: ['이벤트 응모 유도', '경품 제공 안내']
2025-10-22 12:38:40,781 - __main__ - INFO - 상품 수: 1개
2025-10-22 12:38:40,781 - __main__ - INFO - 채널 수: 3개
2025-10-22 12:38:40,781 - __main__ - INFO - 프로그램 수: 2개
2025-10-22 12:38:40,782 - utils - INFO - process_message 실행완료: 15.82초
2025-10-22 12:38:40,782 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-22 12:38:41,570 - mongodb_utils - INFO - MongoDB 연결 성공: aos.mmsext
2025-10-22 12:38:41,573 - mongodb_utils - INFO - 문서 저장 성공: 68f851c132017ba7eb350cb2
2025-10-22 12:38:41,575 - mongodb_utils - INFO - MongoDB 연결 해제
2025-10-22 15:04:27,739 - __main__ - INFO - MMS 추출기 초기화 중...
2025-10-22 15:04:27,740 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-10-22 15:04:27,740 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-10-22 15:04:27,740 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-10-22 15:04:27,740 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-10-22 15:04:27,742 - __main__ - INFO - 💻 디바이스 설정 중...
2025-10-22 15:04:27,784 - __main__ - INFO - Using device: mps
2025-10-22 15:04:27,784 - utils - INFO - _initialize_device 실행완료: 0.04초
2025-10-22 15:04:27,784 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-10-22 15:04:27,785 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-10-22 15:04:27,785 - utils - INFO - _initialize_llm 실행완료: 0.00초
2025-10-22 15:04:27,785 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-10-22 15:04:27,785 - utils - INFO - Loading model from ./models/ko-sbert-nli...
2025-10-22 15:04:27,785 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-10-22 15:04:27,785 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-10-22 15:04:28,348 - utils - INFO - Model loaded on mps
2025-10-22 15:04:28,349 - utils - INFO - _initialize_embedding_model 실행완료: 0.56초
2025-10-22 15:04:28,349 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-10-22 15:04:28,975 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-10-22 15:04:28,975 - utils - INFO - _initialize_kiwi 실행완료: 0.63초
2025-10-22 15:04:28,975 - __main__ - INFO - 📁 데이터 로드 중...
2025-10-22 15:04:28,975 - __main__ - INFO - ============================================================
2025-10-22 15:04:28,975 - __main__ - INFO - 📊 데이터 로딩 시작
2025-10-22 15:04:28,975 - __main__ - INFO - ============================================================
2025-10-22 15:04:28,975 - __main__ - INFO - 데이터 소스 모드: local
2025-10-22 15:04:28,975 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-10-22 15:04:28,975 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-10-22 15:04:28,975 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-10-22 15:04:28,976 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-22 15:04:29,129 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-10-22 15:04:29,129 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-22 15:04:29,129 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-10-22 15:04:29,136 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-10-22 15:04:29,137 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-10-22 15:04:29,138 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-22 15:04:29,139 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-22 15:04:29,139 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-10-22 15:04:29,139 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-10-22 15:04:29,146 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-10-22 15:04:29,150 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-10-22 15:04:29,150 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-10-22 15:04:29,150 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-22 15:04:29,150 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-10-22 15:04:29,150 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-10-22 15:04:29,151 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-10-22 15:04:29,151 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-22 15:04:29,151 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-10-22 15:04:29,151 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-10-22 15:04:29,151 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-10-22 15:04:29,156 - __main__ - INFO - 로드된 별칭 규칙 수: 168개
2025-10-22 15:04:29,157 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-10-22 15:04:29,157 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-22 15:04:29,157 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-10-22 15:04:29,157 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-10-22 15:04:29,375 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-10-22 15:04:29,385 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22608
2025-10-22 15:04:29,386 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증', '우주pass Netflix 인증']
2025-10-22 15:04:29,386 - __main__ - INFO - 별칭 규칙 적용 완료: 168개 규칙
2025-10-22 15:04:29,386 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22608, 9)
2025-10-22 15:04:29,386 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-10-22 15:04:29,387 - __main__ - INFO - 정지어 로드 완료: 176개
2025-10-22 15:04:29,387 - __main__ - INFO - 로드된 정지어 수: 176개
2025-10-22 15:04:29,387 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-10-22 15:04:29,387 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-10-22 15:04:29,389 - __main__ - INFO - 등록할 고유 별칭 수: 17022개
2025-10-22 15:04:29,390 - __main__ - INFO - 유효한 별칭 수: 17021개
2025-10-22 15:04:29,390 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증', '우주pass Netflix 인증']
2025-10-22 15:04:29,410 - __main__ - INFO - Kiwi에 상품명 등록 완료: 17021개 성공, 0개 실패
2025-10-22 15:04:29,410 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-10-22 15:04:29,411 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-10-22 15:04:29,424 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-10-22 15:04:29,424 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-10-22 15:04:29,730 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-10-22 15:04:29,730 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-10-22 15:04:29,730 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-10-22 15:04:29,730 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-10-22 15:04:29,730 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-10-22 15:04:29,730 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-10-22 15:04:29,810 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-10-22 15:04:29,810 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-10-22 15:04:29,813 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-10-22 15:04:29,813 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-10-22 15:04:29,813 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-10-22 15:04:29,813 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-10-22 15:04:29,813 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-10-22 15:04:29,814 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-10-22 15:04:29,814 - __main__ - INFO - ============================================================
2025-10-22 15:04:29,814 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-10-22 15:04:29,814 - __main__ - INFO - ============================================================
2025-10-22 15:04:29,814 - __main__ - INFO - ✅ 상품 데이터: (22608, 9)
2025-10-22 15:04:29,814 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-10-22 15:04:29,814 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-10-22 15:04:29,814 - __main__ - INFO - ✅ 정지어: 176개
2025-10-22 15:04:29,814 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-10-22 15:04:29,815 - __main__ - INFO - 고유 상품명 수: 6586개
2025-10-22 15:04:29,817 - __main__ - INFO - 고유 별칭 수: 17021개
2025-10-22 15:04:29,819 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-10-22 15:04:29,819 - utils - INFO - _load_data 실행완료: 0.84초
2025-10-22 15:04:29,819 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-10-22 15:04:29,819 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-10-22 15:04:29,820 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
'[SK텔레콤] 30만개의 콘텐츠가 고객님을 기다리고 있어요!
' +
    '(광고)[...
2025-10-22 15:04:29,820 - __main__ - INFO - ============================================================
2025-10-22 15:04:29,820 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-10-22 15:04:29,820 - __main__ - INFO - ============================================================
2025-10-22 15:04:29,820 - __main__ - INFO - 메시지 내용: 
'[SK텔레콤] 30만개의 콘텐츠가 고객님을 기다리고 있어요!
' +
    '(광고)[SKT] #04 고객님, 안녕하세요.__가입하신 T우주 wavve 혜택 100% 즐기고 계신가요?__지금 바로 wavve에서 드라마/예능/해외시리즈/영화 까지!_30만편의 콘텐츠를 무제한 감상해보세요!__■인기 드라마 보기_http://t-mms.kr/t.do?m=#6...
2025-10-22 15:04:29,820 - __main__ - INFO - 메시지 길이: 588 문자
2025-10-22 15:04:29,820 - __main__ - INFO - === 현재 추출기 설정 ===
2025-10-22 15:04:29,820 - __main__ - INFO - 데이터 소스: local
2025-10-22 15:04:29,820 - __main__ - INFO - 상품 정보 추출 모드: llm
2025-10-22 15:04:29,820 - __main__ - INFO - 엔티티 추출 모드: llm
2025-10-22 15:04:29,820 - __main__ - INFO - LLM 모델: ax
2025-10-22 15:04:29,820 - __main__ - INFO - 상품 데이터 크기: (22608, 9)
2025-10-22 15:04:29,820 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-10-22 15:04:29,820 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-10-22 15:04:29,820 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-10-22 15:04:29,820 - __main__ - INFO - 처리할 메시지 길이: 586 문자
2025-10-22 15:04:29,821 - __main__ - INFO - 매칭할 상품 별칭 수: 17022개
2025-10-22 15:04:30,467 - __main__ - INFO - 분할된 문장 수: 16개
2025-10-22 15:04:30,468 - __main__ - INFO - 필터링된 문장들: [' SK텔레콤 30만개의 콘텐츠가 고객님 있어요 ', ' 광고 SKT 고객님 안녕하세요 ', '가입하신 T우주 wavve 혜택 100 계신가요 ']...
2025-10-22 15:04:30,476 - __main__ - INFO - 전체 토큰 수: 173개
2025-10-22 15:04:30,477 - __main__ - INFO - NNP 태그 토큰들: ['SK텔레콤', '영화', '코로나']
2025-10-22 15:04:30,477 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['영화', '코로나']
2025-10-22 15:04:30,477 - __main__ - INFO - 퍼지 매칭 시작...
2025-10-22 15:04:37,440 - __main__ - INFO - 퍼지 매칭 결과 크기: (3145, 3)
2025-10-22 15:04:37,441 - __main__ - INFO - 퍼지 매칭 성공: 3145개 결과
2025-10-22 15:04:37,443 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' SK텔레콤 30만개의 콘텐츠가 고객님 있어요 ', 'item_nm_alias': '뉴스콤 관제30', 'sim': 0.5}, {'sent': ' SK텔레콤 30만개의 콘텐츠가 고객님 있어요 ', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' SK텔레콤 30만개의 콘텐츠가 고객님 있어요 ', 'item_nm_alias': 'V30클럽', 'sim': 0.4}]
2025-10-22 15:04:37,443 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-10-22 15:04:37,518 - __main__ - INFO - 시퀀스 유사도 결과 크기: (3145, 3)
2025-10-22 15:04:37,519 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' SK텔레콤 30만개의 콘텐츠가 고객님 있어요 ', 'item_nm_alias': '뉴스콤 관제30', 'sim': 0.39999999999999997}, {'sent': ' SK텔레콤 30만개의 콘텐츠가 고객님 있어요 ', 'item_nm_alias': '노트7고객', 'sim': 0.31999999999999995}, {'sent': ' SK텔레콤 30만개의 콘텐츠가 고객님 있어요 ', 'item_nm_alias': 'V30클럽', 'sim': 0.31999999999999995}]
2025-10-22 15:04:37,519 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-10-22 15:04:37,523 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 4개
2025-10-22 15:04:37,526 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 1개
2025-10-22 15:04:37,526 - __main__ - INFO - 통합된 후보 아이템 수: 5개
2025-10-22 15:04:37,530 - __main__ - INFO - 최종 후보 아이템 리스트: ['영화', 'A. 전화 연결', 'B tv 혜택', 'A. 전화']
2025-10-22 15:04:37,533 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (4, 2)
2025-10-22 15:04:37,533 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'B tv 혜택', 'item_id': ['PR00000374']}, {'item_nm': '에이닷 전화', 'item_id': ['NA00004249']}, {'item_nm': '에이닷 전화 연결', 'item_id': ['NA00009055']}]
2025-10-22 15:04:37,534 - utils - INFO - extract_entities_from_kiwi 실행완료: 7.71초
2025-10-22 15:04:37,534 - __main__ - INFO - 추출된 후보 엔티티: ['영화', 'A. 전화 연결', 'B tv 혜택', 'A. 전화']
2025-10-22 15:04:37,534 - __main__ - INFO - 매칭된 상품 정보: (4, 2)
2025-10-22 15:04:37,534 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-10-22 15:04:38,034 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-10-22 15:04:38,034 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-10-22 15:04:38,035 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 423 문자
2025-10-22 15:04:38,035 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-10-22 15:04:38,035 - __main__ - INFO - 후보 아이템 리스트 크기: 4개
2025-10-22 15:04:38,035 - __main__ - INFO - 후보 아이템 리스트: ['영화', 'A. 전화 연결', 'B tv 혜택', 'A. 전화']
2025-10-22 15:04:38,035 - __main__ - INFO - extra_item_pdf 크기: (4, 2)
2025-10-22 15:04:38,035 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-10-22 15:04:38,035 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'B tv 혜택', 'item_id': ['PR00000374']}, {'item_nm': '에이닷 전화', 'item_id': ['NA00004249']}]
2025-10-22 15:04:38,035 - __main__ - INFO - LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
2025-10-22 15:04:38,035 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-10-22 15:04:38,035 - __main__ - INFO - 구성된 프롬프트 길이: 6447 문자
2025-10-22 15:04:38,035 - __main__ - INFO - RAG 컨텍스트 포함 여부: True
2025-10-22 15:04:38,035 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-10-22 15:04:38,035 - __main__ - INFO - 📝 프롬프트 길이: 6,447 문자
2025-10-22 15:04:38,035 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-10-22 15:04:38,035 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-10-22 15:04:49,224 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-22 15:04:49,248 - __main__ - INFO - LLM 응답 길이: 1516 문자
2025-10-22 15:04:49,248 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "[SKT] #04 고객님, 안녕하세요.__가입하신 T우주 wavve 혜택 100% 즐기고 계신가요?__지금 바로 wavve에서 드라마/예능/해외시리즈/영화 까지!_30만편의 콘텐츠를 무제한 감상해보세요!__",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "웹/앱 접속 유도"
    ],
    "product": [
        {
            "name": "T우주 wavve",
            "action": "가입"
        },
        {
            "name": "드라마",
            "action": "사용"
        },
        {
            "name": "예능",
            "action": "사용"
        },
        {
            "name": ...
2025-10-22 15:04:49,248 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-10-22 15:04:49,249 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-10-22 15:04:49,249 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-10-22 15:04:49,249 - __main__ - INFO - 파싱된 JSON 내용: {'title': '[SKT] #04 고객님, 안녕하세요.__가입하신 T우주 wavve 혜택 100% 즐기고 계신가요?__지금 바로 wavve에서 드라마/예능/해외시리즈/영화 까지!_30만편의 콘텐츠를 무제한 감상해보세요!__', 'purpose': ['상품 가입 유도', '혜택 안내', '웹/앱 접속 유도'], 'product': [{'name': 'T우주 wavve', 'action': '가입'}, {'name': '드라마', 'action': '사용'}, {'name': '예능', 'action': '사용'}, {'name': '해외시리즈', 'action': '사용'}, {'name': '영화', 'action': '사용'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&s=11234&a=&u=https://link.wavve.com/list/VN4?came=home', 'action': '추가 정보'}, {'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&s=11235&a=&u=https://link.wavve.com/list/VN3?came=home', 'action': '추가 정보'}, {'type': 'URL', 'value': 'http://t-mms.kr/t.do?m=#61&s=11236&a=&u=https://link.wavve.com/list/EN713?came=HOME', 'action': '추가 정보'}, {'type': '전화번호', 'value': 'SKT 구독상품 전담 고객센터(1505, 무료)', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['상품및부가서비스가입유도_구독', '사용법/혜택/이벤트안내_구독']}
2025-10-22 15:04:49,250 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-10-22 15:04:49,250 - __main__ - INFO - LLM 추출 엔티티: ['T우주 wavve', '드라마', '예능', '해외시리즈', '영화']
2025-10-22 15:04:49,251 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-10-22 15:04:49,251 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 3,003 문자
2025-10-22 15:04:49,251 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-10-22 15:04:49,251 - __main__ - INFO - 📝 프롬프트 길이: 3,003 문자
2025-10-22 15:04:49,251 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-10-22 15:04:49,251 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-10-22 15:04:49,251 - __main__ - INFO - 🔄 1개 LLM 모델로 엔티티 추출 시작
2025-10-22 15:04:49,251 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-10-22 15:04:49,251 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-10-22 15:04:49,251 - __main__ - INFO - 🔍 메시지 길이: 586 문자
2025-10-22 15:04:50,955 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-22 15:04:50,958 - __main__ - INFO - ✅ LLM 추출 완료: ['T우주 wavve', 'wavve']
2025-10-22 15:04:51,090 - utils - INFO - extract_entities_by_llm 실행완료: 1.84초
2025-10-22 15:04:51,096 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-10-22 15:04:51,096 - __main__ - INFO - ============================================================
2025-10-22 15:04:51,096 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-10-22 15:04:51,096 - __main__ - INFO - ============================================================
2025-10-22 15:04:51,096 - __main__ - INFO - 제목: [SKT] #04 고객님, 안녕하세요.__가입하신 T우주 wavve 혜택 100% 즐기고 계신가요?__지금 바로 wavve에서 드라마/예능/해외시리즈/영화 까지!_30만편의 콘텐츠를 무제한 감상해보세요!__
2025-10-22 15:04:51,096 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '웹/앱 접속 유도']
2025-10-22 15:04:51,096 - __main__ - INFO - 상품 수: 1개
2025-10-22 15:04:51,096 - __main__ - INFO - 채널 수: 5개
2025-10-22 15:04:51,096 - __main__ - INFO - 프로그램 수: 2개
2025-10-22 15:04:51,096 - utils - INFO - process_message 실행완료: 21.28초
2025-10-22 15:04:51,096 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-10-22 15:04:51,840 - mongodb_utils - INFO - MongoDB 연결 성공: aos.mmsext
2025-10-22 15:04:51,843 - mongodb_utils - INFO - 문서 저장 성공: 68f87403d6dc078458340cd1
2025-10-22 15:04:51,845 - mongodb_utils - INFO - MongoDB 연결 해제
