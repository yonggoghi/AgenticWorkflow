2025-09-11 11:29:38,937 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-11 11:29:38,937 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-11 11:29:38,937 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-11 11:29:38,937 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-09-11 11:29:38,937 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-11 11:29:38,938 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-11 11:29:38,957 - __main__ - INFO - Using device: mps
2025-09-11 11:29:38,957 - __main__ - INFO - _initialize_device 실행완료: 0.02초
2025-09-11 11:29:38,957 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-11 11:29:38,957 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-11 11:29:38,957 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-11 11:29:38,957 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-11 11:29:38,957 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-11 11:29:38,957 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-11 11:29:38,957 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-11 11:29:39,990 - __main__ - INFO - Model loaded on mps
2025-09-11 11:29:39,990 - __main__ - INFO - _initialize_embedding_model 실행완료: 1.03초
2025-09-11 11:29:39,990 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-11 11:29:40,458 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-11 11:29:40,458 - __main__ - INFO - _initialize_kiwi 실행완료: 0.47초
2025-09-11 11:29:40,458 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-11 11:29:40,458 - __main__ - INFO - ============================================================
2025-09-11 11:29:40,458 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-11 11:29:40,458 - __main__ - INFO - ============================================================
2025-09-11 11:29:40,458 - __main__ - INFO - 데이터 소스 모드: local
2025-09-11 11:29:40,458 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-11 11:29:40,458 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-11 11:29:40,458 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-11 11:29:40,459 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-11 11:29:40,459 - __main__ - ERROR - 상품 정보 로드 실패: [Errno 2] No such file or directory: './data/offer_master_data.csv'
2025-09-11 11:29:40,461 - __main__ - ERROR - 오류 상세: Traceback (most recent call last):
  File "/Users/1110566/workspace/AgenticWorkflow/mms_extractor_prd/mms_extractor.py", line 990, in _load_item_data
    item_pdf_raw = pd.read_csv(csv_path)
                   ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Caskroom/miniforge/base/lib/python3.12/site-packages/pandas/io/parsers/readers.py", line 1026, in read_csv
    return _read(filepath_or_buffer, kwds)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Caskroom/miniforge/base/lib/python3.12/site-packages/pandas/io/parsers/readers.py", line 620, in _read
    parser = TextFileReader(filepath_or_buffer, **kwds)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Caskroom/miniforge/base/lib/python3.12/site-packages/pandas/io/parsers/readers.py", line 1620, in __init__
    self._engine = self._make_engine(f, self.engine)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Caskroom/miniforge/base/lib/python3.12/site-packages/pandas/io/parsers/readers.py", line 1880, in _make_engine
    self.handles = get_handle(
                   ^^^^^^^^^^^
  File "/opt/homebrew/Caskroom/miniforge/base/lib/python3.12/site-packages/pandas/io/common.py", line 873, in get_handle
    handle = open(
             ^^^^^
FileNotFoundError: [Errno 2] No such file or directory: './data/offer_master_data.csv'

2025-09-11 11:29:40,462 - __main__ - WARNING - 빈 DataFrame으로 fallback 설정됨
2025-09-11 11:29:40,462 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (0, 4)
2025-09-11 11:29:40,462 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn']
2025-09-11 11:29:40,462 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-11 11:29:40,462 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-11 11:29:40,462 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (0, 4)
2025-09-11 11:29:40,466 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-11 11:29:40,466 - __main__ - INFO - null이 아닌 상품명 수: 0개
2025-09-11 11:29:40,466 - __main__ - INFO - 기존 item_nm_alias 데이터가 없어 item_nm에서 별칭을 생성합니다.
2025-09-11 11:29:40,467 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 0 -> 0
2025-09-11 11:29:40,467 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-11 11:29:40,467 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (0, 5)
2025-09-11 11:29:40,467 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-11 11:29:40,468 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-11 11:29:40,468 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-11 11:29:40,468 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-11 11:29:40,468 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-11 11:29:40,468 - __main__ - INFO - 등록할 고유 별칭 수: 0개
2025-09-11 11:29:40,468 - __main__ - INFO - 유효한 별칭 수: 0개
2025-09-11 11:29:40,468 - __main__ - INFO - Kiwi에 상품명 등록 완료: 0개 성공, 0개 실패
2025-09-11 11:29:40,468 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-11 11:29:40,468 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-11 11:29:40,470 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-11 11:29:40,470 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-11 11:29:40,619 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-11 11:29:40,619 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-11 11:29:40,619 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-11 11:29:41,103 - __main__ - INFO - 조직 정보 로드 완료: 259233개 조직
2025-09-11 11:29:41,103 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (259233, 8)
2025-09-11 11:29:41,103 - __main__ - INFO - ============================================================
2025-09-11 11:29:41,103 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-11 11:29:41,103 - __main__ - INFO - ============================================================
2025-09-11 11:29:41,103 - __main__ - INFO - ✅ 상품 데이터: (0, 5)
2025-09-11 11:29:41,104 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-11 11:29:41,104 - __main__ - INFO - ✅ 조직 데이터: (259233, 8)
2025-09-11 11:29:41,104 - __main__ - INFO - ✅ 정지어: 166개
2025-09-11 11:29:41,104 - __main__ - INFO - _load_data 실행완료: 0.65초
2025-09-11 11:29:41,104 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-11 11:29:41,104 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-11 11:29:41,104 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
            '[T 우주] 넷플릭스와 웨이브를 월 9,900원에! 
(광고)[S...
2025-09-11 11:29:41,104 - __main__ - INFO - ============================================================
2025-09-11 11:29:41,104 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-11 11:29:41,104 - __main__ - INFO - ============================================================
2025-09-11 11:29:41,104 - __main__ - INFO - 메시지 내용: 
            '[T 우주] 넷플릭스와 웨이브를 월 9,900원에! 
(광고)[SKT] 넷플릭스+웨이브 월 9,900원, 이게 되네! __#04 고객님,_넷플릭스와 웨이브 둘 다 보고 싶었지만, 가격 때문에 망설이셨다면 지금이 바로 기회! __오직 T 우주에서만, _2개월 동안 월 9,900원에 넷플릭스와 웨이브를 모두 즐기실 수 있습니다.__8월...
2025-09-11 11:29:41,104 - __main__ - INFO - 메시지 길이: 675 문자
2025-09-11 11:29:41,104 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-11 11:29:41,104 - __main__ - INFO - 데이터 소스: local
2025-09-11 11:29:41,104 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-11 11:29:41,104 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-11 11:29:41,104 - __main__ - INFO - LLM 모델: ax
2025-09-11 11:29:41,104 - __main__ - INFO - 상품 데이터 크기: (0, 5)
2025-09-11 11:29:41,104 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-11 11:29:41,104 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-11 11:29:41,104 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-11 11:29:41,104 - __main__ - INFO - 처리할 메시지 길이: 649 문자
2025-09-11 11:29:41,104 - __main__ - ERROR - 상품 데이터가 비어있습니다! 엔티티 추출 불가
2025-09-11 11:29:41,104 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 0.00초
2025-09-11 11:29:41,104 - __main__ - INFO - 추출된 후보 엔티티: []
2025-09-11 11:29:41,104 - __main__ - INFO - 매칭된 상품 정보: (0, 0)
2025-09-11 11:29:41,104 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-11 11:29:41,203 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-11 11:29:41,203 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-11 11:29:41,203 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 423 문자
2025-09-11 11:29:41,203 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-11 11:29:41,203 - __main__ - WARNING - 후보 아이템이 없습니다!
2025-09-11 11:29:41,203 - __main__ - WARNING - 이는 다음 중 하나의 문제일 수 있습니다:
2025-09-11 11:29:41,203 - __main__ - WARNING - 1. 상품 데이터 로딩 실패
2025-09-11 11:29:41,203 - __main__ - WARNING - 2. 엔티티 추출 실패
2025-09-11 11:29:41,203 - __main__ - WARNING - 3. 유사도 매칭 임계값 문제
2025-09-11 11:29:41,204 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-11 11:29:41,204 - __main__ - INFO - 구성된 프롬프트 길이: 5837 문자
2025-09-11 11:29:41,204 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-11 11:29:41,204 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 5837)
2025-09-11 11:29:41,204 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-11 11:29:41,204 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-11 11:29:46,839 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-11 11:29:46,852 - __main__ - INFO - LLM 응답 길이: 774 문자
2025-09-11 11:29:46,852 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "[T 우주] 넷플릭스와 웨이브를 월 9,900원에!",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "쿠폰 제공 안내"
    ],
    "product": [
        {
            "name": "우주패스 Netflix(광고형 스탠다드)",
            "action": "가입"
        },
        {
            "name": "Wavve 콘텐츠 팩",
            "action": "사용"
        }
    ],
    "channel": [
        {
            "type": "URL",
            "value": "http://t-mms.kr/jAs/#74",
            "action": "추가 정보"
        },
        {
            ...
2025-09-11 11:29:46,852 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-11 11:29:46,852 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-11 11:29:46,852 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-11 11:29:46,853 - __main__ - INFO - 파싱된 JSON 내용: {'title': '[T 우주] 넷플릭스와 웨이브를 월 9,900원에!', 'purpose': ['상품 가입 유도', '혜택 안내', '쿠폰 제공 안내'], 'product': [{'name': '우주패스 Netflix(광고형 스탠다드)', 'action': '가입'}, {'name': 'Wavve 콘텐츠 팩', 'action': '사용'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/jAs/#74', 'action': '추가 정보'}, {'type': '전화번호', 'value': '1505', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['상품및부가서비스가입유도_구독', '사용법/혜택/이벤트안내_구독']}
2025-09-11 11:29:46,853 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-11 11:29:46,853 - __main__ - INFO - LLM 추출 엔티티: ['우주패스 Netflix(광고형 스탠다드)', 'Wavve 콘텐츠 팩']
2025-09-11 11:29:46,873 - __main__ - ERROR - LLM 기반 엔티티 추출 실패: 'item_nm_alias'
2025-09-11 11:29:46,874 - __main__ - INFO - extract_entities_by_llm 실행완료: 0.02초
2025-09-11 11:29:46,877 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-11 11:29:46,877 - __main__ - INFO - ============================================================
2025-09-11 11:29:46,877 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-11 11:29:46,877 - __main__ - INFO - ============================================================
2025-09-11 11:29:46,877 - __main__ - INFO - 제목: [T 우주] 넷플릭스와 웨이브를 월 9,900원에!
2025-09-11 11:29:46,877 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '쿠폰 제공 안내']
2025-09-11 11:29:46,877 - __main__ - INFO - 상품 수: 2개
2025-09-11 11:29:46,877 - __main__ - INFO - 채널 수: 3개
2025-09-11 11:29:46,877 - __main__ - INFO - 프로그램 수: 2개
2025-09-11 11:29:46,877 - __main__ - INFO - process_message 실행완료: 5.77초
2025-09-11 11:29:46,878 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-11 11:30:44,488 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-11 11:30:44,488 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-11 11:30:44,488 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-11 11:30:44,488 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-09-11 11:30:44,488 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-11 11:30:44,489 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-11 11:30:44,506 - __main__ - INFO - Using device: mps
2025-09-11 11:30:44,506 - __main__ - INFO - _initialize_device 실행완료: 0.02초
2025-09-11 11:30:44,506 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-11 11:30:44,506 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-11 11:30:44,506 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-11 11:30:44,506 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-11 11:30:44,506 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-11 11:30:44,506 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-11 11:30:44,506 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-11 11:30:45,367 - __main__ - INFO - Model loaded on mps
2025-09-11 11:30:45,367 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.86초
2025-09-11 11:30:45,367 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-11 11:30:45,805 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-11 11:30:45,805 - __main__ - INFO - _initialize_kiwi 실행완료: 0.44초
2025-09-11 11:30:45,805 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-11 11:30:45,805 - __main__ - INFO - ============================================================
2025-09-11 11:30:45,805 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-11 11:30:45,805 - __main__ - INFO - ============================================================
2025-09-11 11:30:45,805 - __main__ - INFO - 데이터 소스 모드: local
2025-09-11 11:30:45,805 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-11 11:30:45,805 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-11 11:30:45,805 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-11 11:30:45,805 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-11 11:30:45,874 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-11 11:30:45,874 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-11 11:30:45,874 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-11 11:30:45,878 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-11 11:30:45,879 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-11 11:30:45,879 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 11:30:45,880 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 11:30:45,880 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-11 11:30:45,880 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-11 11:30:45,882 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-11 11:30:45,885 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-11 11:30:45,885 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-11 11:30:45,885 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 11:30:45,886 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-11 11:30:45,886 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-11 11:30:45,886 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-11 11:30:45,886 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 11:30:45,886 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-11 11:30:45,886 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-11 11:30:45,886 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-11 11:30:45,887 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-11 11:30:45,887 - __main__ - INFO - null이 아닌 상품명 수: 10551개
2025-09-11 11:30:45,887 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 11:30:45,888 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-11 11:30:45,888 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 11:30:46,019 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-11 11:30:46,023 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 21522
2025-09-11 11:30:46,024 - __main__ - INFO - 별칭 적용 후 샘플: ['우주PASS Netflix 인증', '우주Pass Netflix 인증', '우주pass Netflix 인증', '우주패스 Netflix 인증', '우주패스 넷플릭스 인증']
2025-09-11 11:30:46,024 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-11 11:30:46,024 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (21522, 9)
2025-09-11 11:30:46,024 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-11 11:30:46,025 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-11 11:30:46,025 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-11 11:30:46,025 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-11 11:30:46,025 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-11 11:30:46,027 - __main__ - INFO - 등록할 고유 별칭 수: 16403개
2025-09-11 11:30:46,028 - __main__ - INFO - 유효한 별칭 수: 16403개
2025-09-11 11:30:46,028 - __main__ - INFO - 등록할 별칭 샘플: ['우주PASS Netflix 인증', '우주Pass Netflix 인증', '우주pass Netflix 인증', '우주패스 Netflix 인증', '우주패스 넷플릭스 인증']
2025-09-11 11:30:46,044 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16403개 성공, 0개 실패
2025-09-11 11:30:46,044 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-11 11:30:46,044 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-11 11:30:46,045 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-11 11:30:46,045 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-11 11:30:46,202 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-11 11:30:46,202 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-11 11:30:46,202 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-11 11:30:46,714 - __main__ - INFO - 조직 정보 로드 완료: 259233개 조직
2025-09-11 11:30:46,714 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (259233, 8)
2025-09-11 11:30:46,714 - __main__ - INFO - ============================================================
2025-09-11 11:30:46,714 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-11 11:30:46,714 - __main__ - INFO - ============================================================
2025-09-11 11:30:46,714 - __main__ - INFO - ✅ 상품 데이터: (21522, 9)
2025-09-11 11:30:46,714 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-11 11:30:46,714 - __main__ - INFO - ✅ 조직 데이터: (259233, 8)
2025-09-11 11:30:46,714 - __main__ - INFO - ✅ 정지어: 166개
2025-09-11 11:30:46,714 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-11 11:30:46,716 - __main__ - INFO - 고유 상품명 수: 6847개
2025-09-11 11:30:46,718 - __main__ - INFO - 고유 별칭 수: 16403개
2025-09-11 11:30:46,719 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-11 11:30:46,719 - __main__ - INFO - _load_data 실행완료: 0.91초
2025-09-11 11:30:46,719 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-11 11:30:46,719 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-11 11:30:46,719 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
            '[T 우주] 넷플릭스와 웨이브를 월 9,900원에! 
(광고)[S...
2025-09-11 11:30:46,719 - __main__ - INFO - ============================================================
2025-09-11 11:30:46,719 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-11 11:30:46,719 - __main__ - INFO - ============================================================
2025-09-11 11:30:46,719 - __main__ - INFO - 메시지 내용: 
            '[T 우주] 넷플릭스와 웨이브를 월 9,900원에! 
(광고)[SKT] 넷플릭스+웨이브 월 9,900원, 이게 되네! __#04 고객님,_넷플릭스와 웨이브 둘 다 보고 싶었지만, 가격 때문에 망설이셨다면 지금이 바로 기회! __오직 T 우주에서만, _2개월 동안 월 9,900원에 넷플릭스와 웨이브를 모두 즐기실 수 있습니다.__8월...
2025-09-11 11:30:46,719 - __main__ - INFO - 메시지 길이: 675 문자
2025-09-11 11:30:46,719 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-11 11:30:46,719 - __main__ - INFO - 데이터 소스: local
2025-09-11 11:30:46,719 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-11 11:30:46,719 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-11 11:30:46,719 - __main__ - INFO - LLM 모델: ax
2025-09-11 11:30:46,719 - __main__ - INFO - 상품 데이터 크기: (21522, 9)
2025-09-11 11:30:46,719 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-11 11:30:46,719 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-11 11:30:46,719 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-11 11:30:46,719 - __main__ - INFO - 처리할 메시지 길이: 649 문자
2025-09-11 11:30:46,720 - __main__ - INFO - 매칭할 상품 별칭 수: 16403개
2025-09-11 11:30:47,220 - __main__ - INFO - 분할된 문장 수: 21개
2025-09-11 11:30:47,221 - __main__ - INFO - 필터링된 문장들: [' T 우주 넷플릭스와 웨이브 월 에 광고 SKT ', '넷플릭스 웨이브 월 이게 되네 ', ' 고객님 ']...
2025-09-11 11:30:47,226 - __main__ - INFO - 전체 토큰 수: 272개
2025-09-11 11:30:47,226 - __main__ - INFO - NNP 태그 토큰들: ['넷플릭스', '넷플릭스', '넷플릭스', '넷플릭스', 'Netflix', 'Wavve 콘텐츠 팩', 'Netflix']
2025-09-11 11:30:47,226 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['Wavve 콘텐츠 팩', '넷플릭스', 'Netflix']
2025-09-11 11:30:47,226 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-11 11:30:48,265 - __main__ - INFO - 퍼지 매칭 결과 크기: (5348, 3)
2025-09-11 11:30:48,266 - __main__ - INFO - 퍼지 매칭 성공: 5348개 결과
2025-09-11 11:30:48,266 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' T 우주 넷플릭스와 웨이브 월 에 광고 SKT ', 'item_nm_alias': '우주패스 넷플릭스 인증', 'sim': 0.6956521739130435}, {'sent': ' T 우주 넷플릭스와 웨이브 월 에 광고 SKT ', 'item_nm_alias': '밴드 데이터 세이브', 'sim': 0.4}, {'sent': ' T 우주 넷플릭스와 웨이브 월 에 광고 SKT ', 'item_nm_alias': '다이렉트5G 76(넷플릭스)', 'sim': 0.41666666666666663}]
2025-09-11 11:30:48,266 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-11 11:30:48,363 - __main__ - INFO - 시퀀스 유사도 결과 크기: (5348, 3)
2025-09-11 11:30:48,364 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' T 우주 넷플릭스와 웨이브 월 에 광고 SKT ', 'item_nm_alias': '우주패스 넷플릭스 인증', 'sim': 0.5333333333333333}, {'sent': ' T 우주 넷플릭스와 웨이브 월 에 광고 SKT ', 'item_nm_alias': '밴드 데이터 세이브', 'sim': 0.32000000000000006}, {'sent': ' T 우주 넷플릭스와 웨이브 월 에 광고 SKT ', 'item_nm_alias': '다이렉트5G 76(넷플릭스)', 'sim': 0.34285714285714286}]
2025-09-11 11:30:48,364 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-11 11:30:48,367 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 58개
2025-09-11 11:30:48,369 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 4개
2025-09-11 11:30:48,370 - __main__ - INFO - 통합된 후보 아이템 수: 62개
2025-09-11 11:30:48,372 - __main__ - INFO - 최종 후보 아이템 리스트: ['Netflix', 'Wavve 콘텐츠 팩', '넷플릭스', 'Netflix 광고형 스탠다드 이용권', 'Netflix 스탠다드 이용권', 'T 우주패스 Netflix', '우주패스 Netflix 인증', '멤버십가입', '우주패스 Netflix 추가혜택', '티빙 광고형 스탠다드', 'Netflix 프리미엄 이용권', 'Wavve 콘텐츠 팩_인증', 'Wavve 콘텐츠 팩 연간', 'Wavve 콘텐츠 팩(TV)', 'Wavve 콘텐츠 팩(티비)', '타다 쿠폰', 'Netflix 단독', 'Wavve 콘텐츠 팩_할인2', 'Wavve 콘텐츠 팩_할인1', 'Wavve 콘텐츠 팩(이벤트)', 'Wavve 콘텐츠 팩 플러스', 'Wavve 콘텐츠 팩 이용권', 'tving 광고형 스탠다드', 'TVING 광고형 스탠다드', '플로 콘텐츠 팩', 'T 우주패스 넷플릭스', '넷플릭스 광고형 스탠다드 이용권', 'Wavve 콘텐츠 팩 프리미엄', '멤버십 미가입자', 'Wavve 콘텐츠 팩 plus', 'Wavve 콘텐츠 팩 Plus', 'Wavve 콘텐츠 팩 PLUS', '클럽T 스탠다드', '클럽T 프리미엄']
2025-09-11 11:30:48,375 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (25, 2)
2025-09-11 11:30:48,375 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'FLO 콘텐츠 팩', 'item_id': ['PR00000217']}, {'item_nm': 'Netflix', 'item_id': ['PR00000501', 'PR00000501']}, {'item_nm': 'Netflix 광고형 스탠다드 이용권', 'item_id': ['PR00000418', 'PR00000418']}]
2025-09-11 11:30:48,376 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.66초
2025-09-11 11:30:48,376 - __main__ - INFO - 추출된 후보 엔티티: ['Netflix', 'Wavve 콘텐츠 팩', '넷플릭스', 'Netflix 광고형 스탠다드 이용권', 'Netflix 스탠다드 이용권', 'T 우주패스 Netflix', '우주패스 Netflix 인증', '멤버십가입', '우주패스 Netflix 추가혜택', '티빙 광고형 스탠다드', 'Netflix 프리미엄 이용권', 'Wavve 콘텐츠 팩_인증', 'Wavve 콘텐츠 팩 연간', 'Wavve 콘텐츠 팩(TV)', 'Wavve 콘텐츠 팩(티비)', '타다 쿠폰', 'Netflix 단독', 'Wavve 콘텐츠 팩_할인2', 'Wavve 콘텐츠 팩_할인1', 'Wavve 콘텐츠 팩(이벤트)', 'Wavve 콘텐츠 팩 플러스', 'Wavve 콘텐츠 팩 이용권', 'tving 광고형 스탠다드', 'TVING 광고형 스탠다드', '플로 콘텐츠 팩', 'T 우주패스 넷플릭스', '넷플릭스 광고형 스탠다드 이용권', 'Wavve 콘텐츠 팩 프리미엄', '멤버십 미가입자', 'Wavve 콘텐츠 팩 plus', 'Wavve 콘텐츠 팩 Plus', 'Wavve 콘텐츠 팩 PLUS', '클럽T 스탠다드', '클럽T 프리미엄']
2025-09-11 11:30:48,376 - __main__ - INFO - 매칭된 상품 정보: (25, 2)
2025-09-11 11:30:48,376 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-11 11:30:48,474 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-11 11:30:48,474 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-11 11:30:48,474 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 423 문자
2025-09-11 11:30:48,474 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-11 11:30:48,474 - __main__ - INFO - 후보 아이템 리스트 크기: 34개
2025-09-11 11:30:48,474 - __main__ - INFO - 후보 아이템 리스트: ['Netflix', 'Wavve 콘텐츠 팩', '넷플릭스', 'Netflix 광고형 스탠다드 이용권', 'Netflix 스탠다드 이용권', 'T 우주패스 Netflix', '우주패스 Netflix 인증', '멤버십가입', '우주패스 Netflix 추가혜택', '티빙 광고형 스탠다드', 'Netflix 프리미엄 이용권', 'Wavve 콘텐츠 팩_인증', 'Wavve 콘텐츠 팩 연간', 'Wavve 콘텐츠 팩(TV)', 'Wavve 콘텐츠 팩(티비)', '타다 쿠폰', 'Netflix 단독', 'Wavve 콘텐츠 팩_할인2', 'Wavve 콘텐츠 팩_할인1', 'Wavve 콘텐츠 팩(이벤트)', 'Wavve 콘텐츠 팩 플러스', 'Wavve 콘텐츠 팩 이용권', 'tving 광고형 스탠다드', 'TVING 광고형 스탠다드', '플로 콘텐츠 팩', 'T 우주패스 넷플릭스', '넷플릭스 광고형 스탠다드 이용권', 'Wavve 콘텐츠 팩 프리미엄', '멤버십 미가입자', 'Wavve 콘텐츠 팩 plus', 'Wavve 콘텐츠 팩 Plus', 'Wavve 콘텐츠 팩 PLUS', '클럽T 스탠다드', '클럽T 프리미엄']
2025-09-11 11:30:48,474 - __main__ - INFO - extra_item_pdf 크기: (25, 2)
2025-09-11 11:30:48,474 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-11 11:30:48,475 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'FLO 콘텐츠 팩', 'item_id': ['PR00000217']}, {'item_nm': 'Netflix', 'item_id': ['PR00000501', 'PR00000501']}]
2025-09-11 11:30:48,476 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 25개
2025-09-11 11:30:48,476 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': 'FLO 콘텐츠 팩', 'action': '기타'}, {'name': 'Netflix', 'action': '기타'}]
2025-09-11 11:30:48,476 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-11 11:30:48,476 - __main__ - INFO - 구성된 프롬프트 길이: 7259 문자
2025-09-11 11:30:48,476 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-11 11:30:48,476 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 7259)
2025-09-11 11:30:48,476 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-11 11:30:48,476 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-11 11:30:56,235 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-11 11:30:56,243 - __main__ - INFO - LLM 응답 길이: 1176 문자
2025-09-11 11:30:56,243 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "[T 우주] 넷플릭스와 웨이브를 월 9,900원에!",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "쿠폰 제공 안내"
    ],
    "product": [
        {
            "name": "Netflix",
            "action": "가입"
        },
        {
            "name": "Wavve",
            "action": "가입"
        },
        {
            "name": "우주패스 Netflix",
            "action": "가입"
        },
        {
            "name": "Netflix 광고형 스탠다드",
            "action": "가입"
        },
        {
          ...
2025-09-11 11:30:56,243 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-11 11:30:56,244 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-11 11:30:56,244 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-11 11:30:56,244 - __main__ - INFO - 파싱된 JSON 내용: {'title': '[T 우주] 넷플릭스와 웨이브를 월 9,900원에!', 'purpose': ['상품 가입 유도', '혜택 안내', '쿠폰 제공 안내'], 'product': [{'name': 'Netflix', 'action': '가입'}, {'name': 'Wavve', 'action': '가입'}, {'name': '우주패스 Netflix', 'action': '가입'}, {'name': 'Netflix 광고형 스탠다드', 'action': '가입'}, {'name': 'Wavve 콘텐츠 팩', 'action': '가입'}, {'name': 'Netflix 스탠다드', 'action': '가입'}, {'name': 'Netflix 프리미엄', 'action': '가입'}], 'channel': [{'type': 'URL', 'value': 'http://t-mms.kr/jAs/#74', 'action': '추가 정보'}, {'type': '전화번호', 'value': '1505', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['상품및부가서비스가입유도_구독', '사용법/혜택/이벤트안내_구독']}
2025-09-11 11:30:56,244 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-11 11:30:56,244 - __main__ - INFO - LLM 추출 엔티티: ['Netflix', 'Wavve', '우주패스 Netflix', 'Netflix 광고형 스탠다드', 'Wavve 콘텐츠 팩', 'Netflix 스탠다드', 'Netflix 프리미엄']
2025-09-11 11:30:56,540 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 4224)
2025-09-11 11:30:56,540 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-11 11:30:56,540 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-11 11:30:57,218 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-11 11:30:57,507 - __main__ - INFO - extract_entities_by_llm 실행완료: 1.26초
2025-09-11 11:30:57,511 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-11 11:30:57,511 - __main__ - INFO - ============================================================
2025-09-11 11:30:57,511 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-11 11:30:57,511 - __main__ - INFO - ============================================================
2025-09-11 11:30:57,511 - __main__ - INFO - 제목: [T 우주] 넷플릭스와 웨이브를 월 9,900원에!
2025-09-11 11:30:57,511 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '쿠폰 제공 안내']
2025-09-11 11:30:57,511 - __main__ - INFO - 상품 수: 5개
2025-09-11 11:30:57,511 - __main__ - INFO - 채널 수: 3개
2025-09-11 11:30:57,511 - __main__ - INFO - 프로그램 수: 2개
2025-09-11 11:30:57,512 - __main__ - INFO - process_message 실행완료: 10.79초
2025-09-11 11:30:57,512 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-11 12:39:21,002 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-11 12:39:21,003 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-11 12:39:21,003 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-11 12:39:21,003 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-09-11 12:39:21,003 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-11 12:39:21,004 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-11 12:39:21,021 - __main__ - INFO - Using device: mps
2025-09-11 12:39:21,021 - __main__ - INFO - _initialize_device 실행완료: 0.02초
2025-09-11 12:39:21,021 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-11 12:39:21,021 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-11 12:39:21,022 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-11 12:39:21,022 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-11 12:39:21,022 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-11 12:39:21,022 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-11 12:39:21,022 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-11 12:39:22,057 - __main__ - INFO - Model loaded on mps
2025-09-11 12:39:22,057 - __main__ - INFO - _initialize_embedding_model 실행완료: 1.04초
2025-09-11 12:39:22,057 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-11 12:39:22,466 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-11 12:39:22,466 - __main__ - INFO - _initialize_kiwi 실행완료: 0.41초
2025-09-11 12:39:22,466 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-11 12:39:22,466 - __main__ - INFO - ============================================================
2025-09-11 12:39:22,466 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-11 12:39:22,466 - __main__ - INFO - ============================================================
2025-09-11 12:39:22,466 - __main__ - INFO - 데이터 소스 모드: local
2025-09-11 12:39:22,466 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-11 12:39:22,466 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-11 12:39:22,467 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-11 12:39:22,467 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-11 12:39:22,540 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-11 12:39:22,540 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-11 12:39:22,540 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-11 12:39:22,543 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-11 12:39:22,544 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-11 12:39:22,544 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 12:39:22,545 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 12:39:22,545 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-11 12:39:22,545 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-11 12:39:22,546 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-11 12:39:22,549 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-11 12:39:22,549 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-11 12:39:22,549 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 12:39:22,549 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-11 12:39:22,549 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-11 12:39:22,550 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-11 12:39:22,550 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 12:39:22,550 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-11 12:39:22,550 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-11 12:39:22,550 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-11 12:39:22,557 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-11 12:39:22,557 - __main__ - INFO - null이 아닌 상품명 수: 10551개
2025-09-11 12:39:22,557 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 12:39:22,558 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-11 12:39:22,558 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 12:39:22,682 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-11 12:39:22,686 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 21522
2025-09-11 12:39:22,687 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 넷플릭스 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증']
2025-09-11 12:39:22,687 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-11 12:39:22,687 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (21522, 9)
2025-09-11 12:39:22,687 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-11 12:39:22,688 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-11 12:39:22,688 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-11 12:39:22,689 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-11 12:39:22,689 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-11 12:39:22,690 - __main__ - INFO - 등록할 고유 별칭 수: 16403개
2025-09-11 12:39:22,691 - __main__ - INFO - 유효한 별칭 수: 16403개
2025-09-11 12:39:22,691 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 넷플릭스 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증']
2025-09-11 12:39:22,704 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16403개 성공, 0개 실패
2025-09-11 12:39:22,704 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-11 12:39:22,704 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-11 12:39:22,708 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-11 12:39:22,708 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-11 12:39:22,856 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-11 12:39:22,856 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-11 12:39:22,856 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-11 12:39:22,866 - __main__ - WARNING - 조직 정보 로드 실패: 'utf-8' codec can't decode byte 0xb4 in position 104: invalid start byte
2025-09-11 12:39:22,868 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (0, 3)
2025-09-11 12:39:22,868 - __main__ - INFO - ============================================================
2025-09-11 12:39:22,868 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-11 12:39:22,868 - __main__ - INFO - ============================================================
2025-09-11 12:39:22,868 - __main__ - INFO - ✅ 상품 데이터: (21522, 9)
2025-09-11 12:39:22,868 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-11 12:39:22,868 - __main__ - INFO - ✅ 조직 데이터: (0, 3)
2025-09-11 12:39:22,868 - __main__ - INFO - ✅ 정지어: 166개
2025-09-11 12:39:22,868 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-11 12:39:22,869 - __main__ - INFO - 고유 상품명 수: 6847개
2025-09-11 12:39:22,871 - __main__ - INFO - 고유 별칭 수: 16403개
2025-09-11 12:39:22,872 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-11 12:39:22,872 - __main__ - INFO - _load_data 실행완료: 0.41초
2025-09-11 12:39:22,872 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-11 12:39:22,872 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-11 12:39:22,872 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-11 12:39:22,872 - __main__ - INFO - ============================================================
2025-09-11 12:39:22,872 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-11 12:39:22,872 - __main__ - INFO - ============================================================
2025-09-11 12:39:22,872 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-11 12:39:22,872 - __main__ - INFO - 메시지 길이: 420 문자
2025-09-11 12:39:22,872 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-11 12:39:22,872 - __main__ - INFO - 데이터 소스: local
2025-09-11 12:39:22,872 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-11 12:39:22,872 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-11 12:39:22,872 - __main__ - INFO - LLM 모델: ax
2025-09-11 12:39:22,873 - __main__ - INFO - 상품 데이터 크기: (21522, 9)
2025-09-11 12:39:22,873 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-11 12:39:22,873 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-11 12:39:22,873 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-11 12:39:22,873 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-11 12:39:22,874 - __main__ - INFO - 매칭할 상품 별칭 수: 16403개
2025-09-11 12:39:23,328 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-11 12:39:23,329 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-11 12:39:23,332 - __main__ - INFO - 전체 토큰 수: 155개
2025-09-11 12:39:23,332 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하', '갤럭시', 'A', '기기값', '아이폰', '을지로입구역', '하나은행', '명동']
2025-09-11 12:39:23,332 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['명동', '을지로입구역', '갤럭시', '하나은행', '아이폰', '기기값', '구매하']
2025-09-11 12:39:23,332 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-11 12:39:24,099 - __main__ - INFO - 퍼지 매칭 결과 크기: (1047, 3)
2025-09-11 12:39:24,099 - __main__ - INFO - 퍼지 매칭 성공: 1047개 결과
2025-09-11 12:39:24,100 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-11 12:39:24,100 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-11 12:39:24,140 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1047, 3)
2025-09-11 12:39:24,140 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-11 12:39:24,141 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-11 12:39:24,143 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 1개
2025-09-11 12:39:24,145 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 1개
2025-09-11 12:39:24,145 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-09-11 12:39:24,147 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시']
2025-09-11 12:39:24,149 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (1, 2)
2025-09-11 12:39:24,150 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-11 12:39:24,150 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.28초
2025-09-11 12:39:24,150 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시']
2025-09-11 12:39:24,150 - __main__ - INFO - 매칭된 상품 정보: (1, 2)
2025-09-11 12:39:24,150 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-11 12:39:24,235 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-11 12:39:24,235 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-11 12:39:24,235 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-11 12:39:24,235 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-11 12:39:24,235 - __main__ - INFO - 후보 아이템 리스트 크기: 1개
2025-09-11 12:39:24,236 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시']
2025-09-11 12:39:24,236 - __main__ - INFO - extra_item_pdf 크기: (1, 2)
2025-09-11 12:39:24,236 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-11 12:39:24,236 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-11 12:39:24,237 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 1개
2025-09-11 12:39:24,237 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': 'GALAXY', 'action': '기타'}]
2025-09-11 12:39:24,237 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-11 12:39:24,237 - __main__ - INFO - 구성된 프롬프트 길이: 5000 문자
2025-09-11 12:39:24,237 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-11 12:39:24,237 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 5000)
2025-09-11 12:39:24,237 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-11 12:39:24,237 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-11 12:39:32,574 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-11 12:39:32,583 - __main__ - INFO - LLM 응답 길이: 1245 문자
2025-09-11 12:39:32,583 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "갤럭시 S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        },
        {
            "name"...
2025-09-11 12:39:32,583 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-11 12:39:32,584 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-11 12:39:32,584 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-11 12:39:32,584 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': '갤럭시 S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}, {'name': '인터넷+TV', 'action': '가입'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '가입'}, {'type': '전화번호', 'value': '080-801-0011', 'action': '수신 거부'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-11 12:39:32,584 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-11 12:39:32,584 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', '갤럭시 S24 FE', '아이폰17', '인터넷+TV']
2025-09-11 12:39:32,782 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 3050)
2025-09-11 12:39:32,782 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-11 12:39:32,782 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-11 12:39:33,470 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-11 12:39:33,750 - __main__ - INFO - extract_entities_by_llm 실행완료: 1.17초
2025-09-11 12:39:33,754 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-11 12:39:33,754 - __main__ - INFO - ============================================================
2025-09-11 12:39:33,754 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-11 12:39:33,754 - __main__ - INFO - ============================================================
2025-09-11 12:39:33,754 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-11 12:39:33,754 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-11 12:39:33,754 - __main__ - INFO - 상품 수: 2개
2025-09-11 12:39:33,754 - __main__ - INFO - 채널 수: 5개
2025-09-11 12:39:33,755 - __main__ - INFO - 프로그램 수: 2개
2025-09-11 12:39:33,755 - __main__ - INFO - process_message 실행완료: 10.88초
2025-09-11 12:39:33,755 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-11 12:41:43,778 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-11 12:41:43,778 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-11 12:41:43,778 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-11 12:41:43,778 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-09-11 12:41:43,778 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-11 12:41:43,779 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-11 12:41:43,796 - __main__ - INFO - Using device: mps
2025-09-11 12:41:43,796 - __main__ - INFO - _initialize_device 실행완료: 0.02초
2025-09-11 12:41:43,796 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-11 12:41:43,796 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-11 12:41:43,797 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-11 12:41:43,797 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-11 12:41:43,797 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-11 12:41:43,797 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-11 12:41:43,797 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-11 12:41:44,625 - __main__ - INFO - Model loaded on mps
2025-09-11 12:41:44,625 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.83초
2025-09-11 12:41:44,625 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-11 12:41:45,033 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-11 12:41:45,033 - __main__ - INFO - _initialize_kiwi 실행완료: 0.41초
2025-09-11 12:41:45,033 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-11 12:41:45,033 - __main__ - INFO - ============================================================
2025-09-11 12:41:45,033 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-11 12:41:45,033 - __main__ - INFO - ============================================================
2025-09-11 12:41:45,033 - __main__ - INFO - 데이터 소스 모드: local
2025-09-11 12:41:45,033 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-11 12:41:45,033 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-11 12:41:45,033 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-11 12:41:45,033 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-11 12:41:45,097 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-11 12:41:45,097 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-11 12:41:45,097 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-11 12:41:45,101 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-11 12:41:45,101 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-11 12:41:45,102 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 12:41:45,102 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 12:41:45,102 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-11 12:41:45,103 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-11 12:41:45,104 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-11 12:41:45,106 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-11 12:41:45,106 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-11 12:41:45,106 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 12:41:45,107 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-11 12:41:45,107 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-11 12:41:45,107 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-11 12:41:45,107 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 12:41:45,107 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-11 12:41:45,107 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-11 12:41:45,107 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-11 12:41:45,108 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-11 12:41:45,109 - __main__ - INFO - null이 아닌 상품명 수: 10551개
2025-09-11 12:41:45,109 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 12:41:45,109 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-11 12:41:45,109 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 12:41:45,233 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-11 12:41:45,238 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 21522
2025-09-11 12:41:45,239 - __main__ - INFO - 별칭 적용 후 샘플: ['우주pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주Pass Netflix 인증', '우주패스 넷플릭스 인증']
2025-09-11 12:41:45,239 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-11 12:41:45,239 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (21522, 9)
2025-09-11 12:41:45,239 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-11 12:41:45,240 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-11 12:41:45,240 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-11 12:41:45,240 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-11 12:41:45,240 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-11 12:41:45,242 - __main__ - INFO - 등록할 고유 별칭 수: 16403개
2025-09-11 12:41:45,243 - __main__ - INFO - 유효한 별칭 수: 16403개
2025-09-11 12:41:45,243 - __main__ - INFO - 등록할 별칭 샘플: ['우주pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주Pass Netflix 인증', '우주패스 넷플릭스 인증']
2025-09-11 12:41:45,255 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16403개 성공, 0개 실패
2025-09-11 12:41:45,255 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-11 12:41:45,255 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-11 12:41:45,256 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-11 12:41:45,257 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-11 12:41:45,406 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-11 12:41:45,406 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-11 12:41:45,406 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-11 12:41:45,475 - __main__ - INFO - 조직 정보 로드 완료: 5765개 조직
2025-09-11 12:41:45,475 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-11 12:41:45,475 - __main__ - INFO - ============================================================
2025-09-11 12:41:45,475 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-11 12:41:45,475 - __main__ - INFO - ============================================================
2025-09-11 12:41:45,475 - __main__ - INFO - ✅ 상품 데이터: (21522, 9)
2025-09-11 12:41:45,475 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-11 12:41:45,475 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-11 12:41:45,475 - __main__ - INFO - ✅ 정지어: 166개
2025-09-11 12:41:45,475 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-11 12:41:45,476 - __main__ - INFO - 고유 상품명 수: 6847개
2025-09-11 12:41:45,478 - __main__ - INFO - 고유 별칭 수: 16403개
2025-09-11 12:41:45,479 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-11 12:41:45,479 - __main__ - INFO - _load_data 실행완료: 0.45초
2025-09-11 12:41:45,479 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-11 12:41:45,479 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-11 12:41:45,479 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-11 12:41:45,479 - __main__ - INFO - ============================================================
2025-09-11 12:41:45,479 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-11 12:41:45,479 - __main__ - INFO - ============================================================
2025-09-11 12:41:45,479 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-11 12:41:45,479 - __main__ - INFO - 메시지 길이: 420 문자
2025-09-11 12:41:45,479 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-11 12:41:45,479 - __main__ - INFO - 데이터 소스: local
2025-09-11 12:41:45,479 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-11 12:41:45,480 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-11 12:41:45,480 - __main__ - INFO - LLM 모델: ax
2025-09-11 12:41:45,480 - __main__ - INFO - 상품 데이터 크기: (21522, 9)
2025-09-11 12:41:45,480 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-11 12:41:45,480 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-11 12:41:45,480 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-11 12:41:45,480 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-11 12:41:45,481 - __main__ - INFO - 매칭할 상품 별칭 수: 16403개
2025-09-11 12:41:45,942 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-11 12:41:45,943 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-11 12:41:45,946 - __main__ - INFO - 전체 토큰 수: 155개
2025-09-11 12:41:45,946 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하', '갤럭시', 'A', '기기값', '아이폰', '을지로입구역', '하나은행', '명동']
2025-09-11 12:41:45,946 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['갤럭시', '아이폰', '구매하', '하나은행', '명동', '을지로입구역', '기기값']
2025-09-11 12:41:45,946 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-11 12:41:46,713 - __main__ - INFO - 퍼지 매칭 결과 크기: (1047, 3)
2025-09-11 12:41:46,713 - __main__ - INFO - 퍼지 매칭 성공: 1047개 결과
2025-09-11 12:41:46,714 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-11 12:41:46,714 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-11 12:41:46,753 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1047, 3)
2025-09-11 12:41:46,753 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-11 12:41:46,754 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-11 12:41:46,756 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 1개
2025-09-11 12:41:46,758 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 1개
2025-09-11 12:41:46,758 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-09-11 12:41:46,760 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시']
2025-09-11 12:41:46,762 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (1, 2)
2025-09-11 12:41:46,762 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-11 12:41:46,762 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.28초
2025-09-11 12:41:46,762 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시']
2025-09-11 12:41:46,762 - __main__ - INFO - 매칭된 상품 정보: (1, 2)
2025-09-11 12:41:46,763 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-11 12:41:46,848 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-11 12:41:46,848 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-11 12:41:46,848 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-11 12:41:46,848 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-11 12:41:46,848 - __main__ - INFO - 후보 아이템 리스트 크기: 1개
2025-09-11 12:41:46,848 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시']
2025-09-11 12:41:46,848 - __main__ - INFO - extra_item_pdf 크기: (1, 2)
2025-09-11 12:41:46,848 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-11 12:41:46,848 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-11 12:41:46,849 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 1개
2025-09-11 12:41:46,849 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': 'GALAXY', 'action': '기타'}]
2025-09-11 12:41:46,849 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-11 12:41:46,849 - __main__ - INFO - 구성된 프롬프트 길이: 5000 문자
2025-09-11 12:41:46,849 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-11 12:41:46,849 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 5000)
2025-09-11 12:41:46,849 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-11 12:41:46,849 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-11 12:41:55,198 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-11 12:41:55,206 - __main__ - INFO - LLM 응답 길이: 1245 문자
2025-09-11 12:41:55,207 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "갤럭시 S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        },
        {
            "name"...
2025-09-11 12:41:55,207 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-11 12:41:55,207 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-11 12:41:55,207 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-11 12:41:55,207 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': '갤럭시 S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}, {'name': '인터넷+TV', 'action': '가입'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '가입'}, {'type': '전화번호', 'value': '080-801-0011', 'action': '수신 거부'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-11 12:41:55,207 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-11 12:41:55,207 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', '갤럭시 S24 FE', '아이폰17', '인터넷+TV']
2025-09-11 12:41:55,403 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 3050)
2025-09-11 12:41:55,403 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-11 12:41:55,403 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-11 12:41:55,951 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-11 12:41:56,244 - __main__ - INFO - extract_entities_by_llm 실행완료: 1.04초
2025-09-11 12:41:56,301 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-11 12:41:56,301 - __main__ - INFO - ============================================================
2025-09-11 12:41:56,301 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-11 12:41:56,301 - __main__ - INFO - ============================================================
2025-09-11 12:41:56,301 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-11 12:41:56,301 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-11 12:41:56,301 - __main__ - INFO - 상품 수: 2개
2025-09-11 12:41:56,301 - __main__ - INFO - 채널 수: 5개
2025-09-11 12:41:56,301 - __main__ - INFO - 프로그램 수: 2개
2025-09-11 12:41:56,301 - __main__ - INFO - process_message 실행완료: 10.82초
2025-09-11 12:41:56,301 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-11 12:51:50,133 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-11 12:51:50,133 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-11 12:51:50,133 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-11 12:51:50,133 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-09-11 12:51:50,133 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-11 12:51:50,134 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-11 12:51:50,198 - __main__ - INFO - Using device: mps
2025-09-11 12:51:50,199 - __main__ - INFO - _initialize_device 실행완료: 0.06초
2025-09-11 12:51:50,199 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-11 12:51:50,199 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-11 12:51:50,199 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-11 12:51:50,199 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-11 12:51:50,199 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-11 12:51:50,199 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-11 12:51:50,199 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-11 12:51:54,984 - __main__ - INFO - Model loaded on mps
2025-09-11 12:51:54,984 - __main__ - INFO - _initialize_embedding_model 실행완료: 4.78초
2025-09-11 12:51:54,984 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-11 12:51:55,683 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-11 12:51:55,683 - __main__ - INFO - _initialize_kiwi 실행완료: 0.70초
2025-09-11 12:51:55,683 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-11 12:51:55,683 - __main__ - INFO - ============================================================
2025-09-11 12:51:55,683 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-11 12:51:55,683 - __main__ - INFO - ============================================================
2025-09-11 12:51:55,683 - __main__ - INFO - 데이터 소스 모드: local
2025-09-11 12:51:55,683 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-11 12:51:55,683 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-11 12:51:55,683 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-11 12:51:55,683 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-11 12:51:55,823 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-11 12:51:55,823 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-11 12:51:55,824 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-11 12:51:55,827 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-11 12:51:55,828 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-11 12:51:55,828 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 12:51:55,829 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 12:51:55,829 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-11 12:51:55,829 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-11 12:51:55,936 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-11 12:51:55,940 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-11 12:51:55,940 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-11 12:51:55,940 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 12:51:55,940 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-11 12:51:55,940 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-11 12:51:55,941 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-11 12:51:55,941 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 12:51:55,941 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-11 12:51:55,941 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-11 12:51:55,941 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-11 12:51:56,016 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-11 12:51:56,017 - __main__ - INFO - null이 아닌 상품명 수: 10551개
2025-09-11 12:51:56,017 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 12:51:56,017 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-11 12:51:56,018 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 12:51:56,155 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-11 12:51:56,161 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 21522
2025-09-11 12:51:56,161 - __main__ - INFO - 별칭 적용 후 샘플: ['우주Pass Netflix 인증', '우주pass Netflix 인증', '우주패스 Netflix 인증', '우주패스 넷플릭스 인증', '우주PASS Netflix 인증']
2025-09-11 12:51:56,161 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-11 12:51:56,162 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (21522, 9)
2025-09-11 12:51:56,162 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-11 12:51:56,185 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-11 12:51:56,185 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-11 12:51:56,185 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-11 12:51:56,185 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-11 12:51:56,187 - __main__ - INFO - 등록할 고유 별칭 수: 16403개
2025-09-11 12:51:56,188 - __main__ - INFO - 유효한 별칭 수: 16403개
2025-09-11 12:51:56,188 - __main__ - INFO - 등록할 별칭 샘플: ['우주Pass Netflix 인증', '우주pass Netflix 인증', '우주패스 Netflix 인증', '우주패스 넷플릭스 인증', '우주PASS Netflix 인증']
2025-09-11 12:51:56,204 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16403개 성공, 0개 실패
2025-09-11 12:51:56,204 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-11 12:51:56,204 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-11 12:51:56,263 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-11 12:51:56,263 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-11 12:51:57,173 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-11 12:51:57,173 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-11 12:51:57,173 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-11 12:51:57,173 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-09-11 12:51:57,173 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-09-11 12:51:57,173 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-11 12:51:57,244 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-09-11 12:51:57,244 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-11 12:51:57,247 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-09-11 12:51:57,247 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-09-11 12:51:57,247 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-09-11 12:51:57,247 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 12:51:57,248 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-11 12:51:57,248 - __main__ - INFO - ============================================================
2025-09-11 12:51:57,248 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-11 12:51:57,248 - __main__ - INFO - ============================================================
2025-09-11 12:51:57,248 - __main__ - INFO - ✅ 상품 데이터: (21522, 9)
2025-09-11 12:51:57,248 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-11 12:51:57,248 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-11 12:51:57,248 - __main__ - INFO - ✅ 정지어: 166개
2025-09-11 12:51:57,248 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-11 12:51:57,250 - __main__ - INFO - 고유 상품명 수: 6847개
2025-09-11 12:51:57,252 - __main__ - INFO - 고유 별칭 수: 16403개
2025-09-11 12:51:57,253 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-11 12:51:57,253 - __main__ - INFO - _load_data 실행완료: 1.57초
2025-09-11 12:51:57,253 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-11 12:51:57,253 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-11 12:51:57,253 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-11 12:51:57,253 - __main__ - INFO - ============================================================
2025-09-11 12:51:57,253 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-11 12:51:57,253 - __main__ - INFO - ============================================================
2025-09-11 12:51:57,253 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-11 12:51:57,253 - __main__ - INFO - 메시지 길이: 420 문자
2025-09-11 12:51:57,253 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-11 12:51:57,253 - __main__ - INFO - 데이터 소스: local
2025-09-11 12:51:57,253 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-11 12:51:57,253 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-11 12:51:57,253 - __main__ - INFO - LLM 모델: ax
2025-09-11 12:51:57,253 - __main__ - INFO - 상품 데이터 크기: (21522, 9)
2025-09-11 12:51:57,253 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-11 12:51:57,253 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-11 12:51:57,253 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-11 12:51:57,253 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-11 12:51:57,255 - __main__ - INFO - 매칭할 상품 별칭 수: 16403개
2025-09-11 12:51:57,735 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-11 12:51:57,735 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-11 12:51:57,741 - __main__ - INFO - 전체 토큰 수: 155개
2025-09-11 12:51:57,741 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하', '갤럭시', 'A', '기기값', '아이폰', '을지로입구역', '하나은행', '명동']
2025-09-11 12:51:57,741 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['갤럭시', '아이폰', '기기값', '을지로입구역', '하나은행', '구매하', '명동']
2025-09-11 12:51:57,741 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-11 12:51:58,539 - __main__ - INFO - 퍼지 매칭 결과 크기: (1047, 3)
2025-09-11 12:51:58,539 - __main__ - INFO - 퍼지 매칭 성공: 1047개 결과
2025-09-11 12:51:58,540 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-11 12:51:58,540 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-11 12:51:58,580 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1047, 3)
2025-09-11 12:51:58,581 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-11 12:51:58,581 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-11 12:51:58,583 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 1개
2025-09-11 12:51:58,585 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 1개
2025-09-11 12:51:58,585 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-09-11 12:51:58,588 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시']
2025-09-11 12:51:58,590 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (1, 2)
2025-09-11 12:51:58,590 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-11 12:51:58,590 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.34초
2025-09-11 12:51:58,590 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시']
2025-09-11 12:51:58,590 - __main__ - INFO - 매칭된 상품 정보: (1, 2)
2025-09-11 12:51:58,590 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-11 12:51:58,686 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-11 12:51:58,687 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-11 12:51:58,687 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-11 12:51:58,687 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-11 12:51:58,687 - __main__ - INFO - 후보 아이템 리스트 크기: 1개
2025-09-11 12:51:58,687 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시']
2025-09-11 12:51:58,687 - __main__ - INFO - extra_item_pdf 크기: (1, 2)
2025-09-11 12:51:58,687 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-11 12:51:58,687 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-11 12:51:58,688 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 1개
2025-09-11 12:51:58,688 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': 'GALAXY', 'action': '기타'}]
2025-09-11 12:51:58,688 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-11 12:51:58,688 - __main__ - INFO - 구성된 프롬프트 길이: 5000 문자
2025-09-11 12:51:58,688 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-11 12:51:58,688 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 5000)
2025-09-11 12:51:58,688 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-11 12:51:58,688 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-11 12:52:07,004 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-11 12:52:07,013 - __main__ - INFO - LLM 응답 길이: 1245 문자
2025-09-11 12:52:07,014 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "갤럭시 S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        },
        {
            "name"...
2025-09-11 12:52:07,014 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-11 12:52:07,014 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-11 12:52:07,014 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-11 12:52:07,015 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': '갤럭시 S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}, {'name': '인터넷+TV', 'action': '가입'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '가입'}, {'type': '전화번호', 'value': '080-801-0011', 'action': '수신 거부'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-11 12:52:07,015 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-11 12:52:07,015 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', '갤럭시 S24 FE', '아이폰17', '인터넷+TV']
2025-09-11 12:52:07,210 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 3050)
2025-09-11 12:52:07,210 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-11 12:52:07,210 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-11 12:52:07,790 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-11 12:52:08,076 - __main__ - INFO - extract_entities_by_llm 실행완료: 1.06초
2025-09-11 12:52:08,133 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-11 12:52:08,133 - __main__ - INFO - ============================================================
2025-09-11 12:52:08,133 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-11 12:52:08,133 - __main__ - INFO - ============================================================
2025-09-11 12:52:08,133 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-11 12:52:08,133 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-11 12:52:08,133 - __main__ - INFO - 상품 수: 2개
2025-09-11 12:52:08,133 - __main__ - INFO - 채널 수: 5개
2025-09-11 12:52:08,133 - __main__ - INFO - 프로그램 수: 2개
2025-09-11 12:52:08,133 - __main__ - INFO - process_message 실행완료: 10.88초
2025-09-11 12:52:08,133 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-11 15:03:17,844 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-11 15:03:17,844 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-11 15:03:17,844 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-11 15:03:17,845 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-09-11 15:03:17,845 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-11 15:03:17,846 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-11 15:03:17,862 - __main__ - INFO - Using device: mps
2025-09-11 15:03:17,862 - __main__ - INFO - _initialize_device 실행완료: 0.02초
2025-09-11 15:03:17,862 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-11 15:03:17,862 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-11 15:03:17,862 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-11 15:03:17,862 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-11 15:03:17,862 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-11 15:03:17,863 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-11 15:03:17,863 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-11 15:03:18,981 - __main__ - INFO - Model loaded on mps
2025-09-11 15:03:18,981 - __main__ - INFO - _initialize_embedding_model 실행완료: 1.12초
2025-09-11 15:03:18,981 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-11 15:03:19,392 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-11 15:03:19,392 - __main__ - INFO - _initialize_kiwi 실행완료: 0.41초
2025-09-11 15:03:19,392 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-11 15:03:19,392 - __main__ - INFO - ============================================================
2025-09-11 15:03:19,392 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-11 15:03:19,392 - __main__ - INFO - ============================================================
2025-09-11 15:03:19,393 - __main__ - INFO - 데이터 소스 모드: local
2025-09-11 15:03:19,393 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-11 15:03:19,393 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-11 15:03:19,393 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-11 15:03:19,393 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-11 15:03:19,466 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-11 15:03:19,466 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-11 15:03:19,466 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-11 15:03:19,470 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-11 15:03:19,470 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-11 15:03:19,471 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 15:03:19,471 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 15:03:19,472 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-11 15:03:19,472 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-11 15:03:19,473 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-11 15:03:19,476 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-11 15:03:19,476 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-11 15:03:19,476 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 15:03:19,476 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-11 15:03:19,476 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-11 15:03:19,477 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-11 15:03:19,477 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 15:03:19,477 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-11 15:03:19,477 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-11 15:03:19,477 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-11 15:03:19,480 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-11 15:03:19,480 - __main__ - INFO - null이 아닌 상품명 수: 10551개
2025-09-11 15:03:19,480 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 15:03:19,480 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-11 15:03:19,481 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-11 15:03:19,605 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-11 15:03:19,609 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 21522
2025-09-11 15:03:19,610 - __main__ - INFO - 별칭 적용 후 샘플: ['우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증']
2025-09-11 15:03:19,610 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-11 15:03:19,610 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (21522, 9)
2025-09-11 15:03:19,610 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-11 15:03:19,611 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-11 15:03:19,611 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-11 15:03:19,611 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-11 15:03:19,611 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-11 15:03:19,613 - __main__ - INFO - 등록할 고유 별칭 수: 16403개
2025-09-11 15:03:19,613 - __main__ - INFO - 유효한 별칭 수: 16403개
2025-09-11 15:03:19,613 - __main__ - INFO - 등록할 별칭 샘플: ['우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증']
2025-09-11 15:03:19,629 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16403개 성공, 0개 실패
2025-09-11 15:03:19,629 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-11 15:03:19,629 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-11 15:03:19,631 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-11 15:03:19,632 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-11 15:03:19,814 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-11 15:03:19,815 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-11 15:03:19,815 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-11 15:03:19,815 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-09-11 15:03:19,815 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-09-11 15:03:19,815 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-11 15:03:19,880 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-09-11 15:03:19,880 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-11 15:03:19,882 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-09-11 15:03:19,883 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-09-11 15:03:19,883 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-09-11 15:03:19,883 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-11 15:03:19,883 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-09-11 15:03:19,884 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-11 15:03:19,884 - __main__ - INFO - ============================================================
2025-09-11 15:03:19,884 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-11 15:03:19,884 - __main__ - INFO - ============================================================
2025-09-11 15:03:19,884 - __main__ - INFO - ✅ 상품 데이터: (21522, 9)
2025-09-11 15:03:19,884 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-11 15:03:19,884 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-11 15:03:19,884 - __main__ - INFO - ✅ 정지어: 166개
2025-09-11 15:03:19,884 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-11 15:03:19,885 - __main__ - INFO - 고유 상품명 수: 6847개
2025-09-11 15:03:19,887 - __main__ - INFO - 고유 별칭 수: 16403개
2025-09-11 15:03:19,888 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-11 15:03:19,888 - __main__ - INFO - _load_data 실행완료: 0.50초
2025-09-11 15:03:19,888 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-11 15:03:19,888 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-11 15:03:19,888 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-11 15:03:19,888 - __main__ - INFO - ============================================================
2025-09-11 15:03:19,888 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-11 15:03:19,888 - __main__ - INFO - ============================================================
2025-09-11 15:03:19,888 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-11 15:03:19,888 - __main__ - INFO - 메시지 길이: 420 문자
2025-09-11 15:03:19,888 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-11 15:03:19,888 - __main__ - INFO - 데이터 소스: local
2025-09-11 15:03:19,888 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-11 15:03:19,888 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-11 15:03:19,888 - __main__ - INFO - LLM 모델: ax
2025-09-11 15:03:19,888 - __main__ - INFO - 상품 데이터 크기: (21522, 9)
2025-09-11 15:03:19,888 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-11 15:03:19,888 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-11 15:03:19,888 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-11 15:03:19,888 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-11 15:03:19,889 - __main__ - INFO - 매칭할 상품 별칭 수: 16403개
2025-09-11 15:03:20,352 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-11 15:03:20,352 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-11 15:03:20,356 - __main__ - INFO - 전체 토큰 수: 155개
2025-09-11 15:03:20,356 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하', '갤럭시', 'A', '기기값', '아이폰', '을지로입구역', '하나은행', '명동']
2025-09-11 15:03:20,356 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['을지로입구역', '아이폰', '기기값', '하나은행', '구매하', '명동', '갤럭시']
2025-09-11 15:03:20,356 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-11 15:03:21,113 - __main__ - INFO - 퍼지 매칭 결과 크기: (1047, 3)
2025-09-11 15:03:21,113 - __main__ - INFO - 퍼지 매칭 성공: 1047개 결과
2025-09-11 15:03:21,114 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-11 15:03:21,114 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-11 15:03:21,153 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1047, 3)
2025-09-11 15:03:21,154 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-11 15:03:21,154 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-11 15:03:21,156 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 1개
2025-09-11 15:03:21,157 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 1개
2025-09-11 15:03:21,158 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-09-11 15:03:21,160 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시']
2025-09-11 15:03:21,161 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (1, 2)
2025-09-11 15:03:21,162 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-11 15:03:21,162 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.27초
2025-09-11 15:03:21,162 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시']
2025-09-11 15:03:21,162 - __main__ - INFO - 매칭된 상품 정보: (1, 2)
2025-09-11 15:03:21,162 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-11 15:03:21,263 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-11 15:03:21,263 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-11 15:03:21,263 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-11 15:03:21,263 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-11 15:03:21,263 - __main__ - INFO - 후보 아이템 리스트 크기: 1개
2025-09-11 15:03:21,263 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시']
2025-09-11 15:03:21,263 - __main__ - INFO - extra_item_pdf 크기: (1, 2)
2025-09-11 15:03:21,263 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-11 15:03:21,264 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-11 15:03:21,265 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 1개
2025-09-11 15:03:21,265 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': 'GALAXY', 'action': '기타'}]
2025-09-11 15:03:21,265 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-11 15:03:21,265 - __main__ - INFO - 구성된 프롬프트 길이: 5000 문자
2025-09-11 15:03:21,265 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-11 15:03:21,265 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 5000)
2025-09-11 15:03:21,265 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-11 15:03:21,265 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-11 15:03:30,185 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-11 15:03:30,198 - __main__ - INFO - LLM 응답 길이: 1245 문자
2025-09-11 15:03:30,198 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "갤럭시 S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        },
        {
            "name"...
2025-09-11 15:03:30,198 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-11 15:03:30,199 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-11 15:03:30,199 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-11 15:03:30,199 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': '갤럭시 S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}, {'name': '인터넷+TV', 'action': '가입'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '가입'}, {'type': '전화번호', 'value': '080-801-0011', 'action': '수신 거부'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-11 15:03:30,199 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-11 15:03:30,199 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', '갤럭시 S24 FE', '아이폰17', '인터넷+TV']
2025-09-11 15:03:30,715 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-11 15:03:30,715 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 17480)
2025-09-11 15:03:30,715 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-11 15:03:30,715 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-11 15:03:31,269 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-11 15:03:31,518 - __main__ - INFO - extract_entities_by_llm 실행완료: 1.32초
2025-09-11 15:03:31,575 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-11 15:03:31,575 - __main__ - INFO - ============================================================
2025-09-11 15:03:31,575 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-11 15:03:31,575 - __main__ - INFO - ============================================================
2025-09-11 15:03:31,575 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-11 15:03:31,575 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-11 15:03:31,575 - __main__ - INFO - 상품 수: 1개
2025-09-11 15:03:31,575 - __main__ - INFO - 채널 수: 5개
2025-09-11 15:03:31,575 - __main__ - INFO - 프로그램 수: 2개
2025-09-11 15:03:31,575 - __main__ - INFO - process_message 실행완료: 11.69초
2025-09-11 15:03:31,575 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-19 12:49:49,150 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-19 12:49:49,152 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-19 12:49:49,152 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-19 12:49:49,152 - __main__ - INFO - 🎯 DAG 추출 모드 활성화됨
2025-09-19 12:49:49,152 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-19 12:49:49,153 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-19 12:49:49,208 - __main__ - INFO - Using device: mps
2025-09-19 12:49:49,208 - __main__ - INFO - _initialize_device 실행완료: 0.06초
2025-09-19 12:49:49,208 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-19 12:49:49,209 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-19 12:49:49,209 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-19 12:49:49,209 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-19 12:49:49,209 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-19 12:49:49,209 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-19 12:49:49,209 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-19 12:49:54,067 - __main__ - INFO - Model loaded on mps
2025-09-19 12:49:54,067 - __main__ - INFO - _initialize_embedding_model 실행완료: 4.86초
2025-09-19 12:49:54,067 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-19 12:49:54,573 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-19 12:49:54,573 - __main__ - INFO - _initialize_kiwi 실행완료: 0.51초
2025-09-19 12:49:54,573 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-19 12:49:54,573 - __main__ - INFO - ============================================================
2025-09-19 12:49:54,573 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-19 12:49:54,573 - __main__ - INFO - ============================================================
2025-09-19 12:49:54,573 - __main__ - INFO - 데이터 소스 모드: local
2025-09-19 12:49:54,573 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-19 12:49:54,573 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-19 12:49:54,573 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-19 12:49:54,574 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-19 12:49:54,646 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-19 12:49:54,646 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-19 12:49:54,647 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-19 12:49:54,652 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-19 12:49:54,652 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-19 12:49:54,653 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-19 12:49:54,653 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-19 12:49:54,654 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-19 12:49:54,654 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-19 12:49:54,661 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-19 12:49:54,663 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-19 12:49:54,663 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-19 12:49:54,663 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-19 12:49:54,663 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-19 12:49:54,663 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-19 12:49:54,664 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-19 12:49:54,664 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-19 12:49:54,664 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-19 12:49:54,664 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-19 12:49:54,664 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-19 12:49:54,669 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-19 12:49:54,669 - __main__ - INFO - null이 아닌 상품명 수: 10551개
2025-09-19 12:49:54,669 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-19 12:49:54,669 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-19 12:49:54,670 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-19 12:49:54,799 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-19 12:49:54,805 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 21522
2025-09-19 12:49:54,806 - __main__ - INFO - 별칭 적용 후 샘플: ['우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주패스 넷플릭스 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증']
2025-09-19 12:49:54,806 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-19 12:49:54,806 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (21522, 9)
2025-09-19 12:49:54,806 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-19 12:49:54,807 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-19 12:49:54,807 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-19 12:49:54,807 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-19 12:49:54,807 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-19 12:49:54,809 - __main__ - INFO - 등록할 고유 별칭 수: 16403개
2025-09-19 12:49:54,810 - __main__ - INFO - 유효한 별칭 수: 16403개
2025-09-19 12:49:54,810 - __main__ - INFO - 등록할 별칭 샘플: ['우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주패스 넷플릭스 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증']
2025-09-19 12:49:54,822 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16403개 성공, 0개 실패
2025-09-19 12:49:54,822 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-19 12:49:54,822 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-19 12:49:54,834 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-19 12:49:54,834 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-19 12:49:55,054 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-19 12:49:55,055 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-19 12:49:55,055 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-19 12:49:55,055 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-09-19 12:49:55,055 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-09-19 12:49:55,055 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-19 12:49:55,123 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-09-19 12:49:55,123 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-19 12:49:55,124 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-09-19 12:49:55,124 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-09-19 12:49:55,125 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-09-19 12:49:55,125 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-19 12:49:55,125 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-09-19 12:49:55,125 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-19 12:49:55,125 - __main__ - INFO - ============================================================
2025-09-19 12:49:55,125 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-19 12:49:55,125 - __main__ - INFO - ============================================================
2025-09-19 12:49:55,125 - __main__ - INFO - ✅ 상품 데이터: (21522, 9)
2025-09-19 12:49:55,125 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-19 12:49:55,125 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-19 12:49:55,125 - __main__ - INFO - ✅ 정지어: 166개
2025-09-19 12:49:55,125 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-19 12:49:55,126 - __main__ - INFO - 고유 상품명 수: 6847개
2025-09-19 12:49:55,128 - __main__ - INFO - 고유 별칭 수: 16403개
2025-09-19 12:49:55,129 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-19 12:49:55,129 - __main__ - INFO - _load_data 실행완료: 0.56초
2025-09-19 12:49:55,129 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-19 12:49:55,129 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-19 12:49:55,129 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-19 12:49:55,129 - __main__ - INFO - ============================================================
2025-09-19 12:49:55,129 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-19 12:49:55,129 - __main__ - INFO - ============================================================
2025-09-19 12:49:55,129 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-19 12:49:55,129 - __main__ - INFO - 메시지 길이: 421 문자
2025-09-19 12:49:55,129 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-19 12:49:55,129 - __main__ - INFO - 데이터 소스: local
2025-09-19 12:49:55,129 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-19 12:49:55,129 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-19 12:49:55,129 - __main__ - INFO - LLM 모델: ax
2025-09-19 12:49:55,129 - __main__ - INFO - 상품 데이터 크기: (21522, 9)
2025-09-19 12:49:55,129 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-19 12:49:55,129 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-19 12:49:55,129 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-19 12:49:55,129 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-19 12:49:55,131 - __main__ - INFO - 매칭할 상품 별칭 수: 16403개
2025-09-19 12:49:55,588 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-19 12:49:55,588 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-19 12:49:55,591 - __main__ - INFO - 전체 토큰 수: 155개
2025-09-19 12:49:55,591 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하', '갤럭시', 'A', '기기값', '아이폰', '을지로입구역', '하나은행', '명동']
2025-09-19 12:49:55,591 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['아이폰', '하나은행', '구매하', '명동', '갤럭시', '을지로입구역', '기기값']
2025-09-19 12:49:55,591 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-19 12:49:56,031 - __main__ - INFO - 퍼지 매칭 결과 크기: (1047, 3)
2025-09-19 12:49:56,032 - __main__ - INFO - 퍼지 매칭 성공: 1047개 결과
2025-09-19 12:49:56,032 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-19 12:49:56,032 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-19 12:49:56,058 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1047, 3)
2025-09-19 12:49:56,059 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-19 12:49:56,059 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-19 12:49:56,061 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 1개
2025-09-19 12:49:56,062 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 1개
2025-09-19 12:49:56,062 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-09-19 12:49:56,065 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시']
2025-09-19 12:49:56,066 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (1, 2)
2025-09-19 12:49:56,066 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-19 12:49:56,066 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 0.94초
2025-09-19 12:49:56,066 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시']
2025-09-19 12:49:56,066 - __main__ - INFO - 매칭된 상품 정보: (1, 2)
2025-09-19 12:49:56,066 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-19 12:49:56,154 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-19 12:49:56,154 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-19 12:49:56,154 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-19 12:49:56,154 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-19 12:49:56,155 - __main__ - INFO - 후보 아이템 리스트 크기: 1개
2025-09-19 12:49:56,155 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시']
2025-09-19 12:49:56,155 - __main__ - INFO - extra_item_pdf 크기: (1, 2)
2025-09-19 12:49:56,155 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-19 12:49:56,155 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-19 12:49:56,156 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 1개
2025-09-19 12:49:56,156 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': 'GALAXY', 'action': '기타'}]
2025-09-19 12:49:56,156 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-19 12:49:56,156 - __main__ - INFO - 구성된 프롬프트 길이: 5000 문자
2025-09-19 12:49:56,156 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-19 12:49:56,156 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 5000)
2025-09-19 12:49:56,156 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-19 12:49:56,156 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-19 12:50:04,611 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-19 12:50:04,625 - __main__ - INFO - LLM 응답 길이: 1245 문자
2025-09-19 12:50:04,626 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "갤럭시 S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        },
        {
            "name"...
2025-09-19 12:50:04,626 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-19 12:50:04,626 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-19 12:50:04,626 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-19 12:50:04,626 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': '갤럭시 S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}, {'name': '인터넷+TV', 'action': '가입'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '가입'}, {'type': '전화번호', 'value': '080-801-0011', 'action': '수신 거부'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-19 12:50:04,626 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-19 12:50:04,626 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', '갤럭시 S24 FE', '아이폰17', '인터넷+TV']
2025-09-19 12:50:05,001 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-19 12:50:05,001 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 17480)
2025-09-19 12:50:05,001 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-19 12:50:05,001 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-19 12:50:06,545 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-19 12:50:06,722 - __main__ - INFO - extract_entities_by_llm 실행완료: 2.10초
2025-09-19 12:50:06,754 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-19 12:50:06,754 - __main__ - INFO - ============================================================
2025-09-19 12:50:06,754 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-19 12:50:06,754 - __main__ - INFO - ============================================================
2025-09-19 12:50:06,754 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-19 12:50:06,754 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-19 12:50:06,754 - __main__ - INFO - 상품 수: 1개
2025-09-19 12:50:06,754 - __main__ - INFO - 채널 수: 5개
2025-09-19 12:50:06,754 - __main__ - INFO - 프로그램 수: 2개
2025-09-19 12:50:06,754 - __main__ - INFO - process_message 실행완료: 11.63초
2025-09-19 12:50:06,754 - __main__ - INFO - 순차적 처리로 메인 추출 및 DAG 추출 수행
2025-09-19 12:50:06,754 - __main__ - INFO - ============================== DAG 추출 시작 ==============================
2025-09-19 12:50:06,755 - entity_dag_extractor - INFO - 🚀 DAG 추출 프로세스 시작
2025-09-19 12:50:06,755 - entity_dag_extractor - INFO - 📝 입력 메시지 길이: 421자
2025-09-19 12:50:06,755 - entity_dag_extractor - INFO - 🤖 사용 LLM 모델: client=<openai.resources.chat.completions.completions.Completions object at 0x128f93410> async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x128f93770> root_client=<openai.OpenAI object at 0x1291e5f20> root_async_client=<openai.AsyncOpenAI object at 0x128f93530> model_name='skt/ax4' temperature=0.0 model_kwargs={} openai_api_key=SecretStr('**********') openai_api_base='https://api.platform.a15t.com/v1' max_tokens=4000
2025-09-19 12:50:06,755 - entity_dag_extractor - INFO - 🤖 LLM에 DAG 추출 요청 중...
2025-09-19 12:50:06,755 - entity_dag_extractor - INFO - 📏 프롬프트 길이: 3406자
2025-09-19 12:50:35,449 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-19 12:50:35,453 - entity_dag_extractor - INFO - 📝 LLM 응답 길이: 3198자
2025-09-19 12:50:35,453 - entity_dag_extractor - INFO - 📄 LLM 응답 미리보기: ## 1. 메시지 분석

```
[메시지 요약 및 핵심 의도]
SKT 을지로점에서 9월 중 갤럭시 시리즈와 아이폰17에 대한 특별 할인 및 혜택을 제공하며, SK로 통신사 이동 시 추가 혜택을 안내함. 매장 방문과 온라인 사전예약을 통해 기기 구매 및 통신사 이동을 유도하고 있음.

[식별된 가치 제안 목록]
- 갤럭시 시리즈(와이드8, A36, S24 F...
2025-09-19 12:50:35,453 - entity_dag_extractor - INFO - 🔍 DAG 섹션 추출 중...
2025-09-19 12:50:35,454 - entity_dag_extractor - INFO - 📄 추출된 DAG 섹션 길이: 284자
2025-09-19 12:50:35,454 - entity_dag_extractor - INFO - 🔗 DAG 파싱 중...
2025-09-19 12:50:35,455 - entity_dag_extractor - INFO - 📊 파싱된 DAG - 노드 수: 11, 엣지 수: 9
2025-09-19 12:50:35,455 - entity_dag_extractor - INFO - 🎯 DAG 노드 목록: ['을지로점:방문', '갤럭시:구매', '기기값할인:수령', '추가할인:수령', '통신사:이동', '상품권:수령', '인터넷TV:가입', '현금지원:수령', '온라인링크:접속', '아이폰17:사전예약', '바로개통:수령']
2025-09-19 12:50:35,455 - entity_dag_extractor - INFO - 🔗 DAG 엣지 목록: [('을지로점:방문', '갤럭시:구매'), ('을지로점:방문', '통신사:이동'), ('갤럭시:구매', '기기값할인:수령'), ('갤럭시:구매', '추가할인:수령'), ('통신사:이동', '상품권:수령'), ('통신사:이동', '인터넷TV:가입'), ('인터넷TV:가입', '현금지원:수령'), ('온라인링크:접속', '아이폰17:사전예약'), ('아이폰17:사전예약', '바로개통:수령')]
2025-09-19 12:50:35,455 - entity_dag_extractor - INFO - ✅ DAG 추출 프로세스 완료
2025-09-19 12:50:35,456 - utils - INFO - 🎨 DAG 다이어그램 생성 시작 - 파일명: dag_ea42c65e2727ae609ac65fcfbeae8a3ccd3131f39e75b2236c29bf21305dca18
2025-09-19 12:50:35,456 - utils - INFO - 📊 입력 그래프 - 노드 수: 11, 엣지 수: 9
2025-09-19 12:50:35,458 - utils - INFO - 🖼️ DAG 이미지 렌더링 중...
2025-09-19 12:50:36,481 - utils - INFO - ✅ DAG 다이어그램 생성 완료: dag_images/dag_ea42c65e2727ae609ac65fcfbeae8a3ccd3131f39e75b2236c29bf21305dca18.png
2025-09-19 12:50:36,482 - __main__ - INFO - ✅ DAG 추출 완료: dag_ea42c65e2727ae609ac65fcfbeae8a3ccd3131f39e75b2236c29bf21305dca18
2025-09-19 12:50:36,482 - __main__ - INFO - 🕒 DAG 처리 시간: 29.727초
2025-09-19 12:50:36,482 - __main__ - INFO - 📏 DAG 섹션 길이: 284자
2025-09-19 12:50:36,482 - __main__ - INFO - 📄 DAG 내용 미리보기: (을지로점:방문) -[방문하면]-> (갤럭시:구매)
(갤럭시:구매) -[구매하면]-> (기기값할인:수령)
(갤럭시:구매) -[구매후 제휴카드사용하면]-> (추가할인:수령)
(을지로점:방문) -[방문하면]-> (통신사:이동)
(통신사:이동) -[이동하면]-> (상품권:수령)
(통신사:이동) -[이동하면]-> (인터넷TV:가입)
(인터넷TV:가입) -[가입하면...
2025-09-19 12:50:36,482 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-19 12:50:37,065 - mongodb_utils - INFO - MongoDB 연결 성공: aos.mmsext
2025-09-19 12:50:37,067 - mongodb_utils - INFO - 문서 저장 성공: 68ccd30dd4cb39cb1ae1e705
2025-09-19 12:50:37,068 - mongodb_utils - INFO - MongoDB 연결 해제
2025-09-19 16:03:44,949 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-19 16:03:44,949 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-19 16:03:44,949 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-19 16:03:44,949 - __main__ - INFO - 🎯 DAG 추출 모드 활성화됨
2025-09-19 16:03:44,949 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-19 16:03:44,950 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-19 16:03:44,967 - __main__ - INFO - Using device: mps
2025-09-19 16:03:44,967 - __main__ - INFO - _initialize_device 실행완료: 0.02초
2025-09-19 16:03:44,967 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-19 16:03:44,968 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-19 16:03:44,968 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-19 16:03:44,968 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-19 16:03:44,968 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-19 16:03:44,968 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-19 16:03:44,968 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-19 16:03:46,077 - __main__ - INFO - Model loaded on mps
2025-09-19 16:03:46,077 - __main__ - INFO - _initialize_embedding_model 실행완료: 1.11초
2025-09-19 16:03:46,077 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-19 16:03:46,505 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-19 16:03:46,505 - __main__ - INFO - _initialize_kiwi 실행완료: 0.43초
2025-09-19 16:03:46,505 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-19 16:03:46,505 - __main__ - INFO - ============================================================
2025-09-19 16:03:46,506 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-19 16:03:46,506 - __main__ - INFO - ============================================================
2025-09-19 16:03:46,506 - __main__ - INFO - 데이터 소스 모드: local
2025-09-19 16:03:46,506 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-19 16:03:46,506 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-19 16:03:46,506 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-19 16:03:46,506 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-19 16:03:46,570 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-19 16:03:46,570 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-19 16:03:46,570 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-19 16:03:46,574 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-19 16:03:46,574 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-19 16:03:46,575 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-19 16:03:46,575 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-19 16:03:46,576 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-19 16:03:46,576 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-19 16:03:46,578 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-19 16:03:46,580 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-19 16:03:46,580 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-19 16:03:46,580 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-19 16:03:46,581 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-19 16:03:46,581 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-19 16:03:46,581 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-19 16:03:46,581 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-19 16:03:46,581 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-19 16:03:46,581 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-19 16:03:46,581 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-19 16:03:46,582 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-19 16:03:46,583 - __main__ - INFO - null이 아닌 상품명 수: 10551개
2025-09-19 16:03:46,583 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-19 16:03:46,583 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-19 16:03:46,583 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-19 16:03:46,710 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-19 16:03:46,715 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 21522
2025-09-19 16:03:46,716 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 Netflix 인증', '우주패스 넷플릭스 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증']
2025-09-19 16:03:46,716 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-19 16:03:46,716 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (21522, 9)
2025-09-19 16:03:46,716 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-19 16:03:46,717 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-19 16:03:46,717 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-19 16:03:46,717 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-19 16:03:46,717 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-19 16:03:46,719 - __main__ - INFO - 등록할 고유 별칭 수: 16403개
2025-09-19 16:03:46,720 - __main__ - INFO - 유효한 별칭 수: 16403개
2025-09-19 16:03:46,720 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 Netflix 인증', '우주패스 넷플릭스 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증']
2025-09-19 16:03:46,734 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16403개 성공, 0개 실패
2025-09-19 16:03:46,734 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-19 16:03:46,734 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-19 16:03:46,736 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-19 16:03:46,736 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-19 16:03:46,915 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-19 16:03:46,916 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-19 16:03:46,916 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-19 16:03:46,916 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-09-19 16:03:46,916 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-09-19 16:03:46,916 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-19 16:03:46,984 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-09-19 16:03:46,984 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-19 16:03:46,986 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-09-19 16:03:46,986 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-09-19 16:03:46,986 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-09-19 16:03:46,986 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-19 16:03:46,986 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-09-19 16:03:46,987 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-19 16:03:46,987 - __main__ - INFO - ============================================================
2025-09-19 16:03:46,987 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-19 16:03:46,987 - __main__ - INFO - ============================================================
2025-09-19 16:03:46,987 - __main__ - INFO - ✅ 상품 데이터: (21522, 9)
2025-09-19 16:03:46,987 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-19 16:03:46,987 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-19 16:03:46,987 - __main__ - INFO - ✅ 정지어: 166개
2025-09-19 16:03:46,987 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-19 16:03:46,988 - __main__ - INFO - 고유 상품명 수: 6847개
2025-09-19 16:03:46,990 - __main__ - INFO - 고유 별칭 수: 16403개
2025-09-19 16:03:46,991 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-19 16:03:46,991 - __main__ - INFO - _load_data 실행완료: 0.49초
2025-09-19 16:03:46,991 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-19 16:03:46,991 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-19 16:03:46,991 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-19 16:03:46,991 - __main__ - INFO - ============================================================
2025-09-19 16:03:46,991 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-19 16:03:46,991 - __main__ - INFO - ============================================================
2025-09-19 16:03:46,991 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-19 16:03:46,991 - __main__ - INFO - 메시지 길이: 421 문자
2025-09-19 16:03:46,991 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-19 16:03:46,991 - __main__ - INFO - 데이터 소스: local
2025-09-19 16:03:46,991 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-19 16:03:46,992 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-19 16:03:46,992 - __main__ - INFO - LLM 모델: ax
2025-09-19 16:03:46,992 - __main__ - INFO - 상품 데이터 크기: (21522, 9)
2025-09-19 16:03:46,992 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-19 16:03:46,992 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-19 16:03:46,992 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-19 16:03:46,992 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-19 16:03:46,993 - __main__ - INFO - 매칭할 상품 별칭 수: 16403개
2025-09-19 16:03:47,474 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-19 16:03:47,475 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-19 16:03:47,478 - __main__ - INFO - 전체 토큰 수: 155개
2025-09-19 16:03:47,478 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하', '갤럭시', 'A', '기기값', '아이폰', '을지로입구역', '하나은행', '명동']
2025-09-19 16:03:47,478 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['하나은행', '명동', '을지로입구역', '아이폰', '구매하', '갤럭시', '기기값']
2025-09-19 16:03:47,478 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-19 16:03:48,367 - __main__ - INFO - 퍼지 매칭 결과 크기: (1047, 3)
2025-09-19 16:03:48,367 - __main__ - INFO - 퍼지 매칭 성공: 1047개 결과
2025-09-19 16:03:48,368 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-19 16:03:48,368 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-19 16:03:48,407 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1047, 3)
2025-09-19 16:03:48,408 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-19 16:03:48,408 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-19 16:03:48,410 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 1개
2025-09-19 16:03:48,412 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 1개
2025-09-19 16:03:48,413 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-09-19 16:03:48,415 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시']
2025-09-19 16:03:48,417 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (1, 2)
2025-09-19 16:03:48,417 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-19 16:03:48,417 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.43초
2025-09-19 16:03:48,417 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시']
2025-09-19 16:03:48,417 - __main__ - INFO - 매칭된 상품 정보: (1, 2)
2025-09-19 16:03:48,417 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-19 16:03:48,510 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-19 16:03:48,510 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-19 16:03:48,510 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-19 16:03:48,510 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-19 16:03:48,510 - __main__ - INFO - 후보 아이템 리스트 크기: 1개
2025-09-19 16:03:48,510 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시']
2025-09-19 16:03:48,510 - __main__ - INFO - extra_item_pdf 크기: (1, 2)
2025-09-19 16:03:48,510 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-19 16:03:48,510 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-19 16:03:48,511 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 1개
2025-09-19 16:03:48,511 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': 'GALAXY', 'action': '기타'}]
2025-09-19 16:03:48,511 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-19 16:03:48,512 - __main__ - INFO - 구성된 프롬프트 길이: 5000 문자
2025-09-19 16:03:48,512 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-19 16:03:48,512 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 5000)
2025-09-19 16:03:48,512 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-19 16:03:48,512 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-19 16:03:57,670 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-19 16:03:57,684 - __main__ - INFO - LLM 응답 길이: 1245 문자
2025-09-19 16:03:57,684 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "갤럭시 S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        },
        {
            "name"...
2025-09-19 16:03:57,684 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-19 16:03:57,684 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-19 16:03:57,685 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-19 16:03:57,685 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': '갤럭시 S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}, {'name': '인터넷+TV', 'action': '가입'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '가입'}, {'type': '전화번호', 'value': '080-801-0011', 'action': '수신 거부'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-19 16:03:57,685 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-19 16:03:57,685 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', '갤럭시 S24 FE', '아이폰17', '인터넷+TV']
2025-09-19 16:03:58,184 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-19 16:03:58,185 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 17480)
2025-09-19 16:03:58,185 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-19 16:03:58,185 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-19 16:03:59,703 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-19 16:03:59,974 - __main__ - INFO - extract_entities_by_llm 실행완료: 2.29초
2025-09-19 16:04:00,031 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-19 16:04:00,031 - __main__ - INFO - ============================================================
2025-09-19 16:04:00,031 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-19 16:04:00,031 - __main__ - INFO - ============================================================
2025-09-19 16:04:00,031 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-19 16:04:00,031 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-19 16:04:00,031 - __main__ - INFO - 상품 수: 1개
2025-09-19 16:04:00,031 - __main__ - INFO - 채널 수: 5개
2025-09-19 16:04:00,031 - __main__ - INFO - 프로그램 수: 2개
2025-09-19 16:04:00,031 - __main__ - INFO - process_message 실행완료: 13.04초
2025-09-19 16:04:00,031 - __main__ - INFO - 순차적 처리로 메인 추출 및 DAG 추출 수행
2025-09-19 16:04:00,031 - __main__ - INFO - ============================== DAG 추출 시작 ==============================
2025-09-19 16:04:00,032 - entity_dag_extractor - INFO - 🚀 DAG 추출 프로세스 시작
2025-09-19 16:04:00,032 - entity_dag_extractor - INFO - 📝 입력 메시지 길이: 421자
2025-09-19 16:04:00,032 - entity_dag_extractor - INFO - 🤖 사용 LLM 모델: client=<openai.resources.chat.completions.completions.Completions object at 0x34550d790> async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x3500f9400> root_client=<openai.OpenAI object at 0x34546bf50> root_async_client=<openai.AsyncOpenAI object at 0x34550c110> model_name='skt/ax4' temperature=0.0 model_kwargs={} openai_api_key=SecretStr('**********') openai_api_base='https://api.platform.a15t.com/v1' max_tokens=4000
2025-09-19 16:04:00,032 - entity_dag_extractor - INFO - 🤖 LLM에 DAG 추출 요청 중...
2025-09-19 16:04:00,032 - entity_dag_extractor - INFO - 📏 프롬프트 길이: 3406자
2025-09-19 16:04:29,438 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-19 16:04:29,441 - entity_dag_extractor - INFO - 📝 LLM 응답 길이: 3008자
2025-09-19 16:04:29,441 - entity_dag_extractor - INFO - 📄 LLM 응답 미리보기: ## 1. 메시지 분석

```
[메시지 요약 및 핵심 의도]
SKT 을지로점에서 9월 중 갤럭시 시리즈와 아이폰17에 대한 특별 할인 및 혜택을 제공하며, SK로 통신사 이동 시 추가 혜택을 안내함. 매장 방문과 온라인 사전예약을 통해 기기 구매 및 통신사 이동을 유도하고 있음.

[식별된 가치 제안 목록]
- 갤럭시 시리즈(와이드8, A36, S24 F...
2025-09-19 16:04:29,441 - entity_dag_extractor - INFO - 🔍 DAG 섹션 추출 중...
2025-09-19 16:04:29,442 - entity_dag_extractor - INFO - 📄 추출된 DAG 섹션 길이: 312자
2025-09-19 16:04:29,442 - entity_dag_extractor - INFO - 🔗 DAG 파싱 중...
2025-09-19 16:04:29,443 - entity_dag_extractor - INFO - 📊 파싱된 DAG - 노드 수: 12, 엣지 수: 10
2025-09-19 16:04:29,443 - entity_dag_extractor - INFO - 🎯 DAG 노드 목록: ['을지로점:방문', '갤럭시:구매', '기기값할인:수령', '추가할인:수령', '통신사:이동', '상품권:수령', '인터넷TV:가입', '현금지원:수령', '온라인링크:접속', '아이폰17:사전예약', '바로개통:수령', '아이폰17:구매']
2025-09-19 16:04:29,443 - entity_dag_extractor - INFO - 🔗 DAG 엣지 목록: [('을지로점:방문', '갤럭시:구매'), ('을지로점:방문', '통신사:이동'), ('갤럭시:구매', '기기값할인:수령'), ('갤럭시:구매', '추가할인:수령'), ('통신사:이동', '상품권:수령'), ('통신사:이동', '인터넷TV:가입'), ('인터넷TV:가입', '현금지원:수령'), ('온라인링크:접속', '아이폰17:사전예약'), ('아이폰17:사전예약', '바로개통:수령'), ('아이폰17:사전예약', '아이폰17:구매')]
2025-09-19 16:04:29,443 - entity_dag_extractor - INFO - ✅ DAG 추출 프로세스 완료
2025-09-19 16:04:29,444 - utils - INFO - 🎨 DAG 다이어그램 생성 시작 - 파일명: dag_ea42c65e2727ae609ac65fcfbeae8a3ccd3131f39e75b2236c29bf21305dca18
2025-09-19 16:04:29,444 - utils - INFO - 📊 입력 그래프 - 노드 수: 12, 엣지 수: 10
2025-09-19 16:04:29,446 - utils - INFO - 🖼️ DAG 이미지 렌더링 중...
2025-09-19 16:04:29,665 - utils - INFO - ✅ DAG 다이어그램 생성 완료: dag_images/dag_ea42c65e2727ae609ac65fcfbeae8a3ccd3131f39e75b2236c29bf21305dca18.png
2025-09-19 16:04:29,665 - __main__ - INFO - ✅ DAG 추출 완료: dag_ea42c65e2727ae609ac65fcfbeae8a3ccd3131f39e75b2236c29bf21305dca18
2025-09-19 16:04:29,665 - __main__ - INFO - 🕒 DAG 처리 시간: 29.634초
2025-09-19 16:04:29,665 - __main__ - INFO - 📏 DAG 섹션 길이: 312자
2025-09-19 16:04:29,666 - __main__ - INFO - 📄 DAG 내용 미리보기: (을지로점:방문) -[방문하면]-> (갤럭시:구매)
(갤럭시:구매) -[구매하면]-> (기기값할인:수령)
(갤럭시:구매) -[제휴카드사용하면]-> (추가할인:수령)
(을지로점:방문) -[방문하면]-> (통신사:이동)
(통신사:이동) -[이동하면]-> (상품권:수령)
(통신사:이동) -[이동후]-> (인터넷TV:가입)
(인터넷TV:가입) -[가입하면]-> (...
2025-09-19 16:04:29,666 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-19 16:04:29,743 - mongodb_utils - INFO - MongoDB 연결 성공: aos.mmsext
2025-09-19 16:04:29,744 - mongodb_utils - INFO - 문서 저장 성공: 68cd007df56630caefcaa11c
2025-09-19 16:04:29,744 - mongodb_utils - INFO - MongoDB 연결 해제
2025-09-19 16:23:51,078 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-19 16:23:51,079 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-19 16:23:51,079 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-19 16:23:51,079 - __main__ - INFO - 🎯 DAG 추출 모드 활성화됨
2025-09-19 16:23:51,079 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-19 16:23:51,083 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-19 16:23:51,103 - __main__ - INFO - Using device: mps
2025-09-19 16:23:51,104 - __main__ - INFO - _initialize_device 실행완료: 0.02초
2025-09-19 16:23:51,104 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-19 16:23:51,104 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-19 16:23:51,104 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-19 16:23:51,104 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-19 16:23:51,104 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-19 16:23:51,104 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-19 16:23:51,104 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-19 16:23:52,546 - __main__ - INFO - Model loaded on mps
2025-09-19 16:23:52,546 - __main__ - INFO - _initialize_embedding_model 실행완료: 1.44초
2025-09-19 16:23:52,546 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-19 16:23:52,980 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-19 16:23:52,980 - __main__ - INFO - _initialize_kiwi 실행완료: 0.43초
2025-09-19 16:23:52,980 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-19 16:23:52,980 - __main__ - INFO - ============================================================
2025-09-19 16:23:52,980 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-19 16:23:52,980 - __main__ - INFO - ============================================================
2025-09-19 16:23:52,980 - __main__ - INFO - 데이터 소스 모드: local
2025-09-19 16:23:52,980 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-19 16:23:52,980 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-19 16:23:52,980 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-19 16:23:52,980 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-19 16:23:53,047 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-19 16:23:53,047 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-19 16:23:53,047 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-19 16:23:53,051 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-19 16:23:53,052 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-19 16:23:53,052 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-19 16:23:53,052 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-19 16:23:53,053 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-19 16:23:53,053 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-19 16:23:53,054 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-19 16:23:53,057 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-19 16:23:53,057 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-19 16:23:53,057 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-19 16:23:53,057 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-19 16:23:53,057 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-19 16:23:53,058 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-19 16:23:53,058 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-19 16:23:53,058 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-19 16:23:53,058 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-19 16:23:53,058 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-19 16:23:53,059 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-19 16:23:53,059 - __main__ - INFO - null이 아닌 상품명 수: 10551개
2025-09-19 16:23:53,059 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-19 16:23:53,060 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-19 16:23:53,060 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-19 16:23:53,184 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-19 16:23:53,189 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 21522
2025-09-19 16:23:53,189 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 넷플릭스 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증', '우주pass Netflix 인증']
2025-09-19 16:23:53,189 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-19 16:23:53,190 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (21522, 9)
2025-09-19 16:23:53,190 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-19 16:23:53,191 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-19 16:23:53,191 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-19 16:23:53,191 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-19 16:23:53,191 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-19 16:23:53,193 - __main__ - INFO - 등록할 고유 별칭 수: 16403개
2025-09-19 16:23:53,193 - __main__ - INFO - 유효한 별칭 수: 16403개
2025-09-19 16:23:53,193 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 넷플릭스 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증', '우주pass Netflix 인증']
2025-09-19 16:23:53,209 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16403개 성공, 0개 실패
2025-09-19 16:23:53,209 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-19 16:23:53,209 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-19 16:23:53,211 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-19 16:23:53,211 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-19 16:23:53,384 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-19 16:23:53,384 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-19 16:23:53,384 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-19 16:23:53,384 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-09-19 16:23:53,384 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-09-19 16:23:53,384 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-19 16:23:53,453 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-09-19 16:23:53,454 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-19 16:23:53,456 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-09-19 16:23:53,456 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-09-19 16:23:53,456 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-09-19 16:23:53,456 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-19 16:23:53,456 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-09-19 16:23:53,457 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-19 16:23:53,457 - __main__ - INFO - ============================================================
2025-09-19 16:23:53,457 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-19 16:23:53,457 - __main__ - INFO - ============================================================
2025-09-19 16:23:53,457 - __main__ - INFO - ✅ 상품 데이터: (21522, 9)
2025-09-19 16:23:53,457 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-19 16:23:53,457 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-19 16:23:53,457 - __main__ - INFO - ✅ 정지어: 166개
2025-09-19 16:23:53,457 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-19 16:23:53,458 - __main__ - INFO - 고유 상품명 수: 6847개
2025-09-19 16:23:53,460 - __main__ - INFO - 고유 별칭 수: 16403개
2025-09-19 16:23:53,461 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-19 16:23:53,461 - __main__ - INFO - _load_data 실행완료: 0.48초
2025-09-19 16:23:53,461 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-19 16:23:53,461 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-19 16:23:53,461 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-19 16:23:53,461 - __main__ - INFO - ============================================================
2025-09-19 16:23:53,461 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-19 16:23:53,461 - __main__ - INFO - ============================================================
2025-09-19 16:23:53,461 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-19 16:23:53,461 - __main__ - INFO - 메시지 길이: 421 문자
2025-09-19 16:23:53,461 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-19 16:23:53,461 - __main__ - INFO - 데이터 소스: local
2025-09-19 16:23:53,461 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-19 16:23:53,461 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-19 16:23:53,461 - __main__ - INFO - LLM 모델: ax
2025-09-19 16:23:53,461 - __main__ - INFO - 상품 데이터 크기: (21522, 9)
2025-09-19 16:23:53,461 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-19 16:23:53,461 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-19 16:23:53,461 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-19 16:23:53,461 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-19 16:23:53,463 - __main__ - INFO - 매칭할 상품 별칭 수: 16403개
2025-09-19 16:23:53,938 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-19 16:23:53,939 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-19 16:23:53,942 - __main__ - INFO - 전체 토큰 수: 155개
2025-09-19 16:23:53,942 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하', '갤럭시', 'A', '기기값', '아이폰', '을지로입구역', '하나은행', '명동']
2025-09-19 16:23:53,942 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['구매하', '아이폰', '명동', '을지로입구역', '하나은행', '갤럭시', '기기값']
2025-09-19 16:23:53,942 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-19 16:23:54,762 - __main__ - INFO - 퍼지 매칭 결과 크기: (1047, 3)
2025-09-19 16:23:54,763 - __main__ - INFO - 퍼지 매칭 성공: 1047개 결과
2025-09-19 16:23:54,763 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-19 16:23:54,763 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-19 16:23:54,915 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1047, 3)
2025-09-19 16:23:54,916 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-19 16:23:54,916 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-19 16:23:54,918 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 1개
2025-09-19 16:23:54,920 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 1개
2025-09-19 16:23:54,920 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-09-19 16:23:54,922 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시']
2025-09-19 16:23:54,923 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (1, 2)
2025-09-19 16:23:54,924 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-19 16:23:54,924 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.46초
2025-09-19 16:23:54,924 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시']
2025-09-19 16:23:54,924 - __main__ - INFO - 매칭된 상품 정보: (1, 2)
2025-09-19 16:23:54,924 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-19 16:23:55,113 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-19 16:23:55,113 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-19 16:23:55,113 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-19 16:23:55,113 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-19 16:23:55,113 - __main__ - INFO - 후보 아이템 리스트 크기: 1개
2025-09-19 16:23:55,113 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시']
2025-09-19 16:23:55,113 - __main__ - INFO - extra_item_pdf 크기: (1, 2)
2025-09-19 16:23:55,113 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-19 16:23:55,113 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-19 16:23:55,114 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 1개
2025-09-19 16:23:55,114 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': 'GALAXY', 'action': '기타'}]
2025-09-19 16:23:55,114 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-19 16:23:55,114 - __main__ - INFO - 구성된 프롬프트 길이: 5000 문자
2025-09-19 16:23:55,114 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-19 16:23:55,114 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 5000)
2025-09-19 16:23:55,114 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-19 16:23:55,114 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-19 16:24:04,850 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-19 16:24:04,866 - __main__ - INFO - LLM 응답 길이: 1245 문자
2025-09-19 16:24:04,866 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "갤럭시 S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        },
        {
            "name"...
2025-09-19 16:24:04,866 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-19 16:24:04,867 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-19 16:24:04,867 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-19 16:24:04,867 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': '갤럭시 S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}, {'name': '인터넷+TV', 'action': '가입'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '가입'}, {'type': '전화번호', 'value': '080-801-0011', 'action': '수신 거부'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-19 16:24:04,867 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-19 16:24:04,867 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', '갤럭시 S24 FE', '아이폰17', '인터넷+TV']
2025-09-19 16:24:05,361 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-19 16:24:05,361 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 17480)
2025-09-19 16:24:05,361 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-19 16:24:05,361 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-19 16:24:06,910 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-19 16:24:07,182 - __main__ - INFO - extract_entities_by_llm 실행완료: 2.31초
2025-09-19 16:24:07,238 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-19 16:24:07,238 - __main__ - INFO - ============================================================
2025-09-19 16:24:07,238 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-19 16:24:07,238 - __main__ - INFO - ============================================================
2025-09-19 16:24:07,238 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-19 16:24:07,238 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-19 16:24:07,238 - __main__ - INFO - 상품 수: 1개
2025-09-19 16:24:07,238 - __main__ - INFO - 채널 수: 5개
2025-09-19 16:24:07,238 - __main__ - INFO - 프로그램 수: 2개
2025-09-19 16:24:07,238 - __main__ - INFO - process_message 실행완료: 13.78초
2025-09-19 16:24:07,238 - __main__ - INFO - 순차적 처리로 메인 추출 및 DAG 추출 수행
2025-09-19 16:24:07,238 - __main__ - INFO - ============================== DAG 추출 시작 ==============================
2025-09-19 16:24:07,238 - entity_dag_extractor - INFO - 🚀 DAG 추출 프로세스 시작
2025-09-19 16:24:07,238 - entity_dag_extractor - INFO - 📝 입력 메시지 길이: 421자
2025-09-19 16:24:07,239 - entity_dag_extractor - INFO - 🤖 사용 LLM 모델: client=<openai.resources.chat.completions.completions.Completions object at 0x3315a3080> async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x3472388f0> root_client=<openai.OpenAI object at 0x3315d02c0> root_async_client=<openai.AsyncOpenAI object at 0x3315a0b30> model_name='skt/ax4' temperature=0.0 model_kwargs={} openai_api_key=SecretStr('**********') openai_api_base='https://api.platform.a15t.com/v1' max_tokens=4000
2025-09-19 16:24:07,239 - entity_dag_extractor - INFO - 🤖 LLM에 DAG 추출 요청 중...
2025-09-19 16:24:07,239 - entity_dag_extractor - INFO - 📏 프롬프트 길이: 3406자
2025-09-19 16:24:37,343 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-19 16:24:37,346 - entity_dag_extractor - INFO - 📝 LLM 응답 길이: 3010자
2025-09-19 16:24:37,346 - entity_dag_extractor - INFO - 📄 LLM 응답 미리보기: ## 1. 메시지 분석

```
[메시지 요약 및 핵심 의도]
SKT 을지로점에서 9월 중 갤럭시 시리즈와 아이폰17에 대한 특별 할인 및 혜택을 제공하며, SK로 통신사 이동 시 추가 혜택을 안내함. 매장 방문과 온라인 사전예약을 통해 기기 구매 및 통신사 이동을 유도하고 있음.

[식별된 가치 제안 목록]
- 갤럭시 시리즈(와이드8, A36, S24 F...
2025-09-19 16:24:37,346 - entity_dag_extractor - INFO - 🔍 DAG 섹션 추출 중...
2025-09-19 16:24:37,347 - entity_dag_extractor - INFO - 📄 추출된 DAG 섹션 길이: 295자
2025-09-19 16:24:37,347 - entity_dag_extractor - INFO - 🔗 DAG 파싱 중...
2025-09-19 16:24:37,348 - entity_dag_extractor - INFO - 📊 파싱된 DAG - 노드 수: 11, 엣지 수: 9
2025-09-19 16:24:37,349 - entity_dag_extractor - INFO - 🎯 DAG 노드 목록: ['을지로점:방문', '갤럭시:구매', '기기값할인:수령', '추가할인:수령', '통신사:이동', '상품권:수령', '인터넷+TV혜택:수령', '온라인링크:접속', '아이폰17:사전예약', '아이폰17:구매', '바로개통:수령']
2025-09-19 16:24:37,349 - entity_dag_extractor - INFO - 🔗 DAG 엣지 목록: [('을지로점:방문', '갤럭시:구매'), ('을지로점:방문', '통신사:이동'), ('갤럭시:구매', '기기값할인:수령'), ('갤럭시:구매', '추가할인:수령'), ('통신사:이동', '상품권:수령'), ('통신사:이동', '인터넷+TV혜택:수령'), ('온라인링크:접속', '아이폰17:사전예약'), ('아이폰17:사전예약', '아이폰17:구매'), ('아이폰17:구매', '바로개통:수령')]
2025-09-19 16:24:37,349 - entity_dag_extractor - INFO - ✅ DAG 추출 프로세스 완료
2025-09-19 16:24:37,350 - utils - INFO - 🎨 DAG 다이어그램 생성 시작 - 파일명: dag_ea42c65e2727ae609ac65fcfbeae8a3ccd3131f39e75b2236c29bf21305dca18
2025-09-19 16:24:37,350 - utils - INFO - 📊 입력 그래프 - 노드 수: 11, 엣지 수: 9
2025-09-19 16:24:37,352 - utils - INFO - 🖼️ DAG 이미지 렌더링 중...
2025-09-19 16:24:37,945 - utils - INFO - ✅ DAG 다이어그램 생성 완료: dag_images/dag_ea42c65e2727ae609ac65fcfbeae8a3ccd3131f39e75b2236c29bf21305dca18.png
2025-09-19 16:24:37,945 - __main__ - INFO - ✅ DAG 추출 완료: dag_ea42c65e2727ae609ac65fcfbeae8a3ccd3131f39e75b2236c29bf21305dca18
2025-09-19 16:24:37,945 - __main__ - INFO - 🕒 DAG 처리 시간: 30.706초
2025-09-19 16:24:37,945 - __main__ - INFO - 📏 DAG 섹션 길이: 295자
2025-09-19 16:24:37,945 - __main__ - INFO - 📄 DAG 내용 미리보기: (을지로점:방문) -[방문하면]-> (갤럭시:구매)
(갤럭시:구매) -[구매하면]-> (기기값할인:수령)
(갤럭시:구매) -[구매후, 제휴카드사용하면]-> (추가할인:수령)
(을지로점:방문) -[방문하면]-> (통신사:이동)
(통신사:이동) -[이동하면]-> (상품권:수령)
(통신사:이동) -[이동후, 인터넷+TV가입하면]-> (인터넷+TV혜택:수령)
(온...
2025-09-19 16:24:37,945 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-19 16:24:38,386 - mongodb_utils - INFO - MongoDB 연결 성공: aos.mmsext
2025-09-19 16:24:38,388 - mongodb_utils - INFO - 문서 저장 성공: 68cd0536ca3b4a824cfb485d
2025-09-19 16:24:38,388 - mongodb_utils - INFO - MongoDB 연결 해제
2025-09-22 20:50:18,364 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-22 20:50:18,364 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-22 20:50:18,364 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-22 20:50:18,364 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-09-22 20:50:18,364 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-22 20:50:18,366 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-22 20:50:18,433 - __main__ - INFO - Using device: mps
2025-09-22 20:50:18,433 - __main__ - INFO - _initialize_device 실행완료: 0.07초
2025-09-22 20:50:18,433 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-22 20:50:18,434 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-22 20:50:18,434 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-22 20:50:18,434 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-22 20:50:18,434 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-22 20:50:18,434 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-22 20:50:18,434 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-22 20:50:22,573 - __main__ - INFO - Model loaded on mps
2025-09-22 20:50:22,573 - __main__ - INFO - _initialize_embedding_model 실행완료: 4.14초
2025-09-22 20:50:22,573 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-22 20:50:23,055 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-22 20:50:23,055 - __main__ - INFO - _initialize_kiwi 실행완료: 0.48초
2025-09-22 20:50:23,055 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-22 20:50:23,055 - __main__ - INFO - ============================================================
2025-09-22 20:50:23,055 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-22 20:50:23,055 - __main__ - INFO - ============================================================
2025-09-22 20:50:23,055 - __main__ - INFO - 데이터 소스 모드: local
2025-09-22 20:50:23,055 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-22 20:50:23,055 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-22 20:50:23,055 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-22 20:50:23,055 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-22 20:50:23,128 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-22 20:50:23,128 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-22 20:50:23,128 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-22 20:50:23,135 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-22 20:50:23,136 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-22 20:50:23,136 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-22 20:50:23,137 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-22 20:50:23,137 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-22 20:50:23,137 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-22 20:50:23,145 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-22 20:50:23,147 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-22 20:50:23,147 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-22 20:50:23,147 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-22 20:50:23,147 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-22 20:50:23,147 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-22 20:50:23,147 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-22 20:50:23,147 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-22 20:50:23,147 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-22 20:50:23,147 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-22 20:50:23,147 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-22 20:50:23,155 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-22 20:50:23,155 - __main__ - INFO - null이 아닌 상품명 수: 10551개
2025-09-22 20:50:23,156 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-22 20:50:23,156 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-22 20:50:23,156 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-22 20:50:23,281 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-22 20:50:23,285 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 21522
2025-09-22 20:50:23,286 - __main__ - INFO - 별칭 적용 후 샘플: ['우주Pass Netflix 인증', '우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증']
2025-09-22 20:50:23,286 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-22 20:50:23,286 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (21522, 9)
2025-09-22 20:50:23,286 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-22 20:50:23,287 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-22 20:50:23,287 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-22 20:50:23,287 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-22 20:50:23,287 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-22 20:50:23,289 - __main__ - INFO - 등록할 고유 별칭 수: 16403개
2025-09-22 20:50:23,290 - __main__ - INFO - 유효한 별칭 수: 16403개
2025-09-22 20:50:23,290 - __main__ - INFO - 등록할 별칭 샘플: ['우주Pass Netflix 인증', '우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증']
2025-09-22 20:50:23,304 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16403개 성공, 0개 실패
2025-09-22 20:50:23,304 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-22 20:50:23,304 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-22 20:50:23,317 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-22 20:50:23,317 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-22 20:50:23,558 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-22 20:50:23,558 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-22 20:50:23,558 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-22 20:50:23,558 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-09-22 20:50:23,558 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-09-22 20:50:23,558 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-22 20:50:23,626 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-09-22 20:50:23,626 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-22 20:50:23,628 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-09-22 20:50:23,629 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-09-22 20:50:23,629 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-09-22 20:50:23,629 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-22 20:50:23,629 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-09-22 20:50:23,629 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-22 20:50:23,629 - __main__ - INFO - ============================================================
2025-09-22 20:50:23,629 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-22 20:50:23,629 - __main__ - INFO - ============================================================
2025-09-22 20:50:23,629 - __main__ - INFO - ✅ 상품 데이터: (21522, 9)
2025-09-22 20:50:23,629 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-22 20:50:23,629 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-22 20:50:23,629 - __main__ - INFO - ✅ 정지어: 166개
2025-09-22 20:50:23,629 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-22 20:50:23,631 - __main__ - INFO - 고유 상품명 수: 6847개
2025-09-22 20:50:23,633 - __main__ - INFO - 고유 별칭 수: 16403개
2025-09-22 20:50:23,634 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-22 20:50:23,634 - __main__ - INFO - _load_data 실행완료: 0.58초
2025-09-22 20:50:23,634 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-22 20:50:23,634 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-22 20:50:23,634 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-22 20:50:23,634 - __main__ - INFO - ============================================================
2025-09-22 20:50:23,634 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-22 20:50:23,634 - __main__ - INFO - ============================================================
2025-09-22 20:50:23,634 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-22 20:50:23,634 - __main__ - INFO - 메시지 길이: 421 문자
2025-09-22 20:50:23,634 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-22 20:50:23,634 - __main__ - INFO - 데이터 소스: local
2025-09-22 20:50:23,634 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-22 20:50:23,634 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-22 20:50:23,634 - __main__ - INFO - LLM 모델: ax
2025-09-22 20:50:23,634 - __main__ - INFO - 상품 데이터 크기: (21522, 9)
2025-09-22 20:50:23,634 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-22 20:50:23,634 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-22 20:50:23,634 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-22 20:50:23,634 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-22 20:50:23,635 - __main__ - INFO - 매칭할 상품 별칭 수: 16403개
2025-09-22 20:50:24,104 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-22 20:50:24,105 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-22 20:50:24,108 - __main__ - INFO - 전체 토큰 수: 155개
2025-09-22 20:50:24,108 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하', '갤럭시', 'A', '기기값', '아이폰', '을지로입구역', '하나은행', '명동']
2025-09-22 20:50:24,108 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['하나은행', '아이폰', '갤럭시', '명동', '기기값', '을지로입구역', '구매하']
2025-09-22 20:50:24,108 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-22 20:50:24,921 - __main__ - INFO - 퍼지 매칭 결과 크기: (1047, 3)
2025-09-22 20:50:24,922 - __main__ - INFO - 퍼지 매칭 성공: 1047개 결과
2025-09-22 20:50:24,922 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-22 20:50:24,922 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-22 20:50:24,963 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1047, 3)
2025-09-22 20:50:24,963 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-22 20:50:24,963 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-22 20:50:24,966 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 1개
2025-09-22 20:50:24,968 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 1개
2025-09-22 20:50:24,968 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-09-22 20:50:24,971 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시']
2025-09-22 20:50:24,972 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (1, 2)
2025-09-22 20:50:24,973 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-22 20:50:24,973 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.34초
2025-09-22 20:50:24,973 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시']
2025-09-22 20:50:24,973 - __main__ - INFO - 매칭된 상품 정보: (1, 2)
2025-09-22 20:50:24,973 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-22 20:50:25,073 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-22 20:50:25,073 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-22 20:50:25,073 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-22 20:50:25,073 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-22 20:50:25,073 - __main__ - INFO - 후보 아이템 리스트 크기: 1개
2025-09-22 20:50:25,073 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시']
2025-09-22 20:50:25,073 - __main__ - INFO - extra_item_pdf 크기: (1, 2)
2025-09-22 20:50:25,073 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-22 20:50:25,074 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-22 20:50:25,075 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 1개
2025-09-22 20:50:25,075 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': 'GALAXY', 'action': '기타'}]
2025-09-22 20:50:25,075 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-22 20:50:25,075 - __main__ - INFO - 구성된 프롬프트 길이: 5000 문자
2025-09-22 20:50:25,075 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-22 20:50:25,075 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 5000)
2025-09-22 20:50:25,075 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-22 20:50:25,075 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-22 20:50:45,842 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-22 20:50:45,846 - __main__ - INFO - LLM 응답 길이: 1245 문자
2025-09-22 20:50:45,847 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "갤럭시 S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        },
        {
            "name"...
2025-09-22 20:50:45,847 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-22 20:50:45,847 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-22 20:50:45,847 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-22 20:50:45,847 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': '갤럭시 S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}, {'name': '인터넷+TV', 'action': '가입'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '가입'}, {'type': '전화번호', 'value': '080-801-0011', 'action': '수신 거부'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-22 20:50:45,848 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-22 20:50:45,848 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', '갤럭시 S24 FE', '아이폰17', '인터넷+TV']
2025-09-22 20:50:46,358 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 17480)
2025-09-22 20:50:46,358 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-22 20:50:46,358 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-22 20:50:46,358 - __main__ - INFO - 🔄 1개 LLM 모델로 엔티티 추출 시작
2025-09-22 20:50:46,358 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-22 20:50:49,255 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-22 20:50:49,256 - __main__ - INFO - ✅ LLM 추출 완료: 5개 후보 엔티티
2025-09-22 20:50:49,503 - __main__ - INFO - extract_entities_by_llm 실행완료: 3.65초
2025-09-22 20:50:49,560 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-22 20:50:49,560 - __main__ - INFO - ============================================================
2025-09-22 20:50:49,560 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-22 20:50:49,560 - __main__ - INFO - ============================================================
2025-09-22 20:50:49,560 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-22 20:50:49,560 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-22 20:50:49,560 - __main__ - INFO - 상품 수: 1개
2025-09-22 20:50:49,560 - __main__ - INFO - 채널 수: 5개
2025-09-22 20:50:49,560 - __main__ - INFO - 프로그램 수: 2개
2025-09-22 20:50:49,561 - __main__ - INFO - process_message 실행완료: 25.93초
2025-09-22 20:50:49,561 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-22 20:56:30,060 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-22 20:56:30,060 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-22 20:56:30,060 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-22 20:56:30,060 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-09-22 20:56:30,060 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-22 20:56:30,061 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-22 20:56:30,080 - __main__ - INFO - Using device: mps
2025-09-22 20:56:30,080 - __main__ - INFO - _initialize_device 실행완료: 0.02초
2025-09-22 20:56:30,080 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-22 20:56:30,081 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-22 20:56:30,081 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-22 20:56:30,081 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-22 20:56:30,081 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-22 20:56:30,081 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-22 20:56:30,081 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-22 20:56:31,042 - __main__ - INFO - Model loaded on mps
2025-09-22 20:56:31,042 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.96초
2025-09-22 20:56:31,042 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-22 20:56:31,471 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-22 20:56:31,471 - __main__ - INFO - _initialize_kiwi 실행완료: 0.43초
2025-09-22 20:56:31,471 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-22 20:56:31,471 - __main__ - INFO - ============================================================
2025-09-22 20:56:31,471 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-22 20:56:31,471 - __main__ - INFO - ============================================================
2025-09-22 20:56:31,471 - __main__ - INFO - 데이터 소스 모드: local
2025-09-22 20:56:31,471 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-22 20:56:31,471 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-22 20:56:31,471 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-22 20:56:31,471 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-22 20:56:31,539 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-22 20:56:31,539 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-22 20:56:31,539 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-22 20:56:31,542 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-22 20:56:31,543 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-22 20:56:31,543 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-22 20:56:31,544 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-22 20:56:31,544 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-22 20:56:31,544 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-22 20:56:31,547 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-22 20:56:31,549 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-22 20:56:31,549 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-22 20:56:31,549 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-22 20:56:31,549 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-22 20:56:31,549 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-22 20:56:31,549 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-22 20:56:31,549 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-22 20:56:31,549 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-22 20:56:31,549 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-22 20:56:31,550 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-22 20:56:31,551 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-22 20:56:31,551 - __main__ - INFO - null이 아닌 상품명 수: 10551개
2025-09-22 20:56:31,551 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-22 20:56:31,551 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-22 20:56:31,552 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-22 20:56:31,683 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-22 20:56:31,689 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 21522
2025-09-22 20:56:31,689 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증', '우주pass Netflix 인증']
2025-09-22 20:56:31,689 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-22 20:56:31,690 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (21522, 9)
2025-09-22 20:56:31,690 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-22 20:56:31,691 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-22 20:56:31,691 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-22 20:56:31,691 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-22 20:56:31,691 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-22 20:56:31,693 - __main__ - INFO - 등록할 고유 별칭 수: 16403개
2025-09-22 20:56:31,694 - __main__ - INFO - 유효한 별칭 수: 16403개
2025-09-22 20:56:31,694 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증', '우주pass Netflix 인증']
2025-09-22 20:56:31,709 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16403개 성공, 0개 실패
2025-09-22 20:56:31,709 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-22 20:56:31,709 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-22 20:56:31,711 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-22 20:56:31,711 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-22 20:56:31,891 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-22 20:56:31,891 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-22 20:56:31,891 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-22 20:56:31,891 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-09-22 20:56:31,891 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-09-22 20:56:31,891 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-22 20:56:31,959 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-09-22 20:56:31,959 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-22 20:56:31,962 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-09-22 20:56:31,962 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-09-22 20:56:31,962 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-09-22 20:56:31,962 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-22 20:56:31,962 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-09-22 20:56:31,963 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-22 20:56:31,963 - __main__ - INFO - ============================================================
2025-09-22 20:56:31,963 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-22 20:56:31,963 - __main__ - INFO - ============================================================
2025-09-22 20:56:31,963 - __main__ - INFO - ✅ 상품 데이터: (21522, 9)
2025-09-22 20:56:31,963 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-22 20:56:31,963 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-22 20:56:31,963 - __main__ - INFO - ✅ 정지어: 166개
2025-09-22 20:56:31,963 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-22 20:56:31,964 - __main__ - INFO - 고유 상품명 수: 6847개
2025-09-22 20:56:31,966 - __main__ - INFO - 고유 별칭 수: 16403개
2025-09-22 20:56:31,967 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-22 20:56:31,967 - __main__ - INFO - _load_data 실행완료: 0.50초
2025-09-22 20:56:31,967 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-22 20:56:31,967 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-22 20:56:31,967 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-22 20:56:31,967 - __main__ - INFO - ============================================================
2025-09-22 20:56:31,967 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-22 20:56:31,968 - __main__ - INFO - ============================================================
2025-09-22 20:56:31,968 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-22 20:56:31,968 - __main__ - INFO - 메시지 길이: 421 문자
2025-09-22 20:56:31,968 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-22 20:56:31,968 - __main__ - INFO - 데이터 소스: local
2025-09-22 20:56:31,968 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-22 20:56:31,968 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-22 20:56:31,968 - __main__ - INFO - LLM 모델: ax
2025-09-22 20:56:31,968 - __main__ - INFO - 상품 데이터 크기: (21522, 9)
2025-09-22 20:56:31,968 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-22 20:56:31,968 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-22 20:56:31,968 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-22 20:56:31,968 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-22 20:56:31,970 - __main__ - INFO - 매칭할 상품 별칭 수: 16403개
2025-09-22 20:56:32,441 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-22 20:56:32,441 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-22 20:56:32,444 - __main__ - INFO - 전체 토큰 수: 155개
2025-09-22 20:56:32,445 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하', '갤럭시', 'A', '기기값', '아이폰', '을지로입구역', '하나은행', '명동']
2025-09-22 20:56:32,445 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['을지로입구역', '갤럭시', '구매하', '기기값', '명동', '아이폰', '하나은행']
2025-09-22 20:56:32,445 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-22 20:56:33,247 - __main__ - INFO - 퍼지 매칭 결과 크기: (1047, 3)
2025-09-22 20:56:33,247 - __main__ - INFO - 퍼지 매칭 성공: 1047개 결과
2025-09-22 20:56:33,248 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-22 20:56:33,248 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-22 20:56:33,287 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1047, 3)
2025-09-22 20:56:33,288 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-22 20:56:33,288 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-22 20:56:33,290 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 1개
2025-09-22 20:56:33,292 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 1개
2025-09-22 20:56:33,292 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-09-22 20:56:33,295 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시']
2025-09-22 20:56:33,296 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (1, 2)
2025-09-22 20:56:33,297 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-22 20:56:33,297 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.33초
2025-09-22 20:56:33,297 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시']
2025-09-22 20:56:33,297 - __main__ - INFO - 매칭된 상품 정보: (1, 2)
2025-09-22 20:56:33,297 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-22 20:56:33,401 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-22 20:56:33,401 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-22 20:56:33,401 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-22 20:56:33,402 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-22 20:56:33,402 - __main__ - INFO - 후보 아이템 리스트 크기: 1개
2025-09-22 20:56:33,402 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시']
2025-09-22 20:56:33,402 - __main__ - INFO - extra_item_pdf 크기: (1, 2)
2025-09-22 20:56:33,402 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-22 20:56:33,402 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-22 20:56:33,403 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 1개
2025-09-22 20:56:33,403 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': 'GALAXY', 'action': '기타'}]
2025-09-22 20:56:33,403 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-22 20:56:33,403 - __main__ - INFO - 구성된 프롬프트 길이: 5000 문자
2025-09-22 20:56:33,403 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-22 20:56:33,403 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 5000)
2025-09-22 20:56:33,403 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-22 20:56:33,403 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-22 20:56:46,081 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-22 20:56:46,090 - __main__ - INFO - LLM 응답 길이: 1245 문자
2025-09-22 20:56:46,090 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "갤럭시 S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        },
        {
            "name"...
2025-09-22 20:56:46,090 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-22 20:56:46,091 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-22 20:56:46,091 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-22 20:56:46,091 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': '갤럭시 S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}, {'name': '인터넷+TV', 'action': '가입'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '가입'}, {'type': '전화번호', 'value': '080-801-0011', 'action': '수신 거부'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-22 20:56:46,091 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-22 20:56:46,091 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', '갤럭시 S24 FE', '아이폰17', '인터넷+TV']
2025-09-22 20:56:46,092 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-09-22 20:56:46,092 - __main__ - INFO - ✅ LLM 모델 초기화 완료: gpt (azure/openai/gpt-4o-2024-08-06)
2025-09-22 20:56:46,092 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-09-22 20:56:46,602 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 17480)
2025-09-22 20:56:46,602 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-22 20:56:46,602 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-22 20:56:46,602 - __main__ - INFO - 🔄 3개 LLM 모델로 엔티티 추출 시작
2025-09-22 20:56:46,616 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-22 20:56:46,616 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-22 20:56:46,617 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-22 20:56:47,983 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-22 20:56:48,144 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-22 20:56:50,348 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-22 20:56:50,353 - __main__ - INFO - ✅ LLM 추출 완료: 7개 후보 엔티티
2025-09-22 20:56:50,656 - __main__ - INFO - extract_entities_by_llm 실행완료: 4.56초
2025-09-22 20:56:50,716 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-22 20:56:50,716 - __main__ - INFO - ============================================================
2025-09-22 20:56:50,716 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-22 20:56:50,716 - __main__ - INFO - ============================================================
2025-09-22 20:56:50,716 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-22 20:56:50,716 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-22 20:56:50,716 - __main__ - INFO - 상품 수: 2개
2025-09-22 20:56:50,716 - __main__ - INFO - 채널 수: 5개
2025-09-22 20:56:50,716 - __main__ - INFO - 프로그램 수: 2개
2025-09-22 20:56:50,716 - __main__ - INFO - process_message 실행완료: 18.75초
2025-09-22 20:56:50,716 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-22 21:00:22,098 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-22 21:00:22,099 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-22 21:00:22,099 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-22 21:00:22,099 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-09-22 21:00:22,099 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-22 21:00:22,100 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-22 21:00:22,118 - __main__ - INFO - Using device: mps
2025-09-22 21:00:22,118 - __main__ - INFO - _initialize_device 실행완료: 0.02초
2025-09-22 21:00:22,118 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-22 21:00:22,118 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-22 21:00:22,118 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-22 21:00:22,118 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-22 21:00:22,118 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-22 21:00:22,119 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-22 21:00:22,119 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-22 21:00:23,172 - __main__ - INFO - Model loaded on mps
2025-09-22 21:00:23,173 - __main__ - INFO - _initialize_embedding_model 실행완료: 1.05초
2025-09-22 21:00:23,173 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-22 21:00:23,607 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-22 21:00:23,607 - __main__ - INFO - _initialize_kiwi 실행완료: 0.43초
2025-09-22 21:00:23,607 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-22 21:00:23,607 - __main__ - INFO - ============================================================
2025-09-22 21:00:23,607 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-22 21:00:23,607 - __main__ - INFO - ============================================================
2025-09-22 21:00:23,607 - __main__ - INFO - 데이터 소스 모드: local
2025-09-22 21:00:23,607 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-22 21:00:23,607 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-22 21:00:23,607 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-22 21:00:23,607 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-22 21:00:23,677 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-22 21:00:23,677 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-22 21:00:23,677 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-22 21:00:23,681 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-22 21:00:23,682 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-22 21:00:23,682 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-22 21:00:23,683 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-22 21:00:23,683 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-22 21:00:23,683 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-22 21:00:23,687 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-22 21:00:23,690 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-22 21:00:23,690 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-22 21:00:23,690 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-22 21:00:23,690 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-22 21:00:23,691 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-22 21:00:23,691 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-22 21:00:23,691 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-22 21:00:23,691 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-22 21:00:23,691 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-22 21:00:23,691 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-22 21:00:23,693 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-22 21:00:23,693 - __main__ - INFO - null이 아닌 상품명 수: 10551개
2025-09-22 21:00:23,693 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-22 21:00:23,693 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-22 21:00:23,694 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-22 21:00:23,818 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-22 21:00:23,823 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 21522
2025-09-22 21:00:23,824 - __main__ - INFO - 별칭 적용 후 샘플: ['우주pass Netflix 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주패스 넷플릭스 인증']
2025-09-22 21:00:23,824 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-22 21:00:23,824 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (21522, 9)
2025-09-22 21:00:23,824 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-22 21:00:23,825 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-22 21:00:23,825 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-22 21:00:23,825 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-22 21:00:23,825 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-22 21:00:23,827 - __main__ - INFO - 등록할 고유 별칭 수: 16403개
2025-09-22 21:00:23,828 - __main__ - INFO - 유효한 별칭 수: 16403개
2025-09-22 21:00:23,828 - __main__ - INFO - 등록할 별칭 샘플: ['우주pass Netflix 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주패스 넷플릭스 인증']
2025-09-22 21:00:23,841 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16403개 성공, 0개 실패
2025-09-22 21:00:23,841 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-22 21:00:23,841 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-22 21:00:23,844 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-22 21:00:23,844 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-22 21:00:24,016 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-22 21:00:24,016 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-22 21:00:24,016 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-22 21:00:24,016 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-09-22 21:00:24,016 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-09-22 21:00:24,016 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-22 21:00:24,085 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-09-22 21:00:24,085 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-22 21:00:24,088 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-09-22 21:00:24,088 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-09-22 21:00:24,088 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-09-22 21:00:24,088 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-22 21:00:24,088 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-09-22 21:00:24,089 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-22 21:00:24,089 - __main__ - INFO - ============================================================
2025-09-22 21:00:24,089 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-22 21:00:24,089 - __main__ - INFO - ============================================================
2025-09-22 21:00:24,089 - __main__ - INFO - ✅ 상품 데이터: (21522, 9)
2025-09-22 21:00:24,089 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-22 21:00:24,089 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-22 21:00:24,089 - __main__ - INFO - ✅ 정지어: 166개
2025-09-22 21:00:24,089 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-22 21:00:24,090 - __main__ - INFO - 고유 상품명 수: 6847개
2025-09-22 21:00:24,092 - __main__ - INFO - 고유 별칭 수: 16403개
2025-09-22 21:00:24,093 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-22 21:00:24,093 - __main__ - INFO - _load_data 실행완료: 0.49초
2025-09-22 21:00:24,093 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-22 21:00:24,093 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-22 21:00:24,093 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-22 21:00:24,093 - __main__ - INFO - ============================================================
2025-09-22 21:00:24,093 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-22 21:00:24,093 - __main__ - INFO - ============================================================
2025-09-22 21:00:24,093 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-22 21:00:24,093 - __main__ - INFO - 메시지 길이: 421 문자
2025-09-22 21:00:24,093 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-22 21:00:24,093 - __main__ - INFO - 데이터 소스: local
2025-09-22 21:00:24,093 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-22 21:00:24,093 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-22 21:00:24,093 - __main__ - INFO - LLM 모델: ax
2025-09-22 21:00:24,093 - __main__ - INFO - 상품 데이터 크기: (21522, 9)
2025-09-22 21:00:24,093 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-22 21:00:24,093 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-22 21:00:24,093 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-22 21:00:24,093 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-22 21:00:24,095 - __main__ - INFO - 매칭할 상품 별칭 수: 16403개
2025-09-22 21:00:24,566 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-22 21:00:24,566 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-22 21:00:24,570 - __main__ - INFO - 전체 토큰 수: 155개
2025-09-22 21:00:24,570 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하', '갤럭시', 'A', '기기값', '아이폰', '을지로입구역', '하나은행', '명동']
2025-09-22 21:00:24,570 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['명동', '아이폰', '구매하', '을지로입구역', '하나은행', '기기값', '갤럭시']
2025-09-22 21:00:24,570 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-22 21:00:25,369 - __main__ - INFO - 퍼지 매칭 결과 크기: (1047, 3)
2025-09-22 21:00:25,369 - __main__ - INFO - 퍼지 매칭 성공: 1047개 결과
2025-09-22 21:00:25,370 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-22 21:00:25,370 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-22 21:00:25,408 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1047, 3)
2025-09-22 21:00:25,409 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-22 21:00:25,409 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-22 21:00:25,411 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 1개
2025-09-22 21:00:25,412 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 1개
2025-09-22 21:00:25,413 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-09-22 21:00:25,415 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시']
2025-09-22 21:00:25,417 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (1, 2)
2025-09-22 21:00:25,417 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-22 21:00:25,417 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.32초
2025-09-22 21:00:25,417 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시']
2025-09-22 21:00:25,417 - __main__ - INFO - 매칭된 상품 정보: (1, 2)
2025-09-22 21:00:25,418 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-22 21:00:25,529 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-22 21:00:25,529 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-22 21:00:25,529 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-22 21:00:25,529 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-22 21:00:25,529 - __main__ - INFO - 후보 아이템 리스트 크기: 1개
2025-09-22 21:00:25,529 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시']
2025-09-22 21:00:25,530 - __main__ - INFO - extra_item_pdf 크기: (1, 2)
2025-09-22 21:00:25,530 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-22 21:00:25,530 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-22 21:00:25,531 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 1개
2025-09-22 21:00:25,531 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': 'GALAXY', 'action': '기타'}]
2025-09-22 21:00:25,531 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-22 21:00:25,531 - __main__ - INFO - 구성된 프롬프트 길이: 5000 문자
2025-09-22 21:00:25,531 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-22 21:00:25,531 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 5000)
2025-09-22 21:00:25,531 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-22 21:00:25,531 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-22 21:00:41,204 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-22 21:00:41,219 - __main__ - INFO - LLM 응답 길이: 1245 문자
2025-09-22 21:00:41,219 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "갤럭시 S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        },
        {
            "name"...
2025-09-22 21:00:41,219 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-22 21:00:41,219 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-22 21:00:41,219 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-22 21:00:41,220 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': '갤럭시 S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}, {'name': '인터넷+TV', 'action': '가입'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '가입'}, {'type': '전화번호', 'value': '080-801-0011', 'action': '수신 거부'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-22 21:00:41,220 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-22 21:00:41,220 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', '갤럭시 S24 FE', '아이폰17', '인터넷+TV']
2025-09-22 21:00:41,222 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-09-22 21:00:41,222 - __main__ - INFO - ✅ LLM 모델 초기화 완료: gpt (azure/openai/gpt-4o-2024-08-06)
2025-09-22 21:00:41,223 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-09-22 21:00:41,724 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 17480)
2025-09-22 21:00:41,724 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-22 21:00:41,724 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-22 21:00:41,724 - __main__ - INFO - 🔄 3개 LLM 모델로 엔티티 추출 시작
2025-09-22 21:00:41,727 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-22 21:00:41,727 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-22 21:00:41,727 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-22 21:00:42,852 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-22 21:00:43,652 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-22 21:00:45,232 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-22 21:00:45,244 - __main__ - INFO - ✅ LLM 추출 완료: ['와이드8', 'S24 FE', '아이폰17 사전예약', '아이폰17', '인터넷+TV', 'A36', '갤럭시']
2025-09-22 21:00:45,556 - __main__ - INFO - extract_entities_by_llm 실행완료: 4.33초
2025-09-22 21:00:45,616 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-22 21:00:45,616 - __main__ - INFO - ============================================================
2025-09-22 21:00:45,616 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-22 21:00:45,616 - __main__ - INFO - ============================================================
2025-09-22 21:00:45,616 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-22 21:00:45,616 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-22 21:00:45,616 - __main__ - INFO - 상품 수: 2개
2025-09-22 21:00:45,616 - __main__ - INFO - 채널 수: 5개
2025-09-22 21:00:45,616 - __main__ - INFO - 프로그램 수: 2개
2025-09-22 21:00:45,616 - __main__ - INFO - process_message 실행완료: 21.52초
2025-09-22 21:00:45,616 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-23 10:09:40,609 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-23 10:09:40,609 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-23 10:09:40,609 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-23 10:09:40,609 - __main__ - INFO - 🎯 DAG 추출 모드 활성화됨
2025-09-23 10:09:40,609 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-23 10:09:40,610 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-23 10:09:40,627 - __main__ - INFO - Using device: mps
2025-09-23 10:09:40,627 - __main__ - INFO - _initialize_device 실행완료: 0.02초
2025-09-23 10:09:40,627 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-23 10:09:40,628 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-23 10:09:40,628 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-23 10:09:40,628 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-23 10:09:40,628 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-23 10:09:40,628 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-23 10:09:40,628 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-23 10:09:44,134 - __main__ - INFO - Model loaded on mps
2025-09-23 10:09:44,134 - __main__ - INFO - _initialize_embedding_model 실행완료: 3.51초
2025-09-23 10:09:44,134 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-23 10:09:44,700 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-23 10:09:44,700 - __main__ - INFO - _initialize_kiwi 실행완료: 0.57초
2025-09-23 10:09:44,700 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-23 10:09:44,700 - __main__ - INFO - ============================================================
2025-09-23 10:09:44,700 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-23 10:09:44,700 - __main__ - INFO - ============================================================
2025-09-23 10:09:44,700 - __main__ - INFO - 데이터 소스 모드: local
2025-09-23 10:09:44,700 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-23 10:09:44,700 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-23 10:09:44,700 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-23 10:09:44,700 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-23 10:09:44,770 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-23 10:09:44,770 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-23 10:09:44,770 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-23 10:09:44,775 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-23 10:09:44,776 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-23 10:09:44,776 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-23 10:09:44,777 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-23 10:09:44,777 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-23 10:09:44,777 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-23 10:09:44,804 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-23 10:09:44,809 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-23 10:09:44,809 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-23 10:09:44,809 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-23 10:09:44,809 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-23 10:09:44,809 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-23 10:09:44,810 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-23 10:09:44,810 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-23 10:09:44,810 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-23 10:09:44,810 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-23 10:09:44,810 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-23 10:09:44,813 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-23 10:09:44,813 - __main__ - INFO - null이 아닌 상품명 수: 10551개
2025-09-23 10:09:44,813 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-23 10:09:44,814 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-23 10:09:44,814 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-23 10:09:44,937 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-23 10:09:44,944 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 21522
2025-09-23 10:09:44,945 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 넷플릭스 인증', '우주PASS Netflix 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증']
2025-09-23 10:09:44,945 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-23 10:09:44,945 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (21522, 9)
2025-09-23 10:09:44,945 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-23 10:09:44,947 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-23 10:09:44,947 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-23 10:09:44,947 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-23 10:09:44,947 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-23 10:09:44,949 - __main__ - INFO - 등록할 고유 별칭 수: 16403개
2025-09-23 10:09:44,949 - __main__ - INFO - 유효한 별칭 수: 16403개
2025-09-23 10:09:44,949 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 넷플릭스 인증', '우주PASS Netflix 인증', '우주pass Netflix 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증']
2025-09-23 10:09:44,964 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16403개 성공, 0개 실패
2025-09-23 10:09:44,965 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-23 10:09:44,965 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-23 10:09:44,974 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-23 10:09:44,974 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-23 10:09:46,765 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-23 10:09:46,765 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-23 10:09:46,765 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-23 10:09:46,765 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-09-23 10:09:46,765 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-09-23 10:09:46,765 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-23 10:09:46,829 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-09-23 10:09:46,829 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-23 10:09:46,831 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-09-23 10:09:46,831 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-09-23 10:09:46,831 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-09-23 10:09:46,831 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-23 10:09:46,831 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-09-23 10:09:46,832 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-23 10:09:46,832 - __main__ - INFO - ============================================================
2025-09-23 10:09:46,832 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-23 10:09:46,832 - __main__ - INFO - ============================================================
2025-09-23 10:09:46,832 - __main__ - INFO - ✅ 상품 데이터: (21522, 9)
2025-09-23 10:09:46,832 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-23 10:09:46,832 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-23 10:09:46,832 - __main__ - INFO - ✅ 정지어: 166개
2025-09-23 10:09:46,832 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-23 10:09:46,833 - __main__ - INFO - 고유 상품명 수: 6847개
2025-09-23 10:09:46,835 - __main__ - INFO - 고유 별칭 수: 16403개
2025-09-23 10:09:46,836 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-23 10:09:46,836 - __main__ - INFO - _load_data 실행완료: 2.14초
2025-09-23 10:09:46,836 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-23 10:09:46,836 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-23 10:09:46,836 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-23 10:09:46,836 - __main__ - INFO - ============================================================
2025-09-23 10:09:46,836 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-23 10:09:46,837 - __main__ - INFO - ============================================================
2025-09-23 10:09:46,837 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-23 10:09:46,837 - __main__ - INFO - 메시지 길이: 421 문자
2025-09-23 10:09:46,837 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-23 10:09:46,837 - __main__ - INFO - 데이터 소스: local
2025-09-23 10:09:46,837 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-23 10:09:46,837 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-23 10:09:46,837 - __main__ - INFO - LLM 모델: ax
2025-09-23 10:09:46,837 - __main__ - INFO - 상품 데이터 크기: (21522, 9)
2025-09-23 10:09:46,837 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-23 10:09:46,837 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-23 10:09:46,837 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-23 10:09:46,837 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-23 10:09:46,838 - __main__ - INFO - 매칭할 상품 별칭 수: 16403개
2025-09-23 10:09:47,295 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-23 10:09:47,296 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-23 10:09:47,299 - __main__ - INFO - 전체 토큰 수: 155개
2025-09-23 10:09:47,299 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하', '갤럭시', 'A', '기기값', '아이폰', '을지로입구역', '하나은행', '명동']
2025-09-23 10:09:47,299 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['하나은행', '을지로입구역', '명동', '갤럭시', '기기값', '구매하', '아이폰']
2025-09-23 10:09:47,299 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-23 10:09:48,157 - __main__ - INFO - 퍼지 매칭 결과 크기: (1047, 3)
2025-09-23 10:09:48,157 - __main__ - INFO - 퍼지 매칭 성공: 1047개 결과
2025-09-23 10:09:48,158 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-23 10:09:48,158 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-23 10:09:48,197 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1047, 3)
2025-09-23 10:09:48,197 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-23 10:09:48,197 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-23 10:09:48,200 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 1개
2025-09-23 10:09:48,201 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 1개
2025-09-23 10:09:48,202 - __main__ - INFO - 통합된 후보 아이템 수: 2개
2025-09-23 10:09:48,205 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시']
2025-09-23 10:09:48,207 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (1, 2)
2025-09-23 10:09:48,208 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-23 10:09:48,208 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.37초
2025-09-23 10:09:48,208 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시']
2025-09-23 10:09:48,208 - __main__ - INFO - 매칭된 상품 정보: (1, 2)
2025-09-23 10:09:48,208 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-23 10:09:49,234 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-23 10:09:49,234 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-23 10:09:49,234 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-23 10:09:49,234 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-23 10:09:49,234 - __main__ - INFO - 후보 아이템 리스트 크기: 1개
2025-09-23 10:09:49,234 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시']
2025-09-23 10:09:49,234 - __main__ - INFO - extra_item_pdf 크기: (1, 2)
2025-09-23 10:09:49,234 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-23 10:09:49,234 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': 'GALAXY', 'item_id': ['SSM2']}]
2025-09-23 10:09:49,236 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 1개
2025-09-23 10:09:49,236 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': 'GALAXY', 'action': '기타'}]
2025-09-23 10:09:49,236 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-23 10:09:49,236 - __main__ - INFO - 구성된 프롬프트 길이: 5000 문자
2025-09-23 10:09:49,236 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-23 10:09:49,236 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 5000)
2025-09-23 10:09:49,236 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-23 10:09:49,236 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-23 10:09:57,777 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-23 10:09:57,790 - __main__ - INFO - LLM 응답 길이: 1245 문자
2025-09-23 10:09:57,790 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "갤럭시 S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        },
        {
            "name"...
2025-09-23 10:09:57,791 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-23 10:09:57,792 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-23 10:09:57,792 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-23 10:09:57,792 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': '갤럭시 S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}, {'name': '인터넷+TV', 'action': '가입'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '가입'}, {'type': '전화번호', 'value': '080-801-0011', 'action': '수신 거부'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-23 10:09:57,792 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-23 10:09:57,792 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', '갤럭시 S24 FE', '아이폰17', '인터넷+TV']
2025-09-23 10:09:57,793 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-09-23 10:09:57,793 - __main__ - INFO - ✅ LLM 모델 초기화 완료: gpt (azure/openai/gpt-4o-2024-08-06)
2025-09-23 10:09:57,793 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-09-23 10:09:58,301 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 17480)
2025-09-23 10:09:58,301 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-23 10:09:58,301 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-23 10:09:58,301 - __main__ - INFO - 🔄 3개 LLM 모델로 엔티티 추출 시작
2025-09-23 10:09:58,315 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-23 10:09:58,315 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-23 10:09:58,315 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-23 10:09:59,784 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-23 10:10:00,126 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-23 10:10:01,699 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-23 10:10:01,701 - __main__ - INFO - ✅ LLM 추출 완료: ['아이폰17', 'A36', '와이드8', '인터넷+TV', 'S24 FE', '아이폰17 사전예약', '갤럭시']
2025-09-23 10:10:02,002 - __main__ - INFO - extract_entities_by_llm 실행완료: 4.21초
2025-09-23 10:10:02,060 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-23 10:10:02,060 - __main__ - INFO - ============================================================
2025-09-23 10:10:02,060 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-23 10:10:02,060 - __main__ - INFO - ============================================================
2025-09-23 10:10:02,061 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-23 10:10:02,061 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-23 10:10:02,061 - __main__ - INFO - 상품 수: 2개
2025-09-23 10:10:02,061 - __main__ - INFO - 채널 수: 5개
2025-09-23 10:10:02,061 - __main__ - INFO - 프로그램 수: 2개
2025-09-23 10:10:02,061 - __main__ - INFO - process_message 실행완료: 15.22초
2025-09-23 10:10:02,061 - __main__ - INFO - 순차적 처리로 메인 추출 및 DAG 추출 수행
2025-09-23 10:10:02,061 - __main__ - INFO - ============================== DAG 추출 시작 ==============================
2025-09-23 10:10:02,061 - entity_dag_extractor - INFO - 🚀 DAG 추출 프로세스 시작
2025-09-23 10:10:02,061 - entity_dag_extractor - INFO - 📝 입력 메시지 길이: 421자
2025-09-23 10:10:02,061 - entity_dag_extractor - INFO - 🤖 사용 LLM 모델: client=<openai.resources.chat.completions.completions.Completions object at 0x334986480> async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x334986d20> root_client=<openai.OpenAI object at 0x32a276030> root_async_client=<openai.AsyncOpenAI object at 0x334986a80> model_name='skt/ax4' temperature=0.0 model_kwargs={} openai_api_key=SecretStr('**********') openai_api_base='https://api.platform.a15t.com/v1' max_tokens=4000
2025-09-23 10:10:02,061 - entity_dag_extractor - INFO - 🤖 LLM에 DAG 추출 요청 중...
2025-09-23 10:10:02,061 - entity_dag_extractor - INFO - 📏 프롬프트 길이: 3406자
2025-09-23 10:10:29,471 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-23 10:10:29,473 - entity_dag_extractor - INFO - 📝 LLM 응답 길이: 2992자
2025-09-23 10:10:29,473 - entity_dag_extractor - INFO - 📄 LLM 응답 미리보기: ## 1. 메시지 분석

```
[메시지 요약 및 핵심 의도]
SKT 을지로점에서 9월 중 갤럭시 시리즈와 아이폰17에 대한 특별 할인 및 혜택을 제공하며, SK로 통신사 이동 시 추가 혜택을 안내함. 매장 방문과 온라인 사전예약을 통해 기기 구매 및 통신사 이동을 유도하고 있음.

[식별된 가치 제안 목록]
- 갤럭시 시리즈(와이드8, A36, S24 F...
2025-09-23 10:10:29,474 - entity_dag_extractor - INFO - 🔍 DAG 섹션 추출 중...
2025-09-23 10:10:29,474 - entity_dag_extractor - INFO - 📄 추출된 DAG 섹션 길이: 263자
2025-09-23 10:10:29,474 - entity_dag_extractor - INFO - 🔗 DAG 파싱 중...
2025-09-23 10:10:29,475 - entity_dag_extractor - INFO - 📊 파싱된 DAG - 노드 수: 10, 엣지 수: 8
2025-09-23 10:10:29,475 - entity_dag_extractor - INFO - 🎯 DAG 노드 목록: ['을지로점:방문', '갤럭시:구매', '기기값할인:수령', '추가할인:수령', '통신사:이동', '상품권:수령', '현금지원:수령', '온라인링크:접속', '아이폰17:사전예약', '바로개통:수령']
2025-09-23 10:10:29,475 - entity_dag_extractor - INFO - 🔗 DAG 엣지 목록: [('을지로점:방문', '갤럭시:구매'), ('을지로점:방문', '통신사:이동'), ('갤럭시:구매', '기기값할인:수령'), ('갤럭시:구매', '추가할인:수령'), ('통신사:이동', '상품권:수령'), ('통신사:이동', '현금지원:수령'), ('온라인링크:접속', '아이폰17:사전예약'), ('아이폰17:사전예약', '바로개통:수령')]
2025-09-23 10:10:29,475 - entity_dag_extractor - INFO - ✅ DAG 추출 프로세스 완료
2025-09-23 10:10:29,475 - utils - INFO - 🎨 DAG 다이어그램 생성 시작 - 파일명: dag_ea42c65e2727ae609ac65fcfbeae8a3ccd3131f39e75b2236c29bf21305dca18
2025-09-23 10:10:29,475 - utils - INFO - 📊 입력 그래프 - 노드 수: 10, 엣지 수: 8
2025-09-23 10:10:29,476 - utils - INFO - 🖼️ DAG 이미지 렌더링 중...
2025-09-23 10:10:30,361 - utils - INFO - ✅ DAG 다이어그램 생성 완료: dag_images/dag_ea42c65e2727ae609ac65fcfbeae8a3ccd3131f39e75b2236c29bf21305dca18.png
2025-09-23 10:10:30,361 - __main__ - INFO - ✅ DAG 추출 완료: dag_ea42c65e2727ae609ac65fcfbeae8a3ccd3131f39e75b2236c29bf21305dca18
2025-09-23 10:10:30,361 - __main__ - INFO - 🕒 DAG 처리 시간: 28.301초
2025-09-23 10:10:30,361 - __main__ - INFO - 📏 DAG 섹션 길이: 263자
2025-09-23 10:10:30,361 - __main__ - INFO - 📄 DAG 내용 미리보기: (을지로점:방문) -[방문하면]-> (갤럭시:구매)
(갤럭시:구매) -[구매하면]-> (기기값할인:수령)
(갤럭시:구매) -[구매하면, 제휴카드사용시]-> (추가할인:수령)
(을지로점:방문) -[방문하면]-> (통신사:이동)
(통신사:이동) -[이동하면]-> (상품권:수령)
(통신사:이동) -[이동하면, 인터넷TV동시가입시]-> (현금지원:수령)
(온라인링...
2025-09-23 10:10:30,362 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-23 10:10:30,892 - mongodb_utils - INFO - MongoDB 연결 성공: aos.mmsext
2025-09-23 10:10:30,896 - mongodb_utils - INFO - 문서 저장 성공: 68d1f3868430cadd04a7c9b0
2025-09-23 10:10:30,897 - mongodb_utils - INFO - MongoDB 연결 해제
2025-09-23 14:08:41,944 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-23 14:08:41,944 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-23 14:08:41,944 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-23 14:08:41,944 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-09-23 14:08:41,944 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-23 14:08:41,945 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-23 14:08:42,009 - __main__ - INFO - Using device: mps
2025-09-23 14:08:42,009 - __main__ - INFO - _initialize_device 실행완료: 0.06초
2025-09-23 14:08:42,010 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-23 14:08:42,010 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-23 14:08:42,010 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-23 14:08:42,010 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-23 14:08:42,010 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-23 14:08:42,010 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-23 14:08:42,010 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-23 14:08:44,203 - __main__ - INFO - Model loaded on mps
2025-09-23 14:08:44,203 - __main__ - INFO - _initialize_embedding_model 실행완료: 2.19초
2025-09-23 14:08:44,203 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-23 14:08:44,693 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-23 14:08:44,693 - __main__ - INFO - _initialize_kiwi 실행완료: 0.49초
2025-09-23 14:08:44,693 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-23 14:08:44,693 - __main__ - INFO - ============================================================
2025-09-23 14:08:44,693 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-23 14:08:44,693 - __main__ - INFO - ============================================================
2025-09-23 14:08:44,693 - __main__ - INFO - 데이터 소스 모드: local
2025-09-23 14:08:44,693 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-23 14:08:44,693 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-23 14:08:44,693 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-23 14:08:44,693 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-23 14:08:44,798 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-23 14:08:44,798 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-23 14:08:44,798 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-23 14:08:44,802 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-23 14:08:44,803 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-23 14:08:44,803 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-23 14:08:44,804 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-23 14:08:44,804 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-23 14:08:44,804 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-23 14:08:44,808 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-23 14:08:44,811 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-23 14:08:44,811 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-23 14:08:44,811 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-23 14:08:44,811 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-23 14:08:44,811 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-23 14:08:44,812 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-23 14:08:44,812 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-23 14:08:44,812 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-23 14:08:44,812 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-23 14:08:44,812 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-23 14:08:44,816 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-23 14:08:44,816 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-09-23 14:08:44,816 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-23 14:08:44,816 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-23 14:08:44,816 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-23 14:08:44,946 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-23 14:08:44,950 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-09-23 14:08:44,951 - __main__ - INFO - 별칭 적용 후 샘플: ['우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주pass Netflix 인증']
2025-09-23 14:08:44,951 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-23 14:08:44,951 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-09-23 14:08:44,951 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-23 14:08:44,952 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-23 14:08:44,952 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-23 14:08:44,952 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-23 14:08:44,952 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-23 14:08:44,953 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-09-23 14:08:44,954 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-09-23 14:08:44,954 - __main__ - INFO - 등록할 별칭 샘플: ['우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주pass Netflix 인증']
2025-09-23 14:08:44,967 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-09-23 14:08:44,967 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-23 14:08:44,967 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-23 14:08:44,969 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-23 14:08:44,969 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-23 14:08:46,571 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-23 14:08:46,572 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-23 14:08:46,572 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-23 14:08:46,572 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-09-23 14:08:46,572 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-09-23 14:08:46,572 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-23 14:08:46,636 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-09-23 14:08:46,636 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-23 14:08:46,637 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-09-23 14:08:46,638 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-09-23 14:08:46,638 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-09-23 14:08:46,638 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-23 14:08:46,638 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-09-23 14:08:46,638 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-23 14:08:46,638 - __main__ - INFO - ============================================================
2025-09-23 14:08:46,638 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-23 14:08:46,638 - __main__ - INFO - ============================================================
2025-09-23 14:08:46,638 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-09-23 14:08:46,638 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-23 14:08:46,638 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-23 14:08:46,638 - __main__ - INFO - ✅ 정지어: 166개
2025-09-23 14:08:46,638 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-23 14:08:46,639 - __main__ - INFO - 고유 상품명 수: 6586개
2025-09-23 14:08:46,640 - __main__ - INFO - 고유 별칭 수: 16948개
2025-09-23 14:08:46,641 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-23 14:08:46,641 - __main__ - INFO - _load_data 실행완료: 1.95초
2025-09-23 14:08:46,641 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-23 14:08:46,641 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-23 14:08:46,641 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-23 14:08:46,641 - __main__ - INFO - ============================================================
2025-09-23 14:08:46,641 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-23 14:08:46,641 - __main__ - INFO - ============================================================
2025-09-23 14:08:46,641 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-23 14:08:46,641 - __main__ - INFO - 메시지 길이: 421 문자
2025-09-23 14:08:46,641 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-23 14:08:46,641 - __main__ - INFO - 데이터 소스: local
2025-09-23 14:08:46,641 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-23 14:08:46,641 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-23 14:08:46,641 - __main__ - INFO - LLM 모델: ax
2025-09-23 14:08:46,641 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-09-23 14:08:46,641 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-23 14:08:46,641 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-23 14:08:46,641 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-23 14:08:46,641 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-23 14:08:46,642 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-09-23 14:08:47,097 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-23 14:08:47,098 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-23 14:08:47,100 - __main__ - INFO - 전체 토큰 수: 154개
2025-09-23 14:08:47,101 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하9', '갤럭시', '아이폰 17', '을지로입구역', '하나은행', '명동']
2025-09-23 14:08:47,101 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['을지로입구역', '갤럭시', '아이폰 17', '구매하9', '명동', '하나은행']
2025-09-23 14:08:47,101 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-23 14:08:47,561 - __main__ - INFO - 퍼지 매칭 결과 크기: (1242, 3)
2025-09-23 14:08:47,561 - __main__ - INFO - 퍼지 매칭 성공: 1242개 결과
2025-09-23 14:08:47,562 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-23 14:08:47,562 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-23 14:08:47,603 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1242, 3)
2025-09-23 14:08:47,603 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-23 14:08:47,603 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-23 14:08:47,605 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 14개
2025-09-23 14:08:47,606 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 5개
2025-09-23 14:08:47,607 - __main__ - INFO - 통합된 후보 아이템 수: 19개
2025-09-23 14:08:47,609 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-23 14:08:47,611 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (13, 2)
2025-09-23 14:08:47,611 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '(KTF)갤럭시 S24 FE', 'item_id': ['A5V7']}, {'item_nm': '(LGU)갤럭시 S24 FE', 'item_id': ['A5V8']}, {'item_nm': 'IPHONE 17', 'item_id': ['A6UD', 'A6SQ', 'A6U2', 'A6U7', 'A6SV']}]
2025-09-23 14:08:47,611 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 0.97초
2025-09-23 14:08:47,611 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-23 14:08:47,611 - __main__ - INFO - 매칭된 상품 정보: (13, 2)
2025-09-23 14:08:47,611 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-23 14:08:48,608 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-23 14:08:48,608 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-23 14:08:48,608 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-23 14:08:48,608 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-23 14:08:48,608 - __main__ - INFO - 후보 아이템 리스트 크기: 15개
2025-09-23 14:08:48,608 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-23 14:08:48,608 - __main__ - INFO - extra_item_pdf 크기: (13, 2)
2025-09-23 14:08:48,608 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-23 14:08:48,608 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '(KTF)갤럭시 S24 FE', 'item_id': ['A5V7']}, {'item_nm': '(LGU)갤럭시 S24 FE', 'item_id': ['A5V8']}]
2025-09-23 14:08:48,609 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 13개
2025-09-23 14:08:48,609 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': '(KTF)갤럭시 S24 FE', 'action': '기타'}, {'name': '(LGU)갤럭시 S24 FE', 'action': '기타'}]
2025-09-23 14:08:48,609 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-23 14:08:48,609 - __main__ - INFO - 구성된 프롬프트 길이: 6000 문자
2025-09-23 14:08:48,609 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-23 14:08:48,609 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 6000)
2025-09-23 14:08:48,609 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-23 14:08:48,609 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-23 14:08:56,661 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-23 14:08:56,677 - __main__ - INFO - LLM 응답 길이: 1163 문자
2025-09-23 14:08:56,677 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        }
    ],
    "channel": [
        {...
2025-09-23 14:08:56,677 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-23 14:08:56,678 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-23 14:08:56,678 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-23 14:08:56,678 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': 'S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '방문'}, {'type': '전화번호', 'value': '080-801-0011', 'action': '수신 거부'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-23 14:08:56,678 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-23 14:08:56,678 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', 'S24 FE', '아이폰17']
2025-09-23 14:08:56,679 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-09-23 14:08:57,036 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 18377)
2025-09-23 14:08:57,036 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-23 14:08:57,036 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-23 14:08:57,036 - __main__ - INFO - 🔄 1개 LLM 모델로 엔티티 추출 시작
2025-09-23 14:08:57,036 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-23 14:09:01,123 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-23 14:09:01,126 - __main__ - INFO - ✅ LLM 추출 완료: ['와이드8', '아이폰17', 'S24 FE', 'A36']
2025-09-23 14:09:01,294 - __main__ - INFO - extract_entities_by_llm 실행완료: 4.61초
2025-09-23 14:09:01,336 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-23 14:09:01,336 - __main__ - INFO - ============================================================
2025-09-23 14:09:01,336 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-23 14:09:01,336 - __main__ - INFO - ============================================================
2025-09-23 14:09:01,336 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-23 14:09:01,336 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-23 14:09:01,336 - __main__ - INFO - 상품 수: 3개
2025-09-23 14:09:01,336 - __main__ - INFO - 채널 수: 5개
2025-09-23 14:09:01,336 - __main__ - INFO - 프로그램 수: 2개
2025-09-23 14:09:01,336 - __main__ - INFO - process_message 실행완료: 14.70초
2025-09-23 14:09:01,336 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-23 14:09:01,989 - mongodb_utils - INFO - MongoDB 연결 성공: aos.mmsext
2025-09-23 14:09:01,991 - mongodb_utils - INFO - 문서 저장 성공: 68d22b6d9493e4c84581d749
2025-09-23 14:09:01,992 - mongodb_utils - INFO - MongoDB 연결 해제
2025-09-24 09:14:06,735 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-24 09:14:06,736 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-24 09:14:06,736 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-24 09:14:06,736 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-09-24 09:14:06,736 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-24 09:14:06,737 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-24 09:14:06,799 - __main__ - INFO - Using device: mps
2025-09-24 09:14:06,799 - __main__ - INFO - _initialize_device 실행완료: 0.06초
2025-09-24 09:14:06,799 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-24 09:14:06,799 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-24 09:14:06,799 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-24 09:14:06,799 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-24 09:14:06,799 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-24 09:14:06,799 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-24 09:14:06,799 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-24 09:14:12,569 - __main__ - INFO - Model loaded on mps
2025-09-24 09:14:12,570 - __main__ - INFO - _initialize_embedding_model 실행완료: 5.77초
2025-09-24 09:14:12,570 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-24 09:14:13,152 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-24 09:14:13,152 - __main__ - INFO - _initialize_kiwi 실행완료: 0.58초
2025-09-24 09:14:13,153 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-24 09:14:13,153 - __main__ - INFO - ============================================================
2025-09-24 09:14:13,153 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-24 09:14:13,153 - __main__ - INFO - ============================================================
2025-09-24 09:14:13,153 - __main__ - INFO - 데이터 소스 모드: local
2025-09-24 09:14:13,153 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-24 09:14:13,153 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-24 09:14:13,153 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-24 09:14:13,153 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-24 09:14:13,261 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-24 09:14:13,262 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-24 09:14:13,262 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-24 09:14:13,266 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-24 09:14:13,266 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-24 09:14:13,267 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-24 09:14:13,268 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-24 09:14:13,268 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-24 09:14:13,268 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-24 09:14:13,276 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-24 09:14:13,279 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-24 09:14:13,279 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-24 09:14:13,279 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-24 09:14:13,279 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-24 09:14:13,279 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-24 09:14:13,280 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-24 09:14:13,280 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-24 09:14:13,280 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-24 09:14:13,280 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-24 09:14:13,280 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-24 09:14:13,286 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-24 09:14:13,287 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-09-24 09:14:13,287 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-24 09:14:13,287 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-24 09:14:13,287 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-24 09:14:13,419 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-24 09:14:13,423 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-09-24 09:14:13,424 - __main__ - INFO - 별칭 적용 후 샘플: ['우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주Pass Netflix 인증']
2025-09-24 09:14:13,424 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-24 09:14:13,424 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-09-24 09:14:13,424 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-24 09:14:13,425 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-24 09:14:13,425 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-24 09:14:13,425 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-24 09:14:13,426 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-24 09:14:13,426 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-09-24 09:14:13,427 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-09-24 09:14:13,427 - __main__ - INFO - 등록할 별칭 샘플: ['우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주PASS Netflix 인증', '우주패스 Netflix 인증', '우주Pass Netflix 인증']
2025-09-24 09:14:13,439 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-09-24 09:14:13,439 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-24 09:14:13,439 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-24 09:14:13,449 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-24 09:14:13,449 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-24 09:14:13,713 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-24 09:14:13,713 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-24 09:14:13,713 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-24 09:14:13,713 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-09-24 09:14:13,713 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-09-24 09:14:13,713 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-24 09:14:13,779 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-09-24 09:14:13,779 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-24 09:14:13,780 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-09-24 09:14:13,781 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-09-24 09:14:13,781 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-09-24 09:14:13,781 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-24 09:14:13,781 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-09-24 09:14:13,781 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-24 09:14:13,781 - __main__ - INFO - ============================================================
2025-09-24 09:14:13,781 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-24 09:14:13,781 - __main__ - INFO - ============================================================
2025-09-24 09:14:13,781 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-09-24 09:14:13,781 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-24 09:14:13,781 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-24 09:14:13,781 - __main__ - INFO - ✅ 정지어: 166개
2025-09-24 09:14:13,781 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-24 09:14:13,782 - __main__ - INFO - 고유 상품명 수: 6586개
2025-09-24 09:14:13,783 - __main__ - INFO - 고유 별칭 수: 16948개
2025-09-24 09:14:13,784 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-24 09:14:13,784 - __main__ - INFO - _load_data 실행완료: 0.63초
2025-09-24 09:14:13,784 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-24 09:14:13,784 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-24 09:14:13,784 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-24 09:14:13,784 - __main__ - INFO - ============================================================
2025-09-24 09:14:13,784 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-24 09:14:13,784 - __main__ - INFO - ============================================================
2025-09-24 09:14:13,784 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-24 09:14:13,784 - __main__ - INFO - 메시지 길이: 421 문자
2025-09-24 09:14:13,784 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-24 09:14:13,784 - __main__ - INFO - 데이터 소스: local
2025-09-24 09:14:13,784 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-24 09:14:13,784 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-24 09:14:13,784 - __main__ - INFO - LLM 모델: ax
2025-09-24 09:14:13,784 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-09-24 09:14:13,784 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-24 09:14:13,784 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-24 09:14:13,784 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-24 09:14:13,784 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-24 09:14:13,785 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-09-24 09:14:14,214 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-24 09:14:14,215 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-24 09:14:14,217 - __main__ - INFO - 전체 토큰 수: 154개
2025-09-24 09:14:14,218 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하9', '갤럭시', '아이폰 17', '을지로입구역', '하나은행', '명동']
2025-09-24 09:14:14,218 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['아이폰 17', '갤럭시', '하나은행', '구매하9', '을지로입구역', '명동']
2025-09-24 09:14:14,218 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-24 09:14:14,667 - __main__ - INFO - 퍼지 매칭 결과 크기: (1242, 3)
2025-09-24 09:14:14,668 - __main__ - INFO - 퍼지 매칭 성공: 1242개 결과
2025-09-24 09:14:14,668 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-24 09:14:14,668 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-24 09:14:14,709 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1242, 3)
2025-09-24 09:14:14,710 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-24 09:14:14,710 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-24 09:14:14,711 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 14개
2025-09-24 09:14:14,713 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 5개
2025-09-24 09:14:14,713 - __main__ - INFO - 통합된 후보 아이템 수: 19개
2025-09-24 09:14:14,715 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-24 09:14:14,717 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (13, 2)
2025-09-24 09:14:14,717 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '(KTF)갤럭시 S24 FE', 'item_id': ['A5V7']}, {'item_nm': '(LGU)갤럭시 S24 FE', 'item_id': ['A5V8']}, {'item_nm': 'IPHONE 17', 'item_id': ['A6UD', 'A6SQ', 'A6U2', 'A6U7', 'A6SV']}]
2025-09-24 09:14:14,717 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 0.93초
2025-09-24 09:14:14,717 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-24 09:14:14,717 - __main__ - INFO - 매칭된 상품 정보: (13, 2)
2025-09-24 09:14:14,717 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-24 09:14:14,796 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-24 09:14:14,796 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-24 09:14:14,796 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-24 09:14:14,796 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-24 09:14:14,796 - __main__ - INFO - 후보 아이템 리스트 크기: 15개
2025-09-24 09:14:14,796 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-24 09:14:14,796 - __main__ - INFO - extra_item_pdf 크기: (13, 2)
2025-09-24 09:14:14,796 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-24 09:14:14,796 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '(KTF)갤럭시 S24 FE', 'item_id': ['A5V7']}, {'item_nm': '(LGU)갤럭시 S24 FE', 'item_id': ['A5V8']}]
2025-09-24 09:14:14,797 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 13개
2025-09-24 09:14:14,797 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': '(KTF)갤럭시 S24 FE', 'action': '기타'}, {'name': '(LGU)갤럭시 S24 FE', 'action': '기타'}]
2025-09-24 09:14:14,797 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-24 09:14:14,797 - __main__ - INFO - 구성된 프롬프트 길이: 6000 문자
2025-09-24 09:14:14,797 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-24 09:14:14,797 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 6000)
2025-09-24 09:14:14,797 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-24 09:14:14,798 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-24 09:14:27,434 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-24 09:14:27,448 - __main__ - INFO - LLM 응답 길이: 1163 문자
2025-09-24 09:14:27,448 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        }
    ],
    "channel": [
        {...
2025-09-24 09:14:27,449 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-24 09:14:27,449 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-24 09:14:27,449 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-24 09:14:27,449 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': 'S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '방문'}, {'type': '전화번호', 'value': '080-801-0011', 'action': '수신 거부'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-24 09:14:27,449 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-24 09:14:27,449 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', 'S24 FE', '아이폰17']
2025-09-24 09:14:27,450 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-09-24 09:14:27,806 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 18377)
2025-09-24 09:14:27,806 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-24 09:14:27,806 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-24 09:14:27,806 - __main__ - INFO - 🔄 1개 LLM 모델로 엔티티 추출 시작
2025-09-24 09:14:27,806 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-24 09:14:30,563 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-24 09:14:30,563 - __main__ - INFO - ✅ LLM 추출 완료: ['아이폰17', 'S24 FE', '와이드8', 'A36']
2025-09-24 09:14:30,742 - __main__ - INFO - extract_entities_by_llm 실행완료: 3.29초
2025-09-24 09:14:30,788 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-24 09:14:30,788 - __main__ - INFO - ============================================================
2025-09-24 09:14:30,788 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-24 09:14:30,788 - __main__ - INFO - ============================================================
2025-09-24 09:14:30,788 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-24 09:14:30,788 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-24 09:14:30,788 - __main__ - INFO - 상품 수: 3개
2025-09-24 09:14:30,788 - __main__ - INFO - 채널 수: 5개
2025-09-24 09:14:30,788 - __main__ - INFO - 프로그램 수: 2개
2025-09-24 09:14:30,788 - __main__ - INFO - process_message 실행완료: 17.00초
2025-09-24 09:14:30,788 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-24 09:14:31,124 - mongodb_utils - INFO - MongoDB 연결 성공: aos.mmsext
2025-09-24 09:14:31,126 - mongodb_utils - INFO - 문서 저장 성공: 68d337e7e34e9ccf297f1cd9
2025-09-24 09:14:31,127 - mongodb_utils - INFO - MongoDB 연결 해제
2025-09-24 09:16:52,603 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-24 09:16:52,603 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-24 09:16:52,603 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-24 09:16:52,603 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-09-24 09:16:52,603 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-24 09:16:52,605 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-24 09:16:52,659 - __main__ - INFO - Using device: mps
2025-09-24 09:16:52,659 - __main__ - INFO - _initialize_device 실행완료: 0.05초
2025-09-24 09:16:52,659 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-24 09:16:52,660 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-24 09:16:52,660 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-24 09:16:52,660 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-24 09:16:52,660 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-24 09:16:52,660 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-24 09:16:52,660 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-24 09:16:56,802 - __main__ - INFO - Model loaded on mps
2025-09-24 09:16:56,802 - __main__ - INFO - _initialize_embedding_model 실행완료: 4.14초
2025-09-24 09:16:56,802 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-24 09:16:57,259 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-24 09:16:57,260 - __main__ - INFO - _initialize_kiwi 실행완료: 0.46초
2025-09-24 09:16:57,260 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-24 09:16:57,260 - __main__ - INFO - ============================================================
2025-09-24 09:16:57,260 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-24 09:16:57,260 - __main__ - INFO - ============================================================
2025-09-24 09:16:57,260 - __main__ - INFO - 데이터 소스 모드: local
2025-09-24 09:16:57,260 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-24 09:16:57,260 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-24 09:16:57,260 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-24 09:16:57,260 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-24 09:16:57,365 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-24 09:16:57,365 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-24 09:16:57,365 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-24 09:16:57,368 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-24 09:16:57,369 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-24 09:16:57,369 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-24 09:16:57,370 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-24 09:16:57,370 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-24 09:16:57,370 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-24 09:16:57,376 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-24 09:16:57,378 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-24 09:16:57,378 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-24 09:16:57,378 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-24 09:16:57,378 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-24 09:16:57,378 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-24 09:16:57,379 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-24 09:16:57,379 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-24 09:16:57,379 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-24 09:16:57,379 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-24 09:16:57,379 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-24 09:16:57,384 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-24 09:16:57,384 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-09-24 09:16:57,384 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-24 09:16:57,384 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-24 09:16:57,385 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-24 09:16:57,514 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-24 09:16:57,519 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-09-24 09:16:57,519 - __main__ - INFO - 별칭 적용 후 샘플: ['우주pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 넷플릭스 인증', '우주패스 Netflix 인증', '우주Pass Netflix 인증']
2025-09-24 09:16:57,519 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-24 09:16:57,519 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-09-24 09:16:57,519 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-24 09:16:57,520 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-24 09:16:57,520 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-24 09:16:57,520 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-24 09:16:57,520 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-24 09:16:57,521 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-09-24 09:16:57,522 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-09-24 09:16:57,522 - __main__ - INFO - 등록할 별칭 샘플: ['우주pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 넷플릭스 인증', '우주패스 Netflix 인증', '우주Pass Netflix 인증']
2025-09-24 09:16:57,535 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-09-24 09:16:57,535 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-24 09:16:57,535 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-24 09:16:57,548 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-24 09:16:57,548 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-24 09:16:57,702 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-24 09:16:57,702 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-24 09:16:57,702 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-24 09:16:57,702 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-09-24 09:16:57,702 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-09-24 09:16:57,702 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-24 09:16:57,766 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-09-24 09:16:57,766 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-24 09:16:57,768 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-09-24 09:16:57,768 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-09-24 09:16:57,768 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-09-24 09:16:57,768 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-24 09:16:57,768 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-09-24 09:16:57,768 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-24 09:16:57,768 - __main__ - INFO - ============================================================
2025-09-24 09:16:57,768 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-24 09:16:57,768 - __main__ - INFO - ============================================================
2025-09-24 09:16:57,768 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-09-24 09:16:57,769 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-24 09:16:57,769 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-24 09:16:57,769 - __main__ - INFO - ✅ 정지어: 166개
2025-09-24 09:16:57,769 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-24 09:16:57,769 - __main__ - INFO - 고유 상품명 수: 6586개
2025-09-24 09:16:57,770 - __main__ - INFO - 고유 별칭 수: 16948개
2025-09-24 09:16:57,771 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-24 09:16:57,771 - __main__ - INFO - _load_data 실행완료: 0.51초
2025-09-24 09:16:57,771 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-24 09:16:57,771 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-24 09:16:57,771 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-24 09:16:57,771 - __main__ - INFO - ============================================================
2025-09-24 09:16:57,771 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-24 09:16:57,771 - __main__ - INFO - ============================================================
2025-09-24 09:16:57,771 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-24 09:16:57,771 - __main__ - INFO - 메시지 길이: 421 문자
2025-09-24 09:16:57,771 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-24 09:16:57,771 - __main__ - INFO - 데이터 소스: local
2025-09-24 09:16:57,771 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-24 09:16:57,771 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-24 09:16:57,771 - __main__ - INFO - LLM 모델: ax
2025-09-24 09:16:57,771 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-09-24 09:16:57,772 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-24 09:16:57,772 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-24 09:16:57,772 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-24 09:16:57,772 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-24 09:16:57,772 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-09-24 09:16:58,193 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-24 09:16:58,193 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-24 09:16:58,196 - __main__ - INFO - 전체 토큰 수: 154개
2025-09-24 09:16:58,196 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하9', '갤럭시', '아이폰 17', '을지로입구역', '하나은행', '명동']
2025-09-24 09:16:58,196 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['명동', '을지로입구역', '구매하9', '아이폰 17', '하나은행', '갤럭시']
2025-09-24 09:16:58,196 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-24 09:16:58,632 - __main__ - INFO - 퍼지 매칭 결과 크기: (1242, 3)
2025-09-24 09:16:58,632 - __main__ - INFO - 퍼지 매칭 성공: 1242개 결과
2025-09-24 09:16:58,633 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-24 09:16:58,633 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-24 09:16:58,673 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1242, 3)
2025-09-24 09:16:58,673 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-24 09:16:58,673 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-24 09:16:58,675 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 14개
2025-09-24 09:16:58,676 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 5개
2025-09-24 09:16:58,677 - __main__ - INFO - 통합된 후보 아이템 수: 19개
2025-09-24 09:16:58,678 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-24 09:16:58,680 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (13, 2)
2025-09-24 09:16:58,680 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '(KTF)갤럭시 S24 FE', 'item_id': ['A5V7']}, {'item_nm': '(LGU)갤럭시 S24 FE', 'item_id': ['A5V8']}, {'item_nm': 'IPHONE 17', 'item_id': ['A6UD', 'A6SQ', 'A6U2', 'A6U7', 'A6SV']}]
2025-09-24 09:16:58,680 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 0.91초
2025-09-24 09:16:58,680 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-24 09:16:58,680 - __main__ - INFO - 매칭된 상품 정보: (13, 2)
2025-09-24 09:16:58,680 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-24 09:16:58,752 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-24 09:16:58,752 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-24 09:16:58,752 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-24 09:16:58,752 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-24 09:16:58,752 - __main__ - INFO - 후보 아이템 리스트 크기: 15개
2025-09-24 09:16:58,752 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-24 09:16:58,752 - __main__ - INFO - extra_item_pdf 크기: (13, 2)
2025-09-24 09:16:58,752 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-24 09:16:58,752 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '(KTF)갤럭시 S24 FE', 'item_id': ['A5V7']}, {'item_nm': '(LGU)갤럭시 S24 FE', 'item_id': ['A5V8']}]
2025-09-24 09:16:58,753 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 13개
2025-09-24 09:16:58,753 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': '(KTF)갤럭시 S24 FE', 'action': '기타'}, {'name': '(LGU)갤럭시 S24 FE', 'action': '기타'}]
2025-09-24 09:16:58,753 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-24 09:16:58,753 - __main__ - INFO - 구성된 프롬프트 길이: 6000 문자
2025-09-24 09:16:58,753 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-24 09:16:58,753 - __main__ - INFO - 프롬프트 저장됨: main_extraction_prompt (길이: 6000)
2025-09-24 09:16:58,754 - __main__ - INFO - 현재 저장된 프롬프트 수: 1
2025-09-24 09:16:58,754 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-24 09:17:09,084 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-24 09:17:09,098 - __main__ - INFO - LLM 응답 길이: 1047 문자
2025-09-24 09:17:09,099 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        }
    ],
    "channel": [
        {...
2025-09-24 09:17:09,099 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-24 09:17:09,099 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-24 09:17:09,099 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-24 09:17:09,099 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': 'S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '방문'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-24 09:17:09,099 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-24 09:17:09,099 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', 'S24 FE', '아이폰17']
2025-09-24 09:17:09,100 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-09-24 09:17:09,101 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-09-24 09:17:09,460 - __main__ - INFO - 프롬프트 저장됨: entity_extraction_prompt (길이: 18377)
2025-09-24 09:17:09,460 - __main__ - INFO - 현재 저장된 프롬프트 수: 2
2025-09-24 09:17:09,460 - __main__ - INFO - 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-24 09:17:09,460 - __main__ - INFO - 🔄 2개 LLM 모델로 엔티티 추출 시작
2025-09-24 09:17:09,481 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-24 09:17:09,481 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-24 09:17:11,744 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-24 09:17:12,921 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-24 09:17:12,929 - __main__ - INFO - ✅ LLM 추출 완료: ['S24 FE', '아이폰17', '갤럭시 와이드8', '와이드8', 'A36']
2025-09-24 09:17:13,114 - __main__ - INFO - extract_entities_by_llm 실행완료: 4.01초
2025-09-24 09:17:13,146 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-24 09:17:13,147 - __main__ - INFO - ============================================================
2025-09-24 09:17:13,147 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-24 09:17:13,147 - __main__ - INFO - ============================================================
2025-09-24 09:17:13,147 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-24 09:17:13,147 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-24 09:17:13,147 - __main__ - INFO - 상품 수: 4개
2025-09-24 09:17:13,147 - __main__ - INFO - 채널 수: 4개
2025-09-24 09:17:13,147 - __main__ - INFO - 프로그램 수: 2개
2025-09-24 09:17:13,147 - __main__ - INFO - process_message 실행완료: 15.38초
2025-09-24 09:17:13,147 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-24 09:17:13,737 - mongodb_utils - INFO - MongoDB 연결 성공: aos.mmsext
2025-09-24 09:17:13,739 - mongodb_utils - INFO - 문서 저장 성공: 68d338892a0986220a571492
2025-09-24 09:17:13,740 - mongodb_utils - INFO - MongoDB 연결 해제
2025-09-24 13:40:15,467 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-24 13:40:15,467 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-24 13:40:15,467 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-24 13:40:15,467 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-09-24 13:40:15,467 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-24 13:40:15,469 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-24 13:40:15,546 - __main__ - INFO - Using device: mps
2025-09-24 13:40:15,546 - __main__ - INFO - _initialize_device 실행완료: 0.08초
2025-09-24 13:40:15,546 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-24 13:40:15,546 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-24 13:40:15,546 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-24 13:40:15,546 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-24 13:40:15,546 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-24 13:40:15,547 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-24 13:40:15,547 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-24 13:40:19,538 - __main__ - INFO - Model loaded on mps
2025-09-24 13:40:19,538 - __main__ - INFO - _initialize_embedding_model 실행완료: 3.99초
2025-09-24 13:40:19,538 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-24 13:40:20,043 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-24 13:40:20,043 - __main__ - INFO - _initialize_kiwi 실행완료: 0.51초
2025-09-24 13:40:20,043 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-24 13:40:20,043 - __main__ - INFO - ============================================================
2025-09-24 13:40:20,043 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-24 13:40:20,043 - __main__ - INFO - ============================================================
2025-09-24 13:40:20,043 - __main__ - INFO - 데이터 소스 모드: local
2025-09-24 13:40:20,043 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-24 13:40:20,043 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-24 13:40:20,043 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-24 13:40:20,043 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-24 13:40:20,153 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-24 13:40:20,153 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-24 13:40:20,153 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-24 13:40:20,156 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-24 13:40:20,157 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-24 13:40:20,158 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-24 13:40:20,158 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-24 13:40:20,159 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-24 13:40:20,159 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-24 13:40:20,163 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-24 13:40:20,165 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-24 13:40:20,165 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-24 13:40:20,165 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-24 13:40:20,165 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-24 13:40:20,165 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-24 13:40:20,166 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-24 13:40:20,166 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-24 13:40:20,166 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-24 13:40:20,166 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-24 13:40:20,166 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-24 13:40:20,169 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-24 13:40:20,169 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-09-24 13:40:20,169 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-24 13:40:20,170 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-24 13:40:20,170 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-24 13:40:20,301 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-24 13:40:20,305 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-09-24 13:40:20,306 - __main__ - INFO - 별칭 적용 후 샘플: ['우주pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증']
2025-09-24 13:40:20,306 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-24 13:40:20,306 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-09-24 13:40:20,306 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-24 13:40:20,307 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-24 13:40:20,307 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-24 13:40:20,307 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-24 13:40:20,307 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-24 13:40:20,308 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-09-24 13:40:20,309 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-09-24 13:40:20,309 - __main__ - INFO - 등록할 별칭 샘플: ['우주pass Netflix 인증', '우주PASS Netflix 인증', '우주패스 넷플릭스 인증', '우주Pass Netflix 인증', '우주패스 Netflix 인증']
2025-09-24 13:40:20,323 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-09-24 13:40:20,323 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-24 13:40:20,323 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-24 13:40:20,328 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-24 13:40:20,328 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-24 13:40:20,496 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-24 13:40:20,497 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-24 13:40:20,497 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-24 13:40:20,497 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-09-24 13:40:20,497 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-09-24 13:40:20,497 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-24 13:40:20,565 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-09-24 13:40:20,565 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-24 13:40:20,567 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-09-24 13:40:20,567 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-09-24 13:40:20,567 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-09-24 13:40:20,567 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-24 13:40:20,567 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-09-24 13:40:20,568 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-24 13:40:20,568 - __main__ - INFO - ============================================================
2025-09-24 13:40:20,568 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-24 13:40:20,568 - __main__ - INFO - ============================================================
2025-09-24 13:40:20,568 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-09-24 13:40:20,568 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-24 13:40:20,568 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-24 13:40:20,568 - __main__ - INFO - ✅ 정지어: 166개
2025-09-24 13:40:20,568 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-24 13:40:20,569 - __main__ - INFO - 고유 상품명 수: 6586개
2025-09-24 13:40:20,570 - __main__ - INFO - 고유 별칭 수: 16948개
2025-09-24 13:40:20,571 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-24 13:40:20,571 - __main__ - INFO - _load_data 실행완료: 0.53초
2025-09-24 13:40:20,571 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-24 13:40:20,571 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-24 13:40:20,571 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-24 13:40:20,571 - __main__ - INFO - ============================================================
2025-09-24 13:40:20,571 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-24 13:40:20,571 - __main__ - INFO - ============================================================
2025-09-24 13:40:20,571 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-24 13:40:20,571 - __main__ - INFO - 메시지 길이: 421 문자
2025-09-24 13:40:20,571 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-24 13:40:20,571 - __main__ - INFO - 데이터 소스: local
2025-09-24 13:40:20,571 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-24 13:40:20,571 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-24 13:40:20,571 - __main__ - INFO - LLM 모델: ax
2025-09-24 13:40:20,571 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-09-24 13:40:20,571 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-24 13:40:20,571 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-24 13:40:20,571 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-24 13:40:20,571 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-24 13:40:20,572 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-09-24 13:40:21,022 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-24 13:40:21,023 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-24 13:40:21,026 - __main__ - INFO - 전체 토큰 수: 154개
2025-09-24 13:40:21,026 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하9', '갤럭시', '아이폰 17', '을지로입구역', '하나은행', '명동']
2025-09-24 13:40:21,026 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['을지로입구역', '하나은행', '구매하9', '아이폰 17', '명동', '갤럭시']
2025-09-24 13:40:21,026 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-24 13:40:21,460 - __main__ - INFO - 퍼지 매칭 결과 크기: (1242, 3)
2025-09-24 13:40:21,460 - __main__ - INFO - 퍼지 매칭 성공: 1242개 결과
2025-09-24 13:40:21,460 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-24 13:40:21,460 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-24 13:40:21,499 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1242, 3)
2025-09-24 13:40:21,500 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-24 13:40:21,500 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-24 13:40:21,501 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 14개
2025-09-24 13:40:21,503 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 5개
2025-09-24 13:40:21,503 - __main__ - INFO - 통합된 후보 아이템 수: 19개
2025-09-24 13:40:21,505 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-24 13:40:21,506 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (13, 2)
2025-09-24 13:40:21,507 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '(KTF)갤럭시 S24 FE', 'item_id': ['A5V7']}, {'item_nm': '(LGU)갤럭시 S24 FE', 'item_id': ['A5V8']}, {'item_nm': 'IPHONE 17', 'item_id': ['A6UD', 'A6SQ', 'A6U2', 'A6U7', 'A6SV']}]
2025-09-24 13:40:21,507 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 0.94초
2025-09-24 13:40:21,507 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-24 13:40:21,507 - __main__ - INFO - 매칭된 상품 정보: (13, 2)
2025-09-24 13:40:21,507 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-24 13:40:21,590 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-24 13:40:21,590 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-24 13:40:21,590 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-24 13:40:21,590 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-24 13:40:21,590 - __main__ - INFO - 후보 아이템 리스트 크기: 15개
2025-09-24 13:40:21,590 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-24 13:40:21,591 - __main__ - INFO - extra_item_pdf 크기: (13, 2)
2025-09-24 13:40:21,591 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-24 13:40:21,591 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '(KTF)갤럭시 S24 FE', 'item_id': ['A5V7']}, {'item_nm': '(LGU)갤럭시 S24 FE', 'item_id': ['A5V8']}]
2025-09-24 13:40:21,592 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 13개
2025-09-24 13:40:21,592 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': '(KTF)갤럭시 S24 FE', 'action': '기타'}, {'name': '(LGU)갤럭시 S24 FE', 'action': '기타'}]
2025-09-24 13:40:21,592 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-24 13:40:21,592 - __main__ - INFO - 구성된 프롬프트 길이: 6000 문자
2025-09-24 13:40:21,592 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-24 13:40:21,592 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-09-24 13:40:21,592 - __main__ - INFO - 📝 프롬프트 길이: 6,000 문자
2025-09-24 13:40:21,592 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-09-24 13:40:21,592 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-24 13:40:36,750 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-24 13:40:36,764 - __main__ - INFO - LLM 응답 길이: 1163 문자
2025-09-24 13:40:36,765 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        }
    ],
    "channel": [
        {...
2025-09-24 13:40:36,765 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-24 13:40:36,765 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-24 13:40:36,765 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-24 13:40:36,765 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': 'S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '방문'}, {'type': '전화번호', 'value': '080-801-0011', 'action': '수신 거부'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-24 13:40:36,765 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-24 13:40:36,766 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', 'S24 FE', '아이폰17']
2025-09-24 13:40:36,766 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-09-24 13:40:36,766 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-09-24 13:40:36,766 - __main__ - INFO - === 후보 엔티티 추출 시작 ===
2025-09-24 13:40:36,766 - __main__ - INFO - 퍼지 매칭 임계값: 0.4
2025-09-24 13:40:37,116 - __main__ - INFO - 로직 기반 추출 원본 엔티티 수: 1052개
2025-09-24 13:40:37,116 - __main__ - INFO - 원본 엔티티 샘플 (최대 10개): ['(KTF)갤럭시 Z 폴드7 512기가', '(LGU)갤럭시 Z 폴드7 256기가', '(LGU)갤럭시 Z 폴드7 512기가', '0 청년 37', '0 청년 43', '0 청년 43 DATA 충전 2GB', '0 청년 43 Data 충전 2GB', '0 청년 43 data 충전 2GB', '0 청년 43 데이터 충전 2GB', '0 청년 43 데이터 충전 2기가']
2025-09-24 13:40:37,117 - __main__ - INFO - 필터링 후 엔티티 수: 1048개
2025-09-24 13:40:37,117 - __main__ - INFO - 제거된 엔티티 수: 4개
2025-09-24 13:40:37,117 - __main__ - INFO - 최종 후보 엔티티 수: 1048개
2025-09-24 13:40:37,117 - __main__ - WARNING - ⚠️ 후보 엔티티가 매우 많습니다: 1048개
2025-09-24 13:40:37,117 - __main__ - WARNING - 이는 프롬프트 길이를 크게 증가시킬 수 있습니다.
2025-09-24 13:40:37,117 - __main__ - WARNING - 성능을 위해 상위 50개만 사용합니다. (원본: 1048개)
2025-09-24 13:40:37,117 - __main__ - INFO - 최종 후보 엔티티 샘플 (최대 10개): ['(KTF)갤럭시 Z 폴드7 512기가', '(LGU)갤럭시 Z 폴드7 256기가', '(LGU)갤럭시 Z 폴드7 512기가', '0 청년 37', '0 청년 43', '0 청년 43 DATA 충전 2GB', '0 청년 43 Data 충전 2GB', '0 청년 43 data 충전 2GB', '0 청년 43 데이터 충전 2GB', '0 청년 43 데이터 충전 2기가']
2025-09-24 13:40:37,117 - __main__ - INFO - === 후보 엔티티 추출 완료 ===
2025-09-24 13:40:37,117 - __main__ - INFO - 🔍 프롬프트에 추가될 엔티티 섹션 길이: 896 문자
2025-09-24 13:40:37,117 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 3,720 문자
2025-09-24 13:40:37,117 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-09-24 13:40:37,117 - __main__ - INFO - 📝 프롬프트 길이: 3,720 문자
2025-09-24 13:40:37,117 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-09-24 13:40:37,117 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-24 13:40:37,117 - __main__ - INFO - 🔄 2개 LLM 모델로 엔티티 추출 시작
2025-09-24 13:40:37,129 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-24 13:40:37,129 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-24 13:40:37,129 - __main__ - INFO - 🔍 프롬프트 구성 중 - LLM 모델: client=<openai.resources.chat.completions.completions.Completions object at 0x13af2e580> async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x13af2f790> root_client=<openai.OpenAI object at 0x13af2e360> root_async_client=<openai.AsyncOpenAI object at 0x13af2e470> model_name='skt/ax4' temperature=0.0 model_kwargs={} openai_api_key=SecretStr('**********') openai_api_base='https://api.platform.a15t.com/v1' max_tokens=4000
2025-09-24 13:40:37,129 - __main__ - INFO - 🔍 프롬프트 구성 중 - LLM 모델: client=<openai.resources.chat.completions.completions.Completions object at 0x13e18e9c0> async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x13e18e690> root_client=<openai.OpenAI object at 0x13b002550> root_async_client=<openai.AsyncOpenAI object at 0x13e18e7a0> model_name='amazon/anthropic/claude-sonnet-4-20250514' temperature=0.0 model_kwargs={} openai_api_key=SecretStr('**********') openai_api_base='https://api.platform.a15t.com/v1' max_tokens=4000
2025-09-24 13:40:37,129 - __main__ - INFO - 🔍 후보 엔티티 개수: 50개
2025-09-24 13:40:37,129 - __main__ - INFO - 🔍 후보 엔티티 개수: 50개
2025-09-24 13:40:37,129 - __main__ - INFO - 🔍 후보 엔티티 문자열 길이: 783 문자
2025-09-24 13:40:37,130 - __main__ - INFO - 🔍 후보 엔티티 문자열 길이: 783 문자
2025-09-24 13:40:37,130 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-09-24 13:40:37,130 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-09-24 13:40:37,130 - __main__ - INFO - 🔍 메시지 길이: 407 문자
2025-09-24 13:40:37,130 - __main__ - INFO - 🔍 메시지 길이: 407 문자
2025-09-24 13:40:37,130 - __main__ - INFO - 🔍 예상 전체 프롬프트 길이: 3,638 문자
2025-09-24 13:40:37,130 - __main__ - INFO - 🔍 예상 전체 프롬프트 길이: 3,638 문자
2025-09-24 13:40:38,389 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-24 13:40:38,583 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-24 13:40:38,591 - __main__ - INFO - ✅ LLM 추출 완료: ['아이폰17', 'A36', 'S24 FE', '와이드8', '인터넷+TV']
2025-09-24 13:40:38,782 - __main__ - INFO - extract_entities_by_llm 실행완료: 2.02초
2025-09-24 13:40:38,814 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-24 13:40:38,814 - __main__ - INFO - ============================================================
2025-09-24 13:40:38,814 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-24 13:40:38,814 - __main__ - INFO - ============================================================
2025-09-24 13:40:38,814 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-24 13:40:38,814 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-24 13:40:38,814 - __main__ - INFO - 상품 수: 3개
2025-09-24 13:40:38,814 - __main__ - INFO - 채널 수: 5개
2025-09-24 13:40:38,814 - __main__ - INFO - 프로그램 수: 2개
2025-09-24 13:40:38,814 - __main__ - INFO - process_message 실행완료: 18.24초
2025-09-24 13:40:38,814 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-24 13:40:39,403 - mongodb_utils - INFO - MongoDB 연결 성공: aos.mmsext
2025-09-24 13:40:39,405 - mongodb_utils - INFO - 문서 저장 성공: 68d37647f46c635bf6da5648
2025-09-24 13:40:39,407 - mongodb_utils - INFO - MongoDB 연결 해제
2025-09-25 13:24:25,395 - __main__ - INFO - MMS 추출기 초기화 중...
2025-09-25 13:24:25,395 - __main__ - INFO - 🚀 MMSExtractor 초기화 시작
2025-09-25 13:24:25,396 - __main__ - INFO - ⚙️ 기본 설정 적용 중...
2025-09-25 13:24:25,396 - __main__ - INFO - 📋 표준 추출 모드 (DAG 비활성화)
2025-09-25 13:24:25,396 - __main__ - INFO - 🔑 환경변수 로드 중...
2025-09-25 13:24:25,397 - __main__ - INFO - 💻 디바이스 설정 중...
2025-09-25 13:24:25,434 - __main__ - INFO - Using device: mps
2025-09-25 13:24:25,434 - __main__ - INFO - _initialize_device 실행완료: 0.04초
2025-09-25 13:24:25,434 - __main__ - INFO - 🤖 LLM 모델 초기화 중...
2025-09-25 13:24:25,435 - __main__ - INFO - LLM 초기화 완료: ax (skt/ax4)
2025-09-25 13:24:25,435 - __main__ - INFO - _initialize_llm 실행완료: 0.00초
2025-09-25 13:24:25,435 - __main__ - INFO - 🧠 임베딩 모델 로드 중...
2025-09-25 13:24:25,435 - __main__ - INFO - Loading model from ./models/ko-sbert-nli...
2025-09-25 13:24:25,435 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-09-25 13:24:25,435 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: ./models/ko-sbert-nli
2025-09-25 13:24:26,079 - __main__ - INFO - Model loaded on mps
2025-09-25 13:24:26,080 - __main__ - INFO - _initialize_embedding_model 실행완료: 0.64초
2025-09-25 13:24:26,080 - __main__ - INFO - 📝 NLP 도구 (Kiwi) 초기화 중...
2025-09-25 13:24:26,716 - __main__ - INFO - Kiwi 형태소 분석기 초기화 완료
2025-09-25 13:24:26,717 - __main__ - INFO - _initialize_kiwi 실행완료: 0.64초
2025-09-25 13:24:26,717 - __main__ - INFO - 📁 데이터 로드 중...
2025-09-25 13:24:26,717 - __main__ - INFO - ============================================================
2025-09-25 13:24:26,717 - __main__ - INFO - 📊 데이터 로딩 시작
2025-09-25 13:24:26,717 - __main__ - INFO - ============================================================
2025-09-25 13:24:26,717 - __main__ - INFO - 데이터 소스 모드: local
2025-09-25 13:24:26,717 - __main__ - INFO - 1️⃣ 상품 정보 로드 중...
2025-09-25 13:24:26,717 - __main__ - INFO - === 상품 정보 로드 시작 (모드: local) ===
2025-09-25 13:24:26,717 - __main__ - INFO - 로컬 CSV 파일에서 상품 정보 로드 중...
2025-09-25 13:24:26,717 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-25 13:24:26,866 - __main__ - INFO - 로컬 CSV에서 로드된 원본 데이터 크기: (16316, 9)
2025-09-25 13:24:26,866 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-25 13:24:26,866 - __main__ - INFO - 컬럼 매핑: {'ITEM_NM': 'item_nm', 'ITEM_ID': 'item_id', 'ITEM_DESC': 'item_desc', 'ITEM_DMN': 'item_dmn', 'ITEM_ALS': 'item_nm_alias'}
2025-09-25 13:24:26,873 - __main__ - INFO - 중복 제거 후 데이터 크기: (16316, 5)
2025-09-25 13:24:26,874 - __main__ - INFO - item_nm_alias에서 16316개 null 값을 item_nm으로 채웁니다.
2025-09-25 13:24:26,875 - __main__ - INFO - 로컬 모드 최종 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-25 13:24:26,875 - __main__ - INFO - item_nm_alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-25 13:24:26,876 - __main__ - INFO - 로컬 모드 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70', '뉴스콤 관제30', '구축-Smart PayHub']
2025-09-25 13:24:26,876 - __main__ - INFO - 로컬 모드 데이터 샘플 (5개 행):
2025-09-25 13:24:26,888 - __main__ - INFO - [{'item_nm': '우주패스 Netflix 인증', 'item_id': 'NA00008735', 'item_desc': '우주패스 Netflix 인증&&T 우주패스 Netflix를 인증하면 가입되는 더미코드&&', 'item_dmn': 'P', 'item_nm_alias': '우주패스 Netflix 인증', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008735', 'oper_dt_hms': '20250101000000'}, {'item_nm': 'LTE-M10(24년_간선망)', 'item_id': 'NA00008782', 'item_desc': 'LTE-M10(24년_간선망)&&ㅇ 한전 AMI 간선망용 무선모뎀 사업수주에 따른 신규 전용상품(요금제) 출시   - 수주일자 : 4/3  - 수량 : 13,656대 (Cat.1 모뎀)  - 상품명 : LTE-M10(24년_한전 간선망)  - 제안요금 : 711원(Vat별도)     > “LTE-M 10 요금제” + “기업데이터 청구” 형태       >  총91MB 제공  - 부가서비스 상품명 : 한전_부가_PGW#37    > UUT 211 적용&&', 'item_dmn': 'P', 'item_nm_alias': 'LTE-M10(24년_간선망)', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00008782', 'oper_dt_hms': '20250101000000'}, {'item_nm': '유선대체 70', 'item_id': 'NA00005883', 'item_desc': '유선대체 70&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건&&ㅇ 기본료 : 7,000원 (VAT포함 7,700원)_ㅇ 기본제공 : 데이터 120MB_ㅇ 특징_  - 월 제공 데이터 소진 후 30kbps로 속도 제어된 상태에서 사용하는 Data는 비과금 처리(월 기본료를 제외한 추가과금 없음)_  - 유선대체 요금제는 당사가 지정하는 012번호의 사물통신형 단말중에서 고정형결제기만 가입가능(단말 리스트 별도관리)_ㅇ 초과요율_  - Data : 월 제공 Data 소진 이후, 30Kbps로 속도 제어된 상태로 사용하는 Data는 비과금 처리(기본료를 초과하여 과금하지 않음)_  - 문자 : SMS 22원/건, 텍스트형MMS 33원/건, 멀티미디어형MMS 110원/건', 'item_dmn': 'P', 'item_nm_alias': '유선대체 70', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NA00005883', 'oper_dt_hms': '20250101000000'}, {'item_nm': '뉴스콤 관제30', 'item_id': 'NB00000764', 'item_desc': '뉴스콤 관제30&&고객사의 메인망은 초고속인터넷이고 백업망으로 당사의 이동통신망을 이용하는 무선라우터를 공급하는 경우, 원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off/ 원격조치 불가능시 출동후 장애 조치 서비스&&원격에서 무선라우터에 연결된 LTE망 장애여부 확인 / 원격 On-Off / 원격조치 불가능시 출동후 장애 조치 서비스', 'item_dmn': 'P', 'item_nm_alias': '뉴스콤 관제30', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'NB00000764', 'oper_dt_hms': '20250101000000'}, {'item_nm': '구축-Smart PayHub', 'item_id': 'PD00013310', 'item_desc': '구축-Smart PayHub&&&&', 'item_dmn': 'P', 'item_nm_alias': '구축-Smart PayHub', 'item_ctg': None, 'item_emb_vec': None, 'ofer_cd': 'PD00013310', 'oper_dt_hms': '20250101000000'}]
2025-09-25 13:24:26,891 - __main__ - INFO - 도메인 필터링: 16316 -> 10551 (제외된 도메인: ['R'])
2025-09-25 13:24:26,891 - __main__ - INFO - === 상품 정보 로드 최종 완료: 10551개 상품 ===
2025-09-25 13:24:26,891 - __main__ - INFO - 최종 데이터 스키마: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-25 13:24:26,891 - __main__ - INFO - 최종 데이터 타입: {'item_nm': dtype('O'), 'item_id': dtype('O'), 'item_desc': dtype('O'), 'item_dmn': dtype('O'), 'item_nm_alias': dtype('O'), 'item_ctg': dtype('O'), 'item_emb_vec': dtype('O'), 'ofer_cd': dtype('O'), 'oper_dt_hms': dtype('O')}
2025-09-25 13:24:26,891 - __main__ - INFO - 모든 중요 컬럼이 존재합니다.
2025-09-25 13:24:26,892 - __main__ - INFO - 상품 정보 로드 후 데이터 크기: (10551, 9)
2025-09-25 13:24:26,892 - __main__ - INFO - 상품 정보 컬럼들: ['item_nm', 'item_id', 'item_desc', 'item_dmn', 'item_nm_alias', 'item_ctg', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-25 13:24:26,892 - __main__ - INFO - 2️⃣ 별칭 규칙 적용 중...
2025-09-25 13:24:26,892 - __main__ - INFO - === 별칭 규칙 적용 시작 ===
2025-09-25 13:24:26,892 - __main__ - INFO - 별칭 규칙 적용 전 상품 데이터 크기: (10551, 9)
2025-09-25 13:24:26,899 - __main__ - INFO - 로드된 별칭 규칙 수: 167개
2025-09-25 13:24:26,899 - __main__ - INFO - null이 아닌 상품명 수: 10393개
2025-09-25 13:24:26,899 - __main__ - INFO - 별칭 적용 전 상품명 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-25 13:24:26,900 - __main__ - INFO - 기존 item_nm_alias 데이터를 발견했습니다. 별칭 규칙과 병합합니다.
2025-09-25 13:24:26,900 - __main__ - INFO - 기존 alias 샘플: ['우주패스 Netflix 인증', 'LTE-M10(24년_간선망)', '유선대체 70']
2025-09-25 13:24:27,093 - __main__ - INFO - 기존 ITEM_ALS 데이터와 별칭 규칙이 성공적으로 병합되었습니다.
2025-09-25 13:24:27,103 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: 10551 -> 22506
2025-09-25 13:24:27,103 - __main__ - INFO - 별칭 적용 후 샘플: ['우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증']
2025-09-25 13:24:27,103 - __main__ - INFO - 별칭 규칙 적용 완료: 167개 규칙
2025-09-25 13:24:27,104 - __main__ - INFO - 별칭 규칙 적용 후 데이터 크기: (22506, 9)
2025-09-25 13:24:27,104 - __main__ - INFO - 3️⃣ 정지어 로드 중...
2025-09-25 13:24:27,108 - __main__ - INFO - 정지어 로드 완료: 166개
2025-09-25 13:24:27,108 - __main__ - INFO - 로드된 정지어 수: 166개
2025-09-25 13:24:27,108 - __main__ - INFO - 4️⃣ Kiwi에 상품명 등록 중...
2025-09-25 13:24:27,108 - __main__ - INFO - === Kiwi에 상품명 등록 시작 ===
2025-09-25 13:24:27,109 - __main__ - INFO - 등록할 고유 별칭 수: 16949개
2025-09-25 13:24:27,110 - __main__ - INFO - 유효한 별칭 수: 16948개
2025-09-25 13:24:27,110 - __main__ - INFO - 등록할 별칭 샘플: ['우주pass Netflix 인증', '우주패스 넷플릭스 인증', '우주패스 Netflix 인증', '우주PASS Netflix 인증', '우주Pass Netflix 인증']
2025-09-25 13:24:27,131 - __main__ - INFO - Kiwi에 상품명 등록 완료: 16948개 성공, 0개 실패
2025-09-25 13:24:27,131 - __main__ - INFO - 5️⃣ 프로그램 분류 정보 로드 중...
2025-09-25 13:24:27,131 - __main__ - INFO - 프로그램 분류 정보 로딩 시작...
2025-09-25 13:24:27,142 - __main__ - INFO - 로컬 파일에서 프로그램 정보 로드: 25개
2025-09-25 13:24:27,142 - __main__ - INFO - 프로그램 분류 임베딩 생성 시작...
2025-09-25 13:24:29,009 - __main__ - INFO - 프로그램 분류 임베딩 생성 완료: 25개 프로그램
2025-09-25 13:24:29,010 - __main__ - INFO - 프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
2025-09-25 13:24:29,010 - __main__ - INFO - 6️⃣ 조직 정보 로드 중...
2025-09-25 13:24:29,010 - __main__ - INFO - === 조직 정보 로드 시작 (모드: local) ===
2025-09-25 13:24:29,010 - __main__ - INFO - 로컬 CSV 파일에서 조직 정보 로드 중...
2025-09-25 13:24:29,010 - __main__ - INFO - CSV 파일 경로: ./data/offer_master_data.csv
2025-09-25 13:24:29,099 - __main__ - INFO - 로컬 CSV에서 로드된 원본 조직 데이터 크기: (16316, 9)
2025-09-25 13:24:29,099 - __main__ - INFO - 로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
2025-09-25 13:24:29,102 - __main__ - INFO - 로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
2025-09-25 13:24:29,102 - __main__ - INFO - 조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
2025-09-25 13:24:29,102 - __main__ - INFO - === 조직 정보 로드 최종 완료: 5765개 조직 ===
2025-09-25 13:24:29,102 - __main__ - INFO - 최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
2025-09-25 13:24:29,102 - __main__ - INFO - 모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
2025-09-25 13:24:29,103 - __main__ - INFO - 조직 정보 로드 후 데이터 크기: (5765, 9)
2025-09-25 13:24:29,103 - __main__ - INFO - ============================================================
2025-09-25 13:24:29,103 - __main__ - INFO - 📋 데이터 로딩 완료 - 최종 상태 요약
2025-09-25 13:24:29,103 - __main__ - INFO - ============================================================
2025-09-25 13:24:29,103 - __main__ - INFO - ✅ 상품 데이터: (22506, 9)
2025-09-25 13:24:29,103 - __main__ - INFO - ✅ 프로그램 데이터: (25, 6)
2025-09-25 13:24:29,103 - __main__ - INFO - ✅ 조직 데이터: (5765, 9)
2025-09-25 13:24:29,103 - __main__ - INFO - ✅ 정지어: 166개
2025-09-25 13:24:29,103 - __main__ - INFO - === 상품 데이터 상세 정보 ===
2025-09-25 13:24:29,104 - __main__ - INFO - 고유 상품명 수: 6586개
2025-09-25 13:24:29,106 - __main__ - INFO - 고유 별칭 수: 16948개
2025-09-25 13:24:29,108 - __main__ - INFO - 고유 상품ID 수: 10551개
2025-09-25 13:24:29,108 - __main__ - INFO - _load_data 실행완료: 2.39초
2025-09-25 13:24:29,108 - __main__ - INFO - ✅ MMSExtractor 초기화 완료
2025-09-25 13:24:29,108 - __main__ - INFO - 단일 메시지 처리 시작 (멀티스레드)
2025-09-25 13:24:29,108 - __main__ - INFO - 워커 프로세스에서 메시지 처리 시작: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 ...
2025-09-25 13:24:29,108 - __main__ - INFO - ============================================================
2025-09-25 13:24:29,108 - __main__ - INFO - 🚀 MMS 메시지 처리 시작
2025-09-25 13:24:29,108 - __main__ - INFO - ============================================================
2025-09-25 13:24:29,108 - __main__ - INFO - 메시지 내용: 
[Web발신]
(광고)[SKT (을지로점)] 신용욱 단골고객님
9월은 SKT 직영점에서 혜택받9, 구매하9

【갤럭시 마지막 특가】
① 와이드8 ▶기기값 5만원
② A36 ▶기기값 10만원
③ S24 FE ▶기기값 20만원
☞ 제휴카드 사용 시 최대 72만원 추가할인

【SK로 통신사 이동 시】
① 쓰던 폰 그대로 이동시 상품권 20만원
② 인터넷+TV ...
2025-09-25 13:24:29,108 - __main__ - INFO - 메시지 길이: 421 문자
2025-09-25 13:24:29,108 - __main__ - INFO - === 현재 추출기 설정 ===
2025-09-25 13:24:29,108 - __main__ - INFO - 데이터 소스: local
2025-09-25 13:24:29,109 - __main__ - INFO - 상품 정보 추출 모드: nlp
2025-09-25 13:24:29,109 - __main__ - INFO - 엔티티 추출 모드: llm
2025-09-25 13:24:29,109 - __main__ - INFO - LLM 모델: ax
2025-09-25 13:24:29,109 - __main__ - INFO - 상품 데이터 크기: (22506, 9)
2025-09-25 13:24:29,109 - __main__ - INFO - 프로그램 데이터 크기: (25, 6)
2025-09-25 13:24:29,109 - __main__ - INFO - ============================== 1단계: 엔티티 추출 ==============================
2025-09-25 13:24:29,109 - __main__ - INFO - === Kiwi 기반 엔티티 추출 시작 ===
2025-09-25 13:24:29,109 - __main__ - INFO - 처리할 메시지 길이: 407 문자
2025-09-25 13:24:29,110 - __main__ - INFO - 매칭할 상품 별칭 수: 16949개
2025-09-25 13:24:29,767 - __main__ - INFO - 분할된 문장 수: 7개
2025-09-25 13:24:29,768 - __main__ - INFO - 필터링된 문장들: [' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', ' 갤럭시 마지막 특가 와이드8 기기값 5만원 A36 기기값 10만원 S24 FE 기기값 20만원 제휴카드 사용 시 최대 72만원 추가할인', ' SK로 통신사 이동 시 쓰던 폰 그대로 이동시 상품권 20만원 인터넷 TV 가입 최대 70만원']...
2025-09-25 13:24:29,772 - __main__ - INFO - 전체 토큰 수: 154개
2025-09-25 13:24:29,772 - __main__ - INFO - NNP 태그 토큰들: ['을지로', '구매하9', '갤럭시', '아이폰 17', '을지로입구역', '하나은행', '명동']
2025-09-25 13:24:29,772 - __main__ - INFO - 필터링 후 Kiwi 추출 엔티티: ['하나은행', '아이폰 17', '구매하9', '명동', '갤럭시', '을지로입구역']
2025-09-25 13:24:29,772 - __main__ - INFO - 퍼지 매칭 시작...
2025-09-25 13:24:30,678 - __main__ - INFO - 퍼지 매칭 결과 크기: (1242, 3)
2025-09-25 13:24:30,678 - __main__ - INFO - 퍼지 매칭 성공: 1242개 결과
2025-09-25 13:24:30,679 - __main__ - INFO - 퍼지 매칭 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.4}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.4}]
2025-09-25 13:24:30,679 - __main__ - INFO - 시퀀스 유사도 계산 시작...
2025-09-25 13:24:30,749 - __main__ - INFO - 시퀀스 유사도 결과 크기: (1242, 3)
2025-09-25 13:24:30,750 - __main__ - INFO - 시퀀스 유사도 샘플: [{'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '노트7고객', 'sim': 0.32000000000000006}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코web툰프리_할인', 'sim': 0.2}, {'sent': ' Web발신 광고 SKT 을지로점 신용욱 단골고객님 은 SKT 직영점에서 혜택받9 구매하9', 'item_nm_alias': '코미코 web툰 프리_인증', 'sim': 0.22857142857142856}]
2025-09-25 13:24:30,750 - __main__ - INFO - 사용할 유사도 임계값: 0.7
2025-09-25 13:24:30,753 - __main__ - INFO - 임계값 필터링 후 후보 아이템 수: 14개
2025-09-25 13:24:30,755 - __main__ - INFO - Kiwi 엔티티 매칭 결과: 5개
2025-09-25 13:24:30,756 - __main__ - INFO - 통합된 후보 아이템 수: 19개
2025-09-25 13:24:30,759 - __main__ - INFO - 최종 후보 아이템 리스트: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-25 13:24:30,762 - __main__ - INFO - 최종 상품 정보 DataFrame 크기: (13, 2)
2025-09-25 13:24:30,762 - __main__ - INFO - 최종 상품 정보 샘플: [{'item_nm': '(KTF)갤럭시 S24 FE', 'item_id': ['A5V7']}, {'item_nm': '(LGU)갤럭시 S24 FE', 'item_id': ['A5V8']}, {'item_nm': 'IPHONE 17', 'item_id': ['A6UD', 'A6SQ', 'A6U2', 'A6U7', 'A6SV']}]
2025-09-25 13:24:30,762 - __main__ - INFO - extract_entities_from_kiwi 실행완료: 1.65초
2025-09-25 13:24:30,762 - __main__ - INFO - 추출된 후보 엔티티: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-25 13:24:30,762 - __main__ - INFO - 매칭된 상품 정보: (13, 2)
2025-09-25 13:24:30,762 - __main__ - INFO - ============================== 2단계: 프로그램 분류 ==============================
2025-09-25 13:24:31,905 - __main__ - INFO - 프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
2025-09-25 13:24:31,905 - __main__ - INFO - ============================== 3단계: RAG 컨텍스트 구성 ==============================
2025-09-25 13:24:31,905 - __main__ - INFO - 프로그램 분류 컨텍스트 길이: 416 문자
2025-09-25 13:24:31,905 - __main__ - INFO - ============================== 4단계: 제품 정보 준비 ==============================
2025-09-25 13:24:31,905 - __main__ - INFO - 후보 아이템 리스트 크기: 15개
2025-09-25 13:24:31,905 - __main__ - INFO - 후보 아이템 리스트: ['갤럭시 S24 FE', '갤럭시 와이드8', '아이폰 17', '갤럭시 A17', '갤럭시 S25 FE', '갤럭시 S25', '갤럭시 S25+', '갤럭시 A36 5G', '갤럭시 탭 S10 FE', '갤럭시 탭 S10 FE+', '(KTF)갤럭시 S24 FE', '(LGU)갤럭시 S24 FE', '갤럭시 탭 A 10.1', '갤럭시 TAB S10 FE', '갤럭시 TAB S10 FE+']
2025-09-25 13:24:31,905 - __main__ - INFO - extra_item_pdf 크기: (13, 2)
2025-09-25 13:24:31,905 - __main__ - INFO - extra_item_pdf 컬럼들: ['item_nm', 'item_id']
2025-09-25 13:24:31,906 - __main__ - INFO - extra_item_pdf 샘플: [{'item_nm': '(KTF)갤럭시 S24 FE', 'item_id': ['A5V7']}, {'item_nm': '(LGU)갤럭시 S24 FE', 'item_id': ['A5V8']}]
2025-09-25 13:24:31,907 - __main__ - INFO - NLP 모드: 제품 요소 준비 완료 - 13개
2025-09-25 13:24:31,907 - __main__ - INFO - NLP 모드 제품 요소 샘플: [{'name': '(KTF)갤럭시 S24 FE', 'action': '기타'}, {'name': '(LGU)갤럭시 S24 FE', 'action': '기타'}]
2025-09-25 13:24:31,907 - __main__ - INFO - ============================== 5단계: LLM 호출 ==============================
2025-09-25 13:24:31,907 - __main__ - INFO - 구성된 프롬프트 길이: 6000 문자
2025-09-25 13:24:31,907 - __main__ - INFO - RAG 컨텍스트 포함 여부: False
2025-09-25 13:24:31,907 - __main__ - INFO - 📝 프롬프트 저장됨: main_extraction_prompt
2025-09-25 13:24:31,907 - __main__ - INFO - 📝 프롬프트 길이: 6,000 문자
2025-09-25 13:24:31,908 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 1
2025-09-25 13:24:31,908 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt']
2025-09-25 13:24:45,924 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-25 13:24:45,943 - __main__ - INFO - LLM 응답 길이: 1047 문자
2025-09-25 13:24:45,944 - __main__ - INFO - LLM 응답 내용 (처음 500자): ```json
{
    "title": "9월은 SKT 직영점에서 혜택받9, 구매하9",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "대리점/매장 방문 유도"
    ],
    "product": [
        {
            "name": "갤럭시 와이드8",
            "action": "구매"
        },
        {
            "name": "갤럭시 A36",
            "action": "구매"
        },
        {
            "name": "S24 FE",
            "action": "구매"
        },
        {
            "name": "아이폰17",
            "action": "사전예약"
        }
    ],
    "channel": [
        {...
2025-09-25 13:24:45,944 - __main__ - INFO - ============================== 6단계: JSON 파싱 ==============================
2025-09-25 13:24:45,944 - __main__ - INFO - 추출된 JSON 객체 수: 1개
2025-09-25 13:24:45,945 - __main__ - INFO - 파싱된 JSON 객체 키: ['title', 'purpose', 'product', 'channel', 'pgm']
2025-09-25 13:24:45,945 - __main__ - INFO - 파싱된 JSON 내용: {'title': '9월은 SKT 직영점에서 혜택받9, 구매하9', 'purpose': ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도'], 'product': [{'name': '갤럭시 와이드8', 'action': '구매'}, {'name': '갤럭시 A36', 'action': '구매'}, {'name': 'S24 FE', 'action': '구매'}, {'name': '아이폰17', 'action': '사전예약'}], 'channel': [{'type': 'URL', 'value': 'https://naver.me/FTM8rdfj', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://naver.me/GipIR3Lg', 'action': '추가 정보'}, {'type': '전화번호', 'value': '0507-1399-6011', 'action': '문의'}, {'type': '대리점', 'value': 'SKT 을지로점', 'action': '방문'}], 'pgm': ['기변유도및해지방어', '상품및부가서비스가입유도_단말']}
2025-09-25 13:24:45,945 - __main__ - INFO - ============================== 7단계: 최종 결과 구성 ==============================
2025-09-25 13:24:45,945 - __main__ - INFO - LLM 추출 엔티티: ['갤럭시 와이드8', '갤럭시 A36', 'S24 FE', '아이폰17']
2025-09-25 13:24:45,946 - __main__ - INFO - ✅ LLM 모델 초기화 완료: ax (skt/ax4)
2025-09-25 13:24:45,946 - __main__ - INFO - ✅ LLM 모델 초기화 완료: cld (amazon/anthropic/claude-sonnet-4-20250514)
2025-09-25 13:24:45,946 - __main__ - INFO - === 후보 엔티티 추출 시작 ===
2025-09-25 13:24:45,946 - __main__ - INFO - 퍼지 매칭 임계값: 0.4
2025-09-25 13:24:46,654 - __main__ - INFO - 로직 기반 추출 원본 엔티티 수: 1052개
2025-09-25 13:24:46,654 - __main__ - INFO - 원본 엔티티 샘플 (최대 10개): ['(KTF)갤럭시 Z 폴드7 512기가', '(LGU)갤럭시 Z 폴드7 256기가', '(LGU)갤럭시 Z 폴드7 512기가', '0 청년 37', '0 청년 43', '0 청년 43 DATA 충전 2GB', '0 청년 43 Data 충전 2GB', '0 청년 43 data 충전 2GB', '0 청년 43 데이터 충전 2GB', '0 청년 43 데이터 충전 2기가']
2025-09-25 13:24:46,656 - __main__ - INFO - 필터링 후 엔티티 수: 1048개
2025-09-25 13:24:46,656 - __main__ - INFO - 제거된 엔티티 수: 4개
2025-09-25 13:24:46,656 - __main__ - INFO - 최종 후보 엔티티 수: 1048개
2025-09-25 13:24:46,656 - __main__ - WARNING - ⚠️ 후보 엔티티가 매우 많습니다: 1048개
2025-09-25 13:24:46,656 - __main__ - WARNING - 이는 프롬프트 길이를 크게 증가시킬 수 있습니다.
2025-09-25 13:24:46,656 - __main__ - WARNING - 성능을 위해 상위 100개만 사용합니다. (원본: 1048개)
2025-09-25 13:24:46,656 - __main__ - INFO - 최종 후보 엔티티 샘플 (최대 10개): ['(KTF)갤럭시 Z 폴드7 512기가', '(LGU)갤럭시 Z 폴드7 256기가', '(LGU)갤럭시 Z 폴드7 512기가', '0 청년 37', '0 청년 43', '0 청년 43 DATA 충전 2GB', '0 청년 43 Data 충전 2GB', '0 청년 43 data 충전 2GB', '0 청년 43 데이터 충전 2GB', '0 청년 43 데이터 충전 2기가']
2025-09-25 13:24:46,656 - __main__ - INFO - === 후보 엔티티 추출 완료 ===
2025-09-25 13:24:46,656 - __main__ - INFO - 🔍 프롬프트에 추가될 엔티티 섹션 길이: 1,528 문자
2025-09-25 13:24:46,656 - __main__ - INFO - 🔍 최종 엔티티 추출 프롬프트 길이: 4,352 문자
2025-09-25 13:24:46,656 - __main__ - INFO - 📝 프롬프트 저장됨: entity_extraction_prompt
2025-09-25 13:24:46,656 - __main__ - INFO - 📝 프롬프트 길이: 4,352 문자
2025-09-25 13:24:46,656 - __main__ - INFO - 📝 현재 저장된 프롬프트 수: 2
2025-09-25 13:24:46,656 - __main__ - INFO - 📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
2025-09-25 13:24:46,656 - __main__ - INFO - 🔄 2개 LLM 모델로 엔티티 추출 시작
2025-09-25 13:24:46,668 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-25 13:24:46,668 - __main__ - INFO - 엔티티 추출에 prompts 디렉토리의 DETAILED_ENTITY_EXTRACTION_PROMPT 사용
2025-09-25 13:24:46,668 - __main__ - INFO - 🔍 프롬프트 구성 중 - LLM 모델: client=<openai.resources.chat.completions.completions.Completions object at 0x1630042c0> async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x1630e9280> root_client=<openai.OpenAI object at 0x163291670> root_async_client=<openai.AsyncOpenAI object at 0x1b1dbaea0> model_name='skt/ax4' temperature=0.0 model_kwargs={} openai_api_key=SecretStr('**********') openai_api_base='https://api.platform.a15t.com/v1' max_tokens=4000
2025-09-25 13:24:46,669 - __main__ - INFO - 🔍 프롬프트 구성 중 - LLM 모델: client=<openai.resources.chat.completions.completions.Completions object at 0x1b1dcf7d0> async_client=<openai.resources.chat.completions.completions.AsyncCompletions object at 0x1694c28a0> root_client=<openai.OpenAI object at 0x1630d5190> root_async_client=<openai.AsyncOpenAI object at 0x1694c0dd0> model_name='amazon/anthropic/claude-sonnet-4-20250514' temperature=0.0 model_kwargs={} openai_api_key=SecretStr('**********') openai_api_base='https://api.platform.a15t.com/v1' max_tokens=4000
2025-09-25 13:24:46,669 - __main__ - INFO - 🔍 후보 엔티티 개수: 100개
2025-09-25 13:24:46,669 - __main__ - INFO - 🔍 후보 엔티티 개수: 100개
2025-09-25 13:24:46,669 - __main__ - INFO - 🔍 후보 엔티티 문자열 길이: 1,365 문자
2025-09-25 13:24:46,669 - __main__ - INFO - 🔍 후보 엔티티 문자열 길이: 1,365 문자
2025-09-25 13:24:46,669 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-09-25 13:24:46,669 - __main__ - INFO - 🔍 베이스 프롬프트 길이: 2,348 문자
2025-09-25 13:24:46,669 - __main__ - INFO - 🔍 메시지 길이: 407 문자
2025-09-25 13:24:46,669 - __main__ - INFO - 🔍 메시지 길이: 407 문자
2025-09-25 13:24:46,669 - __main__ - INFO - 🔍 예상 전체 프롬프트 길이: 4,220 문자
2025-09-25 13:24:46,669 - __main__ - INFO - 🔍 예상 전체 프롬프트 길이: 4,220 문자
2025-09-25 13:24:47,841 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-25 13:24:48,480 - httpx - INFO - HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-25 13:24:48,493 - __main__ - INFO - ✅ LLM 추출 완료: ['S24 FE', '와이드8', 'A36', '아이폰17']
2025-09-25 13:24:48,810 - __main__ - INFO - extract_entities_by_llm 실행완료: 2.86초
2025-09-25 13:24:48,874 - __main__ - INFO - ============================== 8단계: 결과 검증 ==============================
2025-09-25 13:24:48,874 - __main__ - INFO - ============================================================
2025-09-25 13:24:48,874 - __main__ - INFO - ✅ 메시지 처리 완료 - 최종 결과 요약
2025-09-25 13:24:48,874 - __main__ - INFO - ============================================================
2025-09-25 13:24:48,874 - __main__ - INFO - 제목: 9월은 SKT 직영점에서 혜택받9, 구매하9
2025-09-25 13:24:48,874 - __main__ - INFO - 목적: ['상품 가입 유도', '혜택 안내', '대리점/매장 방문 유도']
2025-09-25 13:24:48,874 - __main__ - INFO - 상품 수: 3개
2025-09-25 13:24:48,874 - __main__ - INFO - 채널 수: 4개
2025-09-25 13:24:48,874 - __main__ - INFO - 프로그램 수: 2개
2025-09-25 13:24:48,874 - __main__ - INFO - process_message 실행완료: 19.77초
2025-09-25 13:24:48,874 - __main__ - INFO - 워커 프로세스에서 메시지 처리 완료
2025-09-25 13:24:49,489 - mongodb_utils - INFO - MongoDB 연결 성공: aos.mmsext
2025-09-25 13:24:49,519 - mongodb_utils - INFO - 문서 저장 성공: 68d4c411de02ac3d9dd10d12
2025-09-25 13:24:49,520 - mongodb_utils - INFO - MongoDB 연결 해제
