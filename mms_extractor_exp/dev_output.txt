INFO:mms_extractor:🚀 MMSExtractor 초기화 시작
INFO:mms_extractor:⚙️ 기본 설정 적용 중...
INFO:mms_extractor:🎯 DAG 추출 모드 활성화됨
INFO:mms_extractor:🔑 환경변수 로드 중...
INFO:mms_extractor:💻 디바이스 설정 중...
INFO:mms_extractor:Using device: mps
INFO:utils:_initialize_device 실행완료: 0.03초
INFO:mms_extractor:🤖 LLM 모델 초기화 중...
INFO:mms_extractor:LLM 초기화 완료: ax (skt/ax4)
INFO:utils:_initialize_llm 실행완료: 0.00초
INFO:mms_extractor:🧠 임베딩 모델 로드 중...
INFO:utils:Loading model from ./models/ko-sbert-nli...
INFO:sentence_transformers.SentenceTransformer:Use pytorch device_name: mps
INFO:sentence_transformers.SentenceTransformer:Load pretrained SentenceTransformer: ./models/ko-sbert-nli
INFO:utils:Model loaded on mps
INFO:utils:_initialize_embedding_model 실행완료: 0.50초
INFO:mms_extractor:📝 NLP 도구 (Kiwi) 초기화 중...
INFO:mms_extractor:Kiwi 형태소 분석기 초기화 완료
INFO:utils:_initialize_kiwi 실행완료: 0.66초
INFO:mms_extractor:📁 데이터 로드 중...
INFO:mms_extractor:============================================================
INFO:mms_extractor:📊 데이터 로딩 시작
INFO:mms_extractor:============================================================
INFO:mms_extractor:데이터 소스 모드: local
INFO:mms_extractor:1️⃣ 상품 정보 로드 및 준비 중...
INFO:mms_extractor:=== 상품 정보 로드 및 준비 시작 (모드: local) ===
INFO:mms_extractor:📁 로컬 CSV 파일에서 로드
INFO:mms_extractor:원본 데이터 크기: (18070, 9)
INFO:mms_extractor:컬럼명 소문자 변환 완료
INFO:mms_extractor:도메인 필터링: 18070 -> 12305
INFO:mms_extractor:🔗 별칭 규칙 로드 중...
INFO:mms_extractor:별칭 규칙 수: 427개
INFO:mms_extractor:🔄 별칭 규칙 연쇄 적용 중...
INFO:mms_extractor:별칭 explode: 156399 -> 42462
INFO:mms_extractor:TEST 필터링: 42465 -> 42314
INFO:mms_extractor:=== 상품 정보 준비 완료 ===
INFO:mms_extractor:최종 데이터 크기: (42314, 14)
INFO:mms_extractor:최종 컬럼들: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms', 'item_nm_alias', 'start_dt', 'end_dt', 'rank', 'item_dmn_nm']
INFO:mms_extractor:✅ 모든 중요 컬럼 존재
INFO:mms_extractor:상품명 샘플: ['우주패스 Netflix 인증', '우주패스 Netflix 인증', '우주패스 Netflix 인증']
INFO:mms_extractor:별칭 샘플: ['우주패스 Netflix 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증']
INFO:mms_extractor:상품 정보 최종 데이터 크기: (42314, 14)
INFO:mms_extractor:상품 정보 컬럼들: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms', 'item_nm_alias', 'start_dt', 'end_dt', 'rank', 'item_dmn_nm']
INFO:mms_extractor:2️⃣ 정지어 로드 중...
INFO:mms_extractor:정지어 로드 완료: 202개
INFO:mms_extractor:로드된 정지어 수: 202개
INFO:mms_extractor:3️⃣ Kiwi에 상품명 등록 중...
INFO:mms_extractor:=== Kiwi에 상품명 등록 시작 ===
INFO:mms_extractor:등록할 고유 별칭 수: 34387개
INFO:mms_extractor:유효한 별칭 수: 34387개
INFO:mms_extractor:등록할 별칭 샘플: ['우주패스 Netflix 인증', '우주Pass Netflix 인증', '우주PASS Netflix 인증', '우주pass Netflix 인증', '우주패스 넷플릭스 인증']
INFO:mms_extractor:Kiwi에 상품명 등록 완료: 34387개 성공, 0개 실패
INFO:mms_extractor:4️⃣ 프로그램 분류 정보 로드 중...
INFO:mms_extractor:프로그램 분류 정보 로딩 시작...
INFO:mms_extractor:로컬 파일에서 프로그램 정보 로드: 25개
INFO:mms_extractor:프로그램 분류 임베딩 생성 시작...
INFO:mms_extractor:프로그램 분류 임베딩 생성 완료: 25개 프로그램
INFO:mms_extractor:프로그램 분류 정보 로드 후 데이터 크기: (25, 6)
INFO:mms_extractor:5️⃣ 조직 정보 로드 중...
INFO:mms_extractor:=== 조직 정보 로드 시작 (모드: local) ===
INFO:mms_extractor:로컬 CSV 파일에서 조직 정보 로드 중...
INFO:mms_extractor:CSV 파일 경로: ./data/offer_master_data.csv
INFO:mms_extractor:로컬 CSV에서 로드된 원본 조직 데이터 크기: (18070, 9)
INFO:mms_extractor:로컬 CSV 원본 컬럼들: ['ITEM_ID', 'ITEM_NM', 'ITEM_DMN', 'ITEM_DESC', 'ITEM_CTG', 'ITEM_ALS', 'ITEM_EMB_VEC', 'OFER_CD', 'OPER_DT_HMS']
INFO:mms_extractor:로컬 모드: ITEM_DMN='R' 필터링 후 데이터 크기: (5765, 9)
INFO:mms_extractor:조직 데이터 샘플 (3개 행): [{'item_id': 'D15198_0020', 'item_nm': '가로수대리점 하늘도시점', 'item_dmn': 'R', 'item_desc': '인천 중구 하늘중앙로195번길 11,&&1층 105호(중산동)&&003202309011', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541517', 'oper_dt_hms': 20250909151123}, {'item_id': 'D13622_0398', 'item_nm': 'MD대리점 주엽직영점', 'item_dmn': 'R', 'item_desc': '경기 고양시 일산서구 중앙로 1426,&&(주엽동) 1층111호&&003109152662', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430541945', 'oper_dt_hms': 20250909151123}, {'item_id': 'D15320_0001', 'item_nm': '강서대리점(온라인매장)', 'item_dmn': 'R', 'item_desc': '서울 양천구 남부순환로 354,&&1층 (신월동)&&007078567800', 'item_ctg': '501', 'item_als': nan, 'item_emb_vec': nan, 'ofer_cd': '1430542104', 'oper_dt_hms': 20250909151123}]
INFO:mms_extractor:=== 조직 정보 로드 최종 완료: 5765개 조직 ===
INFO:mms_extractor:최종 조직 데이터 스키마: ['item_id', 'item_nm', 'item_dmn', 'item_desc', 'item_ctg', 'item_als', 'item_emb_vec', 'ofer_cd', 'oper_dt_hms']
INFO:mms_extractor:모든 중요 조직 컬럼이 정상적으로 로드되었습니다.
INFO:mms_extractor:조직 정보 로드 후 데이터 크기: (5765, 9)
INFO:mms_extractor:============================================================
INFO:mms_extractor:📋 데이터 로딩 완료 - 최종 상태 요약
INFO:mms_extractor:============================================================
INFO:mms_extractor:✅ 상품 데이터: (42314, 14)
INFO:mms_extractor:✅ 프로그램 데이터: (25, 6)
INFO:mms_extractor:✅ 조직 데이터: (5765, 9)
INFO:mms_extractor:✅ 정지어: 202개
INFO:mms_extractor:=== 상품 데이터 상세 정보 ===
INFO:mms_extractor:고유 상품명 수: 8219개
INFO:mms_extractor:고유 별칭 수: 34387개
INFO:mms_extractor:고유 상품ID 수: 12244개
INFO:utils:_load_data 실행완료: 11.59초
INFO:mms_extractor:✅ MMSExtractor 초기화 완료
INFO:mms_extractor:============================================================
INFO:mms_extractor:🚀 MMS 메시지 처리 시작
INFO:mms_extractor:============================================================
INFO:mms_extractor:메시지 내용: 
    (광고)[SKT] iPhone 신제품 구매 혜택 안내 __#04 고객님, 안녕하세요._SK텔레콤에서 iPhone 신제품 구매하면, 최대 22만 원 캐시백 이벤트에 참여하실 수 있습니다.__현대카드로 애플 페이도 더 편리하게 이용해 보세요.__▶ 현대카드 바로 가기: https://t-mms.kr/ais/#74_ _애플 페이 티머니 충전 쿠폰 96만...
INFO:mms_extractor:메시지 길이: 379 문자
INFO:mms_extractor:=== 현재 추출기 설정 ===
INFO:mms_extractor:데이터 소스: local
INFO:mms_extractor:상품 정보 추출 모드: llm
INFO:mms_extractor:엔티티 추출 모드: llm
INFO:mms_extractor:LLM 모델: ax
INFO:mms_extractor:상품 데이터 크기: (42314, 14)
INFO:mms_extractor:프로그램 데이터 크기: (25, 6)
INFO:mms_extractor:============================== 1단계: 엔티티 추출 ==============================
INFO:mms_extractor:=== Kiwi 기반 엔티티 추출 시작 ===
INFO:mms_extractor:처리할 메시지 길이: 369 문자
INFO:mms_extractor:매칭할 상품 별칭 수: 34387개
INFO:mms_extractor:분할된 문장 수: 11개
INFO:mms_extractor:필터링된 문장들: [' 광고 SKT iPhone 신제품 구매 혜택 안내', ' 고객님 안녕하세요 ', 'SK텔레콤에서 iPhone 신제품 구매 최대 22만 원 캐시백 이벤트에 참여하실 수 있습니다 ']...
INFO:mms_extractor:전체 토큰 수: 143개
INFO:mms_extractor:NNP 태그 토큰들: ['iPhone 신제품', 'iPhone 신제품', '현대카드', '애플', '현대카드', '애플', '티머니', '충전', '샌프란시스코', '애플']
INFO:mms_extractor:필터링 후 Kiwi 추출 엔티티: ['iPhone 신제품']
INFO:mms_extractor:퍼지 매칭 시작...
Initializing MMSExtractor (Dev)...
Processing message...
INFO:mms_extractor:퍼지 매칭 결과 크기: (4958, 3)
INFO:mms_extractor:퍼지 매칭 성공: 4958개 결과
INFO:mms_extractor:퍼지 매칭 샘플: [{'sent': ' 광고 SKT iPhone 신제품 구매 혜택 안내', 'item_nm_alias': '해지번호안내', 'sim': 0.5}, {'sent': ' 광고 SKT iPhone 신제품 구매 혜택 안내', 'item_nm_alias': 'Tethe링 차단', 'sim': 0.4444444444444444}, {'sent': ' 광고 SKT iPhone 신제품 구매 혜택 안내', 'item_nm_alias': 'T_변경번호안내', 'sim': 0.4}]
INFO:mms_extractor:시퀀스 유사도 계산 시작...
INFO:mms_extractor:시퀀스 유사도 결과 크기: (4958, 3)
INFO:mms_extractor:시퀀스 유사도 샘플: [{'sent': ' 광고 SKT iPhone 신제품 구매 혜택 안내', 'item_nm_alias': '해지번호안내', 'sim': 0.26666666666666666}, {'sent': ' 광고 SKT iPhone 신제품 구매 혜택 안내', 'item_nm_alias': 'Tethe링 차단', 'sim': 0.1222222222222222}, {'sent': ' 광고 SKT iPhone 신제품 구매 혜택 안내', 'item_nm_alias': 'T_변경번호안내', 'sim': 0.39999999999999997}]
INFO:mms_extractor:사용할 유사도 임계값: 0.7
INFO:mms_extractor:임계값 필터링 후 후보 아이템 수: 11개
INFO:mms_extractor:Kiwi 엔티티 매칭 결과: 28개
INFO:mms_extractor:통합된 후보 아이템 수: 39개
INFO:mms_extractor:최종 후보 아이템 리스트: ['iPhone 신제품', 'SK(주)', 'iPhone 16', 'iPhone 17', 'iphone 16', 'iphone 17']
INFO:mms_extractor:최종 상품 정보 DataFrame 크기: (6, 2)
INFO:mms_extractor:최종 상품 정보 샘플: [{'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A5WC', 'A63N', 'A63N', 'A63T', 'A63T', 'A5WH', 'A5WH', 'A63H', 'A63H', 'A5WN', 'A5WN']}, {'item_nm': 'IPHONE 17', 'item_id': ['A6UD', 'A6UD', 'A6UD', 'A6SQ', 'A6SQ', 'A6SQ', 'A6U2', 'A6U2', 'A6U2', 'A6U7', 'A6U7', 'A6U7', 'A6SV', 'A6SV', 'A6SV']}, {'item_nm': 'IPHONE 17 PRO', 'item_id': ['A6UJ', 'A6T4', 'A6UM', 'A6VK', 'A6UQ', 'A6T7', 'A6T1']}]
INFO:utils:extract_entities_from_kiwi 실행완료: 9.93초
INFO:mms_extractor:추출된 Kiwi 엔티티: ['iPhone 신제품']
INFO:mms_extractor:추출된 후보 엔티티: ['iPhone 신제품', 'SK(주)', 'iPhone 16', 'iPhone 17', 'iphone 16', 'iphone 17']
INFO:mms_extractor:매칭된 상품 정보: (6, 2)
INFO:mms_extractor:============================== 2단계: 프로그램 분류 ==============================
INFO:mms_extractor:프로그램 분류 결과 키: ['pgm_cand_info', 'similarities', 'pgm_pdf_tmp']
INFO:mms_extractor:============================== 3단계: RAG 컨텍스트 구성 ==============================
INFO:mms_extractor:프로그램 분류 컨텍스트 길이: 387 문자
INFO:mms_extractor:============================== 4단계: 제품 정보 준비 ==============================
INFO:mms_extractor:후보 아이템 리스트 크기: 6개
INFO:mms_extractor:후보 아이템 리스트: ['iPhone 신제품', 'SK(주)', 'iPhone 16', 'iPhone 17', 'iphone 16', 'iphone 17']
INFO:mms_extractor:extra_item_pdf 크기: (6, 2)
INFO:mms_extractor:extra_item_pdf 컬럼들: ['item_nm', 'item_id']
INFO:mms_extractor:extra_item_pdf 샘플: [{'item_nm': 'IPHONE 16', 'item_id': ['A5WC', 'A5WC', 'A63N', 'A63N', 'A63T', 'A63T', 'A5WH', 'A5WH', 'A63H', 'A63H', 'A5WN', 'A5WN']}, {'item_nm': 'IPHONE 17', 'item_id': ['A6UD', 'A6UD', 'A6UD', 'A6SQ', 'A6SQ', 'A6SQ', 'A6U2', 'A6U2', 'A6U2', 'A6U7', 'A6U7', 'A6U7', 'A6SV', 'A6SV', 'A6SV']}]
INFO:mms_extractor:LLM 모드: 참고용 후보 상품 목록을 RAG 컨텍스트에 추가
INFO:mms_extractor:============================== 5단계: LLM 호출 ==============================
INFO:mms_extractor:구성된 프롬프트 길이: 7361 문자
INFO:mms_extractor:RAG 컨텍스트 포함 여부: True
INFO:mms_extractor:📝 프롬프트 저장됨: main_extraction_prompt
INFO:mms_extractor:📝 프롬프트 길이: 7,361 문자
INFO:mms_extractor:📝 현재 저장된 프롬프트 수: 1
INFO:mms_extractor:📝 저장된 프롬프트 키들: ['main_extraction_prompt']
INFO:httpx:HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO:mms_extractor:LLM 응답 길이: 1101 문자
INFO:mms_extractor:LLM 응답 내용 (처음 500자): ```json
{
    "title": "iPhone 신제품 구매 시 최대 22만 원 캐시백 및 경품 이벤트",
    "purpose": [
        "상품 가입 유도",
        "혜택 안내",
        "이벤트 응모 유도",
        "경품 제공 안내",
        "웹/앱 접속 유도"
    ],
    "sales_script": "iPhone 신제품 구매 시 최대 22만 원 캐시백! 현대카드 혜택과 Lucky 1717 이벤트 응모 안내 필요하세요?",
    "product": [
        {
            "name": "iPhone 신제품",
            "action": "구매"
        },
        {
            "name": "현대카드",
            "action": "사용"
        },
        {
            "name": "애플 페이",
          ...
INFO:mms_extractor:============================== 6단계: JSON 파싱 ==============================
INFO:mms_extractor:추출된 JSON 객체 수: 1개
INFO:mms_extractor:파싱된 JSON 객체 키: ['title', 'purpose', 'sales_script', 'product', 'channel', 'pgm']
INFO:mms_extractor:파싱된 JSON 내용: {'title': 'iPhone 신제품 구매 시 최대 22만 원 캐시백 및 경품 이벤트', 'purpose': ['상품 가입 유도', '혜택 안내', '이벤트 응모 유도', '경품 제공 안내', '웹/앱 접속 유도'], 'sales_script': 'iPhone 신제품 구매 시 최대 22만 원 캐시백! 현대카드 혜택과 Lucky 1717 이벤트 응모 안내 필요하세요?', 'product': [{'name': 'iPhone 신제품', 'action': '구매'}, {'name': '현대카드', 'action': '사용'}, {'name': '애플 페이', 'action': '사용'}], 'channel': [{'type': 'URL', 'value': 'https://t-mms.kr/ais/#74', 'action': '추가 정보'}, {'type': 'URL', 'value': 'https://t-mms.kr/aiN/#74', 'action': '추가 정보'}, {'type': '전화번호', 'value': '1558', 'action': '문의'}, {'type': '전화번호', 'value': '1504', 'action': '수신 거부'}], 'pgm': ['상품및부가서비스가입유도_단말', '사용법/혜택/이벤트안내_단말']}
INFO:mms_extractor:============================== 7단계: 최종 결과 구성 ==============================
INFO:mms_extractor:================================================================================
INFO:mms_extractor:🔍 [PRODUCT DEBUG] _build_final_result 시작
INFO:mms_extractor:================================================================================
INFO:mms_extractor:📋 [STEP 1] product_items 추출
INFO:mms_extractor:   - 원본 product 타입: <class 'list'>
INFO:mms_extractor:   - 원본 product 내용: [{'name': 'iPhone 신제품', 'action': '구매'}, {'name': '현대카드', 'action': '사용'}, {'name': '애플 페이', 'action': '사용'}]
INFO:mms_extractor:   ✅ 최종 product_items 개수: 3개
INFO:mms_extractor:   ✅ 최종 product_items 내용: [{'name': 'iPhone 신제품', 'action': '구매'}, {'name': '현대카드', 'action': '사용'}, {'name': '애플 페이', 'action': '사용'}]
INFO:mms_extractor:📋 [STEP 2] LLM 추출 엔티티: ['iPhone 신제품', '현대카드', '애플 페이']
INFO:mms_extractor:📋 [STEP 2] Kiwi 엔티티: ['iPhone 신제품']
INFO:mms_extractor:📋 [STEP 2] entity_extraction_mode: llm
INFO:mms_extractor:🔍 [STEP 3] LLM 기반 엔티티 매칭 시작
INFO:mms_extractor:✅ LLM 모델 초기화 완료: gen (gcp/gemini-2.5-flash)
INFO:mms_extractor:✅ LLM 모델 초기화 완료: ax (skt/ax4)
INFO:mms_extractor:   - 초기화된 LLM 모델 수: 2개
INFO:mms_extractor:================================================================================
INFO:mms_extractor:🔍 [LLM 엔티티 추출] 함수 시작
INFO:mms_extractor:📝 입력 파라미터:
INFO:mms_extractor:   - rank_limit: 200
INFO:mms_extractor:   - external_cand_entities 제공 여부: True
INFO:mms_extractor:   - external_cand_entities 개수: 1
INFO:mms_extractor:📄 메시지 텍스트 길이: 369 문자
INFO:mms_extractor:📄 메시지 텍스트 미리보기: (광고)[SKT] iPhone 신제품 구매 혜택 안내 __#04 고객님, 안녕하세요._SK텔레콤에서 iPhone 신제품 구매하면, 최대 22만 원 캐시백 이벤트에 참여하실 수 있습...
INFO:mms_extractor:🤖 LLM 모델 지정됨: 2개 모델 사용
INFO:mms_extractor:   [1] 모델: gcp/gemini-2.5-flash
INFO:mms_extractor:   [2] 모델: skt/ax4
INFO:mms_extractor:📋 프롬프트 미리보기 저장 중...
INFO:mms_extractor:📝 프롬프트 저장됨: entity_extraction_prompt
INFO:mms_extractor:📝 프롬프트 길이: 2,414 문자
INFO:mms_extractor:📝 현재 저장된 프롬프트 수: 2
INFO:mms_extractor:📝 저장된 프롬프트 키들: ['main_extraction_prompt', 'entity_extraction_prompt']
INFO:mms_extractor:✅ 프롬프트 미리보기 저장 완료
INFO:mms_extractor:🔄 1단계 LLM 추출 - 메시지에서 직접 엔티티 및 DAG 추출
INFO:mms_extractor:🔄 2개 LLM 모델로 1단계 엔티티 추출 시작
INFO:mms_extractor:⚙️  병렬 처리 설정: 2개 워커 (threading 백엔드)
INFO:httpx:HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO:mms_extractor:✅ 모든 LLM 모델 처리 완료
INFO:mms_extractor:   [1] gcp/gemini-2.5-flash: 11개 엔티티 추출
INFO:mms_extractor:   [2] skt/ax4: 3개 엔티티 추출
INFO:mms_extractor:   📝 캡처된 DAG 컨텍스트 길이: 412자
INFO:mms_extractor:📊 병합 전 총 엔티티 수: 15개
INFO:mms_extractor:📊 중복 제거 및 확장 후 엔티티 수: 17개
INFO:mms_extractor:✅ LLM 추출 완료: ['최대 22만', '애플 페이 티머니 충전 쿠폰 96만', '애플 페이 티머니 충전', '애플 페이 티머니 충전 쿠폰 96만 원', '애플 페이 티머니 충전 쿠폰', '애플 페이', '최대 22만 원 캐시백', '경품 당첨', '현대카드', 'SKT 고객센터', '애플 액세서리 팩', '최대 22만 원', '샌프란시스코 왕복 항공권', 'Lucky 1717 이벤트', 'iPhone 신제품', '애플 페이 티머니', '무료 수신거부 1504']
INFO:mms_extractor:🔍 엔티티-상품 매칭 시작...
INFO:mms_extractor:   입력 엔티티 수: 17개
INFO:mms_extractor:   🔍 [매칭] 퍼지 유사도 매칭 시작...
INFO:mms_extractor:   📝 입력 엔티티 수: 17개
INFO:mms_extractor:   📝 상품 DB 별칭 수: 34,387개
INFO:mms_extractor:   ⚙️  퍼지 유사도 임계값: 0.6
INFO:mms_extractor:   ⚙️  n_jobs: 6, batch_size: 30
INFO:mms_extractor:   ✅ 퍼지 유사도 매칭 완료: 1106개 행
INFO:mms_extractor:   📊 퍼지 매칭 고유 엔티티 수: 13개
INFO:mms_extractor:   📊 퍼지 매칭 고유 별칭 수: 1100개
INFO:mms_extractor:   🔍 [매칭] 정지어 필터링...
INFO:mms_extractor:   📊 정지어 필터링 결과: 1106개 → 1101개 (제거: 5개)
INFO:mms_extractor:   🔍 [매칭] 시퀀스 유사도 계산 시작 (s1, s2 각각)...
INFO:mms_extractor:   ⚙️  ipynb와 동일하게 weights=None, n_jobs=6, batch_size=30 사용
INFO:mms_extractor:   ✅ 시퀀스 유사도 계산 완료: sim_s1=1101개, sim_s2=1101개
INFO:mms_extractor:   🔍 [매칭] sim_s1과 sim_s2 병합 중...
INFO:mms_extractor:   ✅ 병합 완료: 1101개 행
INFO:mms_extractor:   📊 유사도 통계:
INFO:mms_extractor:      - sim_s1 최소: 0.1143
INFO:mms_extractor:      - sim_s1 최대: 1.0000
INFO:mms_extractor:      - sim_s2 최소: 0.0571
INFO:mms_extractor:      - sim_s2 최대: 1.0000
INFO:mms_extractor:   🔍 [매칭] 쿼리 조건 필터링...
INFO:mms_extractor:   ⚙️  조건: (sim_s1>=0.4 and sim_s2>=0.4) or (sim_s1>=1.9 and sim_s2>=0.3) or (sim_s1>=0.3 and sim_s2>=0.9)
INFO:mms_extractor:   📊 쿼리 필터링 결과: 1101개 → 67개 (제거: 1034개)
INFO:mms_extractor:   🔍 [매칭] sim_s1과 sim_s2 합산 중...
INFO:mms_extractor:   ✅ 합산 완료: 67개 행
INFO:mms_extractor:   🔍 [매칭] 유사도 필터링 (임계값: sim>=1.1)...
INFO:mms_extractor:   📊 유사도 필터링 결과: 67개 → 35개 (제거: 32개)
INFO:mms_extractor:   📊 합산 sim 통계:
INFO:mms_extractor:      - 최소: 1.1267
INFO:mms_extractor:      - 최대: 2.0000
INFO:mms_extractor:      - 평균: 1.2187
INFO:mms_extractor:      - 중앙값: 1.1574
INFO:mms_extractor:   🔍 [매칭] 순위 매기기 및 결과 제한 (rank_limit: 200)...
INFO:mms_extractor:   📊 순위 제한 결과: 35개 → 35개 (제거: 0개)
INFO:mms_extractor:   🔍 [매칭] item_dmn_nm 병합 중...
INFO:mms_extractor:   ✅ item_dmn_nm 병합 완료
INFO:mms_extractor:   ✅ [매칭] 최종 결과: 35개 행, 2개 고유 엔티티
INFO:mms_extractor:   매칭 결과: 35개 행
INFO:mms_extractor:   매칭된 고유 item_name_in_msg 수: 2개
INFO:mms_extractor:   매칭된 고유 item_nm_alias 수: 35개
INFO:mms_extractor:🔍 2단계 LLM 필터링 시작 (동적 배치 크기 + DAG 컨텍스트 사용)...
INFO:mms_extractor:   입력 메시지 엔티티 수: 2개
INFO:mms_extractor:   후보 상품 별칭 수: 35개
INFO:mms_extractor:   📏 메시지 길이 기반 최적 배치 크기: 100개
INFO:mms_extractor:   총 후보 상품 별칭: 35개
INFO:mms_extractor:🔄 2단계 LLM 필터링: 1개 배치로 분할 (배치당 ~100개)
INFO:mms_extractor:⚙️  병렬 처리 설정: 1개 워커 (threading 백엔드)
INFO:httpx:HTTP Request: POST https://api.platform.a15t.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO:mms_extractor:📊 배치별 결과 요약:
INFO:mms_extractor:   배치 1: 1개 엔티티
INFO:mms_extractor:✅ 2단계 LLM 필터링 완료
INFO:mms_extractor:📊 최종 선택된 엔티티 수: 1개
INFO:mms_extractor:📊 최종 선택된 엔티티: ['iPhone 신제품']
INFO:mms_extractor:🔍 최종 엔티티로 필터링 중...
INFO:mms_extractor:   필터링 전 행 수: 35개
INFO:mms_extractor:   필터링 후 행 수: 1개
INFO:mms_extractor:================================================================================
INFO:mms_extractor:✅ [LLM 엔티티 추출] 함수 완료
INFO:mms_extractor:📊 최종 결과: 1개 행 반환
INFO:mms_extractor:================================================================================
INFO:utils:extract_entities_by_llm 실행완료: 31.90초
INFO:mms_extractor:   ✅ similarities_fuzzy 결과 크기: (1, 5)
INFO:mms_extractor:   📊 similarities_fuzzy 샘플 (처음 3개):
INFO:mms_extractor:[{'item_name_in_msg': 'iPhone 신제품', 'item_nm_alias': 'iPhone 신제품', 'sim': 2.0, 'rank': 1.0, 'item_dmn_nm': '단말기'}]
INFO:mms_extractor:🔍 [STEP 4] alias_pdf_raw와 merge 시작
INFO:mms_extractor:   - alias_pdf_raw 크기: (187, 6)
INFO:mms_extractor:   ✅ merged_df 크기: (1, 7)
INFO:mms_extractor:   📊 merged_df 샘플 (처음 3개):
INFO:mms_extractor:[{'item_name_in_msg': 'iPhone 신제품', 'item_nm_alias': 'iPhone 신제품', 'sim': 2.0, 'rank': 1.0, 'item_dmn_nm': '단말기', 'alias_1': nan, 'type': nan}]
INFO:mms_extractor:🔍 [STEP 5] filtered_df 생성 (expansion 타입 필터링)
INFO:mms_extractor:   ✅ filtered_df 크기: (1, 7)
INFO:mms_extractor:   📊 filtered_df 샘플 (처음 3개):
INFO:mms_extractor:[{'item_name_in_msg': 'iPhone 신제품', 'item_nm_alias': 'iPhone 신제품', 'sim': 2.0, 'rank': 1.0, 'item_dmn_nm': '단말기', 'alias_1': nan, 'type': nan}]
INFO:mms_extractor:🔍 [STEP 6] 상품 정보 매핑 시작
INFO:mms_extractor:   - similarities_fuzzy.empty: False
INFO:mms_extractor:   ✅ similarities_fuzzy가 비어있지 않음 → _map_products_with_similarity 호출
INFO:mms_extractor:🔍 [_map_products_with_similarity] 시작
INFO:mms_extractor:   - 입력 similarities_fuzzy 크기: (1, 5)
INFO:mms_extractor:   - high_sim_threshold: 1.1
INFO:mms_extractor:   - high_sim_items 개수: 1개
INFO:mms_extractor:   - high_sim_items: ['iPhone 신제품']
INFO:mms_extractor:   - 필터링: 1개 → 1개 (제거: 0개)
INFO:mms_extractor:   📊 filtered_similarities 샘플 (처음 3개):
INFO:mms_extractor:[{'item_name_in_msg': 'iPhone 신제품', 'item_nm_alias': 'iPhone 신제품', 'sim': 2.0, 'rank': 1.0, 'item_dmn_nm': '단말기'}]
INFO:mms_extractor:   🔍 item_pdf_all과 merge 시작
INFO:mms_extractor:   - item_pdf_all 크기: (42314, 14)
INFO:mms_extractor:   - merged_items 크기: (28, 18)
INFO:mms_extractor:   📊 merged_items 샘플 (처음 3개):
INFO:mms_extractor:[{'item_id': 'A6UW', 'item_nm': 'IPHONE 17 PRO MAX', 'item_dmn': 'E', 'item_desc': 'IPHONE 17 PRO MAX', 'item_ctg': None, 'item_als': nan, 'item_emb_vec': None, 'ofer_cd': 'A6UW', 'oper_dt_hms': '20250101000000', 'item_nm_alias': 'iPhone 신제품', 'start_dt': nan, 'end_dt': nan, 'rank_x': nan, 'item_dmn_nm_x': '단말기', 'item_name_in_msg': 'iPhone 신제품', 'sim': 2.0, 'rank_y': 1.0, 'item_dmn_nm_y': '단말기'}, {'item_id': 'A6UJ', 'item_nm': 'IPHONE 17 PRO', 'item_dmn': 'E', 'item_desc': 'IPHONE 17 PRO', 'item_ctg': None, 'item_als': nan, 'item_emb_vec': None, 'ofer_cd': 'A6UJ', 'oper_dt_hms': '20250101000000', 'item_nm_alias': 'iPhone 신제품', 'start_dt': nan, 'end_dt': nan, 'rank_x': nan, 'item_dmn_nm_x': '단말기', 'item_name_in_msg': 'iPhone 신제품', 'sim': 2.0, 'rank_y': 1.0, 'item_dmn_nm_y': '단말기'}, {'item_id': 'A6TT', 'item_nm': 'IPHONE AIR', 'item_dmn': 'E', 'item_desc': 'IPHONE AIR', 'item_ctg': None, 'item_als': nan, 'item_emb_vec': None, 'ofer_cd': 'A6TT', 'oper_dt_hms': '20250101000000', 'item_nm_alias': 'iPhone 신제품', 'start_dt': nan, 'end_dt': nan, 'rank_x': nan, 'item_dmn_nm_x': '단말기', 'item_name_in_msg': 'iPhone 신제품', 'sim': 2.0, 'rank_y': 1.0, 'item_dmn_nm_y': '단말기'}]
INFO:mms_extractor:   🔍 convert_df_to_json_list 호출
INFO:mms_extractor:   ✅ product_tag 개수: 4개
INFO:mms_extractor:   ✅ product_tag 내용: [{'item_nm': 'IPHONE 17', 'item_id': ['A6UD', 'A6SQ', 'A6U2', 'A6U7', 'A6SV'], 'item_name_in_msg': ['iPhone 신제품']}, {'item_nm': 'IPHONE 17 PRO', 'item_id': ['A6UJ', 'A6T4', 'A6UM', 'A6VK', 'A6UQ', 'A6T7', 'A6T1'], 'item_name_in_msg': ['iPhone 신제품']}, {'item_nm': 'IPHONE 17 PRO MAX', 'item_id': ['A6UW', 'A6TH', 'A6TA', 'A6TL', 'A6V3', 'A6TE', 'A6UT', 'A6VN', 'A6UZ'], 'item_name_in_msg': ['iPhone 신제품']}, {'item_nm': 'IPHONE AIR', 'item_id': ['A6TT', 'A6VR', 'A6TP', 'A6TX', 'A6V6', 'A6VA', 'A6VF'], 'item_name_in_msg': ['iPhone 신제품']}]
INFO:mms_extractor:   🔍 expected_action 추가 시작
INFO:mms_extractor:   - action_mapping: {'iPhone 신제품': '구매', '현대카드': '사용', '애플 페이': '사용'}
INFO:mms_extractor:   ✅ expected_action 추가 완료
INFO:mms_extractor:✅ [_map_products_with_similarity] 완료 - 반환: 4개
INFO:mms_extractor:   ✅ 최종 product 개수: 4개
INFO:mms_extractor:   ✅ 최종 product 내용: [{'item_nm': 'IPHONE 17', 'item_id': ['A6UD', 'A6SQ', 'A6U2', 'A6U7', 'A6SV'], 'item_name_in_msg': ['iPhone 신제품'], 'expected_action': ['구매']}, {'item_nm': 'IPHONE 17 PRO', 'item_id': ['A6UJ', 'A6T4', 'A6UM', 'A6VK', 'A6UQ', 'A6T7', 'A6T1'], 'item_name_in_msg': ['iPhone 신제품'], 'expected_action': ['구매']}, {'item_nm': 'IPHONE 17 PRO MAX', 'item_id': ['A6UW', 'A6TH', 'A6TA', 'A6TL', 'A6V3', 'A6TE', 'A6UT', 'A6VN', 'A6UZ'], 'item_name_in_msg': ['iPhone 신제품'], 'expected_action': ['구매']}, {'item_nm': 'IPHONE AIR', 'item_id': ['A6TT', 'A6VR', 'A6TP', 'A6TX', 'A6V6', 'A6VA', 'A6VF'], 'item_name_in_msg': ['iPhone 신제품'], 'expected_action': ['구매']}]
INFO:mms_extractor:🏷️  [STEP 7] offer_object 초기화: type=product, value 개수=4개
INFO:mms_extractor:🔍 [STEP 8] 채널 정보 처리 및 offer_object 업데이트
INFO:mms_extractor:   ✅ 최종 channel 개수: 4개
INFO:mms_extractor:   ✅ 최종 offer_object type: product
INFO:mms_extractor:   ✅ 최종 offer_object value 개수: 4개
INFO:mms_extractor:✅ [STEP 9] final_result에 offer 필드 추가 완료
INFO:mms_extractor:================================================================================
INFO:mms_extractor:✅ [PRODUCT DEBUG] _build_final_result 완료
INFO:mms_extractor:   최종 final_result['product'] 개수: 4개
INFO:mms_extractor:================================================================================
INFO:mms_extractor:============================== 8단계: 결과 검증 ==============================
INFO:mms_extractor:============================================================
INFO:mms_extractor:✅ 메시지 처리 완료 - 최종 결과 요약
INFO:mms_extractor:============================================================
INFO:mms_extractor:제목: iPhone 신제품 구매 시 최대 22만 원 캐시백 및 경품 이벤트
INFO:mms_extractor:목적: ['상품 가입 유도', '혜택 안내', '이벤트 응모 유도', '경품 제공 안내', '웹/앱 접속 유도']
INFO:mms_extractor:판매 스크립트: iPhone 신제품 구매 시 최대 22만 원 캐시백! 현대카드 혜택과 Lucky 1717 이벤트 응모 안내 필요하세요?
INFO:mms_extractor:상품 수: 4개
INFO:mms_extractor:채널 수: 4개
INFO:mms_extractor:프로그램 수: 2개
INFO:mms_extractor:오퍼 타입: product
INFO:mms_extractor:오퍼 항목 수: 4개
INFO:utils:process_message 실행완료: 50.60초

============================================================
Extraction Result (Dev):
============================================================
{
  "extracted_result": {
    "title": "iPhone 신제품 구매 시 최대 22만 원 캐시백 및 경품 이벤트",
    "purpose": [
      "상품 가입 유도",
      "혜택 안내",
      "이벤트 응모 유도",
      "경품 제공 안내",
      "웹/앱 접속 유도"
    ],
    "sales_script": "iPhone 신제품 구매 시 최대 22만 원 캐시백! 현대카드 혜택과 Lucky 1717 이벤트 응모 안내 필요하세요?",
    "product": [
      {
        "item_nm": "IPHONE 17",
        "item_id": [
          "A6UD",
          "A6SQ",
          "A6U2",
          "A6U7",
          "A6SV"
        ],
        "item_name_in_msg": [
          "iPhone 신제품"
        ],
        "expected_action": [
          "구매"
        ]
      },
      {
        "item_nm": "IPHONE 17 PRO",
        "item_id": [
          "A6UJ",
          "A6T4",
          "A6UM",
          "A6VK",
          "A6UQ",
          "A6T7",
          "A6T1"
        ],
        "item_name_in_msg": [
          "iPhone 신제품"
        ],
        "expected_action": [
          "구매"
        ]
      },
      {
        "item_nm": "IPHONE 17 PRO MAX",
        "item_id": [
          "A6UW",
          "A6TH",
          "A6TA",
          "A6TL",
          "A6V3",
          "A6TE",
          "A6UT",
          "A6VN",
          "A6UZ"
        ],
        "item_name_in_msg": [
          "iPhone 신제품"
        ],
        "expected_action": [
          "구매"
        ]
      },
      {
        "item_nm": "IPHONE AIR",
        "item_id": [
          "A6TT",
          "A6VR",
          "A6TP",
          "A6TX",
          "A6V6",
          "A6VA",
          "A6VF"
        ],
        "item_name_in_msg": [
          "iPhone 신제품"
        ],
        "expected_action": [
          "구매"
        ]
      }
    ],
    "channel": [
      {
        "type": "URL",
        "value": "https://t-mms.kr/ais/#74",
        "action": "추가 정보",
        "store_info": []
      },
      {
        "type": "URL",
        "value": "https://t-mms.kr/aiN/#74",
        "action": "추가 정보",
        "store_info": []
      },
      {
        "type": "전화번호",
        "value": "1558",
        "action": "문의",
        "store_info": []
      },
      {
        "type": "전화번호",
        "value": "1504",
        "action": "수신 거부",
        "store_info": []
      }
    ],
    "pgm": [
      {
        "pgm_nm": "[마케팅_Care]사용법/혜택/이벤트안내_단말",
        "pgm_id": "#2025ABCD01"
      },
      {
        "pgm_nm": "[마케팅_Sales]상품및부가서비스가입유도_단말",
        "pgm_id": "2019SCTDH04"
      }
    ],
    "offer": {
      "type": "product",
      "value": [
        {
          "item_nm": "IPHONE 17",
          "item_id": [
            "A6UD",
            "A6SQ",
            "A6U2",
            "A6U7",
            "A6SV"
          ],
          "item_name_in_msg": [
            "iPhone 신제품"
          ],
          "expected_action": [
            "구매"
          ]
        },
        {
          "item_nm": "IPHONE 17 PRO",
          "item_id": [
            "A6UJ",
            "A6T4",
            "A6UM",
            "A6VK",
            "A6UQ",
            "A6T7",
            "A6T1"
          ],
          "item_name_in_msg": [
            "iPhone 신제품"
          ],
          "expected_action": [
            "구매"
          ]
        },
        {
          "item_nm": "IPHONE 17 PRO MAX",
          "item_id": [
            "A6UW",
            "A6TH",
            "A6TA",
            "A6TL",
            "A6V3",
            "A6TE",
            "A6UT",
            "A6VN",
            "A6UZ"
          ],
          "item_name_in_msg": [
            "iPhone 신제품"
          ],
          "expected_action": [
            "구매"
          ]
        },
        {
          "item_nm": "IPHONE AIR",
          "item_id": [
            "A6TT",
            "A6VR",
            "A6TP",
            "A6TX",
            "A6V6",
            "A6VA",
            "A6VF"
          ],
          "item_name_in_msg": [
            "iPhone 신제품"
          ],
          "expected_action": [
            "구매"
          ]
        }
      ]
    },
    "entity_dag": []
  },
  "raw_result": {
    "title": "iPhone 신제품 구매 시 최대 22만 원 캐시백 및 경품 이벤트",
    "purpose": [
      "상품 가입 유도",
      "혜택 안내",
      "이벤트 응모 유도",
      "경품 제공 안내",
      "웹/앱 접속 유도"
    ],
    "sales_script": "iPhone 신제품 구매 시 최대 22만 원 캐시백! 현대카드 혜택과 Lucky 1717 이벤트 응모 안내 필요하세요?",
    "product": [
      {
        "name": "iPhone 신제품",
        "action": "구매"
      },
      {
        "name": "현대카드",
        "action": "사용"
      },
      {
        "name": "애플 페이",
        "action": "사용"
      }
    ],
    "channel": [
      {
        "type": "URL",
        "value": "https://t-mms.kr/ais/#74",
        "action": "추가 정보"
      },
      {
        "type": "URL",
        "value": "https://t-mms.kr/aiN/#74",
        "action": "추가 정보"
      },
      {
        "type": "전화번호",
        "value": "1558",
        "action": "문의"
      },
      {
        "type": "전화번호",
        "value": "1504",
        "action": "수신 거부"
      }
    ],
    "pgm": [
      "상품및부가서비스가입유도_단말",
      "사용법/혜택/이벤트안내_단말"
    ]
  },
  "prompts": {
    "main_extraction_prompt": {
      "title": "메인 정보 추출 프롬프트",
      "description": "광고 메시지에서 제목, 목적, 상품, 채널, 프로그램 정보를 추출하는 프롬프트",
      "content": "\nExtract the advertisement purpose and product names from the provided advertisement text.\n\n### Advertisement Message ###\n(광고)[SKT] iPhone 신제품 구매 혜택 안내 __#04 고객님, 안녕하세요._SK텔레콤에서 iPhone 신제품 구매하면, 최대 22만 원 캐시백 이벤트에 참여하실 수 있습니다.__현대카드로 애플 페이도 더 편리하게 이용해 보세요.__▶ 현대카드 바로 가기: https://t-mms.kr/ais/#74_ _애플 페이 티머니 충전 쿠폰 96만 원, 샌프란시스코 왕복 항공권, 애플 액세서리 팩까지!_Lucky 1717 이벤트 응모하고 경품 당첨의 행운을 누려 보세요.__▶ 이벤트 자세히 보기: https://t-mms.kr/aiN/#74_ _■ 문의: SKT 고객센터(1558, 무료)__SKT와 함께해 주셔서 감사합니다.__무료 수신거부 1504',\n\n### Extraction Steps ###\n\n1. Identify the advertisement's purpose first, using expressions as they appear in the original text.\n2. Extract ONLY explicitly mentioned product/service names from the text, using exact original expressions.\n3. For each product, assign a standardized action from: [구매, 가입, 사용, 방문, 참여, 코드입력, 쿠폰다운로드, 기타].\n4. Avoid inferring or adding products not directly mentioned in the text.\n5. Provide channel information considering the extracted product information, preserving original text expressions.\n\n\n### Extraction Guidelines ###\n\n* For title: Create a concise headline (max 50 characters) in headline style (개조식) that captures the core content, excluding labels like '(광고)', '[SKT]' and special characters like __, and prioritizing the most important information (benefits, products, events).\n* Prioritize recall over precision to ensure all relevant products are captured, but verify that each extracted term is a distinct offering.\n* Extract all information (purpose, product, channel, pgm) using the exact expressions as they appear in the original text without translation, as specified in the schema.\n* If the advertisement purpose includes encouraging agency/store visits, provide agency channel information.\n\n* Refer to the candidate product names list as guidance, but extract products based on your understanding of the advertisement content.\n* Maintain consistency by using standardized product naming conventions.\n* If multiple similar products exist, choose the most specific and relevant one to reduce variability.\n\n\n### 일관성 유지 지침 ###\n* 동일한 광고 메시지에 대해서는 항상 동일한 결과를 생성해야 합니다.\n* 애매한 표현이 있을 때는 가장 명확하고 구체적인 해석을 선택하세요.\n* 상품명은 원문에서 정확히 언급된 표현만 사용하세요.\n\n\n\nReturn your response as a JSON object that follows this exact structure:\n\n{\n    \"title\": \"Extract a concise title summarizing the key content of the advertisement in one sentence (max 50 characters). Guidelines: (1) Clearly capture the core content (benefits, products, events, etc.), (2) Write concisely in one sentence, (3) Exclude labels like '(광고)', '[SKT]', (4) Remove special characters (__, etc.) and create a natural sentence, (5) Prioritize the most important information, (6) Use a headline style (개조식).\",\n    \"purpose\": {\n        \"type\": \"array\",\n        \"items\": {\n            \"type\": \"string\",\n            \"enum\": [\n                \"상품 가입 유도\",\n                \"대리점/매장 방문 유도\",\n                \"웹/앱 접속 유도\",\n                \"이벤트 응모 유도\",\n                \"혜택 안내\",\n                \"쿠폰 제공 안내\",\n                \"경품 제공 안내\",\n                \"수신 거부 안내\",\n                \"기타 정보 제공\"\n            ]\n        },\n        \"description\": \"Primary purpose(s) of the advertisement.\"\n    },\n    \"sales_script\": \"Generate an extremely concise sales prompt, intended for display on a call center agent's monitor, to be used for a rapid cross-sell immediately after resolving a customer's issue. The resulting script/message should be highly condensed, containing only the absolute essential facts and a clear action cue, and must be easily readable at a glance.\",\n    \"product\": {\n        \"type\": \"array\",\n        \"items\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"name\": {\n                    \"type\": \"string\",\n                    \"description\": \"Name of the advertised product or service.\"\n                },\n                \"action\": {\n                    \"type\": \"string\",\n                    \"enum\": [\n                        \"구매\",\n                        \"가입\",\n                        \"사용\",\n                        \"방문\",\n                        \"참여\",\n                        \"코드입력\",\n                        \"쿠폰다운로드\",\n                        \"기타\"\n                    ],\n                    \"description\": \"Expected customer action for the product.\"\n                }\n            }\n        },\n        \"description\": \"Extract all product names from the advertisement.\"\n    },\n    \"channel\": {\n        \"type\": \"array\",\n        \"items\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"type\": {\n                    \"type\": \"string\",\n                    \"enum\": [\n                        \"URL\",\n                        \"전화번호\",\n                        \"앱\",\n                        \"대리점\"\n                    ],\n                    \"description\": \"Channel type.\"\n                },\n                \"value\": {\n                    \"type\": \"string\",\n                    \"description\": \"Specific information for the channel. 대리점인 경우 ***점으로 표시될 가능성이 높음\"\n                },\n                \"action\": {\n                    \"type\": \"string\",\n                    \"enum\": [\n                        \"가입\",\n                        \"추가 정보\",\n                        \"문의\",\n                        \"수신\",\n                        \"수신 거부\"\n                    ],\n                    \"description\": \"Purpose of the channel.\"\n                }\n            }\n        },\n        \"description\": \"Channels provided in the advertisement.\"\n    },\n    \"pgm\": {\n        \"type\": \"array\",\n        \"items\": {\n            \"type\": \"string\"\n        },\n        \"description\": \"Select the two most relevant pgm_nm from the advertising classification criteria.\"\n    }\n}\n\nIMPORTANT: \n- Do NOT return the schema definition itself\n- Return actual extracted data in the specified format\n- For \"purpose\": return an array of strings from the enum values\n- For \"sales_script\": return a concise string for call center agents\n- For \"product\": return an array of objects with \"name\" and \"action\" fields\n- For \"channel\": return an array of objects with \"type\", \"value\", and \"action\" fields\n- For \"pgm\": return an array of strings\n\nExample response format:\n{\n    \"title\": \"아이폰 신제품 출시 기념 최대 70% 할인 혜택\",\n    \"purpose\": [\"상품 가입 유도\", \"혜택 안내\"],\n    \"sales_script\": \"아이폰 신제품 출시 기념! 티원대리점 화순점 방문 시 최대 70% 할인. 지금 바로 안내드릴까요?\",\n    \"product\": [\n        {\"name\": \"실제 상품명\", \"action\": \"가입\"},\n        {\"name\": \"다른 상품명\", \"action\": \"구매\"}\n    ],\n    \"channel\": [\n        {\"type\": \"URL\", \"value\": \"실제 URL\", \"action\": \"가입\"}\n    ],\n    \"pgm\": [\"실제 프로그램명\"]\n}\n\n\n### OUTPUT FORMAT REQUIREMENT ###\nYou MUST respond with a valid JSON object containing actual extracted data.\nDo NOT include schema definitions, type specifications, or template structures.\nReturn only the concrete extracted information in the specified JSON format.\n\n\n### 광고 분류 기준 정보 ###\n\t사용법/혜택/이벤트안내_단말 : 갤럭시, 아이폰, 사용법, 안내, 이벤트, 혜택, 기능, 팁, 활용법, 업데이트\n\t상품및부가서비스가입유도_단말 : 신규, 출시, 갤럭시, Galaxy, Iphone, 아이폰, 사전, 예약, 할인, 프로모션, 구매, 단말기, 폴더블\n\t기변유도및해지방어 : TDS, 기기, 변경, 약정, 할인, 혜택, 업그레이드, 신규단말, 신규 단말, 보상, 프로모션, 교체\n\t사용법/혜택/이벤트안내_T멤버십 : 멤버십, Tday, T day, VIP, 등급, 할인, 쿠폰, 이벤트, 혜택, 적립, 무료\n\t상품및부가서비스가입유도_SKT : 상품, 추천, 컬러링, 로밍, 가입, 이용 요금, 부가서비스, 부가 서비스, 혜택, 무료체험, 할인\n\n### 참고용 후보 상품 이름 목록 ###\n\t['iPhone 신제품', 'SK(주)', 'iPhone 16', 'iPhone 17', 'iphone 16', 'iphone 17']\n\n### FINAL REMINDER ###\nReturn a JSON object with actual data, not schema definitions!\n",
      "length": 7361
    },
    "entity_extraction_prompt": {
      "title": "엔티티 추출 프롬프트",
      "description": "메시지에서 상품/서비스 엔티티를 추출하는 프롬프트",
      "content": "\n            \nAnalyze the advertisement to extract **User Action Paths**.\nOutput two distinct sections:\n1. **ENTITY**: A list of independent Root Nodes.\n2. **DAG**: A structured graph representing the flow from Root to Benefit.\n\n## Crucial Language Rule\n* **DO NOT TRANSLATE:** Extract entities **exactly as they appear** in the source text.\n* **Preserve Original Script:** If the text says \"아이폰 17\", output \"아이폰 17\" (NOT \"iPhone 17\"). If it says \"T Day\", output \"T Day\".\n\n## Part 1: Root Node Selection Hierarchy (Extract ALL Distinct Roots)\nIdentify logical starting points based on this priority. If multiple independent offers exist, extract all.\n\n1.  **Physical Store (Highest):** Specific branch names.\n    * *Match:* \"새샘대리점 역곡점\", \"백색대리점 수성직영점\"\n2.  **Core Service (Plans/VAS):** Rate plans, Value-Added Services, Internet/IPTV.\n    * *Match:* \"5GX 프라임 요금제\", \"V컬러링\", \"로밍 baro 요금제\"\n3.  **Subscription/Event:** Membership signups or specific campaigns.\n    * *Match:* \"T 우주\", \"T Day\", \"0 day\", \"골드번호 프로모션\"\n4.  **App/Platform:** Apps requiring action.\n    * *Match:* \"A.(에이닷)\", \"PASS 앱\", \"T world\"\n5.  **Product (Hardware):** Device launches without a specific store focus.\n    * *Match:* \"iPhone 17\", \"갤럭시 Z 플립7\"\n\n## Part 2: DAG Construction Rules\nConstruct a Directed Acyclic Graph (DAG) for each identified Root Node.\n* **Format:** `(Node:Action) -[Edge]-> (Node:Action)`\n* **Nodes:**\n    * **Root:** The entry point identified above (Original Text).\n    * **Core:** The product/service being used or bought (Original Text).\n    * **Value:** The final reward or benefit (Original Text).\n* **Logic:** Represent the shortest path from the Root action to the Final Benefit.\n\n## Strict Exclusions\n* Ignore navigational labels ('바로 가기', '링크', 'Shortcut').\n* Ignore generic partners ('스타벅스', 'CU') unless they are the main subscription target.\n\n## Output Format\nENTITY: <comma-separated list of all Nodes in original text>\nDAG:\n<DAG representation line by line in original text>\n\n\n            ## message:                \n            (광고)[SKT] iPhone 신제품 구매 혜택 안내 __#04 고객님, 안녕하세요._SK텔레콤에서 iPhone 신제품 구매하면, 최대 22만 원 캐시백 이벤트에 참여하실 수 있습니다.__현대카드로 애플 페이도 더 편리하게 이용해 보세요.__▶ 현대카드 바로 가기: https://t-mms.kr/ais/#74_ _애플 페이 티머니 충전 쿠폰 96만 원, 샌프란시스코 왕복 항공권, 애플 액세서리 팩까지!_Lucky 1717 이벤트 응모하고 경품 당첨의 행운을 누려 보세요.__▶ 이벤트 자세히 보기: https://t-mms.kr/aiN/#74_ _■ 문의: SKT 고객센터(1558, 무료)__SKT와 함께해 주셔서 감사합니다.__무료 수신거부 1504',\n            ",
      "length": 2414
    }
  }
}
============================================================
