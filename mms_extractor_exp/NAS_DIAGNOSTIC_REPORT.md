# 🔍 NAS 서버 접근 진단 보고서

**진단 일시**: 2024-10-14  
**NAS 서버 IP**: 172.27.7.58  
**클라이언트 IP**: 172.23.25.171

---

## ❌ 진단 결과: NAS 서버 접근 불가

### **1. 네트워크 연결 테스트 (PING)**
```bash
$ ping -c 3 172.27.7.58
❌ FAILED: 100% 패킷 손실
```

**상태**: 실패  
**의미**: NAS 서버와 네트워크 통신 불가

---

### **2. NFS Export 확인 (showmount)**
```bash
$ showmount -e 172.27.7.58
❌ FAILED: RPC: Timed out
```

**상태**: 실패  
**의미**: NFS 서비스에 접근 불가

---

### **3. NFS 포트 접근 (Port 2049)**
```bash
$ nc -zv -w 3 172.27.7.58 2049
❌ FAILED: Operation timed out
```

**상태**: 실패  
**의미**: NFS 포트에 연결 불가

---

### **4. 네트워크 정보**

#### **클라이언트 (현재 시스템)**
```
IP 주소:     172.23.25.171
서브넷:      172.23.24.0/22 (172.23.24.0 - 172.23.27.255)
게이트웨이:  172.23.24.1
```

#### **NAS 서버**
```
IP 주소:     172.27.7.58
서브넷:      172.27.0.0/16 (추정)
```

**문제**: 클라이언트와 NAS 서버가 **다른 네트워크 대역**에 있음

---

## 🔍 원인 분석

### **가능한 원인 (우선순위 순)**

#### **1. NAS 서버가 다운되었거나 네트워크에 연결되지 않음** ⭐⭐⭐
- NAS 서버 전원 꺼짐
- NAS 네트워크 케이블 분리
- NAS 네트워크 인터페이스 비활성화

#### **2. IP 주소가 잘못됨** ⭐⭐⭐
- 172.27.7.58이 정확한 주소가 아닐 수 있음
- NAS 서버 IP가 변경되었을 수 있음

#### **3. 네트워크 라우팅 문제** ⭐⭐
- 클라이언트(172.23.x.x)와 NAS(172.27.x.x)가 다른 서브넷
- 라우터/방화벽 설정 문제

#### **4. 방화벽 차단** ⭐
- NAS 서버 방화벽이 클라이언트 IP 차단
- 중간 네트워크 장비에서 NFS 트래픽 차단

#### **5. NFS 서비스 미실행** ⭐
- NAS에서 NFS 서비스가 시작되지 않음
- NFS export 설정 안 됨

---

## ✅ 해결 방법

### **Step 1: NAS 서버 상태 확인** (최우선)

#### **물리적 확인**
```
□ NAS 서버 전원이 켜져 있는가?
□ NAS 전면 LED가 정상인가?
□ 네트워크 케이블이 연결되어 있는가?
□ 네트워크 포트 LED가 깜빡이는가?
```

#### **NAS 관리 페이지 접근**
```bash
# 웹 브라우저에서 다음 주소 접속 시도:
http://172.27.7.58
https://172.27.7.58

# 또는 다른 일반적인 포트:
http://172.27.7.58:5000  # Synology
http://172.27.7.58:8080  # QNAP
```

---

### **Step 2: IP 주소 확인**

#### **2-1. NAS 서버에서 직접 확인**
NAS 관리 콘솔이나 모니터를 연결하여:
- 네트워크 설정 메뉴에서 현재 IP 확인
- DHCP로 설정되어 있으면 IP가 변경되었을 수 있음

#### **2-2. 네트워크 스캔으로 찾기**
```bash
# nmap 설치 (없는 경우)
brew install nmap

# 현재 네트워크에서 NAS 찾기
nmap -sn 172.23.24.0/22

# 또는 arp 테이블 확인
arp -a | grep -i synology
arp -a | grep -i qnap
```

#### **2-3. 라우터/DHCP 서버에서 확인**
- 라우터 관리 페이지 접속
- DHCP 클라이언트 목록에서 NAS 찾기
- MAC 주소로 식별

---

### **Step 3: NAS 네트워크 설정 확인**

NAS 관리 페이지에 접속 가능하면:

#### **Synology NAS**
```
제어판 > 네트워크 > 네트워크 인터페이스
- IP 주소 확인
- 서브넷 마스크 확인
- 게이트웨이 확인
```

#### **QNAP NAS**
```
제어판 > 시스템 설정 > 네트워크 > TCP/IP
- IP 주소 확인
```

---

### **Step 4: NFS 서비스 활성화**

NAS 관리 페이지에서:

#### **Synology NAS**
```
1. 제어판 > 파일 서비스 > NFS
2. "NFS 서비스 활성화" 체크
3. "NFSv3 활성화" 체크 (macOS 호환성)
```

#### **QNAP NAS**
```
1. 제어판 > 네트워크 및 파일 서비스 > Win/Mac/NFS
2. "NFS 서비스 활성화" 체크
```

---

### **Step 5: NFS Export 설정**

#### **Synology NAS**
```
1. 제어판 > 공유 폴더 > [aos_ext 폴더 선택]
2. 편집 > NFS 권한
3. 생성 클릭:
   - 호스트 이름 또는 IP: 172.23.25.171 (또는 172.23.24.0/22)
   - 권한: 읽기/쓰기
   - Squash: 루트 권한을 admin에 매핑
   - 보안: sys
   - "비동기" 체크 (성능 향상)
```

#### **QNAP NAS**
```
1. 제어판 > 권한 설정 > 공유 폴더
2. [aos_ext 폴더] > NFS 호스트 액세스
3. 액세스 권한 추가:
   - IP: 172.23.25.171/22
   - 권한: 읽기/쓰기
```

---

### **Step 6: 방화벽 설정**

#### **NAS 방화벽**
```
다음 포트 개방:
- 111 (RPC)
- 2049 (NFS)
- 4045 (NFS Lock Manager)
```

#### **macOS 방화벽**
```bash
# 시스템 설정 > 네트워크 > 방화벽
# NFS 클라이언트 허용 확인
```

---

## 🧪 테스트 명령어

IP 주소가 확인되면 다음 명령어로 테스트:

```bash
# 네트워크 연결
ping -c 3 <NAS-IP>

# NFS export 확인
showmount -e <NAS-IP>

# 예상 출력:
# Exports list on <NAS-IP>:
# /aos_ext    172.23.25.171

# NFS 포트 확인
nc -zv <NAS-IP> 2049
nc -zv <NAS-IP> 111

# 수동 마운트 테스트
sudo mkdir -p /Volumes/nas_test
sudo mount -t nfs <NAS-IP>:/aos_ext /Volumes/nas_test
ls /Volumes/nas_test
sudo umount /Volumes/nas_test
```

---

## 📝 임시 해결책 (NAS 접근 불가 시)

NAS 서버에 접근할 수 없는 동안 로컬에서 API를 사용하려면:

### **옵션 1: 로컬 디렉토리 그대로 사용**
```bash
cd /Users/yongwook/workspace/AgenticWorkflow/mms_extractor_exp

# 현재 dag_images 디렉토리가 있으면 그대로 사용
# 이미지는 로컬에 저장됨

# API 서버 실행
python api.py
```

### **옵션 2: 다른 NAS/공유 스토리지 사용**
다른 접근 가능한 네트워크 스토리지가 있다면:
```bash
# 스크립트의 IP 주소 변경
nano scripts/setup_nas_mount.sh
# NAS_IP="172.27.7.58" -> NAS_IP="<새-IP>"
```

---

## 📞 추가 지원 필요 시

다음 정보를 확인해 주세요:

### **확인 사항**
```
1. NAS 제조사 및 모델명: _______________
2. NAS 관리자 ID/PW: _______________
3. NAS 물리적 위치: _______________
4. 네트워크 관리자 연락처: _______________
```

### **수집할 정보**
```bash
# 현재 네트워크 정보
ifconfig
netstat -rn
arp -a

# NAS 서버 스캔 (nmap 설치 후)
nmap -sn 172.23.24.0/22 > network_scan.txt
```

---

## 🎯 결론

**현재 상태**: ❌ NAS 서버 172.27.7.58에 접근 불가

**최우선 조치**:
1. ✅ NAS 서버 전원 및 네트워크 연결 확인
2. ✅ NAS 서버 실제 IP 주소 확인
3. ✅ NFS 서비스 활성화 확인

**문의**: 네트워크 관리자 또는 NAS 관리자에게 문의 필요

---

**작성일**: 2024-10-14  
**작성자**: MMS Extractor Team

