# CoT + Self-Refinement 하이브리드 DAG 추출 프롬프트

## 작업 목표
통신사 광고 메시지에서 **핵심 행동 흐름**을 추출하여 간결한 DAG(Directed Acyclic Graph) 형식으로 표현

## 핵심 원칙
1. **연쇄적 사고 (CoT)**: 각 단계의 추론 과정을 명시적으로 드러내기
2. **반복적 개선 (Self-Refinement)**: 체계적인 자기 검증과 개선
3. **최소 경로 원칙**: 동일한 결과를 얻는 가장 짧은 경로만 표현
4. **핵심 흐름 우선**: 부가적 설명보다 주요 행동 연쇄에 집중
5. **중복 제거**: 의미가 겹치는 노드는 하나로 통합

## 출력 형식
```
(개체명:기대행동) -[관계동사]-> (개체명:기대행동)
```

## 개체명 카테고리
### 필수 추출 대상
- **제품/서비스**: 구체적 제품명, 서비스명, 요금제명
- **핵심 혜택**: 금전적 혜택, 사은품, 할인
- **행동 장소**: 온/오프라인 채널 (필요 시만)

### 추출 제외 대상
- 광고 대상자 (예: "아이폰 고객님")
- 일정/기간 정보
- 부가 설명 기능 (핵심 흐름과 무관한 경우)
- 법적 고지사항

## 기대 행동 (10개 표준 동사)
`구매, 가입, 사용, 방문, 참여, 등록, 다운로드, 확인, 수령, 적립`

## 관계 동사 우선순위
### 1순위: 조건부 관계
- `가입하면`, `구매하면`, `사용하면`
- `가입후`, `구매후`, `사용후`

### 2순위: 결과 관계
- `받다`, `수령하다`, `적립하다`

### 3순위: 경로 관계 (필요 시만)
- `통해`, `이용하여`

## 복수 Root Node 처리 가이드

### 복수 Root Node가 필요한 상황
1. **독립적 진입 채널**: 온라인/오프라인 별도 시작점
2. **다중 가치 제안**: 서로 다른 혜택을 위한 독립적 경로
3. **고객 세그먼트별**: 신규/기존 고객의 다른 시작점
4. **시간적 분리**: 즉시 혜택 vs 장기 혜택의 별도 흐름

### 단일 vs 복수 Root 판단 기준
```
단일 Root 선택 조건:
✓ 모든 가치가 하나의 행동에서 시작
✓ 고객의 진입점이 명확히 하나
✓ 순차적 흐름이 자연스러움

복수 Root 선택 조건:
✓ 독립적인 여러 가치 흐름 존재
✓ 서로 다른 진입 채널 제공
✓ 병렬적 혜택 획득 가능
✓ 고객 선택권이 다양함
```

### 복수 Root Node 구조 예시
```
# 예시 1: 채널별 독립 진입
(매장:방문) -[방문하여]-> (상담:확인) -[확인후]-> (할인혜택:수령)
(온라인몰:접속) -[접속하여]-> (제품:구매) -[구매시]-> (사은품:수령)

# 예시 2: 가치별 독립 흐름
(이벤트:참여) -[참여하면]-> (즉시혜택:수령)
(서비스:가입) -[가입하면]-> (장기혜택:적립)

# 예시 3: 통합 지점이 있는 복수 시작
(매장:방문) -[방문하여]-> (제품구매:확인)
(온라인:접속) -[접속하여]-> (제품구매:확인)
(제품구매:확인) -[구매하면]-> (통합혜택:수령)
```

## CoT + Self-Refinement 하이브리드 프로세스

### 🧠 Phase 1: Chain of Thought - 단계별 추론

#### CoT Step 1: 메시지 해체 및 핵심 요소 식별
```
💭 사고 과정:
"이 메시지를 읽으면서 내가 어떤 생각의 흐름을 따르고 있는가?"

1. 첫 인상: [메시지를 처음 읽었을 때 떠오른 생각]
2. 키워드 포착: [자동으로 눈에 들어온 핵심 단어들]
   → 왜 이 단어들이 눈에 띄었는가? [근거]
3. 메시지 유형 추론: [제품출시/혜택안내/이벤트/매장안내]
   → 어떤 단서로 이 유형이라고 판단했는가? [추론 근거]
4. 광고주 의도 추론: [광고주가 고객에게 바라는 최종 행동]
   → 이렇게 생각한 이유는? [논리적 연결고리]
```

#### CoT Step 2: 고객 관점에서의 가치 인식 추론
```
💭 사고 과정:
"만약 내가 이 메시지를 받은 고객이라면 어떤 생각을 할 것인가?"

1. 즉각적 반응: [메시지를 본 순간의 첫 반응]
   → 왜 이런 반응이 나올까? [심리적 근거]
2. 관심 요소 식별: [고객이 관심을 가질 만한 요소들]
   → 각 요소가 매력적인 이유는? [가치 분석]
3. 의사결정 과정 추론: [고객이 행동을 결정하기까지의 사고 과정]
   → 어떤 단계를 거쳐 결정할까? [단계별 추론]
4. 장벽 요소 식별: [고객이 망설일 수 있는 요소들]
   → 이런 장벽이 생기는 이유는? [심리적 분석]
```

#### CoT Step 3: 행동 경로 추론 - 다중 시나리오
```
💭 사고 과정:
"고객이 실제로 어떤 경로를 따라 행동할 것인가?"

시나리오 A: 적극적 고객 (즉시 행동)
- 사고 흐름: [메시지 인지] → [관심 증가] → [즉시 행동] → [결과 획득]
- 각 단계의 심리: [왜 이렇게 생각하고 행동할까?]

시나리오 B: 신중한 고객 (정보 수집 후 행동)
- 사고 흐름: [메시지 인지] → [정보 탐색] → [비교 검토] → [결정] → [행동]
- 각 단계의 심리: [왜 이런 과정을 거칠까?]

시나리오 C: 수동적 고객 (외부 자극 필요)
- 사고 흐름: [메시지 인지] → [관심 있지만 미루기] → [추가 자극] → [행동]
- 각 단계의 심리: [어떤 추가 자극이 필요할까?]

→ 가장 일반적인 시나리오는? [근거와 함께]
```

#### CoT Step 4: DAG 구조 추론 - 논리적 연결
```
💭 사고 과정:
"앞서 추론한 내용들을 어떻게 DAG로 연결할 것인가?"

1. Root Node(s) 결정 추론:
   - 후보들: [앞 단계에서 식별된 모든 시작점들]
   - 단일 vs 복수 Root 판단: "독립적인 진입점이 여러 개 존재하는가?"
     * 단일 Root 케이스: 모든 흐름이 하나의 시작점에서 출발
     * 복수 Root 케이스: 독립적인 여러 가치 흐름이 병렬로 존재
   - 각 Root의 정당성: "왜 이것들이 독립적인 시작점인가?"
   - Root 간 관계 분석: "이들 Root 노드들 사이에 연결이 필요한가?"

2. 병렬 흐름 vs 통합 흐름 결정:
   - 병렬 흐름: 독립적으로 진행되는 여러 가치 사슬
   - 통합 흐름: 어느 시점에서 합쳐지는 흐름들
   - 선택 근거: "왜 이런 구조가 적절한가?"

3. 중간 노드 연결 추론:
   - 각 연결의 논리: "A에서 B로 가는 것이 자연스러운 이유는?"
   - 대안 경로 고려: "다른 연결 방식도 가능하지만 왜 이것을 선택했는가?"
   - 교차 연결 검토: "서로 다른 흐름 간 연결점이 있는가?"

4. 관계 동사 선택 추론:
   - 각 관계의 의미: "이 관계 동사가 정확히 무엇을 표현하는가?"
   - 우선순위 적용: "왜 이 우선순위를 따랐는가?"
```

### 🔄 Phase 2: Self-Refinement - 체계적 개선

#### Refinement Cycle 1: 구조적 완성도 검증
```
🔍 검증 질문:
"내가 만든 DAG가 정말 완전한가?"

1. Root Node(s) 구조 검증:
   - Root 노드 수 적절성: [단일/복수 Root가 적절한가?]
   - 독립성 검증: [각 Root가 진정 독립적인가?]
   - 누락된 진입점: [다른 시작 방법이 있는가?]
   - 불필요한 Root: [통합 가능한 Root가 있는가?]

2. 누락 요소 탐지:
   - 체크리스트: [모든 핵심 요소가 포함되었는가?]
   - 발견된 누락: [무엇이 빠졌는가?]
   - 누락 원인 분석: [왜 놓쳤는가?]
   - 보완 방안: [어떻게 추가할 것인가?]

3. 중복 요소 제거:
   - 중복 발견: [의미가 겹치는 노드들]
   - 통합 논리: [어떻게 하나로 합칠 것인가?]
   - 통합 후 검증: [의미 손실이 없는가?]

4. 병렬 흐름 검증:
   - 독립적 가치 흐름: [각 흐름이 독립적 가치를 제공하는가?]
   - 교차점 확인: [흐름들 간 교차 연결이 필요한가?]
   - 균형성 검토: [각 흐름의 중요도가 균형적인가?]

수정된 DAG v1.1: [개선 사항 반영]
```

#### Refinement Cycle 2: 논리적 일관성 검증
```
🔍 검증 질문:
"내가 만든 DAG의 논리가 일관성 있는가?"

1. 인과관계 검증:
   - 각 연결 점검: "A → B 연결이 논리적으로 타당한가?"
   - 문제 발견: [논리적 모순이나 부자연스러운 연결]
   - 원인 분석: [왜 이런 문제가 생겼는가?]
   - 해결 방안: [어떻게 수정할 것인가?]

2. 시간 순서 검증:
   - 시간적 흐름: [시간 순서가 맞는가?]
   - 동시성 처리: [동시에 일어나는 것들은 적절히 표현되었는가?]

3. 조건-결과 관계 검증:
   - 조건의 명확성: [조건이 명확히 표현되었는가?]
   - 결과의 적절성: [결과가 조건에 부합하는가?]

수정된 DAG v1.2: [논리적 일관성 개선]
```

#### Refinement Cycle 3: 실용적 타당성 검증
```
🔍 검증 질문:
"실제 고객이 이 경로를 따를 것인가?"

1. 현실성 검토:
   - 각 단계의 현실성: [실제로 이런 행동을 할까?]
   - 장벽 요소 고려: [실행을 방해하는 요소들은?]
   - 동기 부족 지점: [동기가 약해질 수 있는 지점은?]

2. 비즈니스 관점 검토:
   - 비즈니스 목표 부합: [광고주의 목표에 부합하는가?]
   - 경쟁력 표현: [차별화 요소가 드러나는가?]
   - ROI 관점: [투자 대비 효과가 명확한가?]

수정된 DAG v1.3: [실용성 개선]
```

### 🎯 Phase 3: CoT + Refinement 통합 - 최종 최적화

#### 통합 추론: 전체적 관점에서 재검토
```
💭 종합적 사고 과정:
"지금까지의 모든 추론과 개선을 종합해보면?"

1. 추론 일관성 검토:
   - Phase 1의 추론과 Phase 2의 개선이 일치하는가?
   - 모순되는 부분은 없는가?
   - 어떤 부분에서 생각이 바뀌었고, 그 이유는?

2. 최적화 기회 탐색:
   - 더 간결하게 표현할 방법은?
   - 더 명확하게 표현할 방법은?
   - 더 강력하게 표현할 방법은?

3. 대안 시나리오 최종 검토:
   - 다른 접근법도 여전히 유효한가?
   - 현재 선택이 최선인 근거는?
   - 미래에 다르게 접근할 상황은?
```

## 하이브리드 출력 형식

### 1. CoT - 단계별 추론 과정
```
🧠 Phase 1: 연쇄적 사고 과정

[CoT Step 1: 메시지 해체]
💭 첫 인상: 
💭 키워드 포착: 
💭 메시지 유형 추론: 
💭 광고주 의도 추론: 

[CoT Step 2: 고객 관점 추론]
💭 즉각적 반응: 
💭 관심 요소: 
💭 의사결정 과정: 
💭 장벽 요소: 

[CoT Step 3: 행동 경로 추론]
💭 시나리오 A (적극적): 
💭 시나리오 B (신중한): 
💭 시나리오 C (수동적): 
💭 선택된 주요 시나리오와 근거: 

[CoT Step 4: DAG 구조 추론]
💭 Root Node(s) 결정 논리: [단일/복수 Root 선택과 근거]
💭 병렬 흐름 vs 통합 흐름 결정: [구조 선택 이유]
💭 중간 노드 연결 논리: 
💭 관계 동사 선택 논리: 

초기 DAG v1.0:
[추론 기반 초기 DAG]
```

### 2. Self-Refinement - 체계적 개선 과정
```
🔄 Phase 2: 자기 개선 과정

[Refinement Cycle 1: 구조적 완성도]
🔍 누락 요소 탐지: 
🔍 중복 요소 제거: 
🔍 개선 사항: 
수정된 DAG v1.1: [개선사항 반영]

[Refinement Cycle 2: 논리적 일관성]
🔍 인과관계 검증: 
🔍 시간 순서 검증: 
🔍 조건-결과 관계 검증: 
수정된 DAG v1.2: [논리적 일관성 개선]

[Refinement Cycle 3: 실용적 타당성]
🔍 현실성 검토: 
🔍 비즈니스 관점 검토: 
🔍 개선 사항: 
수정된 DAG v1.3: [실용성 개선]
```

### 3. 통합 최종 결과
```
🎯 Phase 3: 통합 최적화

[종합적 추론 검토]
💭 추론 일관성: 
💭 최적화 기회: 
💭 대안 검토: 

[최종 DAG]
[완전히 최적화된 최종 DAG]

[품질 자체 평가]
- 완성도: X/5 (근거: )
- 간결성: X/5 (근거: )
- 논리성: X/5 (근거: )
- 실용성: X/5 (근거: )
- 차별성: X/5 (근거: )
- 총점: X/25

[메타 학습]
💡 이번 과정에서 배운 것: 
💡 다음에 더 잘할 수 있는 것: 
💡 일반화 가능한 원칙: 
```

## 실행 지침

### CoT 실행 원칙
1. **사고 과정 가시화**: 모든 추론 단계를 💭로 명시
2. **논리적 연결**: 각 단계가 이전 단계의 결과를 활용
3. **다중 관점**: 고객, 광고주, 비즈니스 관점 모두 고려
4. **근거 명시**: 모든 판단에 대한 이유 제시

### Self-Refinement 실행 원칙
1. **체계적 검증**: 구조 → 논리 → 실용성 순서로 검증
2. **구체적 개선**: 추상적 평가가 아닌 구체적 수정
3. **반복적 적용**: 각 cycle에서 실제 개선 수행
4. **품질 추적**: 버전별 개선 사항 명확히 기록

### 통합 원칙
1. **일관성 유지**: CoT와 Refinement 결과가 조화
2. **투명성**: 모든 사고와 개선 과정 공개
3. **학습 중심**: 결과뿐만 아니라 과정에서의 학습 중시
4. **적응성**: 메시지 특성에 따른 유연한 적용

**핵심**: 이 프롬프트는 **생각하는 과정(CoT)**과 **개선하는 과정(Self-Refinement)**을 명확히 분리하면서도 유기적으로 연결하여, 더 깊이 있고 완성도 높은 DAG를 생성하는 것을 목표로 합니다.

## message:
{msg}
