# Self-Refinement 기반 개선된 DAG 추출 프롬프트

## 작업 목표
통신사 광고 메시지에서 **핵심 행동 흐름**을 추출하여 간결한 DAG(Directed Acyclic Graph) 형식으로 표현

## 핵심 원칙
1. **최소 경로 원칙**: 동일한 결과를 얻는 가장 짧은 경로만 표현
2. **핵심 흐름 우선**: 부가적 설명보다 주요 행동 연쇄에 집중
3. **중복 제거**: 의미가 겹치는 노드는 하나로 통합
4. **메타인지적 성찰**: 각 결정에 대한 근거와 대안 고려
5. **반복적 개선**: 체계적인 자기 검증과 개선

## 출력 형식
```
(개체명:기대행동) -[관계동사]-> (개체명:기대행동)
```

## 개체명 카테고리
### 필수 추출 대상
- **제품/서비스**: 구체적 제품명, 서비스명, 요금제명
- **핵심 혜택**: 금전적 혜택, 사은품, 할인
- **행동 장소**: 온/오프라인 채널 (필요 시만)

### 추출 제외 대상
- 광고 대상자 (예: "아이폰 고객님")
- 일정/기간 정보
- 부가 설명 기능 (핵심 흐름과 무관한 경우)
- 법적 고지사항

## 기대 행동 (10개 표준 동사)
`구매, 가입, 사용, 방문, 참여, 등록, 다운로드, 확인, 수령, 적립`

## 관계 동사 우선순위
### 1순위: 조건부 관계
- `가입하면`, `구매하면`, `사용하면`
- `가입후`, `구매후`, `사용후`

### 2순위: 결과 관계
- `받다`, `수령하다`, `적립하다`

### 3순위: 경로 관계 (필요 시만)
- `통해`, `이용하여`

## Self-Refinement 기반 분석 프로세스

### Phase 1: 초기 분석 및 다중 접근법 탐색

#### Step 1: 메시지 유형 분류 및 맥락 이해
- **메시지 유형 식별**: [제품 출시/혜택 안내/이벤트/매장 안내] 중 분류
- **타겟 고객층 파악**: 메시지가 겨냥하는 주요 고객층
- **핵심 의도 요약**: 한 문장으로 광고주의 핵심 목적 서술
- **메타인지적 질문**: "이 메시지가 다른 유형이라면 어떻게 접근해야 할까?"

#### Step 2: 다중 가치 제안 탐색
- **명시적 혜택**: 직접 언급된 혜택들
- **암시적 혜택**: 함축적으로 제시된 가치들
- **경쟁 가치**: 상충할 수 있는 여러 선택지
- **대안적 해석**: "이 혜택을 다르게 해석할 수 있는 방법은?"

#### Step 3: 다양한 Root Node 후보 생성
- **후보 1**: 매장/온라인 접점 기반 시작
- **후보 2**: 고객 의도 기반 시작 (정보 탐색 → 구매)
- **후보 3**: 혜택 중심 역추적 시작
- **비교 분석**: 각 후보의 장단점과 적합성 평가
- **메타인지적 성찰**: "왜 이 Root Node가 가장 적절한가?"

### Phase 2: 초기 DAG 구성 및 대안 탐색

#### Step 4: 다중 DAG 후보 생성
```
# 접근법 A: 고객 여정 중심
(매장:방문) → (상담:확인) → (제품:구매) → (혜택:수령)

# 접근법 B: 혜택 중심
(이벤트:참여) → (조건:충족) → (혜택:수령)

# 접근법 C: 서비스 가치 중심
(서비스:가입) → (기능:사용) → (만족도:향상)
```

#### Step 5: 정량적 품질 평가
각 DAG 후보를 다음 기준으로 점수화 (1-5점):
- **완성도**: 모든 핵심 요소 포함 여부
- **간결성**: 불필요한 노드 제거 정도
- **논리성**: 인과관계의 명확성
- **실용성**: 실제 고객 행동과의 일치도
- **차별성**: 다른 광고와 구분되는 특징
- **총점 및 선택 근거**

### Phase 3: 체계적 자기 검증 및 개선

#### Step 6: 다층적 검증 프로세스

##### Level 1: 구조적 검증
- □ Root Node가 명확히 식별되었는가?
- □ 모든 독립적 가치 제안이 포함되었는가?
- □ 주요 기능들이 적절히 그룹화되었는가?
- □ 각 경로가 명확한 가치를 전달하는가?
- □ 전체 구조가 간결하고 이해하기 쉬운가?
- □ 관계 동사가 우선순위에 맞게 사용되었는가?

##### Level 2: 논리적 검증
- □ 시간적 순서가 논리적으로 타당한가?
- □ 조건-결과 관계가 명확한가?
- □ 순환 종속성이 없는가?
- □ 모든 경로가 의미 있는 결과로 이어지는가?

##### Level 3: 실용적 검증
- □ 실제 고객이 이 경로를 따를 가능성이 높은가?
- □ 경쟁사 대비 차별화 요소가 드러나는가?
- □ 광고의 핵심 메시지가 효과적으로 전달되는가?

#### Step 7: 메타인지적 성찰 및 개선
- **실패 분석**: "어떤 부분에서 실수했고, 왜 그런 실수를 했는가?"
- **대안 탐색**: "다른 방식으로 접근했다면 어떤 결과가 나왔을까?"
- **학습 추출**: "이 경험에서 얻은 교훈은 무엇인가?"
- **일반화**: "비슷한 유형의 메시지에 적용할 수 있는 패턴은?"

#### Step 8: 반복적 개선 (최대 3회)
각 반복에서:
1. **구체적 문제 식별**: 정확히 무엇이 문제인가?
2. **근본 원인 분석**: 왜 이 문제가 발생했는가?
3. **다중 해결책 생성**: 3가지 이상의 개선 방안
4. **최적 해결책 선택**: 근거와 함께
5. **개선 효과 예측**: 이 수정으로 어떤 개선을 기대하는가?

### Phase 4: 최종 검증 및 메타 학습

#### Step 9: 홀리스틱 품질 평가
- **내적 일관성**: 모든 구성 요소가 조화롭게 작동하는가?
- **외적 타당성**: 실제 비즈니스 맥락에서 의미가 있는가?
- **확장 가능성**: 다른 유사한 케이스에 적용 가능한가?

#### Step 10: 메타 학습 및 패턴 추출
- **성공 요인**: 이번 분석에서 잘된 점은?
- **개선 영역**: 다음에 더 잘할 수 있는 부분은?
- **일반화 가능한 인사이트**: 다른 케이스에도 적용할 수 있는 원칙은?

## 개선된 출력 형식

### 1. 메시지 분석 및 다중 접근법 탐색
```
[메시지 유형]: 
[핵심 의도]: 
[가치 제안 후보들]:
- 명시적: 
- 암시적: 
[Root Node 후보 3가지와 선택 근거]:
```

### 2. 다중 DAG 후보 및 평가
```
[접근법 A - 설명]:
[DAG A 구조]
[평가 점수]: 완성도 X/5, 간결성 X/5, 논리성 X/5, 실용성 X/5, 차별성 X/5

[접근법 B - 설명]:
[DAG B 구조]
[평가 점수]: 완성도 X/5, 간결성 X/5, 논리성 X/5, 실용성 X/5, 차별성 X/5

[최종 선택 및 근거]:
```

### 3. 체계적 검증 결과
```
[구조적 검증]: ✓/✗ 각 항목별 상세 평가
[논리적 검증]: ✓/✗ 각 항목별 상세 평가  
[실용적 검증]: ✓/✗ 각 항목별 상세 평가
[식별된 문제점 및 근본 원인]:
```

### 4. 개선 과정 (반복 시)
```
[반복 1]
- 문제: 
- 원인: 
- 해결책 후보들: 
- 선택된 해결책 및 근거:
- 개선된 DAG:
- 예상 효과:

[반복 2] (필요시)
...
```

### 5. 최종 DAG 및 메타 학습
```
[최종 DAG]:

[홀리스틱 품질 평가]:
- 내적 일관성: 
- 외적 타당성: 
- 확장 가능성: 

[메타 학습]:
- 성공 요인: 
- 개선 영역: 
- 일반화 가능한 인사이트: 
```

## 실행 지침

1. **철저한 탐색**: 단일 답안에 만족하지 말고 다양한 접근법 시도
2. **메타인지적 사고**: 각 결정에 대해 "왜?"라고 질문하기
3. **정량적 평가**: 주观적 판단을 객관적 점수로 보완
4. **반복적 개선**: 완벽할 때까지 계속 개선
5. **학습 중심**: 단순한 답안 생성이 아닌 학습과 성장에 초점
6. **투명성**: 모든 사고 과정과 의사결정 근거 명시

## 품질 메트릭

### 정량적 지표
- DAG 완성도 점수: /25점 (5개 영역 × 5점)
- 검증 통과율: /100% (모든 검증 항목 통과)
- 개선 횟수: 품질 향상을 위한 반복 횟수
- 대안 탐색 수: 고려한 접근법의 다양성

### 정성적 지표
- 메타인지적 성찰의 깊이
- 근거의 논리적 타당성
- 학습 추출의 유용성
- 일반화 가능성

**중요**: 이 프롬프트는 단순한 DAG 생성이 아닌, **self-refinement를 통한 지속적 학습과 개선**을 목표로 합니다. 각 단계에서 깊이 있게 사고하고, 다양한 관점을 탐색하며, 체계적으로 개선해 나가세요.

## message:
{msg}
